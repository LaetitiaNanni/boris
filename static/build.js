(function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var h=typeof require=="function"&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i})({1:[function(e,t,r){"use strict";t.exports.Composer=e("./src/Composer");t.exports.CopyPass=e("./src/passes/copy/CopyPass");t.exports.BlendMode={Normal:1,Dissolve:2,Darken:3,Multiply:4,ColorBurn:5,LinearBurn:6,DarkerColor:7,Lighten:8,Screen:9,ColorDodge:10,LinearDodge:11,LighterColor:12,Overlay:13,SoftLight:14,HardLight:15,VividLight:16,LinearLight:17,PinLight:18,HardMix:19,Difference:20,Exclusion:21,Substract:22,Divide:23}},{"./src/Composer":3,"./src/passes/copy/CopyPass":11}],2:[function(e,t,r){var n=n||{};var i={REVISION:"73"};if(typeof define==="function"&&define.amd){define("three",i)}else if("undefined"!==typeof r&&"undefined"!==typeof t){t.exports=i}if(n.requestAnimationFrame===undefined||n.cancelAnimationFrame===undefined){(function(){var e=0;var t=["ms","moz","webkit","o"];for(var r=0;r<t.length&&!n.requestAnimationFrame;++r){n.requestAnimationFrame=n[t[r]+"RequestAnimationFrame"];n.cancelAnimationFrame=n[t[r]+"CancelAnimationFrame"]||n[t[r]+"CancelRequestAnimationFrame"]}if(n.requestAnimationFrame===undefined&&n.setTimeout!==undefined){n.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e));var a=n.setTimeout(function(){t(r+i)},i);e=r+i;return a}}if(n.cancelAnimationFrame===undefined&&n.clearTimeout!==undefined){n.cancelAnimationFrame=function(e){n.clearTimeout(e)}}})()}if(n.performance===undefined){n.performance={}}if(n.performance.now===undefined){(function(){var e=Date.now();n.performance.now=function(){return Date.now()-e}})()}if(Number.EPSILON===undefined){Number.EPSILON=Math.pow(2,-52)}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:+e}}if(Function.prototype.name===undefined&&Object.defineProperty!==undefined){Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}})}i.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};i.CullFaceNone=0;i.CullFaceBack=1;i.CullFaceFront=2;i.CullFaceFrontBack=3;i.FrontFaceDirectionCW=0;i.FrontFaceDirectionCCW=1;i.BasicShadowMap=0;i.PCFShadowMap=1;i.PCFSoftShadowMap=2;i.FrontSide=0;i.BackSide=1;i.DoubleSide=2;i.FlatShading=1;i.SmoothShading=2;i.NoColors=0;i.FaceColors=1;i.VertexColors=2;i.NoBlending=0;i.NormalBlending=1;i.AdditiveBlending=2;i.SubtractiveBlending=3;i.MultiplyBlending=4;i.CustomBlending=5;i.AddEquation=100;i.SubtractEquation=101;i.ReverseSubtractEquation=102;i.MinEquation=103;i.MaxEquation=104;i.ZeroFactor=200;i.OneFactor=201;i.SrcColorFactor=202;i.OneMinusSrcColorFactor=203;i.SrcAlphaFactor=204;i.OneMinusSrcAlphaFactor=205;i.DstAlphaFactor=206;i.OneMinusDstAlphaFactor=207;i.DstColorFactor=208;i.OneMinusDstColorFactor=209;i.SrcAlphaSaturateFactor=210;i.NeverDepth=0;i.AlwaysDepth=1;i.LessDepth=2;i.LessEqualDepth=3;i.EqualDepth=4;i.GreaterEqualDepth=5;i.GreaterDepth=6;i.NotEqualDepth=7;i.MultiplyOperation=0;i.MixOperation=1;i.AddOperation=2;i.UVMapping=300;i.CubeReflectionMapping=301;i.CubeRefractionMapping=302;i.EquirectangularReflectionMapping=303;i.EquirectangularRefractionMapping=304;i.SphericalReflectionMapping=305;i.RepeatWrapping=1e3;i.ClampToEdgeWrapping=1001;i.MirroredRepeatWrapping=1002;i.NearestFilter=1003;i.NearestMipMapNearestFilter=1004;i.NearestMipMapLinearFilter=1005;i.LinearFilter=1006;i.LinearMipMapNearestFilter=1007;i.LinearMipMapLinearFilter=1008;i.UnsignedByteType=1009;i.ByteType=1010;i.ShortType=1011;i.UnsignedShortType=1012;i.IntType=1013;i.UnsignedIntType=1014;i.FloatType=1015;i.HalfFloatType=1025;i.UnsignedShort4444Type=1016;i.UnsignedShort5551Type=1017;i.UnsignedShort565Type=1018;i.AlphaFormat=1019;i.RGBFormat=1020;i.RGBAFormat=1021;i.LuminanceFormat=1022;i.LuminanceAlphaFormat=1023;i.RGBEFormat=i.RGBAFormat;i.RGB_S3TC_DXT1_Format=2001;i.RGBA_S3TC_DXT1_Format=2002;i.RGBA_S3TC_DXT3_Format=2003;i.RGBA_S3TC_DXT5_Format=2004;i.RGB_PVRTC_4BPPV1_Format=2100;i.RGB_PVRTC_2BPPV1_Format=2101;i.RGBA_PVRTC_4BPPV1_Format=2102;i.RGBA_PVRTC_2BPPV1_Format=2103;i.LoopOnce=2200;i.LoopRepeat=2201;i.LoopPingPong=2202;i.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};i.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};i.Color=function(e){if(arguments.length===3){return this.fromArray(arguments)}return this.set(e)};i.Color.prototype={constructor:i.Color,r:1,g:1,b:1,set:function(e){if(e instanceof i.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,r){this.r=e;this.g=t;this.b=r;return this},setHSL:function(){function e(e,t,r){if(r<0)r+=1;if(r>1)r-=1;if(r<1/6)return e+(t-e)*6*r;if(r<1/2)return t;if(r<2/3)return e+(t-e)*6*(2/3-r);return e}return function(t,r,n){t=i.Math.euclideanModulo(t,1);r=i.Math.clamp(r,0,1);n=i.Math.clamp(n,0,1);if(r===0){this.r=this.g=this.b=n}else{var a=n<=.5?n*(1+r):n+r-n*r;var o=2*n-a;this.r=e(o,a,t+1/3);this.g=e(o,a,t);this.b=e(o,a,t-1/3)}return this}}(),setStyle:function(e){function t(t){if(t===undefined)return;if(parseFloat(t)<1){console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n;var a=r[1];var o=r[2];switch(a){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){this.r=Math.min(255,parseInt(n[1],10))/255;this.g=Math.min(255,parseInt(n[2],10))/255;this.b=Math.min(255,parseInt(n[3],10))/255;t(n[5]);return this}if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){this.r=Math.min(100,parseInt(n[1],10))/100;this.g=Math.min(100,parseInt(n[2],10))/100;this.b=Math.min(100,parseInt(n[3],10))/100;t(n[5]);return this}break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(n[1])/360;var h=parseInt(n[2],10)/100;var u=parseInt(n[3],10)/100;t(n[5]);return this.setHSL(s,h,u)}break}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=r[1];var c=l.length;if(c===3){this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255;this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255;this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255;return this}else if(c===6){this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255;this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255;this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255;return this}}if(e&&e.length>0){var l=i.ColorKeywords[e];if(l!==undefined){this.setHex(l)}else{console.warn("THREE.Color: Unknown color "+e)}}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e,t){if(t===undefined)t=2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},copyLinearToGamma:function(e,t){if(t===undefined)t=2;var r=t>0?1/t:1;this.r=Math.pow(e.r,r);this.g=Math.pow(e.g,r);this.b=Math.pow(e.b,r);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;this.r=e*e;this.g=t*t;this.b=r*r;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var r=this.r,n=this.g,i=this.b;var a=Math.max(r,n,i);var o=Math.min(r,n,i);var s,h;var u=(o+a)/2;if(o===a){s=0;h=0}else{var l=a-o;h=u<=.5?l/(a+o):l/(2-a-o);switch(a){case r:s=(n-i)/l+(n<i?6:0);break;case n:s=(i-r)/l+2;break;case i:s=(r-n)/l+4;break}s/=6}t.h=s;t.s=h;t.l=u;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,r){var n=this.getHSL();n.h+=e;n.s+=t;n.l+=r;this.setHSL(n.h,n.s,n.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){if(t===undefined)t=0;this.r=e[t];this.g=e[t+1];this.b=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e}};i.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};i.Quaternion=function(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._w=n!==undefined?n:1};i.Quaternion.prototype={constructor:i.Quaternion,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e;this.onChangeCallback()},set:function(e,t,r,n){this._x=e;this._y=t;this._z=r;this._w=n;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(e instanceof i.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=Math.cos(e._x/2);var n=Math.cos(e._y/2);var a=Math.cos(e._z/2);var o=Math.sin(e._x/2);var s=Math.sin(e._y/2);var h=Math.sin(e._z/2);var u=e.order;if(u==="XYZ"){this._x=o*n*a+r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a-o*s*h}else if(u==="YXZ"){this._x=o*n*a+r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a+o*s*h}else if(u==="ZXY"){this._x=o*n*a-r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a-o*s*h}else if(u==="ZYX"){this._x=o*n*a-r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a+o*s*h}else if(u==="YZX"){this._x=o*n*a+r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a-o*s*h}else if(u==="XZY"){this._x=o*n*a-r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a+o*s*h}if(t!==false)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);this._x=e.x*n;this._y=e.y*n;this._z=e.z*n;this._w=Math.cos(r);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],n=t[4],i=t[8],a=t[1],o=t[5],s=t[9],h=t[2],u=t[6],l=t[10],c=r+o+l,f;if(c>0){f=.5/Math.sqrt(c+1);this._w=.25/f;this._x=(u-s)*f;this._y=(i-h)*f;this._z=(a-n)*f}else if(r>o&&r>l){f=2*Math.sqrt(1+r-o-l);this._w=(u-s)/f;this._x=.25*f;this._y=(n+a)/f;this._z=(i+h)/f}else if(o>l){f=2*Math.sqrt(1+o-r-l);this._w=(i-h)/f;this._x=(n+a)/f;this._y=.25*f;this._z=(s+u)/f}else{f=2*Math.sqrt(1+l-r-o);this._w=(a-n)/f;this._x=(i+h)/f;this._y=(s+u)/f;this._z=.25*f}this.onChangeCallback();return this},setFromUnitVectors:function(){var e,t;var r=1e-6;return function(n,a){if(e===undefined)e=new i.Vector3;t=n.dot(a)+1;if(t<r){t=0;if(Math.abs(n.x)>Math.abs(n.z)){e.set(-n.y,n.x,0)}else{e.set(0,-n.z,n.y)}}else{e.crossVectors(n,a)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this.onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w;var o=t._x,s=t._y,h=t._z,u=t._w;this._x=r*u+a*o+n*h-i*s;this._y=n*u+a*s+i*o-r*h;this._z=i*u+a*h+r*s-n*o;this._w=a*u-r*o-n*s-i*h;this.onChangeCallback();return this},multiplyVector3:function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w;var o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=a;this._x=r;this._y=n;this._z=i;return this}var s=Math.acos(o);var h=Math.sqrt(1-o*o);if(Math.abs(h)<.001){this._w=.5*(a+this._w);this._x=.5*(r+this._x);this._y=.5*(n+this._y);this._z=.5*(i+this._z);return this}var u=Math.sin((1-t)*s)/h,l=Math.sin(t*s)/h;this._w=a*u+this._w*l;this._x=r*u+this._x*l;this._y=n*u+this._y*l;this._z=i*u+this._z*l;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){}};i.Quaternion.slerp=function(e,t,r,n){return r.copy(e).slerp(t,n)};i.Vector2=function(e,t){this.x=e||0;this.y=t||0};i.Vector2.prototype={constructor:i.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subScalar:function(e){this.x-=e;this.y-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){if(isFinite(e)){this.x*=e;this.y*=e}else{this.x=0;this.y=0}return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));return this},clampScalar:function(){var e,t;return function r(n,a){if(e===undefined){e=new i.Vector2;t=new i.Vector2}e.set(n,n);t.set(a,a);return this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();this.multiplyScalar(Math.max(e,Math.min(t,r))/r);return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];return this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t);var i=this.x-e.x;var a=this.y-e.y;this.x=i*r-a*n+e.x;this.y=i*n+a*r+e.y;return this}};i.Vector3=function(e,t,r){this.x=e||0;this.y=t||0;this.z=r||0};i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,r){this.x=e;this.y=t;this.z=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){if(isFinite(e)){this.x*=e;this.y*=e;this.z*=e}else{this.x=0;this.y=0;this.z=0}return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function t(r){if(r instanceof i.Euler===false){console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromEuler(r));return this}}(),applyAxisAngle:function(){var e;return function t(r,n){if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromAxisAngle(r,n));return this}}(),applyMatrix3:function(e){var t=this.x;var r=this.y;var n=this.z;var i=e.elements;this.x=i[0]*t+i[3]*r+i[6]*n;this.y=i[1]*t+i[4]*r+i[7]*n;this.z=i[2]*t+i[5]*r+i[8]*n;return this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z;var i=e.elements;this.x=i[0]*t+i[4]*r+i[8]*n+i[12];this.y=i[1]*t+i[5]*r+i[9]*n+i[13];this.z=i[2]*t+i[6]*r+i[10]*n+i[14];return this},applyProjection:function(e){var t=this.x,r=this.y,n=this.z;var i=e.elements;var a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a;this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a;this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a;return this},applyQuaternion:function(e){var t=this.x;var r=this.y;var n=this.z;var i=e.x;var a=e.y;var o=e.z;var s=e.w;var h=s*t+a*n-o*r;var u=s*r+o*t-i*n;var l=s*n+i*r-a*t;var c=-i*t-a*r-o*n;this.x=h*s+c*-i+u*-o-l*-a;this.y=u*s+c*-a+l*-i-h*-o;this.z=l*s+c*-o+h*-a-u*-i;return this},project:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.multiplyMatrices(r.projectionMatrix,e.getInverse(r.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z;var i=e.elements;this.x=i[0]*t+i[4]*r+i[8]*n;this.y=i[1]*t+i[5]*r+i[9]*n;this.z=i[2]*t+i[6]*r+i[10]*n;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));return this},clampScalar:function(){var e,t;return function r(n,a){if(e===undefined){e=new i.Vector3;t=new i.Vector3}e.set(n,n,n);t.set(a,a,a);return this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();this.multiplyScalar(Math.max(e,Math.min(t,r))/r);return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},cross:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var r=this.x,n=this.y,i=this.z;this.x=n*e.z-i*e.y;this.y=i*e.x-r*e.z;this.z=r*e.y-n*e.x;return this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z;var a=t.x,o=t.y,s=t.z;this.x=n*s-i*o;this.y=i*a-r*s;this.z=r*o-n*a;return this},projectOnVector:function(){var e,t;return function r(n){if(e===undefined)e=new i.Vector3;e.copy(n).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function t(r){if(e===undefined)e=new i.Vector3;e.copy(this).projectOnVector(r);return this.sub(e)}}(),reflect:function(){var e;return function t(r){if(e===undefined)e=new i.Vector3;return this.sub(e.copy(r).multiplyScalar(2*this.dot(r)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var r=this.y-e.y;var n=this.z-e.z;return t*t+r*r+n*n},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var r=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=r;this.z=n;return this},setFromMatrixColumn:function(e,t){var r=e*4;var n=t.elements;this.x=n[r];this.y=n[r+1];this.z=n[r+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];return this}};i.Vector4=function(e,t,r,n){this.x=e||0;this.y=t||0;this.z=r||0;this.w=n!==undefined?n:1};i.Vector4.prototype={constructor:i.Vector4,set:function(e,t,r,n){this.x=e;this.y=t;this.z=r;this.w=n;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){if(isFinite(e)){this.x*=e;this.y*=e;this.z*=e;this.w*=e}else{this.x=0;this.y=0;this.z=0;this.w=0}return this},applyMatrix4:function(e){var t=this.x;var r=this.y;var n=this.z;var i=this.w;var a=e.elements;this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i;this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i;
this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i;this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=.01,o=.1,s=e.elements,h=s[0],u=s[4],l=s[8],c=s[1],f=s[5],d=s[9],p=s[2],m=s[6],v=s[10];if(Math.abs(u-c)<a&&Math.abs(l-p)<a&&Math.abs(d-m)<a){if(Math.abs(u+c)<o&&Math.abs(l+p)<o&&Math.abs(d+m)<o&&Math.abs(h+f+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(h+1)/2;var y=(f+1)/2;var x=(v+1)/2;var b=(u+c)/4;var w=(l+p)/4;var _=(d+m)/4;if(g>y&&g>x){if(g<a){r=0;n=.707106781;i=.707106781}else{r=Math.sqrt(g);n=b/r;i=w/r}}else if(y>x){if(y<a){r=.707106781;n=0;i=.707106781}else{n=Math.sqrt(y);r=b/n;i=_/n}}else{if(x<a){r=.707106781;n=.707106781;i=0}else{i=Math.sqrt(x);r=w/i;n=_/i}}this.set(r,n,i,t);return this}var M=Math.sqrt((m-d)*(m-d)+(l-p)*(l-p)+(c-u)*(c-u));if(Math.abs(M)<.001)M=1;this.x=(m-d)/M;this.y=(l-p)/M;this.z=(c-u)/M;this.w=Math.acos((h+f+v-1)/2);return this},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);this.w=Math.min(this.w,e.w);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);this.w=Math.max(this.w,e.w);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));this.w=Math.max(e.w,Math.min(t.w,this.w));return this},clampScalar:function(){var e,t;return function r(n,a){if(e===undefined){e=new i.Vector4;t=new i.Vector4}e.set(n,n,n,n);t.set(a,a,a,a);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];this.w=e.array[t+3];return this}};i.Euler=function(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._order=n||i.Euler.DefaultOrder};i.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];i.Euler.DefaultOrder="XYZ";i.Euler.prototype={constructor:i.Euler,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e;this.onChangeCallback()},set:function(e,t,r,n){this._x=e;this._y=t;this._z=r;this._order=n||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t,r){var n=i.Math.clamp;var a=e.elements;var o=a[0],s=a[4],h=a[8];var u=a[1],l=a[5],c=a[9];var f=a[2],d=a[6],p=a[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(n(h,-1,1));if(Math.abs(h)<.99999){this._x=Math.atan2(-c,p);this._z=Math.atan2(-s,o)}else{this._x=Math.atan2(d,l);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-n(c,-1,1));if(Math.abs(c)<.99999){this._y=Math.atan2(h,p);this._z=Math.atan2(u,l)}else{this._y=Math.atan2(-f,o);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(n(d,-1,1));if(Math.abs(d)<.99999){this._y=Math.atan2(-f,p);this._z=Math.atan2(-s,l)}else{this._y=0;this._z=Math.atan2(u,o)}}else if(t==="ZYX"){this._y=Math.asin(-n(f,-1,1));if(Math.abs(f)<.99999){this._x=Math.atan2(d,p);this._z=Math.atan2(u,o)}else{this._x=0;this._z=Math.atan2(-s,l)}}else if(t==="YZX"){this._z=Math.asin(n(u,-1,1));if(Math.abs(u)<.99999){this._x=Math.atan2(-c,l);this._y=Math.atan2(-f,o)}else{this._x=0;this._y=Math.atan2(h,p)}}else if(t==="XZY"){this._z=Math.asin(-n(s,-1,1));if(Math.abs(s)<.99999){this._x=Math.atan2(d,l);this._y=Math.atan2(h,o)}else{this._x=Math.atan2(-c,p);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t)}this._order=t;if(r!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var e;return function(t,r,n){if(e===undefined)e=new i.Matrix4;e.makeRotationFromQuaternion(t);this.setFromRotationMatrix(e,r,n);return this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new i.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e},toVector3:function(e){if(e){return e.set(this._x,this._y,this._z)}else{return new i.Vector3(this._x,this._y,this._z)}},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){}};i.Line3=function(e,t){this.start=e!==undefined?e:new i.Vector3;this.end=t!==undefined?t:new i.Vector3};i.Line3.prototype={constructor:i.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new i.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new i.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r,n){e.subVectors(r,this.start);t.subVectors(this.end,this.start);var a=t.dot(t);var o=t.dot(e);var s=o/a;if(n){s=i.Math.clamp(s,0,1)}return s}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);var a=r||new i.Vector3;return this.delta(a).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}};i.Box2=function(e,t){this.min=e!==undefined?e:new i.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new i.Vector2(-Infinity,-Infinity)};i.Box2.prototype={constructor:i.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new i.Vector2;return function(t,r){var n=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(n);this.max.copy(t).add(n);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new i.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var r=t||new i.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var r=t||new i.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};i.Box3=function(e,t){this.min=e!==undefined?e:new i.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new i.Vector3(-Infinity,-Infinity,-Infinity)};i.Box3.prototype={constructor:i.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new i.Vector3;return function(t,r){var n=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(n);this.max.copy(t).add(n);return this}}(),setFromObject:function(){var e=new i.Vector3;return function(t){var r=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){var n=t.geometry;if(n!==undefined){if(n instanceof i.Geometry){var a=n.vertices;for(var o=0,s=a.length;o<s;o++){e.copy(a[o]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}else if(n instanceof i.BufferGeometry&&n.attributes["position"]!==undefined){var h=n.attributes["position"].array;for(var o=0,s=h.length;o<s;o+=3){e.set(h[o],h[o+1],h[o+2]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var r=t||new i.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var r=t||new i.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new i.Vector3;return function(t){var r=t||new i.Sphere;r.center=this.center();r.radius=this.size(e).length()*.5;return r}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};i.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};i.Matrix3.prototype={constructor:i.Matrix3,set:function(e,t,r,n,i,a,o,s,h){var u=this.elements;u[0]=e;u[3]=t;u[6]=r;u[1]=n;u[4]=i;u[7]=a;u[2]=o;u[5]=s;u[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,n){if(e===undefined)e=new i.Vector3;if(r===undefined)r=0;if(n===undefined)n=t.length;for(var a=0,o=r;a<n;a+=3,o+=3){e.fromArray(t,o);e.applyMatrix3(this);e.toArray(t,o)}return t}}(),applyToBuffer:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Vector3;if(n===undefined)n=0;if(a===undefined)a=r.length/r.itemSize;for(var o=0,s=n;o<a;o++,s++){e.x=r.getX(s);e.y=r.getY(s);e.z=r.getZ(s);e.applyMatrix3(this);r.setXYZ(e.x,e.y,e.z)}return r}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],h=e[7],u=e[8];return t*a*u-t*o*h-r*i*u+r*o*s+n*i*h-n*a*s},getInverse:function(e,t){var r=e.elements;var n=this.elements;n[0]=r[10]*r[5]-r[6]*r[9];n[1]=-r[10]*r[1]+r[2]*r[9];n[2]=r[6]*r[1]-r[2]*r[5];n[3]=-r[10]*r[4]+r[6]*r[8];n[4]=r[10]*r[0]-r[2]*r[8];n[5]=-r[6]*r[0]+r[2]*r[4];n[6]=r[9]*r[4]-r[5]*r[8];n[7]=-r[9]*r[0]+r[1]*r[8];n[8]=r[5]*r[0]-r[1]*r[4];var i=r[0]*n[0]+r[1]*n[3]+r[2]*n[6];if(i===0){var a="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(a)}else{console.warn(a)}this.identity();return this}this.multiplyScalar(1/i);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];return e},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}};i.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};i.Matrix4.prototype={constructor:i.Matrix4,set:function(e,t,r,n,i,a,o,s,h,u,l,c,f,d,p,m){var v=this.elements;v[0]=e;v[4]=t;v[8]=r;v[12]=n;v[1]=i;v[5]=a;v[9]=o;v[13]=s;v[2]=h;v[6]=u;v[10]=l;v[14]=c;v[3]=f;v[7]=d;v[11]=p;v[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new i.Matrix4).fromArray(this.elements)},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var r=e.elements;t[12]=r[12];t[13]=r[13];t[14]=r[14];return this},extractBasis:function(e,t,r){var n=this.elements;e.set(n[0],n[1],n[2]);t.set(n[4],n[5],n[6]);r.set(n[8],n[9],n[10]);return this},makeBasis:function(e,t,r){this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1);return this},extractRotation:function(){var e;return function(t){if(e===undefined)e=new i.Vector3;var r=this.elements;var n=t.elements;var a=1/e.set(n[0],n[1],n[2]).length();var o=1/e.set(n[4],n[5],n[6]).length();var s=1/e.set(n[8],n[9],n[10]).length();r[0]=n[0]*a;r[1]=n[1]*a;r[2]=n[2]*a;r[4]=n[4]*o;r[5]=n[5]*o;r[6]=n[6]*o;r[8]=n[8]*s;r[9]=n[9]*s;r[10]=n[10]*s;return this}}(),makeRotationFromEuler:function(e){if(e instanceof i.Euler===false){console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var r=e.x,n=e.y,a=e.z;var o=Math.cos(r),s=Math.sin(r);var h=Math.cos(n),u=Math.sin(n);var l=Math.cos(a),c=Math.sin(a);if(e.order==="XYZ"){var f=o*l,d=o*c,p=s*l,m=s*c;t[0]=h*l;t[4]=-h*c;t[8]=u;t[1]=d+p*u;t[5]=f-m*u;t[9]=-s*h;t[2]=m-f*u;t[6]=p+d*u;t[10]=o*h}else if(e.order==="YXZ"){var v=h*l,g=h*c,y=u*l,x=u*c;t[0]=v+x*s;t[4]=y*s-g;t[8]=o*u;t[1]=o*c;t[5]=o*l;t[9]=-s;t[2]=g*s-y;t[6]=x+v*s;t[10]=o*h}else if(e.order==="ZXY"){var v=h*l,g=h*c,y=u*l,x=u*c;t[0]=v-x*s;t[4]=-o*c;t[8]=y+g*s;t[1]=g+y*s;t[5]=o*l;t[9]=x-v*s;t[2]=-o*u;t[6]=s;t[10]=o*h}else if(e.order==="ZYX"){var f=o*l,d=o*c,p=s*l,m=s*c;t[0]=h*l;t[4]=p*u-d;t[8]=f*u+m;t[1]=h*c;t[5]=m*u+f;t[9]=d*u-p;t[2]=-u;t[6]=s*h;t[10]=o*h}else if(e.order==="YZX"){var b=o*h,w=o*u,_=s*h,M=s*u;t[0]=h*l;t[4]=M-b*c;t[8]=_*c+w;t[1]=c;t[5]=o*l;t[9]=-s*l;t[2]=-u*l;t[6]=w*c+_;t[10]=b-M*c}else if(e.order==="XZY"){var b=o*h,w=o*u,_=s*h,M=s*u;t[0]=h*l;t[4]=-c;t[8]=u*l;t[1]=b*c+M;t[5]=o*l;t[9]=w*c-_;t[2]=_*c-w;t[6]=s*l;t[10]=M*c+b}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var r=e.x,n=e.y,i=e.z,a=e.w;var o=r+r,s=n+n,h=i+i;var u=r*o,l=r*s,c=r*h;var f=n*s,d=n*h,p=i*h;var m=a*o,v=a*s,g=a*h;t[0]=1-(f+p);t[4]=l-g;t[8]=c+v;t[1]=l+g;t[5]=1-(u+p);t[9]=d-m;t[2]=c-v;t[6]=d+m;t[10]=1-(u+f);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e,t,r;return function(n,a,o){if(e===undefined)e=new i.Vector3;if(t===undefined)t=new i.Vector3;if(r===undefined)r=new i.Vector3;var s=this.elements;r.subVectors(n,a).normalize();if(r.lengthSq()===0){r.z=1}e.crossVectors(o,r).normalize();if(e.lengthSq()===0){r.x+=1e-4;e.crossVectors(o,r).normalize()}t.crossVectors(r,e);s[0]=e.x;s[4]=t.x;s[8]=r.x;s[1]=e.y;s[5]=t.y;s[9]=r.y;s[2]=e.z;s[6]=t.z;s[10]=r.z;return this}}(),multiply:function(e,t){if(t!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements;var n=t.elements;var i=this.elements;var a=r[0],o=r[4],s=r[8],h=r[12];var u=r[1],l=r[5],c=r[9],f=r[13];var d=r[2],p=r[6],m=r[10],v=r[14];var g=r[3],y=r[7],x=r[11],b=r[15];var w=n[0],_=n[4],M=n[8],S=n[12];var T=n[1],E=n[5],C=n[9],A=n[13];var L=n[2],P=n[6],R=n[10],D=n[14];var k=n[3],F=n[7],O=n[11],U=n[15];i[0]=a*w+o*T+s*L+h*k;i[4]=a*_+o*E+s*P+h*F;i[8]=a*M+o*C+s*R+h*O;i[12]=a*S+o*A+s*D+h*U;i[1]=u*w+l*T+c*L+f*k;i[5]=u*_+l*E+c*P+f*F;i[9]=u*M+l*C+c*R+f*O;i[13]=u*S+l*A+c*D+f*U;i[2]=d*w+p*T+m*L+v*k;i[6]=d*_+p*E+m*P+v*F;i[10]=d*M+p*C+m*R+v*O;i[14]=d*S+p*A+m*D+v*U;i[3]=g*w+y*T+x*L+b*k;i[7]=g*_+y*E+x*P+b*F;i[11]=g*M+y*C+x*R+b*O;i[15]=g*S+y*A+x*D+b*U;return this},multiplyToArray:function(e,t,r){var n=this.elements;this.multiplyMatrices(e,t);r[0]=n[0];r[1]=n[1];r[2]=n[2];r[3]=n[3];r[4]=n[4];r[5]=n[5];r[6]=n[6];r[7]=n[7];r[8]=n[8];r[9]=n[9];r[10]=n[10];r[11]=n[11];r[12]=n[12];r[13]=n[13];r[14]=n[14];r[15]=n[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,n){if(e===undefined)e=new i.Vector3;if(r===undefined)r=0;if(n===undefined)n=t.length;for(var a=0,o=r;a<n;a+=3,o+=3){e.fromArray(t,o);e.applyMatrix4(this);e.toArray(t,o)}return t}}(),applyToBuffer:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Vector3;if(n===undefined)n=0;if(a===undefined)a=r.length/r.itemSize;for(var o=0,s=n;o<a;o++,s++){e.x=r.getX(s);e.y=r.getY(s);e.z=r.getZ(s);e.applyMatrix4(this);r.setXYZ(e.x,e.y,e.z)}return r}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],r=e[4],n=e[8],i=e[12];var a=e[1],o=e[5],s=e[9],h=e[13];var u=e[2],l=e[6],c=e[10],f=e[14];var d=e[3],p=e[7],m=e[11],v=e[15];return d*(+i*s*l-n*h*l-i*o*c+r*h*c+n*o*f-r*s*f)+p*(+t*s*f-t*h*c+i*a*c-n*a*f+n*h*u-i*s*u)+m*(+t*h*l-t*o*f-i*a*l+r*a*f+i*o*u-r*h*u)+v*(-n*o*u-t*s*l+t*o*c+n*a*l-r*a*c+r*s*u)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];e[t+9]=r[9];e[t+10]=r[10];e[t+11]=r[11];e[t+12]=r[12];e[t+13]=r[13];e[t+14]=r[14];e[t+15]=r[15];return e},getPosition:function(){var e;return function(){if(e===undefined)e=new i.Vector3;console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var r=this.elements;var n=e.elements;var i=n[0],a=n[4],o=n[8],s=n[12];var h=n[1],u=n[5],l=n[9],c=n[13];var f=n[2],d=n[6],p=n[10],m=n[14];var v=n[3],g=n[7],y=n[11],x=n[15];r[0]=l*m*g-c*p*g+c*d*y-u*m*y-l*d*x+u*p*x;r[4]=s*p*g-o*m*g-s*d*y+a*m*y+o*d*x-a*p*x;r[8]=o*c*g-s*l*g+s*u*y-a*c*y-o*u*x+a*l*x;r[12]=s*l*d-o*c*d-s*u*p+a*c*p+o*u*m-a*l*m;r[1]=c*p*v-l*m*v-c*f*y+h*m*y+l*f*x-h*p*x;r[5]=o*m*v-s*p*v+s*f*y-i*m*y-o*f*x+i*p*x;r[9]=s*l*v-o*c*v-s*h*y+i*c*y+o*h*x-i*l*x;r[13]=o*c*f-s*l*f+s*h*p-i*c*p-o*h*m+i*l*m;r[2]=u*m*v-c*d*v+c*f*g-h*m*g-u*f*x+h*d*x;r[6]=s*d*v-a*m*v-s*f*g+i*m*g+a*f*x-i*d*x;r[10]=a*c*v-s*u*v+s*h*g-i*c*g-a*h*x+i*u*x;r[14]=s*u*f-a*c*f-s*h*d+i*c*d+a*h*m-i*u*m;r[3]=l*d*v-u*p*v-l*f*g+h*p*g+u*f*y-h*d*y;r[7]=a*p*v-o*d*v+o*f*g-i*p*g-a*f*y+i*d*y;r[11]=o*u*v-a*l*v-o*h*g+i*l*g+a*h*y-i*u*y;r[15]=a*l*f-o*u*f+o*h*d-i*l*d-a*h*p+i*u*p;var b=i*r[0]+h*r[4]+f*r[8]+v*r[12];if(b===0){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(w)}else{console.warn(w)}this.identity();return this}this.multiplyScalar(1/b);return this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var r=e.x,n=e.y,i=e.z;t[0]*=r;t[4]*=n;t[8]*=i;t[1]*=r;t[5]*=n;t[9]*=i;t[2]*=r;t[6]*=n;t[10]*=i;t[3]*=r;t[7]*=n;t[11]*=i;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var r=Math.cos(t);var n=Math.sin(t);var i=1-r;var a=e.x,o=e.y,s=e.z;var h=i*a,u=i*o;this.set(h*a+r,h*o-n*s,h*s+n*o,0,h*o+n*s,u*o+r,u*s-n*a,0,h*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1);return this},makeScale:function(e,t,r){this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1);return this},compose:function(e,t,r){this.makeRotationFromQuaternion(t);this.scale(r);this.setPosition(e);return this},decompose:function(){var e,t;return function(r,n,a){if(e===undefined)e=new i.Vector3;if(t===undefined)t=new i.Matrix4;var o=this.elements;var s=e.set(o[0],o[1],o[2]).length();var h=e.set(o[4],o[5],o[6]).length();var u=e.set(o[8],o[9],o[10]).length();var l=this.determinant();if(l<0){s=-s}r.x=o[12];r.y=o[13];r.z=o[14];t.elements.set(this.elements);var c=1/s;var f=1/h;var d=1/u;t.elements[0]*=c;t.elements[1]*=c;t.elements[2]*=c;t.elements[4]*=f;t.elements[5]*=f;t.elements[6]*=f;t.elements[8]*=d;t.elements[9]*=d;t.elements[10]*=d;n.setFromRotationMatrix(t);a.x=s;a.y=h;a.z=u;return this}}(),makeFrustum:function(e,t,r,n,i,a){var o=this.elements;var s=2*i/(t-e);var h=2*i/(n-r);var u=(t+e)/(t-e);var l=(n+r)/(n-r);var c=-(a+i)/(a-i);var f=-2*a*i/(a-i);o[0]=s;o[4]=0;o[8]=u;o[12]=0;o[1]=0;o[5]=h;o[9]=l;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=f;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,r,n){var a=r*Math.tan(i.Math.degToRad(e*.5));var o=-a;var s=o*t;var h=a*t;return this.makeFrustum(s,h,o,a,r,n)},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements;var s=t-e;var h=r-n;var u=a-i;var l=(t+e)/s;var c=(r+n)/h;var f=(a+i)/u;o[0]=2/s;o[4]=0;o[8]=0;o[12]=-l;o[1]=0;o[5]=2/h;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/u;o[14]=-f;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},equals:function(e){var t=this.elements;var r=e.elements;for(var n=0;n<16;n++){if(t[n]!==r[n])return false}return true},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}};i.Ray=function(e,t){this.origin=e!==undefined?e:new i.Vector3;this.direction=t!==undefined?t:new i.Vector3};i.Ray.prototype={constructor:i.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var r=t||new i.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new i.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var r=t||new i.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);if(n<0){return r.copy(this.origin)}return r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new i.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);if(r<0){return this.origin.distanceToSquared(t)}e.copy(this.direction).multiplyScalar(r).add(this.origin);return e.distanceToSquared(t)}}(),distanceSqToSegment:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(n,i,a,o){e.copy(n).add(i).multiplyScalar(.5);t.copy(i).sub(n).normalize();r.copy(this.origin).sub(e);var s=n.distanceTo(i)*.5;var h=-this.direction.dot(t);var u=r.dot(this.direction);var l=-r.dot(t);var c=r.lengthSq();var f=Math.abs(1-h*h);var d,p,m,v;if(f>0){d=h*l-u;p=h*u-l;v=s*f;if(d>=0){if(p>=-v){if(p<=v){var g=1/f;d*=g;p*=g;m=d*(d+h*p+2*u)+p*(h*d+p+2*l)+c}else{p=s;d=Math.max(0,-(h*p+u));m=-d*d+p*(p+2*l)+c}}else{p=-s;d=Math.max(0,-(h*p+u));m=-d*d+p*(p+2*l)+c}}else{if(p<=-v){d=Math.max(0,-(-h*s+u));p=d>0?-s:Math.min(Math.max(-s,-l),s);m=-d*d+p*(p+2*l)+c}else if(p<=v){d=0;p=Math.min(Math.max(-s,-l),s);m=p*(p+2*l)+c}else{d=Math.max(0,-(h*s+u));p=d>0?s:Math.min(Math.max(-s,-l),s);m=-d*d+p*(p+2*l)+c}}}else{p=h>0?-s:s;d=Math.max(0,-(h*p+u));m=-d*d+p*(p+2*l)+c}if(a){a.copy(this.direction).multiplyScalar(d).add(this.origin)}if(o){o.copy(t).multiplyScalar(p).add(e)}return m}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new i.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction);var i=e.dot(e)-n*n;var a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i);var s=n-o;var h=n+o;if(s<0&&h<0)return null;if(s<0)return this.at(h,r);return this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var r=e.normal.dot(this.direction);if(r*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0){
if(e.distanceToPoint(this.origin)===0){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(r===null){return null}return this.at(r,t)},isIntersectionBox:function(){var e=new i.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var r,n,i,a,o,s;var h=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z;var c=this.origin;if(h>=0){r=(e.min.x-c.x)*h;n=(e.max.x-c.x)*h}else{r=(e.max.x-c.x)*h;n=(e.min.x-c.x)*h}if(u>=0){i=(e.min.y-c.y)*u;a=(e.max.y-c.y)*u}else{i=(e.max.y-c.y)*u;a=(e.min.y-c.y)*u}if(r>a||i>n)return null;if(i>r||r!==r)r=i;if(a<n||n!==n)n=a;if(l>=0){o=(e.min.z-c.z)*l;s=(e.max.z-c.z)*l}else{o=(e.max.z-c.z)*l;s=(e.min.z-c.z)*l}if(r>s||o>n)return null;if(o>r||r!==r)r=o;if(s<n||n!==n)n=s;if(n<0)return null;return this.at(r>=0?r:n,t)},intersectTriangle:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;var n=new i.Vector3;return function(i,a,o,s,h){t.subVectors(a,i);r.subVectors(o,i);n.crossVectors(t,r);var u=this.direction.dot(n);var l;if(u>0){if(s)return null;l=1}else if(u<0){l=-1;u=-u}else{return null}e.subVectors(this.origin,i);var c=l*this.direction.dot(r.crossVectors(e,r));if(c<0){return null}var f=l*this.direction.dot(t.cross(e));if(f<0){return null}if(c+f>u){return null}var d=-l*e.dot(n);if(d<0){return null}return this.at(d/u,h)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}};i.Sphere=function(e,t){this.center=e!==undefined?e:new i.Vector3;this.radius=t!==undefined?t:0};i.Sphere.prototype={constructor:i.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new i.Box3;return function(t,r){var n=this.center;if(r!==undefined){n.copy(r)}else{e.setFromPoints(t).center(n)}var i=0;for(var a=0,o=t.length;a<o;a++){i=Math.max(i,n.distanceToSquared(t[a]))}this.radius=Math.sqrt(i);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);var n=t||new i.Vector3;n.copy(e);if(r>this.radius*this.radius){n.sub(this.center).normalize();n.multiplyScalar(this.radius).add(this.center)}return n},getBoundingBox:function(e){var t=e||new i.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}};i.Frustum=function(e,t,r,n,a,o){this.planes=[e!==undefined?e:new i.Plane,t!==undefined?t:new i.Plane,r!==undefined?r:new i.Plane,n!==undefined?n:new i.Plane,a!==undefined?a:new i.Plane,o!==undefined?o:new i.Plane]};i.Frustum.prototype={constructor:i.Frustum,set:function(e,t,r,n,i,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(r);o[3].copy(n);o[4].copy(i);o[5].copy(a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=this.planes;for(var r=0;r<6;r++){t[r].copy(e.planes[r])}return this},setFromMatrix:function(e){var t=this.planes;var r=e.elements;var n=r[0],i=r[1],a=r[2],o=r[3];var s=r[4],h=r[5],u=r[6],l=r[7];var c=r[8],f=r[9],d=r[10],p=r[11];var m=r[12],v=r[13],g=r[14],y=r[15];t[0].setComponents(o-n,l-s,p-c,y-m).normalize();t[1].setComponents(o+n,l+s,p+c,y+m).normalize();t[2].setComponents(o+i,l+h,p+f,y+v).normalize();t[3].setComponents(o-i,l-h,p-f,y-v).normalize();t[4].setComponents(o-a,l-u,p-d,y-g).normalize();t[5].setComponents(o+a,l+u,p+d,y+g).normalize();return this},intersectsObject:function(){var e=new i.Sphere;return function(t){var r=t.geometry;if(r.boundingSphere===null)r.computeBoundingSphere();e.copy(r.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var r=e.center;var n=-e.radius;for(var i=0;i<6;i++){var a=t[i].distanceToPoint(r);if(a<n){return false}}return true},intersectsBox:function(){var e=new i.Vector3,t=new i.Vector3;return function(r){var n=this.planes;for(var i=0;i<6;i++){var a=n[i];e.x=a.normal.x>0?r.min.x:r.max.x;t.x=a.normal.x>0?r.max.x:r.min.x;e.y=a.normal.y>0?r.min.y:r.max.y;t.y=a.normal.y>0?r.max.y:r.min.y;e.z=a.normal.z>0?r.min.z:r.max.z;t.z=a.normal.z>0?r.max.z:r.min.z;var o=a.distanceToPoint(e);var s=a.distanceToPoint(t);if(o<0&&s<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var r=0;r<6;r++){if(t[r].distanceToPoint(e)<0){return false}}return true}};i.Plane=function(e,t){this.normal=e!==undefined?e:new i.Vector3(1,0,0);this.constant=t!==undefined?t:0};i.Plane.prototype={constructor:i.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,r,n){this.normal.set(e,t,r);this.constant=n;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r,n,i){var a=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();this.setFromNormalAndCoplanarPoint(a,r);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);var n=t||new i.Vector3;return n.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new i.Vector3;return function(t,r){var n=r||new i.Vector3;var a=t.delta(e);var o=this.normal.dot(a);if(o===0){if(this.distanceToPoint(t.start)===0){return n.copy(t.start)}return undefined}var s=-(t.start.dot(this.normal)+this.constant)/o;if(s<0||s>1){return undefined}return n.copy(a).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t=e||new i.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function(n,i){var a=i||r.getNormalMatrix(n);var o=e.copy(this.normal).applyMatrix3(a);var s=this.coplanarPoint(t);s.applyMatrix4(n);this.setFromNormalAndCoplanarPoint(o,s);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}};i.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var r=0,n;return function(){for(var i=0;i<36;i++){if(i===8||i===13||i===18||i===23){t[i]="-"}else if(i===14){t[i]="4"}else{if(r<=2)r=33554432+Math.random()*16777216|0;n=r&15;r=r>>4;t[i]=e[i===19?n&3|8:n]}}return t.join("")}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},smoothstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*(3-2*e)},smootherstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;e++;return e}};i.Spline=function(e){this.points=e;var t=[],r={x:0,y:0,z:0},n,a,o,s,h,u,l,c,f;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){n=(this.points.length-1)*e;a=Math.floor(n);o=n-a;t[0]=a===0?a:a-1;t[1]=a;t[2]=a>this.points.length-2?this.points.length-1:a+1;t[3]=a>this.points.length-3?this.points.length-1:a+2;u=this.points[t[0]];l=this.points[t[1]];c=this.points[t[2]];f=this.points[t[3]];s=o*o;h=o*s;r.x=d(u.x,l.x,c.x,f.x,o,s,h);r.y=d(u.y,l.y,c.y,f.y,o,s,h);r.z=d(u.z,l.z,c.z,f.z,o,s,h);return r};this.getControlPointsArray=function(){var e,t,r=this.points.length,n=[];for(e=0;e<r;e++){t=this.points[e];n[e]=[t.x,t.y,t.z]}return n};this.getLength=function(e){var t,r,n,a,o=0,s=0,h=0,u=new i.Vector3,l=new i.Vector3,c=[],f=0;c[0]=0;if(!e)e=100;n=this.points.length*e;u.copy(this.points[0]);for(t=1;t<n;t++){r=t/n;a=this.getPoint(r);l.copy(a);f+=l.distanceTo(u);u.copy(a);o=(this.points.length-1)*r;s=Math.floor(o);if(s!==h){c[s]=f;h=s}}c[c.length]=f;return{chunks:c,total:f}};this.reparametrizeByArcLength=function(e){var t,r,n,a,o,s,h,u,l=[],c=new i.Vector3,f=this.getLength();l.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){s=f.chunks[t]-f.chunks[t-1];h=Math.ceil(e*s/f.total);a=(t-1)/(this.points.length-1);o=t/(this.points.length-1);for(r=1;r<h-1;r++){n=a+r*(1/h)*(o-a);u=this.getPoint(n);l.push(c.copy(u).clone())}l.push(c.copy(this.points[t]).clone())}this.points=l};function d(e,t,r,n,i,a,o){var s=(r-e)*.5,h=(n-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*i+t}};i.Triangle=function(e,t,r){this.a=e!==undefined?e:new i.Vector3;this.b=t!==undefined?t:new i.Vector3;this.c=r!==undefined?r:new i.Vector3};i.Triangle.normal=function(){var e=new i.Vector3;return function(t,r,n,a){var o=a||new i.Vector3;o.subVectors(n,r);e.subVectors(t,r);o.cross(e);var s=o.lengthSq();if(s>0){return o.multiplyScalar(1/Math.sqrt(s))}return o.set(0,0,0)}}();i.Triangle.barycoordFromPoint=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(n,a,o,s,h){e.subVectors(s,a);t.subVectors(o,a);r.subVectors(n,a);var u=e.dot(e);var l=e.dot(t);var c=e.dot(r);var f=t.dot(t);var d=t.dot(r);var p=u*f-l*l;var m=h||new i.Vector3;if(p===0){return m.set(-2,-1,-1)}var v=1/p;var g=(f*c-l*d)*v;var y=(u*d-l*c)*v;return m.set(1-g-y,y,g)}}();i.Triangle.containsPoint=function(){var e=new i.Vector3;return function(t,r,n,a){var o=i.Triangle.barycoordFromPoint(t,r,n,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}();i.Triangle.prototype={constructor:i.Triangle,set:function(e,t,r){this.a.copy(e);this.b.copy(t);this.c.copy(r);return this},setFromPointsAndIndices:function(e,t,r,n){this.a.copy(e[t]);this.b.copy(e[r]);this.c.copy(e[n]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new i.Vector3;var t=new i.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new i.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return i.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new i.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return i.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return i.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};i.Channels=function(){this.mask=1};i.Channels.prototype={constructor:i.Channels,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)}};i.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};i.Clock.prototype={constructor:i.Clock,start:function(){this.startTime=n.performance.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=n.performance.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};i.EventDispatcher=function(){};i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(e){e.addEventListener=i.EventDispatcher.prototype.addEventListener;e.hasEventListener=i.EventDispatcher.prototype.hasEventListener;e.removeEventListener=i.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var r=this._listeners;if(r[e]===undefined){r[e]=[]}if(r[e].indexOf(t)===-1){r[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var r=this._listeners;if(r[e]!==undefined&&r[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var r=this._listeners;var n=r[e];if(n!==undefined){var i=n.indexOf(t);if(i!==-1){n.splice(i,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var r=t[e.type];if(r!==undefined){e.target=this;var n=[];var i=r.length;for(var a=0;a<i;a++){n[a]=r[a]}for(var a=0;a<i;a++){n[a].call(this,e)}}}};(function(e){e.Raycaster=function(t,r,n,i){this.ray=new e.Ray(t,r);this.near=n||0;this.far=i||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};function t(e,t){return e.distance-t.distance}function r(e,t,n,i){if(e.visible===false)return;e.raycast(t,n);if(i===true){var a=e.children;for(var o=0,s=a.length;o<s;o++){r(a[o],t,n,true)}}}e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){if(r instanceof e.PerspectiveCamera){this.ray.origin.setFromMatrixPosition(r.matrixWorld);this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize()}else if(r instanceof e.OrthographicCamera){this.ray.origin.set(t.x,t.y,-1).unproject(r);this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)}else{console.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(e,n){var i=[];r(e,this,i,n);i.sort(t);return i},intersectObjects:function(e,n){var i=[];if(Array.isArray(e)===false){console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return i}for(var a=0,o=e.length;a<o;a++){r(e[a],this,i,n)}i.sort(t);return i}}})(i);i.Object3D=function(){Object.defineProperty(this,"id",{value:i.Object3DIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.channels=new i.Channels;this.children=[];this.up=i.Object3D.DefaultUp.clone();var e=new i.Vector3;var t=new i.Euler;var r=new i.Quaternion;var n=new i.Vector3(1,1,1);function a(){r.setFromEuler(t,false)}function o(){t.setFromQuaternion(r,undefined,false)}t.onChange(a);r.onChange(o);Object.defineProperties(this,{position:{enumerable:true,value:e},rotation:{enumerable:true,value:t},quaternion:{enumerable:true,value:r},scale:{enumerable:true,value:n},modelViewMatrix:{value:new i.Matrix4},normalMatrix:{value:new i.Matrix3}});this.rotationAutoUpdate=true;this.matrix=new i.Matrix4;this.matrixWorld=new i.Matrix4;this.matrixAutoUpdate=i.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};i.Object3D.DefaultUp=new i.Vector3(0,1,0);i.Object3D.DefaultMatrixAutoUpdate=true;i.Object3D.prototype={constructor:i.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i.Quaternion;return function(t,r){e.setFromAxisAngle(t,r);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new i.Vector3;return function(t,r){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(r));return this}}(),translate:function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},translateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new i.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e instanceof i.Object3D){if(e.parent!==null){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}}var r=this.children.indexOf(e);if(r!==-1){e.parent=null;e.dispatchEvent({type:"removed"});this.children.splice(r,1)}},getChildByName:function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r];var a=i.getObjectByProperty(e,t);if(a!==undefined){return a}}return undefined},getWorldPosition:function(e){var t=e||new i.Vector3;this.updateMatrixWorld(true);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r){var n=r||new i.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,n,t);return n}}(),getWorldRotation:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Euler;this.getWorldQuaternion(e);return r.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new i.Vector3;var t=new i.Quaternion;return function(r){var n=r||new i.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,n);return n}}(),getWorldDirection:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;this.getWorldQuaternion(e);return r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);var t=this.children;for(var r=0,n=t.length;r<n;r++){t[r].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);var t=this.children;for(var r=0,n=t.length;r<n;r++){t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;if(t!==null){e(t);t.traverseAncestors(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,r=this.children.length;t<r;t++){this.children[t].updateMatrixWorld(e)}},toJSON:function(e){var t=e===undefined;var r={};if(t){e={geometries:{},materials:{},textures:{},images:{}};r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"}}var n={};n.uuid=this.uuid;n.type=this.type;if(this.name!=="")n.name=this.name;if(JSON.stringify(this.userData)!=="{}")n.userData=this.userData;if(this.castShadow===true)n.castShadow=true;if(this.receiveShadow===true)n.receiveShadow=true;if(this.visible===false)n.visible=false;n.matrix=this.matrix.toArray();if(this.geometry!==undefined){if(e.geometries[this.geometry.uuid]===undefined){e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)}n.geometry=this.geometry.uuid}if(this.material!==undefined){if(e.materials[this.material.uuid]===undefined){e.materials[this.material.uuid]=this.material.toJSON(e)}n.material=this.material.uuid}if(this.children.length>0){n.children=[];for(var i=0;i<this.children.length;i++){n.children.push(this.children[i].toJSON(e).object)}}if(t){var a=u(e.geometries);var o=u(e.materials);var s=u(e.textures);var h=u(e.images);if(a.length>0)r.geometries=a;if(o.length>0)r.materials=o;if(s.length>0)r.textures=s;if(h.length>0)r.images=h}r.object=n;return r;function u(e){var t=[];for(var r in e){var n=e[r];delete n.metadata;t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(t===undefined)t=true;this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.rotationAutoUpdate=e.rotationAutoUpdate;this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(t===true){for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}}return this}};i.EventDispatcher.prototype.apply(i.Object3D.prototype);i.Object3DIdCount=0;i.Face3=function(e,t,r,n,a,o){this.a=e;this.b=t;this.c=r;this.normal=n instanceof i.Vector3?n:new i.Vector3;this.vertexNormals=Array.isArray(n)?n:[];this.color=a instanceof i.Color?a:new i.Color;this.vertexColors=Array.isArray(a)?a:[];this.materialIndex=o!==undefined?o:0};i.Face3.prototype={constructor:i.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a;this.b=e.b;this.c=e.c;this.normal.copy(e.normal);this.color.copy(e.color);this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++){this.vertexNormals[t]=e.vertexNormals[t].clone()}for(var t=0,r=e.vertexColors.length;t<r;t++){this.vertexColors[t]=e.vertexColors[t].clone()}return this}};i.Face4=function(e,t,r,n,a,o,s){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new i.Face3(e,t,r,a,o,s)};i.BufferAttribute=function(e,t){this.uuid=i.Math.generateUUID();this.array=e;this.itemSize=t;this.dynamic=false;this.updateRange={offset:0,count:-1};this.version=0};i.BufferAttribute.prototype={constructor:i.BufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){if(e===true)this.version++},setDynamic:function(e){this.dynamic=e;return this},copy:function(e){this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.dynamic=e.dynamic;return this},copyAt:function(e,t,r){e*=this.itemSize;r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++){this.array[e+n]=t.array[r+n]}return this},copyArray:function(e){this.array.set(e);return this},copyColorsArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n);o=new i.Color}t[r++]=o.r;t[r++]=o.g;t[r++]=o.b}return this},copyIndicesArray:function(e){var t=this.array,r=0;for(var n=0,i=e.length;n<i;n++){var a=e[n];t[r++]=a.a;t[r++]=a.b;t[r++]=a.c}return this},copyVector2sArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n);o=new i.Vector2}t[r++]=o.x;t[r++]=o.y}return this},copyVector3sArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n);o=new i.Vector3}t[r++]=o.x;t[r++]=o.y;t[r++]=o.z}return this},copyVector4sArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n);o=new i.Vector4}t[r++]=o.x;t[r++]=o.y;t[r++]=o.z;t[r++]=o.w}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){this.array[e*this.itemSize]=t;return this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){this.array[e*this.itemSize+3]=t;return this},setXY:function(e,t,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;return this},setXYZ:function(e,t,r,n){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;this.array[e+2]=n;return this},setXYZW:function(e,t,r,n,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;this.array[e+2]=n;this.array[e+3]=i;return this},clone:function(){return(new this.constructor).copy(this)}};i.Int8Attribute=function(e,t){return new i.BufferAttribute(new Int8Array(e),t)};i.Uint8Attribute=function(e,t){return new i.BufferAttribute(new Uint8Array(e),t)};i.Uint8ClampedAttribute=function(e,t){return new i.BufferAttribute(new Uint8ClampedArray(e),t)};i.Int16Attribute=function(e,t){return new i.BufferAttribute(new Int16Array(e),t)};i.Uint16Attribute=function(e,t){return new i.BufferAttribute(new Uint16Array(e),t)};i.Int32Attribute=function(e,t){return new i.BufferAttribute(new Int32Array(e),t)};i.Uint32Attribute=function(e,t){return new i.BufferAttribute(new Uint32Array(e),t)};i.Float32Attribute=function(e,t){return new i.BufferAttribute(new Float32Array(e),t)};i.Float64Attribute=function(e,t){return new i.BufferAttribute(new Float64Array(e),t)};i.DynamicBufferAttribute=function(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new i.BufferAttribute(e,t).setDynamic(true)};i.InstancedBufferAttribute=function(e,t,r){i.BufferAttribute.call(this,e,t);this.meshPerAttribute=r||1};i.InstancedBufferAttribute.prototype=Object.create(i.BufferAttribute.prototype);i.InstancedBufferAttribute.prototype.constructor=i.InstancedBufferAttribute;i.InstancedBufferAttribute.prototype.copy=function(e){i.BufferAttribute.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this};i.InterleavedBuffer=function(e,t){this.uuid=i.Math.generateUUID();this.array=e;this.stride=t;this.dynamic=false;this.updateRange={offset:0,count:-1};this.version=0};i.InterleavedBuffer.prototype={constructor:i.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){if(e===true)this.version++},setDynamic:function(e){this.dynamic=e;return this},copy:function(e){this.array=new e.array.constructor(e.array);this.stride=e.stride;this.dynamic=e.dynamic},copyAt:function(e,t,r){e*=this.stride;r*=t.stride;for(var n=0,i=this.stride;n<i;n++){this.array[e+n]=t.array[r+n]}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},clone:function(){return(new this.constructor).copy(this)}};i.InstancedInterleavedBuffer=function(e,t,r){i.InterleavedBuffer.call(this,e,t);this.meshPerAttribute=r||1};i.InstancedInterleavedBuffer.prototype=Object.create(i.InterleavedBuffer.prototype);i.InstancedInterleavedBuffer.prototype.constructor=i.InstancedInterleavedBuffer;i.InstancedInterleavedBuffer.prototype.copy=function(e){i.InterleavedBuffer.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this};i.InterleavedBufferAttribute=function(e,t,r){this.uuid=i.Math.generateUUID();this.data=e;this.itemSize=t;this.offset=r};i.InterleavedBufferAttribute.prototype={constructor:i.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this},setY:function(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this},setZ:function(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this},setW:function(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;return this},setXYZ:function(e,t,r,n){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;this.data.array[e+2]=n;return this},setXYZW:function(e,t,r,n,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;this.data.array[e+2]=n;this.data.array[e+3]=i;return this}};i.Geometry=function(){
Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};i.Geometry.prototype={constructor:i.Geometry,applyMatrix:function(e){var t=(new i.Matrix3).getNormalMatrix(e);for(var r=0,n=this.vertices.length;r<n;r++){var a=this.vertices[r];a.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var s=0,h=o.vertexNormals.length;s<h;s++){o.vertexNormals[s].applyMatrix3(t).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},rotateX:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationX(r);this.applyMatrix(e);return this}}(),rotateY:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationY(r);this.applyMatrix(e);return this}}(),rotateZ:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationZ(r);this.applyMatrix(e);return this}}(),translate:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeTranslation(r,n,a);this.applyMatrix(e);return this}}(),scale:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeScale(r,n,a);this.applyMatrix(e);return this}}(),lookAt:function(){var e;return function t(r){if(e===undefined)e=new i.Object3D;e.lookAt(r);e.updateMatrix();this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this;var r=e.index!==null?e.index.array:undefined;var n=e.attributes;var a=n.position.array;var o=n.normal!==undefined?n.normal.array:undefined;var s=n.color!==undefined?n.color.array:undefined;var h=n.uv!==undefined?n.uv.array:undefined;var u=n.uv2!==undefined?n.uv2.array:undefined;if(u!==undefined)this.faceVertexUvs[1]=[];var l=[];var c=[];var f=[];for(var d=0,p=0,m=0;d<a.length;d+=3,p+=2,m+=4){t.vertices.push(new i.Vector3(a[d],a[d+1],a[d+2]));if(o!==undefined){l.push(new i.Vector3(o[d],o[d+1],o[d+2]))}if(s!==undefined){t.colors.push(new i.Color(s[d],s[d+1],s[d+2]))}if(h!==undefined){c.push(new i.Vector2(h[p],h[p+1]))}if(u!==undefined){f.push(new i.Vector2(u[p],u[p+1]))}}function v(e,r,n){var a=o!==undefined?[l[e].clone(),l[r].clone(),l[n].clone()]:[];var d=s!==undefined?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[];var p=new i.Face3(e,r,n,a,d);t.faces.push(p);if(h!==undefined){t.faceVertexUvs[0].push([c[e].clone(),c[r].clone(),c[n].clone()])}if(u!==undefined){t.faceVertexUvs[1].push([f[e].clone(),f[r].clone(),f[n].clone()])}}if(r!==undefined){var g=e.groups;if(g.length>0){for(var d=0;d<g.length;d++){var y=g[d];var x=y.start;var b=y.count;for(var p=x,w=x+b;p<w;p+=3){v(r[p],r[p+1],r[p+2])}}}else{for(var d=0;d<r.length;d+=3){v(r[d],r[d+1],r[d+2])}}}else{for(var d=0;d<a.length/3;d+=3){v(d,d+1,d+2)}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.translate(e.x,e.y,e.z);return e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center;var t=this.boundingSphere.radius;var r=t===0?1:1/t;var n=new i.Matrix4;n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1);this.applyMatrix(n);return this},computeFaceNormals:function(){var e=new i.Vector3,t=new i.Vector3;for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];var o=this.vertices[a.a];var s=this.vertices[a.b];var h=this.vertices[a.c];e.subVectors(h,s);t.subVectors(o,s);e.cross(t);e.normalize();a.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,a,o,s;s=new Array(this.vertices.length);for(t=0,r=this.vertices.length;t<r;t++){s[t]=new i.Vector3}if(e){var h,u,l;var c=new i.Vector3,f=new i.Vector3;for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];h=this.vertices[o.a];u=this.vertices[o.b];l=this.vertices[o.c];c.subVectors(l,u);f.subVectors(h,u);c.cross(f);s[o.a].add(c);s[o.b].add(c);s[o.c].add(c)}}else{for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];s[o.a].add(o.normal);s[o.b].add(o.normal);s[o.c].add(o.normal)}}for(t=0,r=this.vertices.length;t<r;t++){s[t].normalize()}for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];var d=o.vertexNormals;if(d.length===3){d[0].copy(s[o.a]);d[1].copy(s[o.b]);d[2].copy(s[o.c])}else{d[0]=s[o.a].clone();d[1]=s[o.b].clone();d[2]=s[o.c].clone()}}},computeMorphNormals:function(){var e,t,r,n,a;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(!a.__originalFaceNormal){a.__originalFaceNormal=a.normal.clone()}else{a.__originalFaceNormal.copy(a.normal)}if(!a.__originalVertexNormals)a.__originalVertexNormals=[];for(e=0,t=a.vertexNormals.length;e<t;e++){if(!a.__originalVertexNormals[e]){a.__originalVertexNormals[e]=a.vertexNormals[e].clone()}else{a.__originalVertexNormals[e].copy(a.vertexNormals[e])}}}var o=new i.Geometry;o.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals;var h=this.morphNormals[e].vertexNormals;var u,l;for(r=0,n=this.faces.length;r<n;r++){u=new i.Vector3;l={a:new i.Vector3,b:new i.Vector3,c:new i.Vector3};s.push(u);h.push(l)}}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices;o.computeFaceNormals();o.computeVertexNormals();var u,l;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];u=c.faceNormals[r];l=c.vertexNormals[r];u.copy(a.normal);l.a.copy(a.vertexNormals[0]);l.b.copy(a.vertexNormals[1]);l.c.copy(a.vertexNormals[2])}}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];a.normal=a.__originalFaceNormal;a.vertexNormals=a.__originalVertexNormals}},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){var e=0;var t=this.vertices;for(var r=0,n=t.length;r<n;r++){if(r>0){e+=t[r].distanceTo(t[r-1])}this.lineDistances[r]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof i.Geometry===false){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var n,a=this.vertices.length,o=this.vertices,s=e.vertices,h=this.faces,u=e.faces,l=this.faceVertexUvs[0],c=e.faceVertexUvs[0];if(r===undefined)r=0;if(t!==undefined){n=(new i.Matrix3).getNormalMatrix(t)}for(var f=0,d=s.length;f<d;f++){var p=s[f];var m=p.clone();if(t!==undefined)m.applyMatrix4(t);o.push(m)}for(f=0,d=u.length;f<d;f++){var v=u[f],g,y,x,b=v.vertexNormals,w=v.vertexColors;g=new i.Face3(v.a+a,v.b+a,v.c+a);g.normal.copy(v.normal);if(n!==undefined){g.normal.applyMatrix3(n).normalize()}for(var _=0,M=b.length;_<M;_++){y=b[_].clone();if(n!==undefined){y.applyMatrix3(n).normalize()}g.vertexNormals.push(y)}g.color.copy(v.color);for(var _=0,M=w.length;_<M;_++){x=w[_];g.vertexColors.push(x.clone())}g.materialIndex=v.materialIndex+r;h.push(g)}for(f=0,d=c.length;f<d;f++){var S=c[f],T=[];if(S===undefined){continue}for(var _=0,M=S.length;_<M;_++){T.push(S[_].clone())}l.push(T)}},mergeMesh:function(e){if(e instanceof i.Mesh===false){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix();this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={};var t=[],r=[];var n,i;var a=4;var o=Math.pow(10,a);var s,h,u;var l,c,f;for(s=0,h=this.vertices.length;s<h;s++){n=this.vertices[s];i=Math.round(n.x*o)+"_"+Math.round(n.y*o)+"_"+Math.round(n.z*o);if(e[i]===undefined){e[i]=s;t.push(this.vertices[s]);r[s]=t.length-1}else{r[s]=r[e[i]]}}var d=[];for(s=0,h=this.faces.length;s<h;s++){u=this.faces[s];u.a=r[u.a];u.b=r[u.b];u.c=r[u.c];l=[u.a,u.b,u.c];var p=-1;for(var m=0;m<3;m++){if(l[m]===l[(m+1)%3]){p=m;d.push(s);break}}}for(s=d.length-1;s>=0;s--){var v=d[s];this.faces.splice(v,1);for(c=0,f=this.faceVertexUvs.length;c<f;c++){this.faceVertexUvs[c].splice(v,1)}}var g=this.vertices.length-t.length;this.vertices=t;return g},sortFacesByMaterialIndex:function(){var e=this.faces;var t=e.length;for(var r=0;r<t;r++){e[r]._id=r}function n(e,t){return e.materialIndex-t.materialIndex}e.sort(n);var i=this.faceVertexUvs[0];var a=this.faceVertexUvs[1];var o,s;if(i&&i.length===t)o=[];if(a&&a.length===t)s=[];for(var r=0;r<t;r++){var h=e[r]._id;if(o)o.push(i[h]);if(s)s.push(a[h])}if(o)this.faceVertexUvs[0]=o;if(s)this.faceVertexUvs[1]=s},toJSON:function(){var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var r in t){if(t[r]!==undefined)e[r]=t[r]}return e}var n=[];for(var i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}var o=[];var s=[];var h={};var u=[];var l={};var c=[];var f={};for(var i=0;i<this.faces.length;i++){var d=this.faces[i];var p=false;var m=false;var v=this.faceVertexUvs[0][i]!==undefined;var g=d.normal.length()>0;var y=d.vertexNormals.length>0;var x=d.color.r!==1||d.color.g!==1||d.color.b!==1;var b=d.vertexColors.length>0;var w=0;w=T(w,0,0);w=T(w,1,p);w=T(w,2,m);w=T(w,3,v);w=T(w,4,g);w=T(w,5,y);w=T(w,6,x);w=T(w,7,b);o.push(w);o.push(d.a,d.b,d.c);if(v){var _=this.faceVertexUvs[0][i];o.push(A(_[0]),A(_[1]),A(_[2]))}if(g){o.push(E(d.normal))}if(y){var M=d.vertexNormals;o.push(E(M[0]),E(M[1]),E(M[2]))}if(x){o.push(C(d.color))}if(b){var S=d.vertexColors;o.push(C(S[0]),C(S[1]),C(S[2]))}}function T(e,t,r){return r?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(h[t]!==undefined){return h[t]}h[t]=s.length/3;s.push(e.x,e.y,e.z);return h[t]}function C(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(l[t]!==undefined){return l[t]}l[t]=u.length;u.push(e.getHex());return l[t]}function A(e){var t=e.x.toString()+e.y.toString();if(f[t]!==undefined){return f[t]}f[t]=c.length/2;c.push(e.x,e.y);return f[t]}e.data={};e.data.vertices=n;e.data.normals=s;if(u.length>0)e.data.colors=u;if(c.length>0)e.data.uvs=[c];e.data.faces=o;return e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];var t=e.vertices;for(var r=0,n=t.length;r<n;r++){this.vertices.push(t[r].clone())}var i=e.faces;for(var r=0,n=i.length;r<n;r++){this.faces.push(i[r].clone())}for(var r=0,n=e.faceVertexUvs.length;r<n;r++){var a=e.faceVertexUvs[r];if(this.faceVertexUvs[r]===undefined){this.faceVertexUvs[r]=[]}for(var o=0,s=a.length;o<s;o++){var h=a[o],u=[];for(var l=0,c=h.length;l<c;l++){var f=h[l];u.push(f.clone())}this.faceVertexUvs[r].push(u)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Geometry.prototype);i.GeometryIdCount=0;i.DirectGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.uvsNeedUpdate=false;this.groupsNeedUpdate=false};i.DirectGeometry.prototype={constructor:i.DirectGeometry,computeBoundingBox:i.Geometry.prototype.computeBoundingBox,computeBoundingSphere:i.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){var t;var r=[];var n;var i=e.faces;for(var a=0;a<i.length;a++){var o=i[a];if(o.materialIndex!==n){n=o.materialIndex;if(t!==undefined){t.count=a*3-t.start;r.push(t)}t={start:a*3,materialIndex:n}}}if(t!==undefined){t.count=a*3-t.start;r.push(t)}this.groups=r},fromGeometry:function(e){var t=e.faces;var r=e.vertices;var n=e.faceVertexUvs;var a=n[0]&&n[0].length>0;var o=n[1]&&n[1].length>0;var s=e.morphTargets;var h=s.length;if(h>0){var u=[];for(var l=0;l<h;l++){u[l]=[]}this.morphTargets.position=u}var c=e.morphNormals;var f=c.length;if(f>0){var d=[];for(var l=0;l<f;l++){d[l]=[]}this.morphTargets.normal=d}var p=e.skinIndices;var m=e.skinWeights;var v=p.length===r.length;var g=m.length===r.length;for(var l=0;l<t.length;l++){var y=t[l];this.vertices.push(r[y.a],r[y.b],r[y.c]);var x=y.vertexNormals;if(x.length===3){this.normals.push(x[0],x[1],x[2])}else{var b=y.normal;this.normals.push(b,b,b)}var w=y.vertexColors;if(w.length===3){this.colors.push(w[0],w[1],w[2])}else{var _=y.color;this.colors.push(_,_,_)}if(a===true){var M=n[0][l];if(M!==undefined){this.uvs.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l);this.uvs.push(new i.Vector2,new i.Vector2,new i.Vector2)}}if(o===true){var M=n[1][l];if(M!==undefined){this.uvs2.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l);this.uvs2.push(new i.Vector2,new i.Vector2,new i.Vector2)}}for(var S=0;S<h;S++){var T=s[S].vertices;u[S].push(T[y.a],T[y.b],T[y.c])}for(var S=0;S<f;S++){var E=c[S].vertexNormals[l];d[S].push(E.a,E.b,E.c)}if(v){this.skinIndices.push(p[y.a],p[y.b],p[y.c])}if(g){this.skinWeights.push(m[y.a],m[y.b],m[y.c])}}this.computeGroups(e);this.verticesNeedUpdate=e.verticesNeedUpdate;this.normalsNeedUpdate=e.normalsNeedUpdate;this.colorsNeedUpdate=e.colorsNeedUpdate;this.uvsNeedUpdate=e.uvsNeedUpdate;this.groupsNeedUpdate=e.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.DirectGeometry.prototype);i.BufferGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity}};i.BufferGeometry.prototype={constructor:i.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){if(t instanceof i.BufferAttribute===false&&t instanceof i.InterleavedBufferAttribute===false){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.addAttribute(e,new i.BufferAttribute(arguments[1],arguments[2]));return}if(e==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(t);return}this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups},get offsets(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups},addDrawCall:function(e,t,r){if(r!==undefined){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r!==undefined?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e;this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.applyToVector3Array(t.array);t.needsUpdate=true}var r=this.attributes.normal;if(r!==undefined){var n=(new i.Matrix3).getNormalMatrix(e);n.applyToVector3Array(r.array);r.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},rotateX:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationX(r);this.applyMatrix(e);return this}}(),rotateY:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationY(r);this.applyMatrix(e);return this}}(),rotateZ:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationZ(r);this.applyMatrix(e);return this}}(),translate:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeTranslation(r,n,a);this.applyMatrix(e);return this}}(),scale:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeScale(r,n,a);this.applyMatrix(e);return this}}(),lookAt:function(){var e;return function t(r){if(e===undefined)e=new i.Object3D;e.lookAt(r);e.updateMatrix();this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.translate(e.x,e.y,e.z);return e},setFromObject:function(e){var t=e.geometry;if(e instanceof i.Points||e instanceof i.Line){var r=new i.Float32Attribute(t.vertices.length*3,3);var n=new i.Float32Attribute(t.colors.length*3,3);this.addAttribute("position",r.copyVector3sArray(t.vertices));this.addAttribute("color",n.copyColorsArray(t.colors));if(t.lineDistances&&t.lineDistances.length===t.vertices.length){var a=new i.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",a.copyArray(t.lineDistances))}if(t.boundingSphere!==null){this.boundingSphere=t.boundingSphere.clone()}if(t.boundingBox!==null){this.boundingBox=t.boundingBox.clone()}}else if(e instanceof i.Mesh){if(t instanceof i.Geometry){this.fromGeometry(t)}}return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof i.Mesh){var r=t.__directGeometry;if(r===undefined){return this.fromGeometry(t)}r.verticesNeedUpdate=t.verticesNeedUpdate;r.normalsNeedUpdate=t.normalsNeedUpdate;r.colorsNeedUpdate=t.colorsNeedUpdate;r.uvsNeedUpdate=t.uvsNeedUpdate;r.groupsNeedUpdate=t.groupsNeedUpdate;t.verticesNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.uvsNeedUpdate=false;t.groupsNeedUpdate=false;t=r}if(t.verticesNeedUpdate===true){var n=this.attributes.position;if(n!==undefined){n.copyVector3sArray(t.vertices);n.needsUpdate=true}t.verticesNeedUpdate=false}if(t.normalsNeedUpdate===true){var n=this.attributes.normal;if(n!==undefined){n.copyVector3sArray(t.normals);n.needsUpdate=true}t.normalsNeedUpdate=false}if(t.colorsNeedUpdate===true){var n=this.attributes.color;if(n!==undefined){n.copyColorsArray(t.colors);n.needsUpdate=true}t.colorsNeedUpdate=false}if(t.uvsNeedUpdate){var n=this.attributes.uv;if(n!==undefined){n.copyVector2sArray(t.uvs);n.needsUpdate=true}t.uvsNeedUpdate=false}if(t.lineDistancesNeedUpdate){var n=this.attributes.lineDistance;if(n!==undefined){n.copyArray(t.lineDistances);n.needsUpdate=true}t.lineDistancesNeedUpdate=false}if(t.groupsNeedUpdate){t.computeGroups(e.geometry);this.groups=t.groups;t.groupsNeedUpdate=false}return this},fromGeometry:function(e){e.__directGeometry=(new i.DirectGeometry).fromGeometry(e);return this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);this.addAttribute("position",new i.BufferAttribute(t,3).copyVector3sArray(e.vertices));if(e.normals.length>0){var r=new Float32Array(e.normals.length*3);this.addAttribute("normal",new i.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(e.colors.length*3);this.addAttribute("color",new i.BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(e.uvs.length*2);this.addAttribute("uv",new i.BufferAttribute(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(e.uvs2.length*2);this.addAttribute("uv2",new i.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var s=e.vertices.length>65535?Uint32Array:Uint16Array;var h=new s(e.indices.length*3);this.setIndex(new i.BufferAttribute(h,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var u in e.morphTargets){var l=[];var c=e.morphTargets[u];for(var f=0,d=c.length;f<d;f++){var p=c[f];var m=new i.Float32Attribute(p.length*3,3);l.push(m.copyVector3sArray(p))}this.morphAttributes[u]=l}if(e.skinIndices.length>0){var v=new i.Float32Attribute(e.skinIndices.length*4,4);this.addAttribute("skinIndex",v.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var g=new i.Float32Attribute(e.skinWeights.length*4,4);this.addAttribute("skinWeight",g.copyVector4sArray(e.skinWeights))}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}return this},computeBoundingBox:function(){var e=new i.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var n=0,a=t.length;n<a;n+=3){e.fromArray(t,n);r.expandByPoint(e)}}if(t===undefined||t.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}}(),computeBoundingSphere:function(){var e=new i.Box3;var t=new i.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}var r=this.attributes.position.array;if(r){e.makeEmpty();var n=this.boundingSphere.center;for(var a=0,o=r.length;a<o;a+=3){t.fromArray(r,a);e.expandByPoint(t)}e.center(n);var s=0;for(var a=0,o=r.length;a<o;a+=3){t.fromArray(r,a);s=Math.max(s,n.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(s);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index;var t=this.attributes;var r=this.groups;if(t.position){var n=t.position.array;if(t.normal===undefined){this.addAttribute("normal",new i.BufferAttribute(new Float32Array(n.length),3))}else{var a=t.normal.array;for(var o=0,s=a.length;o<s;o++){a[o]=0}}var a=t.normal.array;var h,u,l,c=new i.Vector3,f=new i.Vector3,d=new i.Vector3,p=new i.Vector3,m=new i.Vector3;if(e){var v=e.array;if(r.length===0){this.addGroup(0,v.length)}for(var g=0,y=r.length;g<y;++g){var x=r[g];var b=x.start;var w=x.count;for(var o=b,s=b+w;o<s;o+=3){h=v[o+0]*3;u=v[o+1]*3;l=v[o+2]*3;c.fromArray(n,h);f.fromArray(n,u);d.fromArray(n,l);p.subVectors(d,f);m.subVectors(c,f);p.cross(m);a[h]+=p.x;a[h+1]+=p.y;a[h+2]+=p.z;a[u]+=p.x;a[u+1]+=p.y;a[u+2]+=p.z;a[l]+=p.x;a[l+1]+=p.y;a[l+2]+=p.z}}}else{for(var o=0,s=n.length;o<s;o+=9){c.fromArray(n,o);f.fromArray(n,o+3);d.fromArray(n,o+6);p.subVectors(d,f);m.subVectors(c,f);p.cross(m);a[o]=p.x;a[o+1]=p.y;a[o+2]=p.z;a[o+3]=p.x;a[o+4]=p.y;a[o+5]=p.z;a[o+6]=p.x;a[o+7]=p.y;a[o+8]=p.z}}this.normalizeNormals();t.normal.needsUpdate=true}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(e instanceof i.BufferGeometry===false){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===undefined)t=0;var r=this.attributes;for(var n in r){if(e.attributes[n]===undefined)continue;var a=r[n];var o=a.array;var s=e.attributes[n];var h=s.array;var u=s.itemSize;for(var l=0,c=u*t;l<h.length;l++,c++){o[c]=h[l]}}return this},normalizeNormals:function(){var e=this.attributes.normal.array;var t,r,n,i;for(var a=0,o=e.length;a<o;a+=3){t=e[a];r=e[a+1];n=e[a+2];i=1/Math.sqrt(t*t+r*r+n*n);e[a]*=i;e[a+1]*=i;e[a+2]*=i}},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var r in t){if(t[r]!==undefined)e[r]=t[r]}return e}e.data={attributes:{}};var n=this.index;if(n!==null){var i=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:i}}var a=this.attributes;for(var r in a){var o=a[r];var i=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:i}}var s=this.groups;if(s.length>0){e.data.groups=JSON.parse(JSON.stringify(s))}var h=this.boundingSphere;if(h!==null){e.data.boundingSphere={center:h.center.toArray(),radius:h.radius}}return e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;if(t!==null){this.setIndex(t.clone())}var r=e.attributes;for(var n in r){var i=r[n];this.addAttribute(n,i.clone())}var a=e.groups;for(var o=0,s=a.length;o<s;o++){var h=a[o];this.addGroup(h.start,h.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.BufferGeometry.prototype);i.BufferGeometry.MaxIndex=65535;i.InstancedBufferGeometry=function(){i.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=undefined};i.InstancedBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.InstancedBufferGeometry.prototype.constructor=i.InstancedBufferGeometry;i.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})};i.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;if(t!==null){this.setIndex(t.clone())}var r=e.attributes;for(var n in r){var i=r[n];this.addAttribute(n,i.clone())}var a=e.groups;for(var o=0,s=a.length;o<s;o++){var h=a[o];this.addGroup(h.start,h.count,h.instances)}return this};i.EventDispatcher.prototype.apply(i.InstancedBufferGeometry.prototype);i.AnimationAction=function(e,t,r,n,a){if(e===undefined)throw new Error("clip is null");this.clip=e;this.localRoot=null;this.startTime=t||0;this.timeScale=r||1;this.weight=n||1;this.loop=a||i.LoopRepeat;this.loopCount=0;this.enabled=true;this.actionTime=-this.startTime;this.clipTime=0;this.propertyBindings=[]};i.AnimationAction.prototype={constructor:i.AnimationAction,setLocalRoot:function(e){this.localRoot=e;return this},updateTime:function(e){var t=this.clipTime;var r=this.loopCount;var n=this.actionTime;var a=this.clip.duration;this.actionTime=this.actionTime+e;if(this.loop===i.LoopOnce){this.loopCount=0;this.clipTime=Math.min(Math.max(this.actionTime,0),a);if(this.clipTime!==t){if(this.clipTime===a){this.mixer.dispatchEvent({type:"finished",action:this,direction:1})}else if(this.clipTime===0){this.mixer.dispatchEvent({type:"finished",action:this,direction:-1})}}return this.clipTime}this.loopCount=Math.floor(this.actionTime/a);var o=this.actionTime-this.loopCount*a;o=o%a;if(this.loop==i.LoopPingPong){if(Math.abs(this.loopCount%2)===1){o=a-o}}this.clipTime=o;if(this.loopCount!==r){this.mixer.dispatchEvent({type:"loop",action:this,loopDelta:this.loopCount-this.loopCount})}return this.clipTime},syncWith:function(e){this.actionTime=e.actionTime;this.timeScale=e.timeScale;return this},warpToDuration:function(e){this.timeScale=this.clip.duration/e;return this},init:function(e){this.clipTime=e-this.startTime;return this},update:function(e){this.updateTime(e);var t=this.clip.getAt(this.clipTime);return t},getTimeScaleAt:function(e){if(this.timeScale.getAt){return this.timeScale.getAt(e)}return this.timeScale},getWeightAt:function(e){if(this.weight.getAt){return this.weight.getAt(e)}return this.weight}};i.AnimationClip=function(e,t,r){this.name=e;this.tracks=r;this.duration=t!==undefined?t:-1;if(this.duration<0){for(var n=0;n<this.tracks.length;n++){var i=this.tracks[n];this.duration=Math.max(i.keys[i.keys.length-1].time)}}this.trim();this.optimize();this.results=[]};i.AnimationClip.prototype={constructor:i.AnimationClip,getAt:function(e){e=Math.max(0,Math.min(e,this.duration));for(var t=0;t<this.tracks.length;t++){var r=this.tracks[t];this.results[t]=r.getAt(e)}return this.results},trim:function(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].trim(0,this.duration)}return this},optimize:function(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].optimize()}return this}};i.AnimationClip.CreateFromMorphTargetSequence=function(e,t,r){var n=t.length;var a=[];for(var o=0;o<n;o++){var s=[];s.push({time:(o+n-1)%n,value:0});s.push({time:o,value:1});s.push({time:(o+1)%n,value:0});s.sort(i.KeyframeTrack.keyComparer);if(s[0].time===0){s.push({time:n,value:s[0].value})}a.push(new i.NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",s).scale(1/r))}return new i.AnimationClip(e,-1,a)};i.AnimationClip.findByName=function(e,t){for(var r=0;r<e.length;r++){if(e[r].name===t){return e[r]}}return null};i.AnimationClip.CreateClipsFromMorphTargetSequences=function(e,t){var r={};var n=/^([\w-]*?)([\d]+)$/;for(var a=0,o=e.length;a<o;a++){var s=e[a];var h=s.name.match(n);if(h&&h.length>1){var u=h[1];var l=r[u];if(!l){r[u]=l=[]}l.push(s)}}var c=[];for(var u in r){c.push(i.AnimationClip.CreateFromMorphTargetSequence(u,r[u],t))}return c};i.AnimationClip.parse=function(e){var t=[];for(var r=0;r<e.tracks.length;r++){t.push(i.KeyframeTrack.parse(e.tracks[r]).scale(1/e.fps))}return new i.AnimationClip(e.name,e.duration,t)};i.AnimationClip.parseAnimation=function(e,t,r){if(!e){console.error("  no animation in JSONLoader data");return null}var n=function(e,t,r,n,i){var a=[];for(var o=0;o<t.length;o++){var s=t[o];if(s[r]!==undefined){a.push({time:s.time,value:i(s)})}}if(a.length>0){return new n(e,a)}return null};var a=[];var o=e.name||"default";var s=e.length||-1;var h=e.fps||30;var u=e.hierarchy||[];for(var l=0;l<u.length;l++){var c=u[l].keys;if(!c||c.length==0){continue}if(c[0].morphTargets){var f={};for(var d=0;d<c.length;d++){if(c[d].morphTargets){for(var p=0;p<c[d].morphTargets.length;p++){f[c[d].morphTargets[p]]=-1}}}for(var m in f){var v=[];for(var p=0;p<c[d].morphTargets.length;p++){var g=c[d];v.push({time:g.time,value:g.morphTarget===m?1:0})}a.push(new i.NumberKeyframeTrack(r+".morphTargetInfluence["+m+"]",v))}s=f.length*(h||1)}else{var y=r+".bones["+t[l].name+"]";var x=n(y+".position",c,"pos",i.VectorKeyframeTrack,function(e){return(new i.Vector3).fromArray(e.pos)});if(x)a.push(x);var b=n(y+".quaternion",c,"rot",i.QuaternionKeyframeTrack,function(e){if(e.rot.slerp){return e.rot.clone()}else{return(new i.Quaternion).fromArray(e.rot)}});if(b)a.push(b);var w=n(y+".scale",c,"scl",i.VectorKeyframeTrack,function(e){return(new i.Vector3).fromArray(e.scl)});if(w)a.push(w)}}if(a.length===0){return null}var _=new i.AnimationClip(o,s,a);return _};i.AnimationMixer=function(e){this.root=e;this.time=0;this.timeScale=1;this.actions=[];this.propertyBindingMap={}};i.AnimationMixer.prototype={constructor:i.AnimationMixer,addAction:function(e){this.actions.push(e);e.init(this.time);e.mixer=this;var t=e.clip.tracks;var r=e.localRoot||this.root;for(var n=0;n<t.length;n++){var a=t[n];var o=r.uuid+"-"+a.name;var s=this.propertyBindingMap[o];if(s===undefined){s=new i.PropertyBinding(r,a.name);this.propertyBindingMap[o]=s;
}e.propertyBindings.push(s);s.referenceCount+=1}},removeAllActions:function(){for(var e=0;e<this.actions.length;e++){this.actions[e].mixer=null}for(var t in this.propertyBindingMap){this.propertyBindingMap[t].unbind()}this.actions=[];this.propertyBindingMap={};return this},removeAction:function(e){var t=this.actions.indexOf(e);if(t!==-1){this.actions.splice(t,1);e.mixer=null}var r=e.localRoot||this.root;var n=e.clip.tracks;for(var i=0;i<n.length;i++){var a=n[i];var o=r.uuid+"-"+a.name;var s=this.propertyBindingMap[o];s.referenceCount-=1;if(s.referenceCount<=0){s.unbind();delete this.propertyBindingMap[o]}}return this},findActionByName:function(e){for(var t=0;t<this.actions.length;t++){if(this.actions[t].name===e)return this.actions[t]}return null},play:function(e,t){e.startTime=this.time;this.addAction(e);return this},fadeOut:function(e,t){var r=[];r.push({time:this.time,value:1});r.push({time:this.time+t,value:0});e.weight=new i.NumberKeyframeTrack("weight",r);return this},fadeIn:function(e,t){var r=[];r.push({time:this.time,value:0});r.push({time:this.time+t,value:1});e.weight=new i.NumberKeyframeTrack("weight",r);return this},warp:function(e,t,r,n){var a=[];a.push({time:this.time,value:t});a.push({time:this.time+n,value:r});e.timeScale=new i.NumberKeyframeTrack("timeScale",a);return this},crossFade:function(e,t,r,n){this.fadeOut(e,r);this.fadeIn(t,r);if(n){var i=e.clip.duration/t.clip.duration;var a=1/i;this.warp(e,1,i,r);this.warp(t,a,1,r)}return this},update:function(e){var t=e*this.timeScale;this.time+=t;for(var r=0;r<this.actions.length;r++){var n=this.actions[r];var i=n.getWeightAt(this.time);var a=n.getTimeScaleAt(this.time);var o=t*a;var s=n.update(o);if(n.weight<=0||!n.enabled)continue;for(var h=0;h<s.length;h++){var u=n.clip.tracks[h].name;n.propertyBindings[h].accumulate(s[h],i)}}for(var l in this.propertyBindingMap){this.propertyBindingMap[l].apply()}return this}};i.EventDispatcher.prototype.apply(i.AnimationMixer.prototype);i.AnimationUtils={getEqualsFunc:function(e){if(e.equals){return function t(e,r){return e.equals(r)}}return function r(e,t){return e===t}},clone:function(e){var t=typeof e;if(t==="object"){if(e.clone){return e.clone()}console.error("can not figure out how to copy exemplarValue",e)}return e},lerp:function(e,t,r,n){var a=i.AnimationUtils.getLerpFunc(e,n);return a(e,t,r)},lerp_object:function(e,t,r){return e.lerp(t,r)},slerp_object:function(e,t,r){return e.slerp(t,r)},lerp_number:function(e,t,r){return e*(1-r)+t*r},lerp_boolean:function(e,t,r){return r<.5?e:t},lerp_boolean_immediate:function(e,t,r){return e},lerp_string:function(e,t,r){return r<.5?e:t},lerp_string_immediate:function(e,t,r){return e},getLerpFunc:function(e,t){if(e===undefined||e===null)throw new Error("examplarValue is null");var r=typeof e;switch(r){case"object":if(e.lerp){return i.AnimationUtils.lerp_object}if(e.slerp){return i.AnimationUtils.slerp_object}break;case"number":return i.AnimationUtils.lerp_number;case"boolean":if(t){return i.AnimationUtils.lerp_boolean}else{return i.AnimationUtils.lerp_boolean_immediate}case"string":if(t){return i.AnimationUtils.lerp_string}else{return i.AnimationUtils.lerp_string_immediate}}}};i.KeyframeTrack=function(e,t){if(e===undefined)throw new Error("track name is undefined");if(t===undefined||t.length===0)throw new Error("no keys in track named "+e);this.name=e;this.keys=t;this.lastIndex=0;this.validate();this.optimize()};i.KeyframeTrack.prototype={constructor:i.KeyframeTrack,getAt:function(e){while(this.lastIndex<this.keys.length&&e>=this.keys[this.lastIndex].time){this.lastIndex++}while(this.lastIndex>0&&e<this.keys[this.lastIndex-1].time){this.lastIndex--}if(this.lastIndex>=this.keys.length){this.setResult(this.keys[this.keys.length-1].value);return this.result}if(this.lastIndex===0){this.setResult(this.keys[0].value);return this.result}var t=this.keys[this.lastIndex-1];this.setResult(t.value);if(t.constantToNext){return this.result}var r=this.keys[this.lastIndex];var n=(e-t.time)/(r.time-t.time);this.result=this.lerpValues(this.result,r.value,n);return this.result},shift:function(e){if(e!==0){for(var t=0;t<this.keys.length;t++){this.keys[t].time+=e}}return this},scale:function(e){if(e!==1){for(var t=0;t<this.keys.length;t++){this.keys[t].time*=e}}return this},trim:function(e,t){var r=0;for(var n=1;n<this.keys.length;n++){if(this.keys[n]<=e){r++}}var i=0;for(var n=this.keys.length-2;n>0;n++){if(this.keys[n]>=t){i++}else{break}}if(r+i>0){this.keys=this.keys.splice(r,this.keys.length-i-r)}return this},validate:function(){var e=null;if(this.keys.length===0){console.error("  track is empty, no keys",this);return}for(var t=0;t<this.keys.length;t++){var r=this.keys[t];if(!r){console.error("  key is null in track",this,t);return}if(typeof r.time!=="number"||isNaN(r.time)){console.error("  key.time is not a valid number",this,t,r);return}if(r.value===undefined||r.value===null){console.error("  key.value is null in track",this,t,r);return}if(e&&e.time>r.time){console.error("  key.time is less than previous key time, out of order keys",this,t,r,e);return}e=r}return this},optimize:function(){var e=[];var t=this.keys[0];e.push(t);var r=i.AnimationUtils.getEqualsFunc(t.value);for(var n=1;n<this.keys.length-1;n++){var a=this.keys[n];var o=this.keys[n+1];if(t.time===a.time){continue}if(this.compareValues(t.value,a.value)&&this.compareValues(a.value,o.value)){continue}t.constantToNext=this.compareValues(t.value,a.value);e.push(a);t=a}e.push(this.keys[this.keys.length-1]);this.keys=e;return this}};i.KeyframeTrack.keyComparer=function a(e,t){return e.time-t.time};i.KeyframeTrack.parse=function(e){if(e.type===undefined)throw new Error("track type undefined, can not parse");var t=i.KeyframeTrack.GetTrackTypeForTypeName(e.type);return t.parse(e)};i.KeyframeTrack.GetTrackTypeForTypeName=function(e){switch(e.toLowerCase()){case"vector":case"vector2":case"vector3":case"vector4":return i.VectorKeyframeTrack;case"quaternion":return i.QuaternionKeyframeTrack;case"integer":case"scalar":case"double":case"float":case"number":return i.NumberKeyframeTrack;case"bool":case"boolean":return i.BooleanKeyframeTrack;case"string":return i.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)};i.PropertyBinding=function(e,t){this.rootNode=e;this.trackName=t;this.referenceCount=0;this.originalValue=null;var r=i.PropertyBinding.parseTrackName(t);this.directoryName=r.directoryName;this.nodeName=r.nodeName;this.objectName=r.objectName;this.objectIndex=r.objectIndex;this.propertyName=r.propertyName;this.propertyIndex=r.propertyIndex;this.node=i.PropertyBinding.findNode(e,this.nodeName)||e;this.cumulativeValue=null;this.cumulativeWeight=0};i.PropertyBinding.prototype={constructor:i.PropertyBinding,reset:function(){this.cumulativeValue=null;this.cumulativeWeight=0},accumulate:function(e,t){if(!this.isBound)this.bind();if(this.cumulativeWeight===0){if(t>0){if(this.cumulativeValue===null){this.cumulativeValue=i.AnimationUtils.clone(e)}this.cumulativeWeight=t}}else{var r=t/(this.cumulativeWeight+t);this.cumulativeValue=this.lerpValue(this.cumulativeValue,e,r);this.cumulativeWeight+=t}},unbind:function(){if(!this.isBound)return;this.setValue(this.originalValue);this.setValue=null;this.getValue=null;this.lerpValue=null;this.equalsValue=null;this.triggerDirty=null;this.isBound=false},bind:function(){if(this.isBound)return;var e=this.node;if(!e){console.error("  trying to update node for track: "+this.trackName+" but it wasn't found.");return}if(this.objectName){if(this.objectName==="materials"){if(!e.material){console.error("  can not bind to material as node does not have a material",this);return}if(!e.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}e=e.material.materials}else if(this.objectName==="bones"){if(!e.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}e=e.skeleton.bones;for(var t=0;t<e.length;t++){if(e[t].name===this.objectIndex){this.objectIndex=t;break}}}else{if(e[this.objectName]===undefined){console.error("  can not bind to objectName of node, undefined",this);return}e=e[this.objectName]}if(this.objectIndex!==undefined){if(e[this.objectIndex]===undefined){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);return}e=e[this.objectIndex]}}var r=e[this.propertyName];if(!r){console.error("  trying to update property for track: "+this.nodeName+"."+this.propertyName+" but it wasn't found.",e);return}if(this.propertyIndex!==undefined){if(this.propertyName==="morphTargetInfluences"){if(!e.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this)}if(!e.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this)}for(var t=0;t<this.node.geometry.morphTargets.length;t++){if(e.geometry.morphTargets[t].name===this.propertyIndex){this.propertyIndex=t;break}}}this.setValue=function n(e){if(!this.equalsValue(r[this.propertyIndex],e)){r[this.propertyIndex]=e;return true}return false};this.getValue=function a(){return r[this.propertyIndex]}}else if(r.copy){this.setValue=function o(e){if(!this.equalsValue(r,e)){r.copy(e);return true}return false};this.getValue=function s(){return r}}else{this.setValue=function h(t){if(!this.equalsValue(e[this.propertyName],t)){e[this.propertyName]=t;return true}return false};this.getValue=function u(){return e[this.propertyName]}}if(e.needsUpdate!==undefined){this.triggerDirty=function l(){this.node.needsUpdate=true}}else if(e.matrixWorldNeedsUpdate!==undefined){this.triggerDirty=function c(){e.matrixWorldNeedsUpdate=true}}this.originalValue=this.getValue();this.equalsValue=i.AnimationUtils.getEqualsFunc(this.originalValue);this.lerpValue=i.AnimationUtils.getLerpFunc(this.originalValue,true);this.isBound=true},apply:function(){if(!this.isBound)this.bind();if(this.cumulativeWeight>0){if(this.cumulativeWeight<1){var e=1-this.cumulativeWeight;var t=e/(this.cumulativeWeight+e);this.cumulativeValue=this.lerpValue(this.cumulativeValue,this.originalValue,t)}var r=this.setValue(this.cumulativeValue);if(r&&this.triggerDirty){this.triggerDirty()}this.cumulativeValue=null;this.cumulativeWeight=0}}};i.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/;var r=t.exec(e);if(!r){throw new Error("cannot parse trackName at all: "+e)}if(r.index===t.lastIndex){t.lastIndex++}var n={directoryName:r[1],nodeName:r[3],objectName:r[5],objectIndex:r[7],propertyName:r[9],propertyIndex:r[11]};if(n.propertyName===null||n.propertyName.length===0){throw new Error("can not parse propertyName from trackName: "+e)}return n};i.PropertyBinding.findNode=function(e,t){function r(e){for(var r=0;r<e.bones.length;r++){var n=e.bones[r];if(n.name===t){return n}}return null}function n(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t){return i}var a=n(i.children);if(a)return a}return null}if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid){return e}if(e.skeleton){var i=r(e.skeleton);if(i){return i}}if(e.children){var a=n(e.children);if(a){return a}}return null};i.VectorKeyframeTrack=function(e,t){i.KeyframeTrack.call(this,e,t);this.result=this.keys[0].value.clone()};i.VectorKeyframeTrack.prototype=Object.create(i.KeyframeTrack.prototype);i.VectorKeyframeTrack.prototype.constructor=i.VectorKeyframeTrack;i.VectorKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)};i.VectorKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.lerp(t,r)};i.VectorKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)};i.VectorKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new i.VectorKeyframeTrack(this.name,e)};i.VectorKeyframeTrack.parse=function(e){var t=e.keys[0].value.length;var r=i["Vector"+t];var n=[];for(var a=0;a<e.keys.length;a++){var o=e.keys[a];n.push({value:(new r).fromArray(o.value),time:o.time})}return new i.VectorKeyframeTrack(e.name,n)};i.QuaternionKeyframeTrack=function(e,t){i.KeyframeTrack.call(this,e,t);this.result=this.keys[0].value.clone()};i.QuaternionKeyframeTrack.prototype=Object.create(i.KeyframeTrack.prototype);i.QuaternionKeyframeTrack.prototype.constructor=i.QuaternionKeyframeTrack;i.QuaternionKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)};i.QuaternionKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.slerp(t,r)};i.QuaternionKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)};i.QuaternionKeyframeTrack.prototype.multiply=function(e){for(var t=0;t<this.keys.length;t++){this.keys[t].value.multiply(e)}return this};i.QuaternionKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new i.QuaternionKeyframeTrack(this.name,e)};i.QuaternionKeyframeTrack.parse=function(e){var t=[];for(var r=0;r<e.keys.length;r++){var n=e.keys[r];t.push({value:(new i.Quaternion).fromArray(n.value),time:n.time})}return new i.QuaternionKeyframeTrack(e.name,t)};i.StringKeyframeTrack=function(e,t){i.KeyframeTrack.call(this,e,t);this.result=this.keys[0].value};i.StringKeyframeTrack.prototype=Object.create(i.KeyframeTrack.prototype);i.StringKeyframeTrack.prototype.constructor=i.StringKeyframeTrack;i.StringKeyframeTrack.prototype.setResult=function(e){this.result=e};i.StringKeyframeTrack.prototype.lerpValues=function(e,t,r){return r<1?e:t};i.StringKeyframeTrack.prototype.compareValues=function(e,t){return e===t};i.StringKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new i.StringKeyframeTrack(this.name,e)};i.StringKeyframeTrack.parse=function(e){return new i.StringKeyframeTrack(e.name,e.keys)};i.BooleanKeyframeTrack=function(e,t){i.KeyframeTrack.call(this,e,t);this.result=this.keys[0].value};i.BooleanKeyframeTrack.prototype=Object.create(i.KeyframeTrack.prototype);i.BooleanKeyframeTrack.prototype.constructor=i.BooleanKeyframeTrack;i.BooleanKeyframeTrack.prototype.setResult=function(e){this.result=e};i.BooleanKeyframeTrack.prototype.lerpValues=function(e,t,r){return r<1?e:t};i.BooleanKeyframeTrack.prototype.compareValues=function(e,t){return e===t};i.BooleanKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new i.BooleanKeyframeTrack(this.name,e)};i.BooleanKeyframeTrack.parse=function(e){return new i.BooleanKeyframeTrack(e.name,e.keys)};i.NumberKeyframeTrack=function(e,t){i.KeyframeTrack.call(this,e,t);this.result=this.keys[0].value};i.NumberKeyframeTrack.prototype=Object.create(i.KeyframeTrack.prototype);i.NumberKeyframeTrack.prototype.constructor=i.NumberKeyframeTrack;i.NumberKeyframeTrack.prototype.setResult=function(e){this.result=e};i.NumberKeyframeTrack.prototype.lerpValues=function(e,t,r){return e*(1-r)+t*r};i.NumberKeyframeTrack.prototype.compareValues=function(e,t){return e===t};i.NumberKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new i.NumberKeyframeTrack(this.name,e)};i.NumberKeyframeTrack.parse=function(e){return new i.NumberKeyframeTrack(e.name,e.keys)};i.Camera=function(){i.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new i.Matrix4;this.projectionMatrix=new i.Matrix4};i.Camera.prototype=Object.create(i.Object3D.prototype);i.Camera.prototype.constructor=i.Camera;i.Camera.prototype.getWorldDirection=function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;this.getWorldQuaternion(e);return r.set(0,0,-1).applyQuaternion(e)}}();i.Camera.prototype.lookAt=function(){var e=new i.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();i.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};i.Camera.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);return this};i.CubeCamera=function(e,t,r){i.Object3D.call(this);this.type="CubeCamera";var n=90,a=1;var o=new i.PerspectiveCamera(n,a,e,t);o.up.set(0,-1,0);o.lookAt(new i.Vector3(1,0,0));this.add(o);var s=new i.PerspectiveCamera(n,a,e,t);s.up.set(0,-1,0);s.lookAt(new i.Vector3(-1,0,0));this.add(s);var h=new i.PerspectiveCamera(n,a,e,t);h.up.set(0,0,1);h.lookAt(new i.Vector3(0,1,0));this.add(h);var u=new i.PerspectiveCamera(n,a,e,t);u.up.set(0,0,-1);u.lookAt(new i.Vector3(0,-1,0));this.add(u);var l=new i.PerspectiveCamera(n,a,e,t);l.up.set(0,-1,0);l.lookAt(new i.Vector3(0,0,1));this.add(l);var c=new i.PerspectiveCamera(n,a,e,t);c.up.set(0,-1,0);c.lookAt(new i.Vector3(0,0,-1));this.add(c);this.renderTarget=new i.WebGLRenderTargetCube(r,r,{format:i.RGBFormat,magFilter:i.LinearFilter,minFilter:i.LinearFilter});this.updateCubeMap=function(e,t){if(this.parent===null)this.updateMatrixWorld();var r=this.renderTarget;var n=r.texture.generateMipmaps;r.texture.generateMipmaps=false;r.activeCubeFace=0;e.render(t,o,r);r.activeCubeFace=1;e.render(t,s,r);r.activeCubeFace=2;e.render(t,h,r);r.activeCubeFace=3;e.render(t,u,r);r.activeCubeFace=4;e.render(t,l,r);r.texture.generateMipmaps=n;r.activeCubeFace=5;e.render(t,c,r);e.setRenderTarget(null)}};i.CubeCamera.prototype=Object.create(i.Object3D.prototype);i.CubeCamera.prototype.constructor=i.CubeCamera;i.OrthographicCamera=function(e,t,r,n,a,o){i.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=t;this.top=r;this.bottom=n;this.near=a!==undefined?a:.1;this.far=o!==undefined?o:2e3;this.updateProjectionMatrix()};i.OrthographicCamera.prototype=Object.create(i.Camera.prototype);i.OrthographicCamera.prototype.constructor=i.OrthographicCamera;i.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var r=(this.right+this.left)/2;var n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,n+t,n-t,this.near,this.far)};i.OrthographicCamera.prototype.copy=function(e){i.Camera.prototype.copy.call(this,e);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;return this};i.OrthographicCamera.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.zoom=this.zoom;t.object.left=this.left;t.object.right=this.right;t.object.top=this.top;t.object.bottom=this.bottom;t.object.near=this.near;t.object.far=this.far;return t};i.PerspectiveCamera=function(e,t,r,n){i.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=r!==undefined?r:.1;this.far=n!==undefined?n:2e3;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype);i.PerspectiveCamera.prototype.constructor=i.PerspectiveCamera;i.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*i.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,n,i,a){this.fullWidth=e;this.fullHeight=t;this.x=r;this.y=n;this.width=i;this.height=a;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=i.Math.radToDeg(2*Math.atan(Math.tan(i.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight;var r=Math.tan(i.Math.degToRad(e*.5))*this.near;var n=-r;var a=t*n;var o=t*r;var s=Math.abs(o-a);var h=Math.abs(r-n);this.projectionMatrix.makeFrustum(a+this.x*s/this.fullWidth,a+(this.x+this.width)*s/this.fullWidth,r-(this.y+this.height)*h/this.fullHeight,r-this.y*h/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)}};i.PerspectiveCamera.prototype.copy=function(e){i.Camera.prototype.copy.call(this,e);this.fov=e.fov;this.aspect=e.aspect;this.near=e.near;this.far=e.far;this.zoom=e.zoom;return this};i.PerspectiveCamera.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.zoom=this.zoom;t.object.fov=this.fov;t.object.aspect=this.aspect;t.object.near=this.near;t.object.far=this.far;return t};i.Light=function(e){i.Object3D.call(this);this.type="Light";this.color=new i.Color(e);this.receiveShadow=undefined};i.Light.prototype=Object.create(i.Object3D.prototype);i.Light.prototype.constructor=i.Light;Object.defineProperties(i.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow ) instead.")}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(e){this.shadow.darkness=e}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}});i.Light.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.color.copy(e.color);return this};i.Light.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();if(this.groundColor!==undefined)t.object.groundColor=this.groundColor.getHex();if(this.intensity!==undefined)t.object.intensity=this.intensity;if(this.distance!==undefined)t.object.distance=this.distance;if(this.angle!==undefined)t.object.angle=this.angle;if(this.decay!==undefined)t.object.decay=this.decay;if(this.exponent!==undefined)t.object.exponent=this.exponent;return t};i.LightShadow=function(e){this.camera=e;this.bias=0;this.darkness=1;this.mapSize=new i.Vector2(512,512);this.map=null;this.matrix=null};i.LightShadow.prototype={constructor:i.LightShadow,copy:function(e){this.camera=e.camera.clone();this.bias=e.bias;this.darkness=e.darkness;this.mapSize.copy(e.mapSize)},clone:function(){return(new this.constructor).copy(this)}};i.AmbientLight=function(e){i.Light.call(this,e);this.type="AmbientLight";this.castShadow=undefined};i.AmbientLight.prototype=Object.create(i.Light.prototype);i.AmbientLight.prototype.constructor=i.AmbientLight;i.DirectionalLight=function(e,t){i.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.updateMatrix();this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.shadow=new i.LightShadow(new i.OrthographicCamera(-500,500,500,-500,50,5e3))};i.DirectionalLight.prototype=Object.create(i.Light.prototype);i.DirectionalLight.prototype.constructor=i.DirectionalLight;i.DirectionalLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.intensity=e.intensity;this.target=e.target.clone();this.shadow=e.shadow.clone();return this};i.HemisphereLight=function(e,t,r){i.Light.call(this,e);this.type="HemisphereLight";this.castShadow=undefined;this.position.set(0,1,0);this.updateMatrix();this.groundColor=new i.Color(t);this.intensity=r!==undefined?r:1};i.HemisphereLight.prototype=Object.create(i.Light.prototype);i.HemisphereLight.prototype.constructor=i.HemisphereLight;i.HemisphereLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);this.intensity=e.intensity;return this};i.PointLight=function(e,t,r,n){i.Light.call(this,e);this.type="PointLight";this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.decay=n!==undefined?n:1;this.shadow=new i.LightShadow(new i.PerspectiveCamera(90,1,1,500))};i.PointLight.prototype=Object.create(i.Light.prototype);i.PointLight.prototype.constructor=i.PointLight;i.PointLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.intensity=e.intensity;this.distance=e.distance;this.decay=e.decay;this.shadow=e.shadow.clone();return this};i.SpotLight=function(e,t,r,n,a,o){i.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.updateMatrix();this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.angle=n!==undefined?n:Math.PI/3;this.exponent=a!==undefined?a:10;this.decay=o!==undefined?o:1;this.shadow=new i.LightShadow(new i.PerspectiveCamera(50,1,50,5e3))};i.SpotLight.prototype=Object.create(i.Light.prototype);i.SpotLight.prototype.constructor=i.SpotLight;i.SpotLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.intensity=e.intensity;this.distance=e.distance;this.angle=e.angle;this.exponent=e.exponent;this.decay=e.decay;this.target=e.target.clone();this.shadow=e.shadow.clone();return this};i.Cache={enabled:false,files:{},add:function(e,t){if(this.enabled===false)return;this.files[e]=t},get:function(e){if(this.enabled===false)return;return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};i.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};i.Loader.prototype={constructor:i.Loader,crossOrigin:undefined,extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t,r){var n=[];for(var i=0;i<e.length;++i){n[i]=this.createMaterial(e[i],t,r)}return n},createMaterial:function(){var e,t,r;return function(n,a,o){if(e===undefined)e=new i.Color;if(t===undefined)t=new i.TextureLoader;if(r===undefined)r=new i.MaterialLoader;var s={};function h(e,r,n,h,u){var l=a+e;var c=i.Loader.Handlers.get(l);var f;if(c!==null){f=c.load(l)}else{t.setCrossOrigin(o);f=t.load(l)}if(r!==undefined){f.repeat.fromArray(r);if(r[0]!==1)f.wrapS=i.RepeatWrapping;if(r[1]!==1)f.wrapT=i.RepeatWrapping}if(n!==undefined){f.offset.fromArray(n)}if(h!==undefined){if(h[0]==="repeat")f.wrapS=i.RepeatWrapping;if(h[0]==="mirror")f.wrapS=i.MirroredRepeatWrapping;if(h[1]==="repeat")f.wrapT=i.RepeatWrapping;if(h[1]==="mirror")f.wrapT=i.MirroredRepeatWrapping}if(u!==undefined){f.anisotropy=u}var d=i.Math.generateUUID();s[d]=f;return d}var u={uuid:i.Math.generateUUID(),type:"MeshLambertMaterial"};for(var l in n){var c=n[l];switch(l){case"DbgColor":u.color=c;break;case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":u.name=c;break;case"blending":u.blending=i[c];break;case"colorDiffuse":u.color=e.fromArray(c).getHex();break;case"colorSpecular":u.specular=e.fromArray(c).getHex();break;case"colorEmissive":u.emissive=e.fromArray(c).getHex();break;case"specularCoef":u.shininess=c;break;case"shading":if(c.toLowerCase()==="basic")u.type="MeshBasicMaterial";if(c.toLowerCase()==="phong")u.type="MeshPhongMaterial";break;case"mapDiffuse":u.map=h(c,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":u.lightMap=h(c,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":u.aoMap=h(c,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":u.bumpMap=h(c,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":u.bumpScale=c;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":u.normalMap=h(c,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":u.normalScale=[c,c];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":u.specularMap=h(c,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":u.alphaMap=h(c,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":u.side=i.BackSide;break;case"doubleSided":u.side=i.DoubleSide;break;case"transparency":console.warn("THREE.Loader: transparency has been renamed to opacity");u.opacity=c;break;case"opacity":case"transparent":case"depthTest":case"depthWrite":case"transparent":case"visible":case"wireframe":u[l]=c;break;case"vertexColors":if(c===true)u.vertexColors=i.VertexColors;if(c==="face")u.vertexColors=i.FaceColors;break;default:console.error("Loader.createMaterial: Unsupported",l,c);break}}if(u.type!=="MeshPhongMaterial")delete u.specular;if(u.opacity<1)u.transparent=true;r.setTextures(s);return r.parse(u)}}()};i.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){var t=this.handlers;for(var r=0,n=t.length;r<n;r+=2){var i=t[r];var a=t[r+1];if(i.test(e)){return a}}return null}};i.XHRLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.XHRLoader.prototype={constructor:i.XHRLoader,load:function(e,t,r,n){var a=this;var o=i.Cache.get(e);if(o!==undefined){if(t){setTimeout(function(){t(o)},0)}return o}var s=new XMLHttpRequest;s.open("GET",e,true);s.addEventListener("load",function(r){var n=r.target.response;i.Cache.add(e,n);if(t)t(n);a.manager.itemEnd(e)},false);if(r!==undefined){s.addEventListener("progress",function(e){r(e)},false)}s.addEventListener("error",function(t){if(n)n(t);a.manager.itemError(e)},false);if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)s.responseType=this.responseType;if(this.withCredentials!==undefined)s.withCredentials=this.withCredentials;s.send(null);a.manager.itemStart(e);return s},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}};i.ImageLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.ImageLoader.prototype={constructor:i.ImageLoader,load:function(e,t,r,n){var a=this;var o=i.Cache.get(e);if(o!==undefined){a.manager.itemStart(e);if(t){setTimeout(function(){t(o);a.manager.itemEnd(e)},0)}else{a.manager.itemEnd(e)}return o}var s=document.createElement("img");s.addEventListener("load",function(r){i.Cache.add(e,this);if(t)t(this);a.manager.itemEnd(e)},false);if(r!==undefined){s.addEventListener("progress",function(e){r(e)},false)}s.addEventListener("error",function(t){if(n)n(t);a.manager.itemError(e)},false);if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;a.manager.itemStart(e);s.src=e;return s},setCrossOrigin:function(e){this.crossOrigin=e}};i.JSONLoader=function(e){if(typeof e==="boolean"){console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor.");e=undefined}this.manager=e!==undefined?e:i.DefaultLoadingManager;this.withCredentials=false};i.JSONLoader.prototype={constructor:i.JSONLoader,get statusDomElement(){if(this._statusDomElement===undefined){this._statusDomElement=document.createElement("div")}console.warn("THREE.JSONLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(e,t,r,n){var a=this;var o=this.texturePath&&typeof this.texturePath==="string"?this.texturePath:i.Loader.prototype.extractUrlBase(e);var s=new i.XHRLoader(this.manager);s.setCrossOrigin(this.crossOrigin);
s.setWithCredentials(this.withCredentials);s.load(e,function(r){var n=JSON.parse(r);var i=n.metadata;if(i!==undefined){if(i.type==="object"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");return}if(i.type==="scene"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.");return}}var s=a.parse(n,o);t(s.geometry,s.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){var r=new i.Geometry,n=e.scale!==undefined?1/e.scale:1;a(n);o();s(n);h();r.computeFaceNormals();r.computeBoundingSphere();function a(t){function n(e,t){return e&1<<t}var a,o,s,h,u,l,c,f,d,p,m,v,g,y,x,b,w,_,M,S,T,E,C,A,L,P,R,D=e.faces,k=e.vertices,F=e.normals,O=e.colors,U=0;if(e.uvs!==undefined){for(a=0;a<e.uvs.length;a++){if(e.uvs[a].length)U++}for(a=0;a<U;a++){r.faceVertexUvs[a]=[]}}h=0;u=k.length;while(h<u){_=new i.Vector3;_.x=k[h++]*t;_.y=k[h++]*t;_.z=k[h++]*t;r.vertices.push(_)}h=0;u=D.length;while(h<u){p=D[h++];m=n(p,0);v=n(p,1);g=n(p,3);y=n(p,4);x=n(p,5);b=n(p,6);w=n(p,7);if(m){S=new i.Face3;S.a=D[h];S.b=D[h+1];S.c=D[h+3];T=new i.Face3;T.a=D[h+1];T.b=D[h+2];T.c=D[h+3];h+=4;if(v){d=D[h++];S.materialIndex=d;T.materialIndex=d}s=r.faces.length;if(g){for(a=0;a<U;a++){A=e.uvs[a];r.faceVertexUvs[a][s]=[];r.faceVertexUvs[a][s+1]=[];for(o=0;o<4;o++){f=D[h++];P=A[f*2];R=A[f*2+1];L=new i.Vector2(P,R);if(o!==2)r.faceVertexUvs[a][s].push(L);if(o!==0)r.faceVertexUvs[a][s+1].push(L)}}}if(y){c=D[h++]*3;S.normal.set(F[c++],F[c++],F[c]);T.normal.copy(S.normal)}if(x){for(a=0;a<4;a++){c=D[h++]*3;C=new i.Vector3(F[c++],F[c++],F[c]);if(a!==2)S.vertexNormals.push(C);if(a!==0)T.vertexNormals.push(C)}}if(b){l=D[h++];E=O[l];S.color.setHex(E);T.color.setHex(E)}if(w){for(a=0;a<4;a++){l=D[h++];E=O[l];if(a!==2)S.vertexColors.push(new i.Color(E));if(a!==0)T.vertexColors.push(new i.Color(E))}}r.faces.push(S);r.faces.push(T)}else{M=new i.Face3;M.a=D[h++];M.b=D[h++];M.c=D[h++];if(v){d=D[h++];M.materialIndex=d}s=r.faces.length;if(g){for(a=0;a<U;a++){A=e.uvs[a];r.faceVertexUvs[a][s]=[];for(o=0;o<3;o++){f=D[h++];P=A[f*2];R=A[f*2+1];L=new i.Vector2(P,R);r.faceVertexUvs[a][s].push(L)}}}if(y){c=D[h++]*3;M.normal.set(F[c++],F[c++],F[c])}if(x){for(a=0;a<3;a++){c=D[h++]*3;C=new i.Vector3(F[c++],F[c++],F[c]);M.vertexNormals.push(C)}}if(b){l=D[h++];M.color.setHex(O[l])}if(w){for(a=0;a<3;a++){l=D[h++];M.vertexColors.push(new i.Color(O[l]))}}r.faces.push(M)}}}function o(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var n=0,a=e.skinWeights.length;n<a;n+=t){var o=e.skinWeights[n];var s=t>1?e.skinWeights[n+1]:0;var h=t>2?e.skinWeights[n+2]:0;var u=t>3?e.skinWeights[n+3]:0;r.skinWeights.push(new i.Vector4(o,s,h,u))}}if(e.skinIndices){for(var n=0,a=e.skinIndices.length;n<a;n+=t){var l=e.skinIndices[n];var c=t>1?e.skinIndices[n+1]:0;var f=t>2?e.skinIndices[n+2]:0;var d=t>3?e.skinIndices[n+3]:0;r.skinIndices.push(new i.Vector4(l,c,f,d))}}r.bones=e.bones;if(r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)){console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}}function s(t){if(e.morphTargets!==undefined){for(var n=0,a=e.morphTargets.length;n<a;n++){r.morphTargets[n]={};r.morphTargets[n].name=e.morphTargets[n].name;r.morphTargets[n].vertices=[];var o=r.morphTargets[n].vertices;var s=e.morphTargets[n].vertices;for(var h=0,u=s.length;h<u;h+=3){var l=new i.Vector3;l.x=s[h]*t;l.y=s[h+1]*t;l.z=s[h+2]*t;o.push(l)}}}if(e.morphColors!==undefined&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var c=r.faces;var f=e.morphColors[0].colors;for(var n=0,a=c.length;n<a;n++){c[n].color.fromArray(f,n*3)}}}function h(){var t=[];var n=[];if(e.animation!==undefined){n.push(e.animation)}if(e.animations!==undefined){if(e.animations.length){n=n.concat(e.animations)}else{n.push(e.animations)}}for(var a=0;a<n.length;a++){var o=i.AnimationClip.parseAnimation(n[a],r.bones);if(o)t.push(o)}if(r.morphTargets){var s=i.AnimationClip.CreateClipsFromMorphTargetSequences(r.morphTargets,10);t=t.concat(s)}if(t.length>0)r.animations=t}if(e.materials===undefined||e.materials.length===0){return{geometry:r}}else{var u=i.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:r,materials:u}}}};i.LoadingManager=function(e,t,r){var n=this;var i=false,a=0,o=0;this.onStart=undefined;this.onLoad=e;this.onProgress=t;this.onError=r;this.itemStart=function(e){o++;if(i===false){if(n.onStart!==undefined){n.onStart(e,a,o)}}i=true};this.itemEnd=function(e){a++;if(n.onProgress!==undefined){n.onProgress(e,a,o)}if(a===o){i=false;if(n.onLoad!==undefined){n.onLoad()}}};this.itemError=function(e){if(n.onError!==undefined){n.onError(e)}}};i.DefaultLoadingManager=new i.LoadingManager;i.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.BufferGeometryLoader.prototype={constructor:i.BufferGeometryLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.BufferGeometry;var r=e.data.index;if(r!==undefined){var a=new n[r.type](r.array);t.setIndex(new i.BufferAttribute(a,1))}var o=e.data.attributes;for(var s in o){var h=o[s];var a=new n[h.type](h.array);t.addAttribute(s,new i.BufferAttribute(a,h.itemSize))}var u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==undefined){for(var l=0,c=u.length;l!==c;++l){var f=u[l];t.addGroup(f.start,f.count)}}var d=e.data.boundingSphere;if(d!==undefined){var p=new i.Vector3;if(d.center!==undefined){p.fromArray(d.center)}t.boundingSphere=new i.Sphere(p,d.radius)}return t}};i.MaterialLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this.textures={}};i.MaterialLoader.prototype={constructor:i.MaterialLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;if(t[e]===undefined){console.warn("THREE.MaterialLoader: Undefined texture",e)}return t[e]},parse:function(e){var t=new i[e.type];t.uuid=e.uuid;if(e.name!==undefined)t.name=e.name;if(e.color!==undefined)t.color.setHex(e.color);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.uniforms!==undefined)t.uniforms=e.uniforms;if(e.vertexShader!==undefined)t.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)t.fragmentShader=e.fragmentShader;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.shading!==undefined)t.shading=e.shading;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.alphaTest!==undefined)t.alphaTest=e.alphaTest;if(e.depthTest!==undefined)t.depthTest=e.depthTest;if(e.depthWrite!==undefined)t.depthWrite=e.depthWrite;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.wireframeLinewidth!==undefined)t.wireframeLinewidth=e.wireframeLinewidth;if(e.size!==undefined)t.size=e.size;if(e.sizeAttenuation!==undefined)t.sizeAttenuation=e.sizeAttenuation;if(e.map!==undefined)t.map=this.getTexture(e.map);if(e.alphaMap!==undefined){t.alphaMap=this.getTexture(e.alphaMap);t.transparent=true}if(e.bumpMap!==undefined)t.bumpMap=this.getTexture(e.bumpMap);if(e.bumpScale!==undefined)t.bumpScale=e.bumpScale;if(e.normalMap!==undefined)t.normalMap=this.getTexture(e.normalMap);if(e.normalScale)t.normalScale=new i.Vector2(e.normalScale,e.normalScale);if(e.displacementMap!==undefined)t.displacementMap=this.getTexture(e.displacementMap);if(e.displacementScale!==undefined)t.displacementScale=e.displacementScale;if(e.displacementBias!==undefined)t.displacementBias=e.displacementBias;if(e.specularMap!==undefined)t.specularMap=this.getTexture(e.specularMap);if(e.envMap!==undefined){t.envMap=this.getTexture(e.envMap);t.combine=i.MultiplyOperation}if(e.reflectivity)t.reflectivity=e.reflectivity;if(e.lightMap!==undefined)t.lightMap=this.getTexture(e.lightMap);if(e.lightMapIntensity!==undefined)t.lightMapIntensity=e.lightMapIntensity;if(e.aoMap!==undefined)t.aoMap=this.getTexture(e.aoMap);if(e.aoMapIntensity!==undefined)t.aoMapIntensity=e.aoMapIntensity;if(e.materials!==undefined){for(var r=0,n=e.materials.length;r<n;r++){t.materials.push(this.parse(e.materials[r]))}}return t}};i.ObjectLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this.texturePath=""};i.ObjectLoader.prototype={constructor:i.ObjectLoader,load:function(e,t,r,n){if(this.texturePath===""){this.texturePath=e.substring(0,e.lastIndexOf("/")+1)}var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){a.parse(JSON.parse(e),t)},r,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries);var n=this.parseImages(e.images,function(){if(t!==undefined)t(o)});var i=this.parseTextures(e.textures,n);var a=this.parseMaterials(e.materials,i);var o=this.parseObject(e.object,r,a);if(e.animations){o.animations=this.parseAnimations(e.animations)}if(e.images===undefined||e.images.length===0){if(t!==undefined)t(o)}return o},parseGeometries:function(e){var t={};if(e!==undefined){var r=new i.JSONLoader;var n=new i.BufferGeometryLoader;for(var a=0,o=e.length;a<o;a++){var s;var h=e[a];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new i[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new i.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleBufferGeometry":s=new i.CircleBufferGeometry(h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CircleGeometry":s=new i.CircleGeometry(h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":s=new i.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":s=new i.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"SphereBufferGeometry":s=new i.SphereBufferGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":s=new i.DodecahedronGeometry(h.radius,h.detail);break;case"IcosahedronGeometry":s=new i.IcosahedronGeometry(h.radius,h.detail);break;case"OctahedronGeometry":s=new i.OctahedronGeometry(h.radius,h.detail);break;case"TetrahedronGeometry":s=new i.TetrahedronGeometry(h.radius,h.detail);break;case"RingGeometry":s=new i.RingGeometry(h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":s=new i.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new i.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":s=n.parse(h);break;case"Geometry":s=r.parse(h.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}s.uuid=h.uuid;if(h.name!==undefined)s.name=h.name;t[h.uuid]=s}}return t},parseMaterials:function(e,t){var r={};if(e!==undefined){var n=new i.MaterialLoader;n.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=n.parse(e[a]);r[s.uuid]=s}}return r},parseAnimations:function(e){var t=[];for(var r=0;r<e.length;r++){var n=i.AnimationClip.parse(e[r]);t.push(n)}return t},parseImages:function(e,t){var r=this;var n={};function a(e){r.manager.itemStart(e);return s.load(e,function(){r.manager.itemEnd(e)})}if(e!==undefined&&e.length>0){var o=new i.LoadingManager(t);var s=new i.ImageLoader(o);s.setCrossOrigin(this.crossOrigin);for(var h=0,u=e.length;h<u;h++){var l=e[h];var c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=a(c)}}return n},parseTextures:function(e,t){function r(e){if(typeof e==="number")return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return i[e]}var n={};if(e!==undefined){for(var a=0,o=e.length;a<o;a++){var s=e[a];if(s.image===undefined){console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid)}if(t[s.image]===undefined){console.warn("THREE.ObjectLoader: Undefined image",s.image)}var h=new i.Texture(t[s.image]);h.needsUpdate=true;h.uuid=s.uuid;if(s.name!==undefined)h.name=s.name;if(s.mapping!==undefined)h.mapping=r(s.mapping);if(s.offset!==undefined)h.offset=new i.Vector2(s.offset[0],s.offset[1]);if(s.repeat!==undefined)h.repeat=new i.Vector2(s.repeat[0],s.repeat[1]);if(s.minFilter!==undefined)h.minFilter=r(s.minFilter);if(s.magFilter!==undefined)h.magFilter=r(s.magFilter);if(s.anisotropy!==undefined)h.anisotropy=s.anisotropy;if(Array.isArray(s.wrap)){h.wrapS=r(s.wrap[0]);h.wrapT=r(s.wrap[1])}n[s.uuid]=h}}return n},parseObject:function(){var e=new i.Matrix4;return function(t,r,n){var a;function o(e){if(r[e]===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",e)}return r[e]}function s(e){if(e===undefined)return undefined;if(n[e]===undefined){console.warn("THREE.ObjectLoader: Undefined material",e)}return n[e]}switch(t.type){case"Scene":a=new i.Scene;break;case"PerspectiveCamera":a=new i.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new i.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new i.AmbientLight(t.color);break;case"DirectionalLight":a=new i.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new i.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new i.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":a=new i.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":a=new i.Mesh(o(t.geometry),s(t.material));break;case"LOD":a=new i.LOD;break;case"Line":a=new i.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":case"Points":a=new i.Points(o(t.geometry),s(t.material));break;case"Sprite":a=new i.Sprite(s(t.material));break;case"Group":a=new i.Group;break;default:a=new i.Object3D}a.uuid=t.uuid;if(t.name!==undefined)a.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(a.position,a.quaternion,a.scale)}else{if(t.position!==undefined)a.position.fromArray(t.position);if(t.rotation!==undefined)a.rotation.fromArray(t.rotation);if(t.scale!==undefined)a.scale.fromArray(t.scale)}if(t.castShadow!==undefined)a.castShadow=t.castShadow;if(t.receiveShadow!==undefined)a.receiveShadow=t.receiveShadow;if(t.visible!==undefined)a.visible=t.visible;if(t.userData!==undefined)a.userData=t.userData;if(t.children!==undefined){for(var h in t.children){a.add(this.parseObject(t.children[h],r,n))}}if(t.type==="LOD"){var u=t.levels;for(var l=0;l<u.length;l++){var c=u[l];var h=a.getObjectByProperty("uuid",c.object);if(h!==undefined){a.addLevel(h,c.distance)}}}return a}}()};i.TextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.TextureLoader.prototype={constructor:i.TextureLoader,load:function(e,t,r,n){var a=new i.Texture;var o=new i.ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){a.image=e;a.needsUpdate=true;if(t!==undefined){t(a)}},r,n);return a},setCrossOrigin:function(e){this.crossOrigin=e}};i.CubeTextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.CubeTextureLoader.prototype={constructor:i.CubeTextureLoader,load:function(e,t,r,n){var a=new i.CubeTexture([]);var o=new i.ImageLoader;o.setCrossOrigin(this.crossOrigin);var s=0;function h(r){o.load(e[r],function(e){a.images[r]=e;s++;if(s===6){a.needsUpdate=true;if(t)t(a)}},undefined,n)}for(var u=0;u<e.length;++u){h(u)}return a},setCrossOrigin:function(e){this.crossOrigin=e}};i.DataTextureLoader=i.BinaryTextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this._parser=null};i.BinaryTextureLoader.prototype={constructor:i.BinaryTextureLoader,load:function(e,t,r,n){var a=this;var o=new i.DataTexture;var s=new i.XHRLoader(this.manager);s.setCrossOrigin(this.crossOrigin);s.setResponseType("arraybuffer");s.load(e,function(e){var r=a._parser(e);if(!r)return;if(undefined!==r.image){o.image=r.image}else if(undefined!==r.data){o.image.width=r.width;o.image.height=r.height;o.image.data=r.data}o.wrapS=undefined!==r.wrapS?r.wrapS:i.ClampToEdgeWrapping;o.wrapT=undefined!==r.wrapT?r.wrapT:i.ClampToEdgeWrapping;o.magFilter=undefined!==r.magFilter?r.magFilter:i.LinearFilter;o.minFilter=undefined!==r.minFilter?r.minFilter:i.LinearMipMapLinearFilter;o.anisotropy=undefined!==r.anisotropy?r.anisotropy:1;if(undefined!==r.format){o.format=r.format}if(undefined!==r.type){o.type=r.type}if(undefined!==r.mipmaps){o.mipmaps=r.mipmaps}if(1===r.mipmapCount){o.minFilter=i.LinearFilter}o.needsUpdate=true;if(t)t(o,r)},r,n);return o},setCrossOrigin:function(e){this.crossOrigin=e}};i.CompressedTextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this._parser=null};i.CompressedTextureLoader.prototype={constructor:i.CompressedTextureLoader,load:function(e,t,r,n){var a=this;var o=[];var s=new i.CompressedTexture;s.image=o;var h=new i.XHRLoader(this.manager);h.setCrossOrigin(this.crossOrigin);h.setResponseType("arraybuffer");if(Array.isArray(e)){var u=0;var l=function(l){h.load(e[l],function(e){var r=a._parser(e,true);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps};u+=1;if(u===6){if(r.mipmapCount===1)s.minFilter=i.LinearFilter;s.format=r.format;s.needsUpdate=true;if(t)t(s)}},r,n)};for(var c=0,f=e.length;c<f;++c){l(c)}}else{h.load(e,function(e){var r=a._parser(e,true);if(r.isCubemap){var n=r.mipmaps.length/r.mipmapCount;for(var h=0;h<n;h++){o[h]={mipmaps:[]};for(var u=0;u<r.mipmapCount;u++){o[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+u]);o[h].format=r.format;o[h].width=r.width;o[h].height=r.height}}}else{s.image.width=r.width;s.image.height=r.height;s.mipmaps=r.mipmaps}if(r.mipmapCount===1){s.minFilter=i.LinearFilter}s.format=r.format;s.needsUpdate=true;if(t)t(s)},r,n)}return s},setCrossOrigin:function(e){this.crossOrigin=e}};i.Material=function(){Object.defineProperty(this,"id",{value:i.MaterialIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Material";this.side=i.FrontSide;this.opacity=1;this.transparent=false;this.blending=i.NormalBlending;this.blendSrc=i.SrcAlphaFactor;this.blendDst=i.OneMinusSrcAlphaFactor;this.blendEquation=i.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=i.LessEqualDepth;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.precision=null;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};i.Material.prototype={constructor:i.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},setValues:function(e){if(e===undefined)return;for(var t in e){var r=e[t];if(r===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}var n=this[t];if(n===undefined){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}if(n instanceof i.Color){n.set(r)}else if(n instanceof i.Vector3&&r instanceof i.Vector3){n.copy(r)}else if(t==="overdraw"){this[t]=Number(r)}else{this[t]=r}}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};t.uuid=this.uuid;t.type=this.type;if(this.name!=="")t.name=this.name;if(this.color instanceof i.Color)t.color=this.color.getHex();if(this.emissive instanceof i.Color)t.emissive=this.emissive.getHex();if(this.specular instanceof i.Color)t.specular=this.specular.getHex();if(this.shininess!==undefined)t.shininess=this.shininess;if(this.map instanceof i.Texture)t.map=this.map.toJSON(e).uuid;if(this.alphaMap instanceof i.Texture)t.alphaMap=this.alphaMap.toJSON(e).uuid;if(this.lightMap instanceof i.Texture)t.lightMap=this.lightMap.toJSON(e).uuid;if(this.bumpMap instanceof i.Texture){t.bumpMap=this.bumpMap.toJSON(e).uuid;t.bumpScale=this.bumpScale}if(this.normalMap instanceof i.Texture){t.normalMap=this.normalMap.toJSON(e).uuid;t.normalScale=this.normalScale}if(this.displacementMap instanceof i.Texture){t.displacementMap=this.displacementMap.toJSON(e).uuid;t.displacementScale=this.displacementScale;t.displacementBias=this.displacementBias}if(this.specularMap instanceof i.Texture)t.specularMap=this.specularMap.toJSON(e).uuid;if(this.envMap instanceof i.Texture){t.envMap=this.envMap.toJSON(e).uuid;t.reflectivity=this.reflectivity}if(this.size!==undefined)t.size=this.size;if(this.sizeAttenuation!==undefined)t.sizeAttenuation=this.sizeAttenuation;if(this.vertexColors!==undefined&&this.vertexColors!==i.NoColors)t.vertexColors=this.vertexColors;if(this.shading!==undefined&&this.shading!==i.SmoothShading)t.shading=this.shading;if(this.blending!==undefined&&this.blending!==i.NormalBlending)t.blending=this.blending;if(this.side!==undefined&&this.side!==i.FrontSide)t.side=this.side;if(this.opacity<1)t.opacity=this.opacity;if(this.transparent===true)t.transparent=this.transparent;if(this.alphaTest>0)t.alphaTest=this.alphaTest;if(this.wireframe===true)t.wireframe=this.wireframe;if(this.wireframeLinewidth>1)t.wireframeLinewidth=this.wireframeLinewidth;return t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name;this.side=e.side;this.opacity=e.opacity;this.transparent=e.transparent;this.blending=e.blending;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.alphaTest=e.alphaTest;this.overdraw=e.overdraw;this.visible=e.visible;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new i.Color}};i.EventDispatcher.prototype.apply(i.Material.prototype);i.MaterialIdCount=0;i.LineBasicMaterial=function(e){i.Material.call(this);this.type="LineBasicMaterial";this.color=new i.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=i.NoColors;this.fog=true;this.setValues(e)};i.LineBasicMaterial.prototype=Object.create(i.Material.prototype);i.LineBasicMaterial.prototype.constructor=i.LineBasicMaterial;i.LineBasicMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;this.vertexColors=e.vertexColors;this.fog=e.fog;return this};i.LineDashedMaterial=function(e){i.Material.call(this);this.type="LineDashedMaterial";this.color=new i.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};i.LineDashedMaterial.prototype=Object.create(i.Material.prototype);i.LineDashedMaterial.prototype.constructor=i.LineDashedMaterial;i.LineDashedMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;this.vertexColors=e.vertexColors;this.fog=e.fog;return this};i.MeshBasicMaterial=function(e){i.Material.call(this);this.type="MeshBasicMaterial";this.color=new i.Color(16777215);this.map=null;this.aoMap=null;this.aoMapIntensity=1;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};i.MeshBasicMaterial.prototype=Object.create(i.Material.prototype);i.MeshBasicMaterial.prototype.constructor=i.MeshBasicMaterial;i.MeshBasicMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.fog=e.fog;this.shading=e.shading;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;return this};i.MeshLambertMaterial=function(e){i.Material.call(this);this.type="MeshLambertMaterial";this.color=new i.Color(16777215);this.emissive=new i.Color(0);this.map=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshLambertMaterial.prototype=Object.create(i.Material.prototype);i.MeshLambertMaterial.prototype.constructor=i.MeshLambertMaterial;i.MeshLambertMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.emissive.copy(e.emissive);this.map=e.map;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.fog=e.fog;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};i.MeshPhongMaterial=function(e){i.Material.call(this);this.type="MeshPhongMaterial";this.color=new i.Color(16777215);this.emissive=new i.Color(0);this.specular=new i.Color(1118481);this.shininess=30;this.metal=false;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshPhongMaterial.prototype=Object.create(i.Material.prototype);i.MeshPhongMaterial.prototype.constructor=i.MeshPhongMaterial;i.MeshPhongMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.emissive.copy(e.emissive);this.specular.copy(e.specular);this.shininess=e.shininess;this.metal=e.metal;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissiveMap=e.emissiveMap;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.fog=e.fog;this.shading=e.shading;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};i.MeshDepthMaterial=function(e){i.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};i.MeshDepthMaterial.prototype=Object.create(i.Material.prototype);i.MeshDepthMaterial.prototype.constructor=i.MeshDepthMaterial;i.MeshDepthMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};i.MeshNormalMaterial=function(e){i.Material.call(this,e);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};i.MeshNormalMaterial.prototype=Object.create(i.Material.prototype);i.MeshNormalMaterial.prototype.constructor=i.MeshNormalMaterial;i.MeshNormalMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};i.MultiMaterial=function(e){this.uuid=i.Math.generateUUID();this.type="MultiMaterial";this.materials=e instanceof Array?e:[];this.visible=true};i.MultiMaterial.prototype={constructor:i.MultiMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,r=this.materials.length;t<r;t++){e.materials.push(this.materials[t].toJSON())}e.visible=this.visible;return e},clone:function(){var e=new this.constructor;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}e.visible=this.visible;return e}};i.MeshFaceMaterial=i.MultiMaterial;i.PointsMaterial=function(e){i.Material.call(this);this.type="PointsMaterial";this.color=new i.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=i.NoColors;this.fog=true;this.setValues(e)};i.PointsMaterial.prototype=Object.create(i.Material.prototype);i.PointsMaterial.prototype.constructor=i.PointsMaterial;i.PointsMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;this.vertexColors=e.vertexColors;this.fog=e.fog;return this};i.PointCloudMaterial=function(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new i.PointsMaterial(e)};i.ParticleBasicMaterial=function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new i.PointsMaterial(e)};i.ParticleSystemMaterial=function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new i.PointsMaterial(e)};i.ShaderMaterial=function(e){i.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";
this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=i.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.derivatives=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;if(e!==undefined){if(e.attributes!==undefined){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}this.setValues(e)}};i.ShaderMaterial.prototype=Object.create(i.Material.prototype);i.ShaderMaterial.prototype.constructor=i.ShaderMaterial;i.ShaderMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=i.UniformsUtils.clone(e.uniforms);this.attributes=e.attributes;this.defines=e.defines;this.shading=e.shading;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.fog=e.fog;this.lights=e.lights;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;this.derivatives=e.derivatives;return this};i.ShaderMaterial.prototype.toJSON=function(e){var t=i.Material.prototype.toJSON.call(this,e);t.uniforms=this.uniforms;t.attributes=this.attributes;t.vertexShader=this.vertexShader;t.fragmentShader=this.fragmentShader;return t};i.RawShaderMaterial=function(e){i.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};i.RawShaderMaterial.prototype=Object.create(i.ShaderMaterial.prototype);i.RawShaderMaterial.prototype.constructor=i.RawShaderMaterial;i.SpriteMaterial=function(e){i.Material.call(this);this.type="SpriteMaterial";this.color=new i.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};i.SpriteMaterial.prototype=Object.create(i.Material.prototype);i.SpriteMaterial.prototype.constructor=i.SpriteMaterial;i.SpriteMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.rotation=e.rotation;this.fog=e.fog;return this};i.Texture=function(e,t,r,n,a,o,s,h,u){Object.defineProperty(this,"id",{value:i.TextureIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.sourceFile="";this.image=e!==undefined?e:i.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:i.Texture.DEFAULT_MAPPING;this.wrapS=r!==undefined?r:i.ClampToEdgeWrapping;this.wrapT=n!==undefined?n:i.ClampToEdgeWrapping;this.magFilter=a!==undefined?a:i.LinearFilter;this.minFilter=o!==undefined?o:i.LinearMipMapLinearFilter;this.anisotropy=u!==undefined?u:1;this.format=s!==undefined?s:i.RGBAFormat;this.type=h!==undefined?h:i.UnsignedByteType;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.version=0;this.onUpdate=null};i.Texture.DEFAULT_IMAGE=undefined;i.Texture.DEFAULT_MAPPING=i.UVMapping;i.Texture.prototype={constructor:i.Texture,set needsUpdate(e){if(e===true)this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;return this},toJSON:function(e){if(e.textures[this.uuid]!==undefined){return e.textures[this.uuid]}function t(e){var t;if(e.toDataURL!==undefined){t=e}else{t=document.createElement("canvas");t.width=e.width;t.height=e.height;t.getContext("2d").drawImage(e,0,0,e.width,e.height)}if(t.width>2048||t.height>2048){return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}var r={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(this.image!==undefined){var n=this.image;if(n.uuid===undefined){n.uuid=i.Math.generateUUID()}if(e.images[n.uuid]===undefined){e.images[n.uuid]={uuid:n.uuid,url:t(n)}}r.image=n.uuid}e.textures[this.uuid]=r;return r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==i.UVMapping)return;e.multiply(this.repeat);e.add(this.offset);if(e.x<0||e.x>1){switch(this.wrapS){case i.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case i.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case i.MirroredRepeatWrapping:if(Math.abs(Math.floor(e.x)%2)===1){e.x=Math.ceil(e.x)-e.x}else{e.x=e.x-Math.floor(e.x)}break}}if(e.y<0||e.y>1){switch(this.wrapT){case i.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case i.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case i.MirroredRepeatWrapping:if(Math.abs(Math.floor(e.y)%2)===1){e.y=Math.ceil(e.y)-e.y}else{e.y=e.y-Math.floor(e.y)}break}}if(this.flipY){e.y=1-e.y}}};i.EventDispatcher.prototype.apply(i.Texture.prototype);i.TextureIdCount=0;i.CanvasTexture=function(e,t,r,n,a,o,s,h,u){i.Texture.call(this,e,t,r,n,a,o,s,h,u);this.needsUpdate=true};i.CanvasTexture.prototype=Object.create(i.Texture.prototype);i.CanvasTexture.prototype.constructor=i.CanvasTexture;i.CubeTexture=function(e,t,r,n,a,o,s,h,u){t=t!==undefined?t:i.CubeReflectionMapping;i.Texture.call(this,e,t,r,n,a,o,s,h,u);this.images=e;this.flipY=false};i.CubeTexture.prototype=Object.create(i.Texture.prototype);i.CubeTexture.prototype.constructor=i.CubeTexture;i.CubeTexture.prototype.copy=function(e){i.Texture.prototype.copy.call(this,e);this.images=e.images;return this};i.CompressedTexture=function(e,t,r,n,a,o,s,h,u,l,c){i.Texture.call(this,null,o,s,h,u,l,n,a,c);this.image={width:t,height:r};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false};i.CompressedTexture.prototype=Object.create(i.Texture.prototype);i.CompressedTexture.prototype.constructor=i.CompressedTexture;i.DataTexture=function(e,t,r,n,a,o,s,h,u,l,c){i.Texture.call(this,null,o,s,h,u,l,n,a,c);this.image={data:e,width:t,height:r};this.magFilter=u!==undefined?u:i.NearestFilter;this.minFilter=l!==undefined?l:i.NearestFilter;this.flipY=false;this.generateMipmaps=false};i.DataTexture.prototype=Object.create(i.Texture.prototype);i.DataTexture.prototype.constructor=i.DataTexture;i.VideoTexture=function(e,t,r,n,a,o,s,h,u){i.Texture.call(this,e,t,r,n,a,o,s,h,u);this.generateMipmaps=false;var l=this;function c(){requestAnimationFrame(c);if(e.readyState===e.HAVE_ENOUGH_DATA){l.needsUpdate=true}}c()};i.VideoTexture.prototype=Object.create(i.Texture.prototype);i.VideoTexture.prototype.constructor=i.VideoTexture;i.Group=function(){i.Object3D.call(this);this.type="Group"};i.Group.prototype=Object.create(i.Object3D.prototype);i.Group.prototype.constructor=i.Group;i.Points=function(e,t){i.Object3D.call(this);this.type="Points";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.PointsMaterial({color:Math.random()*16777215})};i.Points.prototype=Object.create(i.Object3D.prototype);i.Points.prototype.constructor=i.Points;i.Points.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;return function r(n,a){var o=this;var s=o.geometry;var h=n.params.Points.threshold;e.getInverse(this.matrixWorld);t.copy(n.ray).applyMatrix4(e);if(s.boundingBox!==null){if(t.isIntersectionBox(s.boundingBox)===false){return}}var u=h/((this.scale.x+this.scale.y+this.scale.z)/3);var l=u*u;var c=new i.Vector3;function f(e,r){var i=t.distanceSqToPoint(e);if(i<l){var s=t.closestPointToPoint(e);s.applyMatrix4(o.matrixWorld);var h=n.ray.origin.distanceTo(s);if(h<n.near||h>n.far)return;a.push({distance:h,distanceToRay:Math.sqrt(i),point:s.clone(),index:r,face:null,object:o})}}if(s instanceof i.BufferGeometry){var d=s.index;var p=s.attributes;var m=p.position.array;if(d!==null){var v=d.array;for(var g=0,y=v.length;g<y;g++){var x=v[g];c.fromArray(m,x*3);f(c,x)}}else{for(var g=0,b=m.length/3;g<b;g++){c.fromArray(m,g*3);f(c,g)}}}else{var w=s.vertices;for(var g=0,b=w.length;g<b;g++){f(w[g],g)}}}}();i.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};i.PointCloud=function(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new i.Points(e,t)};i.ParticleSystem=function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new i.Points(e,t)};i.Line=function(e,t,r){if(r===1){console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.");return new i.LineSegments(e,t)}i.Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.LineBasicMaterial({color:Math.random()*16777215})};i.Line.prototype=Object.create(i.Object3D.prototype);i.Line.prototype.constructor=i.Line;i.Line.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;var r=new i.Sphere;return function n(a,o){var s=a.linePrecision;var h=s*s;var u=this.geometry;if(u.boundingSphere===null)u.computeBoundingSphere();r.copy(u.boundingSphere);r.applyMatrix4(this.matrixWorld);if(a.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(a.ray).applyMatrix4(e);var l=new i.Vector3;var c=new i.Vector3;var f=new i.Vector3;var d=new i.Vector3;var p=this instanceof i.LineSegments?2:1;if(u instanceof i.BufferGeometry){var m=u.index;var v=u.attributes;if(m!==null){var g=m.array;var y=v.position.array;for(var x=0,b=g.length-1;x<b;x+=p){var w=g[x];var _=g[x+1];l.fromArray(y,w*3);c.fromArray(y,_*3);var M=t.distanceSqToSegment(l,c,d,f);if(M>h)continue;d.applyMatrix4(this.matrixWorld);var S=a.ray.origin.distanceTo(d);if(S<a.near||S>a.far)continue;o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{var y=v.position.array;for(var x=0,b=y.length/3-1;x<b;x+=p){l.fromArray(y,3*x);c.fromArray(y,3*x+3);var M=t.distanceSqToSegment(l,c,d,f);if(M>h)continue;d.applyMatrix4(this.matrixWorld);var S=a.ray.origin.distanceTo(d);if(S<a.near||S>a.far)continue;o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(u instanceof i.Geometry){var T=u.vertices;var E=T.length;for(var x=0;x<E-1;x+=p){var M=t.distanceSqToSegment(T[x],T[x+1],d,f);if(M>h)continue;d.applyMatrix4(this.matrixWorld);var S=a.ray.origin.distanceTo(d);if(S<a.near||S>a.far)continue;o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}();i.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};i.LineStrip=0;i.LinePieces=1;i.LineSegments=function(e,t){i.Line.call(this,e,t);this.type="LineSegments"};i.LineSegments.prototype=Object.create(i.Line.prototype);i.LineSegments.prototype.constructor=i.LineSegments;i.Mesh=function(e,t){i.Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};i.Mesh.prototype=Object.create(i.Object3D.prototype);i.Mesh.prototype.constructor=i.Mesh;i.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};i.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};i.Mesh.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;var r=new i.Sphere;var n=new i.Vector3;var a=new i.Vector3;var o=new i.Vector3;var s=new i.Vector3;var h=new i.Vector3;var u=new i.Vector3;var l=new i.Vector2;var c=new i.Vector2;var f=new i.Vector2;var d=new i.Vector3;var p=new i.Vector3;var m=new i.Vector3;function v(e,t,r,n,a,o,s){i.Triangle.barycoordFromPoint(e,t,r,n,d);a.multiplyScalar(d.x);o.multiplyScalar(d.y);s.multiplyScalar(d.z);a.add(o).add(s);return a.clone()}function g(e,t,r,n,a,o,s){var h;var u=e.material;if(u.side===i.BackSide){h=r.intersectTriangle(o,a,n,true,s)}else{h=r.intersectTriangle(n,a,o,u.side!==i.DoubleSide,s)}if(h===null)return null;m.copy(s);m.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(m);if(l<t.near||l>t.far)return null;return{distance:l,point:m.clone(),object:e}}function y(e,t,r,s,h,u,d,m){n.fromArray(s,u*3);a.fromArray(s,d*3);o.fromArray(s,m*3);var y=g(e,t,r,n,a,o,p);if(y){if(h){l.fromArray(h,u*2);c.fromArray(h,d*2);f.fromArray(h,m*2);y.uv=v(p,n,a,o,l,c,f)}y.face=new i.Face3(u,d,m,i.Triangle.normal(n,a,o));y.faceIndex=u}return y}return function x(d,m){var x=this.geometry;var b=this.material;if(b===undefined)return;if(x.boundingSphere===null)x.computeBoundingSphere();var w=this.matrixWorld;r.copy(x.boundingSphere);r.applyMatrix4(w);if(d.ray.isIntersectionSphere(r)===false)return;e.getInverse(w);t.copy(d.ray).applyMatrix4(e);if(x.boundingBox!==null){if(t.isIntersectionBox(x.boundingBox)===false)return}var _,M;if(x instanceof i.BufferGeometry){var S,T,E;var C=x.index;var A=x.attributes;var L=A.position.array;if(A.uv!==undefined){_=A.uv.array}if(C!==null){var P=C.array;for(var R=0,D=P.length;R<D;R+=3){S=P[R];T=P[R+1];E=P[R+2];M=y(this,d,t,L,_,S,T,E);if(M){M.faceIndex=Math.floor(R/3);m.push(M)}}}else{for(var R=0,D=L.length;R<D;R+=9){S=R/3;T=S+1;E=S+2;M=y(this,d,t,L,_,S,T,E);if(M){M.index=S;m.push(M)}}}}else if(x instanceof i.Geometry){var k,F,O;var U=b instanceof i.MeshFaceMaterial;var B=U===true?b.materials:null;var V=x.vertices;var I=x.faces;var N=x.faceVertexUvs[0];if(N.length>0)_=N;for(var G=0,z=I.length;G<z;G++){var H=I[G];var j=U===true?B[H.materialIndex]:b;if(j===undefined)continue;k=V[H.a];F=V[H.b];O=V[H.c];if(j.morphTargets===true){var W=x.morphTargets;var X=this.morphTargetInfluences;n.set(0,0,0);a.set(0,0,0);o.set(0,0,0);for(var q=0,Y=W.length;q<Y;q++){var K=X[q];if(K===0)continue;var Z=W[q].vertices;n.addScaledVector(s.subVectors(Z[H.a],k),K);a.addScaledVector(h.subVectors(Z[H.b],F),K);o.addScaledVector(u.subVectors(Z[H.c],O),K)}n.add(k);a.add(F);o.add(O);k=n;F=a;O=o}M=g(this,d,t,k,F,O,p);if(M){if(_){var Q=_[G];l.copy(Q[0]);c.copy(Q[1]);f.copy(Q[2]);M.uv=v(p,k,F,O,l,c,f)}M.face=H;M.faceIndex=G;m.push(M)}}}}}();i.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};i.Bone=function(e){i.Object3D.call(this);this.type="Bone";this.skin=e};i.Bone.prototype=Object.create(i.Object3D.prototype);i.Bone.prototype.constructor=i.Bone;i.Bone.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.skin=e.skin;return this};i.Skeleton=function(e,t,r){this.useVertexTexture=r!==undefined?r:true;this.identityMatrix=new i.Matrix4;e=e||[];this.bones=e.slice(0);if(this.useVertexTexture){var n=Math.sqrt(this.bones.length*4);n=i.Math.nextPowerOfTwo(Math.ceil(n));n=Math.max(n,4);this.boneTextureWidth=n;this.boneTextureHeight=n;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new i.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,i.RGBAFormat,i.FloatType)}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{console.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var a=0,o=this.bones.length;a<o;a++){this.boneInverses.push(new i.Matrix4)}}}};i.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new i.Matrix4;if(this.bones[e]){r.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(r)}};i.Skeleton.prototype.pose=function(){var e;for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){if(e.parent){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}};i.Skeleton.prototype.update=function(){var e=new i.Matrix4;return function t(){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(n,this.boneInverses[t]);e.flattenToArrayOffset(this.boneMatrices,t*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();i.Skeleton.prototype.clone=function(){return new i.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)};i.SkinnedMesh=function(e,t,r){i.Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new i.Matrix4;this.bindMatrixInverse=new i.Matrix4;var n=[];if(this.geometry&&this.geometry.bones!==undefined){var a,o;for(var s=0,h=this.geometry.bones.length;s<h;++s){o=this.geometry.bones[s];a=new i.Bone(this);n.push(a);a.name=o.name;a.position.fromArray(o.pos);a.quaternion.fromArray(o.rotq);if(o.scl!==undefined)a.scale.fromArray(o.scl)}for(var s=0,h=this.geometry.bones.length;s<h;++s){o=this.geometry.bones[s];if(o.parent!==-1&&o.parent!==null){n[o.parent].add(n[s])}else{this.add(n[s])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new i.Skeleton(n,undefined,r),this.matrixWorld)};i.SkinnedMesh.prototype=Object.create(i.Mesh.prototype);i.SkinnedMesh.prototype.constructor=i.SkinnedMesh;i.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);this.skeleton.calculateInverses();t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)};i.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};i.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof i.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var r=1/t.lengthManhattan();if(r!==Infinity){t.multiplyScalar(r)}else{t.set(1)}}}else{}};i.SkinnedMesh.prototype.updateMatrixWorld=function(e){i.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)}};i.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)};i.LOD=function(){i.Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:true,value:[]},objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}})};i.LOD.prototype=Object.create(i.Object3D.prototype);i.LOD.prototype.constructor=i.LOD;i.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);var r=this.levels;for(var n=0;n<r.length;n++){if(t<r[n].distance){break}}r.splice(n,0,{distance:t,object:e});this.add(e)};i.LOD.prototype.getObjectForDistance=function(e){var t=this.levels;for(var r=1,n=t.length;r<n;r++){if(e<t[r].distance){break}}return t[r-1].object};i.LOD.prototype.raycast=function(){var e=new i.Vector3;return function t(r,n){e.setFromMatrixPosition(this.matrixWorld);var i=r.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(r,n)}}();i.LOD.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function r(n){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(n.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var a=e.distanceTo(t);i[0].object.visible=true;for(var o=1,s=i.length;o<s;o++){if(a>=i[o].distance){i[o-1].object.visible=false;i[o].object.visible=true}else{break}}for(;o<s;o++){i[o].object.visible=false}}}}();i.LOD.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e,false);var t=e.levels;for(var r=0,n=t.length;r<n;r++){var a=t[r];this.addLevel(a.object.clone(),a.distance)}return this};i.LOD.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];var r=this.levels;for(var n=0,a=r.length;n<a;n++){var o=r[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t};i.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]);var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var r=new Float32Array([0,0,1,0,1,1,0,1]);var n=new i.BufferGeometry;n.setIndex(new i.BufferAttribute(e,1));n.addAttribute("position",new i.BufferAttribute(t,3));n.addAttribute("uv",new i.BufferAttribute(r,2));return function a(e){i.Object3D.call(this);this.type="Sprite";this.geometry=n;this.material=e!==undefined?e:new i.SpriteMaterial}}();i.Sprite.prototype=Object.create(i.Object3D.prototype);i.Sprite.prototype.constructor=i.Sprite;i.Sprite.prototype.raycast=function(){var e=new i.Vector3;return function t(r,n){e.setFromMatrixPosition(this.matrixWorld);var i=r.ray.distanceSqToPoint(e);var a=this.scale.x*this.scale.y;if(i>a){return}n.push({distance:Math.sqrt(i),point:this.position,face:null,object:this})}}();i.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)};i.Particle=i.Sprite;i.LensFlare=function(e,t,r,n,a){i.Object3D.call(this);this.lensFlares=[];this.positionScreen=new i.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,r,n,a)}};i.LensFlare.prototype=Object.create(i.Object3D.prototype);i.LensFlare.prototype.constructor=i.LensFlare;i.LensFlare.prototype.add=function(e,t,r,n,a,o){if(t===undefined)t=-1;if(r===undefined)r=0;if(o===undefined)o=1;if(a===undefined)a=new i.Color(16777215);if(n===undefined)n=i.NormalBlending;r=Math.min(r,Math.max(0,r));this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:a,blending:n})};i.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var r;var n=-this.positionScreen.x*2;var i=-this.positionScreen.y*2;for(e=0;e<t;e++){r=this.lensFlares[e];r.x=this.positionScreen.x+n*r.distance;r.y=this.positionScreen.y+i*r.distance;r.wantedRotation=r.x*Math.PI*.25;r.rotation+=(r.wantedRotation-r.rotation)*.25}};i.LensFlare.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.positionScreen.copy(e.positionScreen);this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;t<r;t++){this.lensFlares.push(e.lensFlares[t])}return this};i.Scene=function(){i.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};i.Scene.prototype=Object.create(i.Object3D.prototype);i.Scene.prototype.constructor=i.Scene;i.Scene.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);if(e.fog!==null)this.fog=e.fog.clone();if(e.overrideMaterial!==null)this.overrideMaterial=e.overrideMaterial.clone();this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this};i.Fog=function(e,t,r){this.name="";this.color=new i.Color(e);this.near=t!==undefined?t:1;this.far=r!==undefined?r:1e3};i.Fog.prototype.clone=function(){return new i.Fog(this.color.getHex(),this.near,this.far)};i.FogExp2=function(e,t){this.name="";this.color=new i.Color(e);this.density=t!==undefined?t:25e-5};i.FogExp2.prototype.clone=function(){return new i.FogExp2(this.color.getHex(),this.density)};i.ShaderChunk={};i.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";i.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";i.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";i.ShaderChunk["aomap_fragment"]="#ifdef USE_AOMAP\n\n	totalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n";i.ShaderChunk["aomap_pars_fragment"]="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif";i.ShaderChunk["begin_vertex"]="\nvec3 transformed = vec3( position );\n";i.ShaderChunk["beginnormal_vertex"]="\nvec3 objectNormal = vec3( normal );\n";i.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n";i.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif";i.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";i.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";i.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif";i.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n\n	float fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n\n	return ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n	vec3 halfDir = normalize( lightDir + viewDir );\n\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotLH = saturate( dot( lightDir, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n";i.ShaderChunk["defaultnormal_vertex"]="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";i.ShaderChunk["displacementmap_vertex"]="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n";i.ShaderChunk["displacementmap_pars_vertex"]="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n";i.ShaderChunk["emissivemap_fragment"]="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n";i.ShaderChunk["emissivemap_pars_fragment"]="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n";i.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n";i.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n";i.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n";i.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n";
i.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";i.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";i.ShaderChunk["hemilight_fragment"]="#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalAmbientLight += lightColor;\n\n	}\n\n#endif\n\n";i.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n	totalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n";i.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif";i.ShaderChunk["lights_lambert_pars_vertex"]="#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n";i.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n\n			float dotProduct = dot( normal, lightDir );\n\n			vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			float hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n";i.ShaderChunk["lights_phong_fragment"]="vec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lightPosition = pointLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n\n			float cosineTerm = saturate( dot( normal, lightDir ) );\n\n			totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n			vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n			totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * cosineTerm;\n\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n	}\n\n#endif\n";i.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n";i.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\n#endif\n";i.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n";i.ShaderChunk["linear_to_gamma_fragment"]="\n	outgoingLight = linearToOutput( outgoingLight );\n";i.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";i.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n";i.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";i.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";i.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n";i.ShaderChunk["map_pars_fragment"]="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";i.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";i.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n";i.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n";i.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";i.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n";i.ShaderChunk["normal_phong_fragment"]="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n";i.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";i.ShaderChunk["project_vertex"]="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";i.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n	for ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		float texelSizeY =  1.0 / shadowMapSize[ i ].y;\n\n		float shadow = 0.0;\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n		bool isPointLight = shadowDarkness[ i ] < 0.0;\n\n		if ( isPointLight ) {\n\n			float realShadowDarkness = abs( shadowDarkness[ i ] );\n\n			vec3 lightToPosition = vShadowCoord[ i ].xyz;\n\n	#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n			vec3 bd3D = normalize( lightToPosition );\n			float dp = length( lightToPosition );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\n	#if defined( SHADOWMAP_TYPE_PCF )\n			const float Dr = 1.25;\n	#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			const float Dr = 2.25;\n	#endif\n\n			float os = Dr *  2.0 * texelSizeY;\n\n			const vec3 Gsd = vec3( - 1, 0, 1 );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			shadow *= realShadowDarkness * ( 1.0 / 21.0 );\n\n	#else \n			vec3 bd3D = normalize( lightToPosition );\n			float dp = length( lightToPosition );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			shadow *= realShadowDarkness;\n\n	#endif\n\n		} else {\n\n#endif \n			float texelSizeX =  1.0 / shadowMapSize[ i ].x;\n\n			vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\n			bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n			bool inFrustum = all( inFrustumVec );\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n			bool frustumTest = all( frustumTestVec );\n\n			if ( frustumTest ) {\n\n	#if defined( SHADOWMAP_TYPE_PCF )\n\n\n				/*\n					for ( float y = -1.25; y <= 1.25; y += 1.25 )\n						for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n							vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n							float fDepth = unpackDepth( rgbaDepth );\n							if ( fDepth < shadowCoord.z )\n								shadow += 1.0;\n					}\n					shadow /= 9.0;\n				*/\n\n				shadowCoord.z += shadowBias[ i ];\n\n				const float ShadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = texelSizeX;\n				float yPixelOffset = texelSizeY;\n\n				float dx0 = - 1.25 * xPixelOffset;\n				float dy0 = - 1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				float fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				shadow *= shadowDarkness[ i ];\n\n	#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\n				shadowCoord.z += shadowBias[ i ];\n\n				float xPixelOffset = texelSizeX;\n				float yPixelOffset = texelSizeY;\n\n				float dx0 = - 1.0 * xPixelOffset;\n				float dy0 = - 1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[ 0 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[ 0 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[ 0 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[ 1 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[ 1 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[ 1 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[ 2 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[ 2 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[ 2 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[ 0 ] = vec3( lessThan( depthKernel[ 0 ], shadowZ ) );\n				shadowKernel[ 0 ] *= vec3( 0.25 );\n\n				shadowKernel[ 1 ] = vec3( lessThan( depthKernel[ 1 ], shadowZ ) );\n				shadowKernel[ 1 ] *= vec3( 0.25 );\n\n				shadowKernel[ 2 ] = vec3( lessThan( depthKernel[ 2 ], shadowZ ) );\n				shadowKernel[ 2 ] *= vec3( 0.25 );\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[ i ].xy );\n\n				shadowKernel[ 0 ] = mix( shadowKernel[ 1 ], shadowKernel[ 0 ], fractionalCoord.x );\n				shadowKernel[ 1 ] = mix( shadowKernel[ 2 ], shadowKernel[ 1 ], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[ 0 ][ 1 ], shadowKernel[ 0 ][ 0 ], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[ 0 ][ 2 ], shadowKernel[ 0 ][ 1 ], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[ 1 ][ 1 ], shadowKernel[ 1 ][ 0 ], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[ 1 ][ 2 ], shadowKernel[ 1 ][ 1 ], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) ) * shadowDarkness[ i ];\n\n	#else \n				shadowCoord.z += shadowBias[ i ];\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n					shadow = shadowDarkness[ i ];\n\n	#endif\n\n			}\n\n#ifdef SHADOWMAP_DEBUG\n\n			if ( inFrustum ) {\n\n				if ( i == 0 ) {\n\n					outgoingLight *= vec3( 1.0, 0.5, 0.0 );\n\n				} else if ( i == 1 ) {\n\n					outgoingLight *= vec3( 0.0, 1.0, 0.8 );\n\n				} else {\n\n					outgoingLight *= vec3( 0.0, 0.5, 1.0 );\n\n				}\n\n			}\n\n#endif\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n		}\n\n#endif\n\n		shadowMask = shadowMask * vec3( 1.0 - shadow );\n\n	}\n\n#endif\n";i.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n	#if defined(POINT_LIGHT_SHADOWS)\n\n\n		void adjustShadowValue1K( const float testDepth, const vec4 textureData, const float bias, inout float shadowValue ) {\n\n			const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n			if ( testDepth >= dot( textureData, bitSh ) * 1000.0 + bias )\n				shadowValue += 1.0;\n\n		}\n\n\n		vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\n			vec3 absV = abs( v );\n\n\n			float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n			absV *= scaleToCube;\n\n\n			v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\n\n			vec2 planar = v.xy;\n\n			float almostATexel = 1.5 * texelSizeY;\n			float almostOne = 1.0 - almostATexel;\n\n			if ( absV.z >= almostOne ) {\n\n				if ( v.z > 0.0 )\n					planar.x = 4.0 - v.x;\n\n			} else if ( absV.x >= almostOne ) {\n\n				float signX = sign( v.x );\n				planar.x = v.z * signX + 2.0 * signX;\n\n			} else if ( absV.y >= almostOne ) {\n\n				float signY = sign( v.y );\n				planar.x = v.x + 2.0 * signY + 2.0;\n				planar.y = v.z * signY - 2.0;\n\n			}\n\n\n			return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n		}\n\n	#endif\n\n#endif\n";i.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n#endif";i.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n	for ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";i.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";i.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";i.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";i.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n";i.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";i.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";i.ShaderChunk["uv2_pars_fragment"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif";i.ShaderChunk["uv2_pars_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif";i.ShaderChunk["uv2_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif";i.ShaderChunk["uv_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n\n#endif";i.ShaderChunk["uv_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";i.ShaderChunk["uv_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";i.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n";i.UniformsUtils={merge:function(e){var t={};for(var r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n){t[i]=n[i]}}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var n in e[r]){var a=e[r][n];if(a instanceof i.Color||a instanceof i.Vector2||a instanceof i.Vector3||a instanceof i.Vector4||a instanceof i.Matrix3||a instanceof i.Matrix4||a instanceof i.Texture){t[r][n]=a.clone()}else if(Array.isArray(a)){t[r][n]=a.slice()}else{t[r][n]=a}}}return t}};i.UniformsLib={common:{diffuse:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new i.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};i.ShaderLib={basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["aomap"],i.UniformsLib["fog"],i.UniformsLib["shadowmap"]]),vertexShader:[i.ShaderChunk["common"],i.ShaderChunk["uv_pars_vertex"],i.ShaderChunk["uv2_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["uv_vertex"],i.ShaderChunk["uv2_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["skinbase_vertex"],"	#ifdef USE_ENVMAP",i.ShaderChunk["beginnormal_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"	#endif",i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["uv_pars_fragment"],i.ShaderChunk["uv2_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["aomap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = vec3( 1.0 );","	vec3 shadowMask = vec3( 1.0 );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["aomap_fragment"],i.ShaderChunk["shadowmap_fragment"],"	outgoingLight = diffuseColor.rgb * totalAmbientLight * shadowMask;",i.ShaderChunk["envmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{emissive:{type:"c",value:new i.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk["common"],i.ShaderChunk["uv_pars_vertex"],i.ShaderChunk["uv2_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_lambert_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["uv_vertex"],i.ShaderChunk["uv2_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["beginnormal_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_lambert_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","uniform vec3 ambientLightColor;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["uv_pars_fragment"],i.ShaderChunk["uv2_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 shadowMask = vec3( 1.0 );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["shadowmap_fragment"],"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","		else","			outgoingLight += diffuseColor.rgb * ( vLightBack * shadowMask + totalAmbientLight ) + emissive;","	#else","		outgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","	#endif",i.ShaderChunk["envmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["aomap"],i.UniformsLib["lightmap"],i.UniformsLib["emissivemap"],i.UniformsLib["bumpmap"],i.UniformsLib["normalmap"],i.UniformsLib["displacementmap"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",i.ShaderChunk["common"],i.ShaderChunk["uv_pars_vertex"],i.ShaderChunk["uv2_pars_vertex"],i.ShaderChunk["displacementmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_phong_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["uv_vertex"],i.ShaderChunk["uv2_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["beginnormal_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",i.ShaderChunk["begin_vertex"],i.ShaderChunk["displacementmap_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"	vViewPosition = - mvPosition.xyz;",i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_phong_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["uv_pars_fragment"],i.ShaderChunk["uv2_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["aomap_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["emissivemap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["lights_phong_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["bumpmap_pars_fragment"],i.ShaderChunk["normalmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 totalEmissiveLight = emissive;","	vec3 shadowMask = vec3( 1.0 );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["normal_phong_fragment"],i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["hemilight_fragment"],i.ShaderChunk["aomap_fragment"],i.ShaderChunk["emissivemap_fragment"],i.ShaderChunk["lights_phong_fragment"],i.ShaderChunk["shadowmap_fragment"],"totalDiffuseLight *= shadowMask;","totalSpecularLight *= shadowMask;","#ifdef METAL","	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;","#else","	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;","#endif",i.ShaderChunk["envmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:i.UniformsUtils.merge([i.UniformsLib["points"],i.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_particle_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );","	vec3 shadowMask = vec3( 1.0 );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_particle_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["shadowmap_fragment"],"	outgoingLight = diffuseColor.rgb * shadowMask;",i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["color_fragment"],"	outgoingLight = diffuseColor.rgb;",i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vNormal = normalize( normalMatrix * normal );",i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new i.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["worldpos_vertex"],"vWorldPosition = worldPosition;","}"].join("\n"),fragmentShader:["uniform vec3 lightPos;","varying vec4 vWorldPosition;",i.ShaderChunk["common"],"vec4 pack1K ( float depth ) {","   depth /= 1000.0;","   const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = fract( depth * bitSh );","	res -= res.xxyz * bitMsk;","	return res; ","}","float unpack1K ( vec4 color ) {","	const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	return dot( color, bitSh ) * 1000.0;","}","void main () {","	gl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );","}"].join("\n")}};i.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",i.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),r=e.context!==undefined?e.context:null,n=t.width,a=t.height,o=1,s=e.alpha!==undefined?e.alpha:false,h=e.depth!==undefined?e.depth:true,u=e.stencil!==undefined?e.stencil:true,l=e.antialias!==undefined?e.antialias:false,c=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,f=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,d=new i.Color(0),p=0;var m=[];var v=[];var g=-1;var y=[];var x=-1;var b=new Float32Array(8);var w=[];var _=[];this.domElement=t;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;var M=this,S=null,T=null,E=-1,C="",A=null,L=0,P=0,R=0,D=t.width,k=t.height,F=0,O=0,U=new i.Frustum,B=new i.Matrix4,V=new i.Vector3,I=new i.Vector3,N=true,G={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},z={geometries:0,textures:0},H={calls:0,vertices:0,faces:0,points:0};this.info={render:H,memory:z,programs:null};var j;try{var W={alpha:s,depth:h,stencil:u,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:f};j=r||t.getContext("webgl",W)||t.getContext("experimental-webgl",W);if(j===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}t.addEventListener("webglcontextlost",se,false)}catch(X){console.error("THREE.WebGLRenderer: "+X)}var q=new i.WebGLExtensions(j);q.get("OES_texture_float");q.get("OES_texture_float_linear");q.get("OES_texture_half_float");q.get("OES_texture_half_float_linear");q.get("OES_standard_derivatives");q.get("ANGLE_instanced_arrays");if(q.get("OES_element_index_uint")){i.BufferGeometry.MaxIndex=4294967296}var Y=new i.WebGLCapabilities(j,q,e);var K=new i.WebGLState(j,q,Je);var Z=new i.WebGLProperties;var Q=new i.WebGLObjects(j,Z,this.info);var J=new i.WebGLPrograms(this,Y);this.info.programs=J.programs;var $=new i.WebGLBufferRenderer(j,q,H);var ee=new i.WebGLIndexedBufferRenderer(j,q,H);function te(e,t,r,n){if(c===true){e*=n;t*=n;r*=n}j.clearColor(e,t,r,n)}function re(){K.init();j.viewport(P,R,D,k);te(d.r,d.g,d.b,p)}function ne(){S=null;A=null;C="";E=-1;N=true;K.reset()}re();this.context=j;this.capabilities=Y;this.extensions=q;this.state=K;var ie=new i.WebGLShadowMap(this,m,Q);this.shadowMap=ie;var ae=new i.SpritePlugin(this,w);var oe=new i.LensFlarePlugin(this,_);this.getContext=function(){return j};this.getContextAttributes=function(){return j.getContextAttributes()};this.forceContextLoss=function(){q.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){var e;return function t(){if(e!==undefined)return e;var t=q.get("EXT_texture_filter_anisotropic");if(t!==null){e=j.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{e=0}return e}}();this.getPrecision=function(){return Y.precision};this.getPixelRatio=function(){return o};this.setPixelRatio=function(e){if(e!==undefined)o=e};this.getSize=function(){return{width:n,height:a}};this.setSize=function(e,r,i){n=e;a=r;t.width=e*o;t.height=r*o;if(i!==false){t.style.width=e+"px";t.style.height=r+"px"}this.setViewport(0,0,e,r)};this.setViewport=function(e,t,r,n){P=e*o;R=t*o;D=r*o;k=n*o;j.viewport(P,R,D,k)};this.getViewport=function(e){e.x=P/o;e.y=R/o;e.z=D/o;e.w=k/o};this.setScissor=function(e,t,r,n){j.scissor(e*o,t*o,r*o,n*o)};this.enableScissorTest=function(e){K.setScissorTest(e)};this.getClearColor=function(){return d};this.setClearColor=function(e,t){d.set(e);p=t!==undefined?t:1;te(d.r,d.g,d.b,p)};this.getClearAlpha=function(){return p};this.setClearAlpha=function(e){p=e;te(d.r,d.g,d.b,p)};this.clear=function(e,t,r){var n=0;if(e===undefined||e)n|=j.COLOR_BUFFER_BIT;if(t===undefined||t)n|=j.DEPTH_BUFFER_BIT;if(r===undefined||r)n|=j.STENCIL_BUFFER_BIT;j.clear(n)};this.clearColor=function(){j.clear(j.COLOR_BUFFER_BIT)};this.clearDepth=function(){j.clear(j.DEPTH_BUFFER_BIT)};this.clearStencil=function(){j.clear(j.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,r,n){this.setRenderTarget(e);this.clear(t,r,n)};this.resetGLState=ne;this.dispose=function(){t.removeEventListener("webglcontextlost",se,false)};function se(e){e.preventDefault();ne();re();Z.clear()}function he(e){var t=e.target;t.removeEventListener("dispose",he);ce(t);z.textures--}function ue(e){var t=e.target;t.removeEventListener("dispose",ue);fe(t);z.textures--}function le(e){var t=e.target;t.removeEventListener("dispose",le);de(t)}function ce(e){var t=Z.get(e);if(e.image&&t.__image__webglTextureCube){j.deleteTexture(t.__image__webglTextureCube)}else{if(t.__webglInit===undefined)return;j.deleteTexture(t.__webglTexture)}Z.delete(e)}function fe(e){var t=Z.get(e);var r=Z.get(e.texture);if(!e||r.__webglTexture===undefined)return;j.deleteTexture(r.__webglTexture);if(e instanceof i.WebGLRenderTargetCube){for(var n=0;n<6;n++){j.deleteFramebuffer(t.__webglFramebuffer[n]);j.deleteRenderbuffer(t.__webglRenderbuffer[n])}}else{j.deleteFramebuffer(t.__webglFramebuffer);j.deleteRenderbuffer(t.__webglRenderbuffer)}Z.delete(e.texture);Z.delete(e)}function de(e){pe(e);Z.delete(e)}function pe(e){var t=Z.get(e).program;e.program=undefined;if(t!==undefined){J.releaseProgram(t)}}this.renderBufferImmediate=function(e,t,r){K.initAttributes();var n=Z.get(e);if(e.hasPositions&&!n.position)n.position=j.createBuffer();if(e.hasNormals&&!n.normal)n.normal=j.createBuffer();if(e.hasUvs&&!n.uv)n.uv=j.createBuffer();if(e.hasColors&&!n.color)n.color=j.createBuffer();var a=t.getAttributes();if(e.hasPositions){j.bindBuffer(j.ARRAY_BUFFER,n.position);j.bufferData(j.ARRAY_BUFFER,e.positionArray,j.DYNAMIC_DRAW);K.enableAttribute(a.position);j.vertexAttribPointer(a.position,3,j.FLOAT,false,0,0)}if(e.hasNormals){j.bindBuffer(j.ARRAY_BUFFER,n.normal);if(r.type!=="MeshPhongMaterial"&&r.shading===i.FlatShading){for(var o=0,s=e.count*3;o<s;o+=9){var h=e.normalArray;var u=(h[o+0]+h[o+3]+h[o+6])/3;var l=(h[o+1]+h[o+4]+h[o+7])/3;var c=(h[o+2]+h[o+5]+h[o+8])/3;h[o+0]=u;h[o+1]=l;h[o+2]=c;h[o+3]=u;h[o+4]=l;h[o+5]=c;h[o+6]=u;h[o+7]=l;h[o+8]=c}}j.bufferData(j.ARRAY_BUFFER,e.normalArray,j.DYNAMIC_DRAW);K.enableAttribute(a.normal);j.vertexAttribPointer(a.normal,3,j.FLOAT,false,0,0)}if(e.hasUvs&&r.map){j.bindBuffer(j.ARRAY_BUFFER,n.uv);j.bufferData(j.ARRAY_BUFFER,e.uvArray,j.DYNAMIC_DRAW);K.enableAttribute(a.uv);j.vertexAttribPointer(a.uv,2,j.FLOAT,false,0,0)}if(e.hasColors&&r.vertexColors!==i.NoColors){j.bindBuffer(j.ARRAY_BUFFER,n.color);j.bufferData(j.ARRAY_BUFFER,e.colorArray,j.DYNAMIC_DRAW);K.enableAttribute(a.color);j.vertexAttribPointer(a.color,3,j.FLOAT,false,0,0)}K.disableUnusedAttributes();j.drawArrays(j.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,r,n,a,s,h){Me(a);var u=Te(e,t,r,a,s);var l=false;var c=n.id+"_"+u.id+"_"+a.wireframe;if(c!==C){C=c;l=true}var f=s.morphTargetInfluences;if(f!==undefined){var d=[];for(var p=0,m=f.length;p<m;p++){var v=f[p];d.push([v,p])}d.sort(ve);if(d.length>8){d.length=8}var g=n.morphAttributes;for(var p=0,m=d.length;p<m;p++){var v=d[p];b[p]=v[0];if(v[0]!==0){var y=v[1];if(a.morphTargets===true&&g.position)n.addAttribute("morphTarget"+p,g.position[y]);if(a.morphNormals===true&&g.normal)n.addAttribute("morphNormal"+p,g.normal[y])}else{if(a.morphTargets===true)n.removeAttribute("morphTarget"+p);if(a.morphNormals===true)n.removeAttribute("morphNormal"+p)}}var x=u.getUniforms();if(x.morphTargetInfluences!==null){j.uniform1fv(x.morphTargetInfluences,b)}l=true}var y=n.index;var w=n.attributes.position;if(a.wireframe===true){y=Q.getWireframeAttribute(n)}var _;if(y!==null){_=ee;_.setIndex(y)}else{_=$}if(l){me(a,u,n);if(y!==null){j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,Q.getAttributeBuffer(y))}}var M=0;var S=Infinity;if(y!==null){S=y.count}else if(w!==undefined){S=w.count}var T=n.drawRange.start;var E=n.drawRange.count;var A=h!==null?h.start:0;var L=h!==null?h.count:Infinity;var P=Math.max(M,T,A);var R=Math.min(M+S,T+E,A+L)-1;var D=Math.max(0,R-P+1);if(s instanceof i.Mesh){if(a.wireframe===true){K.setLineWidth(a.wireframeLinewidth*o);_.setMode(j.LINES)}else{_.setMode(j.TRIANGLES)}if(n instanceof i.InstancedBufferGeometry&&n.maxInstancedCount>0){_.renderInstances(n)}else{_.render(P,D)}}else if(s instanceof i.Line){var k=a.linewidth;if(k===undefined)k=1;K.setLineWidth(k*o);if(s instanceof i.LineSegments){_.setMode(j.LINES)}else{_.setMode(j.LINE_STRIP)}_.render(P,D)}else if(s instanceof i.Points){_.setMode(j.POINTS);_.render(P,D)}};function me(e,t,r,n){var a;if(r instanceof i.InstancedBufferGeometry){a=q.get("ANGLE_instanced_arrays");if(a===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}if(n===undefined)n=0;K.initAttributes();var o=r.attributes;var s=t.getAttributes();var h=e.defaultAttributeValues;for(var u in s){var l=s[u];if(l>=0){var c=o[u];if(c!==undefined){var f=c.itemSize;var d=Q.getAttributeBuffer(c);if(c instanceof i.InterleavedBufferAttribute){var p=c.data;var m=p.stride;var v=c.offset;if(p instanceof i.InstancedInterleavedBuffer){K.enableAttributeAndDivisor(l,p.meshPerAttribute,a);if(r.maxInstancedCount===undefined){r.maxInstancedCount=p.meshPerAttribute*p.count}}else{K.enableAttribute(l)}j.bindBuffer(j.ARRAY_BUFFER,d);j.vertexAttribPointer(l,f,j.FLOAT,false,m*p.array.BYTES_PER_ELEMENT,(n*m+v)*p.array.BYTES_PER_ELEMENT)}else{if(c instanceof i.InstancedBufferAttribute){K.enableAttributeAndDivisor(l,c.meshPerAttribute,a);if(r.maxInstancedCount===undefined){r.maxInstancedCount=c.meshPerAttribute*c.count}}else{K.enableAttribute(l)}j.bindBuffer(j.ARRAY_BUFFER,d);j.vertexAttribPointer(l,f,j.FLOAT,false,0,n*f*4)}}else if(h!==undefined){var g=h[u];if(g!==undefined){switch(g.length){case 2:j.vertexAttrib2fv(l,g);break;case 3:j.vertexAttrib3fv(l,g);break;case 4:j.vertexAttrib4fv(l,g);break;default:j.vertexAttrib1fv(l,g)}}}}}K.disableUnusedAttributes()}function ve(e,t){return t[0]-e[0]}function ge(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function ye(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}this.render=function(e,t,r,n){if(t instanceof i.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var a=e.fog;C="";E=-1;A=null;N=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===null)t.updateMatrixWorld();t.matrixWorldInverse.getInverse(t.matrixWorld);B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);U.setFromMatrix(B);m.length=0;g=-1;x=-1;w.length=0;_.length=0;be(e,t);v.length=g+1;y.length=x+1;if(M.sortObjects===true){v.sort(ge);y.sort(ye)}ie.render(e);H.calls=0;H.vertices=0;H.faces=0;H.points=0;this.setRenderTarget(r);if(this.autoClear||n){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}if(e.overrideMaterial){var o=e.overrideMaterial;we(v,t,m,a,o);we(y,t,m,a,o)}else{K.setBlending(i.NoBlending);we(v,t,m,a);we(y,t,m,a)}ae.render(e,t);oe.render(e,t,F,O);if(r){var s=r.texture;var h=He(r);if(s.generateMipmaps&&h&&s.minFilter!==i.NearestFilter&&s.minFilter!==i.LinearFilter){Ze(r)}}K.setDepthTest(true);K.setDepthWrite(true);K.setColorWrite(true)};function xe(e,t,r,n,i){var a,o;if(r.transparent){a=y;o=++x}else{a=v;o=++g}var s=a[o];if(s!==undefined){s.id=e.id;s.object=e;s.geometry=t;s.material=r;s.z=V.z;s.group=i}else{s={id:e.id,object:e,geometry:t,material:r,z:V.z,group:i};a.push(s)}}function be(e,t){if(e.visible===false)return;if((e.channels.mask&t.channels.mask)!==0){if(e instanceof i.Light){m.push(e)}else if(e instanceof i.Sprite){w.push(e)}else if(e instanceof i.LensFlare){_.push(e)}else if(e instanceof i.ImmediateRenderObject){if(M.sortObjects===true){V.setFromMatrixPosition(e.matrixWorld);V.applyProjection(B)}xe(e,null,e.material,V.z,null)}else if(e instanceof i.Mesh||e instanceof i.Line||e instanceof i.Points){if(e instanceof i.SkinnedMesh){e.skeleton.update()}if(e.frustumCulled===false||U.intersectsObject(e)===true){var r=e.material;if(r.visible===true){if(M.sortObjects===true){V.setFromMatrixPosition(e.matrixWorld);V.applyProjection(B)}var n=Q.update(e);if(r instanceof i.MeshFaceMaterial){var a=n.groups;var o=r.materials;for(var s=0,h=a.length;s<h;s++){var u=a[s];var l=o[u.materialIndex];if(l.visible===true){xe(e,n,l,V.z,u)}}}else{xe(e,n,r,V.z,null)}}}}}var c=e.children;for(var s=0,h=c.length;s<h;s++){be(c[s],t)}}function we(e,t,r,n,a){for(var o=0,s=e.length;o<s;o++){var h=e[o];var u=h.object;var l=h.geometry;var c=a===undefined?h.material:a;var f=h.group;u.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,u.matrixWorld);u.normalMatrix.getNormalMatrix(u.modelViewMatrix);if(u instanceof i.ImmediateRenderObject){Me(c);var d=Te(t,r,n,c,u);C="";u.render(function(e){M.renderBufferImmediate(e,d,c)})}else{M.renderBufferDirect(t,r,n,l,c,u,f)}}}function _e(e,t,r,n){var a=Z.get(e);var o=J.getParameters(e,t,r,n);var s=J.getProgramCode(e,o);var h=a.program;var u=true;if(h===undefined){e.addEventListener("dispose",le)}else if(h.code!==s){pe(e)}else if(o.shaderID!==undefined){return}else{u=false}if(u){if(o.shaderID){var l=i.ShaderLib[o.shaderID];a.__webglShader={name:e.type,uniforms:i.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else{a.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}e.__webglShader=a.__webglShader;h=J.acquireProgram(e,o,s);a.program=h;e.program=h}var c=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<M.maxMorphTargets;f++){if(c["morphTarget"+f]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<M.maxMorphNormals;f++){if(c["morphNormal"+f]>=0){e.numSupportedMorphNormals++}}}a.uniformsList=[];var d=a.program.getUniforms();for(var p in a.__webglShader.uniforms){var m=d[p];if(m){a.uniformsList.push([a.__webglShader.uniforms[p],m])}}}function Me(e){Se(e);if(e.transparent===true){K.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha)}else{K.setBlending(i.NoBlending)}K.setDepthFunc(e.depthFunc);K.setDepthTest(e.depthTest);K.setDepthWrite(e.depthWrite);K.setColorWrite(e.colorWrite);K.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Se(e){e.side!==i.DoubleSide?K.enable(j.CULL_FACE):K.disable(j.CULL_FACE);K.setFlipSided(e.side===i.BackSide)}function Te(e,t,r,n,a){L=0;var o=Z.get(n);if(n.needsUpdate||!o.program){_e(n,t,r,a);n.needsUpdate=false}var s=false;var h=false;var u=false;var l=o.program,c=l.getUniforms(),f=o.__webglShader.uniforms;if(l.id!==S){j.useProgram(l.program);S=l.id;s=true;h=true;u=true}if(n.id!==E){if(E===-1)u=true;E=n.id;h=true}if(s||e!==A){j.uniformMatrix4fv(c.projectionMatrix,false,e.projectionMatrix.elements);if(Y.logarithmicDepthBuffer){j.uniform1f(c.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2))}if(e!==A)A=e;if(n instanceof i.ShaderMaterial||n instanceof i.MeshPhongMaterial||n.envMap){if(c.cameraPosition!==undefined){V.setFromMatrixPosition(e.matrixWorld);j.uniform3f(c.cameraPosition,V.x,V.y,V.z)}}if(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshBasicMaterial||n instanceof i.ShaderMaterial||n.skinning){if(c.viewMatrix!==undefined){j.uniformMatrix4fv(c.viewMatrix,false,e.matrixWorldInverse.elements)}}}if(n.skinning){if(a.bindMatrix&&c.bindMatrix!==undefined){
j.uniformMatrix4fv(c.bindMatrix,false,a.bindMatrix.elements)}if(a.bindMatrixInverse&&c.bindMatrixInverse!==undefined){j.uniformMatrix4fv(c.bindMatrixInverse,false,a.bindMatrixInverse.elements)}if(Y.floatVertexTextures&&a.skeleton&&a.skeleton.useVertexTexture){if(c.boneTexture!==undefined){var d=Ue();j.uniform1i(c.boneTexture,d);M.setTexture(a.skeleton.boneTexture,d)}if(c.boneTextureWidth!==undefined){j.uniform1i(c.boneTextureWidth,a.skeleton.boneTextureWidth)}if(c.boneTextureHeight!==undefined){j.uniform1i(c.boneTextureHeight,a.skeleton.boneTextureHeight)}}else if(a.skeleton&&a.skeleton.boneMatrices){if(c.boneGlobalMatrices!==undefined){j.uniformMatrix4fv(c.boneGlobalMatrices,false,a.skeleton.boneMatrices)}}}if(h){if(r&&n.fog){Pe(f,r)}if(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n.lights){if(N){u=true;Ie(t,e);N=false}if(u){De(f,G);ke(f,true)}else{ke(f,false)}}if(n instanceof i.MeshBasicMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshPhongMaterial){Ee(f,n)}if(n instanceof i.LineBasicMaterial){Ce(f,n)}else if(n instanceof i.LineDashedMaterial){Ce(f,n);Ae(f,n)}else if(n instanceof i.PointsMaterial){Le(f,n)}else if(n instanceof i.MeshPhongMaterial){Re(f,n)}else if(n instanceof i.MeshDepthMaterial){f.mNear.value=e.near;f.mFar.value=e.far;f.opacity.value=n.opacity}else if(n instanceof i.MeshNormalMaterial){f.opacity.value=n.opacity}if(a.receiveShadow&&!n._shadowPass){Fe(f,t,e)}Be(o.uniformsList)}Oe(c,a);if(c.modelMatrix!==undefined){j.uniformMatrix4fv(c.modelMatrix,false,a.matrixWorld.elements)}return l}function Ee(e,t){e.opacity.value=t.opacity;e.diffuse.value=t.color;if(t.emissive){e.emissive.value=t.emissive}e.map.value=t.map;e.specularMap.value=t.specularMap;e.alphaMap.value=t.alphaMap;if(t.aoMap){e.aoMap.value=t.aoMap;e.aoMapIntensity.value=t.aoMapIntensity}var r;if(t.map){r=t.map}else if(t.specularMap){r=t.specularMap}else if(t.displacementMap){r=t.displacementMap}else if(t.normalMap){r=t.normalMap}else if(t.bumpMap){r=t.bumpMap}else if(t.alphaMap){r=t.alphaMap}else if(t.emissiveMap){r=t.emissiveMap}if(r!==undefined){if(r instanceof i.WebGLRenderTarget)r=r.texture;var n=r.offset;var a=r.repeat;e.offsetRepeat.value.set(n.x,n.y,a.x,a.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof i.WebGLRenderTargetCube?1:-1;e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio}function Ce(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function Ae(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Le(e,r){e.psColor.value=r.color;e.opacity.value=r.opacity;e.size.value=r.size;e.scale.value=t.height/2;e.map.value=r.map;if(r.map!==null){var n=r.map.offset;var i=r.map.repeat;e.offsetRepeat.value.set(n.x,n.y,i.x,i.y)}}function Pe(e,t){e.fogColor.value=t.color;if(t instanceof i.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof i.FogExp2){e.fogDensity.value=t.density}}function Re(e,t){e.specular.value=t.specular;e.shininess.value=Math.max(t.shininess,1e-4);if(t.lightMap){e.lightMap.value=t.lightMap;e.lightMapIntensity.value=t.lightMapIntensity}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function De(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.pointLightDecay.value=t.point.decays;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.spotLightDecay.value=t.spot.decays;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function ke(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLightColor.needsUpdate=t;e.directionalLightDirection.needsUpdate=t;e.pointLightColor.needsUpdate=t;e.pointLightPosition.needsUpdate=t;e.pointLightDistance.needsUpdate=t;e.pointLightDecay.needsUpdate=t;e.spotLightColor.needsUpdate=t;e.spotLightPosition.needsUpdate=t;e.spotLightDistance.needsUpdate=t;e.spotLightDirection.needsUpdate=t;e.spotLightAngleCos.needsUpdate=t;e.spotLightExponent.needsUpdate=t;e.spotLightDecay.needsUpdate=t;e.hemisphereLightSkyColor.needsUpdate=t;e.hemisphereLightGroundColor.needsUpdate=t;e.hemisphereLightDirection.needsUpdate=t}function Fe(e,t,r){if(e.shadowMatrix){var n=0;for(var a=0,o=t.length;a<o;a++){var s=t[a];if(s.castShadow===true){if(s instanceof i.PointLight||s instanceof i.SpotLight||s instanceof i.DirectionalLight){var h=s.shadow;if(s instanceof i.PointLight){V.setFromMatrixPosition(s.matrixWorld).negate();h.matrix.identity().setPosition(V);e.shadowDarkness.value[n]=-h.darkness}else{e.shadowDarkness.value[n]=h.darkness}e.shadowMatrix.value[n]=h.matrix;e.shadowMap.value[n]=h.map;e.shadowMapSize.value[n]=h.mapSize;e.shadowBias.value[n]=h.bias;n++}}}}}function Oe(e,t){j.uniformMatrix4fv(e.modelViewMatrix,false,t.modelViewMatrix.elements);if(e.normalMatrix){j.uniformMatrix3fv(e.normalMatrix,false,t.normalMatrix.elements)}}function Ue(){var e=L;if(e>=Y.maxTextures){console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Y.maxTextures)}L+=1;return e}function Be(e){var t,r;for(var n=0,a=e.length;n<a;n++){var o=e[n][0];if(o.needsUpdate===false)continue;var s=o.type;var h=o.value;var u=e[n][1];switch(s){case"1i":j.uniform1i(u,h);break;case"1f":j.uniform1f(u,h);break;case"2f":j.uniform2f(u,h[0],h[1]);break;case"3f":j.uniform3f(u,h[0],h[1],h[2]);break;case"4f":j.uniform4f(u,h[0],h[1],h[2],h[3]);break;case"1iv":j.uniform1iv(u,h);break;case"3iv":j.uniform3iv(u,h);break;case"1fv":j.uniform1fv(u,h);break;case"2fv":j.uniform2fv(u,h);break;case"3fv":j.uniform3fv(u,h);break;case"4fv":j.uniform4fv(u,h);break;case"Matrix3fv":j.uniformMatrix3fv(u,false,h);break;case"Matrix4fv":j.uniformMatrix4fv(u,false,h);break;case"i":j.uniform1i(u,h);break;case"f":j.uniform1f(u,h);break;case"v2":j.uniform2f(u,h.x,h.y);break;case"v3":j.uniform3f(u,h.x,h.y,h.z);break;case"v4":j.uniform4f(u,h.x,h.y,h.z,h.w);break;case"c":j.uniform3f(u,h.r,h.g,h.b);break;case"iv1":j.uniform1iv(u,h);break;case"iv":j.uniform3iv(u,h);break;case"fv1":j.uniform1fv(u,h);break;case"fv":j.uniform3fv(u,h);break;case"v2v":if(o._array===undefined){o._array=new Float32Array(2*h.length)}for(var l=0,c=0,f=h.length;l<f;l++,c+=2){o._array[c+0]=h[l].x;o._array[c+1]=h[l].y}j.uniform2fv(u,o._array);break;case"v3v":if(o._array===undefined){o._array=new Float32Array(3*h.length)}for(var l=0,d=0,f=h.length;l<f;l++,d+=3){o._array[d+0]=h[l].x;o._array[d+1]=h[l].y;o._array[d+2]=h[l].z}j.uniform3fv(u,o._array);break;case"v4v":if(o._array===undefined){o._array=new Float32Array(4*h.length)}for(var l=0,p=0,f=h.length;l<f;l++,p+=4){o._array[p+0]=h[l].x;o._array[p+1]=h[l].y;o._array[p+2]=h[l].z;o._array[p+3]=h[l].w}j.uniform4fv(u,o._array);break;case"m3":j.uniformMatrix3fv(u,false,h.elements);break;case"m3v":if(o._array===undefined){o._array=new Float32Array(9*h.length)}for(var l=0,f=h.length;l<f;l++){h[l].flattenToArrayOffset(o._array,l*9)}j.uniformMatrix3fv(u,false,o._array);break;case"m4":j.uniformMatrix4fv(u,false,h.elements);break;case"m4v":if(o._array===undefined){o._array=new Float32Array(16*h.length)}for(var l=0,f=h.length;l<f;l++){h[l].flattenToArrayOffset(o._array,l*16)}j.uniformMatrix4fv(u,false,o._array);break;case"t":t=h;r=Ue();j.uniform1i(u,r);if(!t)continue;if(t instanceof i.CubeTexture||Array.isArray(t.image)&&t.image.length===6){Xe(t,r)}else if(t instanceof i.WebGLRenderTargetCube){qe(t.texture,r)}else if(t instanceof i.WebGLRenderTarget){M.setTexture(t.texture,r)}else{M.setTexture(t,r)}break;case"tv":if(o._array===undefined){o._array=[]}for(var l=0,f=o.value.length;l<f;l++){o._array[l]=Ue()}j.uniform1iv(u,o._array);for(var l=0,f=o.value.length;l<f;l++){t=o.value[l];r=o._array[l];if(!t)continue;if(t instanceof i.CubeTexture||t.image instanceof Array&&t.image.length===6){Xe(t,r)}else if(t instanceof i.WebGLRenderTarget){M.setTexture(t.texture,r)}else if(t instanceof i.WebGLRenderTargetCube){qe(t.texture,r)}else{M.setTexture(t,r)}}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}function Ve(e,t,r,n){e[t+0]=r.r*n;e[t+1]=r.g*n;e[t+2]=r.b*n}function Ie(e,t){var r,n,a,o=0,s=0,h=0,u,l,c,f,d,p=G,m=t.matrixWorldInverse,v=p.directional.colors,g=p.directional.positions,y=p.point.colors,x=p.point.positions,b=p.point.distances,w=p.point.decays,_=p.spot.colors,M=p.spot.positions,S=p.spot.distances,T=p.spot.directions,E=p.spot.anglesCos,C=p.spot.exponents,A=p.spot.decays,L=p.hemi.skyColors,P=p.hemi.groundColors,R=p.hemi.positions,D=0,k=0,F=0,O=0,U=0,B=0,N=0,z=0,H=0,j=0,W=0,X=0;for(r=0,n=e.length;r<n;r++){a=e[r];u=a.color;f=a.intensity;d=a.distance;if(a instanceof i.AmbientLight){if(!a.visible)continue;o+=u.r;s+=u.g;h+=u.b}else if(a instanceof i.DirectionalLight){U+=1;if(!a.visible)continue;I.setFromMatrixPosition(a.matrixWorld);V.setFromMatrixPosition(a.target.matrixWorld);I.sub(V);I.transformDirection(m);H=D*3;g[H+0]=I.x;g[H+1]=I.y;g[H+2]=I.z;Ve(v,H,u,f);D+=1}else if(a instanceof i.PointLight){B+=1;if(!a.visible)continue;j=k*3;Ve(y,j,u,f);V.setFromMatrixPosition(a.matrixWorld);V.applyMatrix4(m);x[j+0]=V.x;x[j+1]=V.y;x[j+2]=V.z;b[k]=d;w[k]=a.distance===0?0:a.decay;k+=1}else if(a instanceof i.SpotLight){N+=1;if(!a.visible)continue;W=F*3;Ve(_,W,u,f);I.setFromMatrixPosition(a.matrixWorld);V.copy(I).applyMatrix4(m);M[W+0]=V.x;M[W+1]=V.y;M[W+2]=V.z;S[F]=d;V.setFromMatrixPosition(a.target.matrixWorld);I.sub(V);I.transformDirection(m);T[W+0]=I.x;T[W+1]=I.y;T[W+2]=I.z;E[F]=Math.cos(a.angle);C[F]=a.exponent;A[F]=a.distance===0?0:a.decay;F+=1}else if(a instanceof i.HemisphereLight){z+=1;if(!a.visible)continue;I.setFromMatrixPosition(a.matrixWorld);I.transformDirection(m);X=O*3;R[X+0]=I.x;R[X+1]=I.y;R[X+2]=I.z;l=a.color;c=a.groundColor;Ve(L,X,l,f);Ve(P,X,c,f);O+=1}}for(r=D*3,n=Math.max(v.length,U*3);r<n;r++)v[r]=0;for(r=k*3,n=Math.max(y.length,B*3);r<n;r++)y[r]=0;for(r=F*3,n=Math.max(_.length,N*3);r<n;r++)_[r]=0;for(r=O*3,n=Math.max(L.length,z*3);r<n;r++)L[r]=0;for(r=O*3,n=Math.max(P.length,z*3);r<n;r++)P[r]=0;p.directional.length=D;p.point.length=k;p.spot.length=F;p.hemi.length=O;p.ambient[0]=o;p.ambient[1]=s;p.ambient[2]=h}this.setFaceCulling=function(e,t){if(e===i.CullFaceNone){K.disable(j.CULL_FACE)}else{if(t===i.FrontFaceDirectionCW){j.frontFace(j.CW)}else{j.frontFace(j.CCW)}if(e===i.CullFaceBack){j.cullFace(j.BACK)}else if(e===i.CullFaceFront){j.cullFace(j.FRONT)}else{j.cullFace(j.FRONT_AND_BACK)}K.enable(j.CULL_FACE)}};function Ne(e,t,r){var n;if(r){j.texParameteri(e,j.TEXTURE_WRAP_S,Je(t.wrapS));j.texParameteri(e,j.TEXTURE_WRAP_T,Je(t.wrapT));j.texParameteri(e,j.TEXTURE_MAG_FILTER,Je(t.magFilter));j.texParameteri(e,j.TEXTURE_MIN_FILTER,Je(t.minFilter))}else{j.texParameteri(e,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE);j.texParameteri(e,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE);if(t.wrapS!==i.ClampToEdgeWrapping||t.wrapT!==i.ClampToEdgeWrapping){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t)}j.texParameteri(e,j.TEXTURE_MAG_FILTER,Qe(t.magFilter));j.texParameteri(e,j.TEXTURE_MIN_FILTER,Qe(t.minFilter));if(t.minFilter!==i.NearestFilter&&t.minFilter!==i.LinearFilter){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)}}n=q.get("EXT_texture_filter_anisotropic");if(n){if(t.type===i.FloatType&&q.get("OES_texture_float_linear")===null)return;if(t.type===i.HalfFloatType&&q.get("OES_texture_half_float_linear")===null)return;if(t.anisotropy>1||Z.get(t).__currentAnisotropy){j.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,M.getMaxAnisotropy()));Z.get(t).__currentAnisotropy=t.anisotropy}}}function Ge(e,t,r){if(e.__webglInit===undefined){e.__webglInit=true;t.addEventListener("dispose",he);e.__webglTexture=j.createTexture();z.textures++}K.activeTexture(j.TEXTURE0+r);K.bindTexture(j.TEXTURE_2D,e.__webglTexture);j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,t.flipY);j.pixelStorei(j.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha);j.pixelStorei(j.UNPACK_ALIGNMENT,t.unpackAlignment);t.image=ze(t.image,Y.maxTextureSize);if(je(t)&&He(t.image)===false){t.image=We(t.image)}var n=t.image,a=He(n),o=Je(t.format),s=Je(t.type);Ne(j.TEXTURE_2D,t,a);var h,u=t.mipmaps;if(t instanceof i.DataTexture){if(u.length>0&&a){for(var l=0,c=u.length;l<c;l++){h=u[l];K.texImage2D(j.TEXTURE_2D,l,o,h.width,h.height,0,o,s,h.data)}t.generateMipmaps=false}else{K.texImage2D(j.TEXTURE_2D,0,o,n.width,n.height,0,o,s,n.data)}}else if(t instanceof i.CompressedTexture){for(var l=0,c=u.length;l<c;l++){h=u[l];if(t.format!==i.RGBAFormat&&t.format!==i.RGBFormat){if(K.getCompressedTextureFormats().indexOf(o)>-1){K.compressedTexImage2D(j.TEXTURE_2D,l,o,h.width,h.height,0,h.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{K.texImage2D(j.TEXTURE_2D,l,o,h.width,h.height,0,o,s,h.data)}}}else{if(u.length>0&&a){for(var l=0,c=u.length;l<c;l++){h=u[l];K.texImage2D(j.TEXTURE_2D,l,o,o,s,h)}t.generateMipmaps=false}else{K.texImage2D(j.TEXTURE_2D,0,o,o,s,t.image)}}if(t.generateMipmaps&&a)j.generateMipmap(j.TEXTURE_2D);e.__version=t.version;if(t.onUpdate)t.onUpdate(t)}this.setTexture=function(e,t){var r=Z.get(e);if(e.version>0&&r.__version!==e.version){var n=e.image;if(n===undefined){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);return}if(n.complete===false){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e);return}Ge(r,e,t);return}K.activeTexture(j.TEXTURE0+t);K.bindTexture(j.TEXTURE_2D,r.__webglTexture)};function ze(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height);var n=document.createElement("canvas");n.width=Math.floor(e.width*r);n.height=Math.floor(e.height*r);var i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height);console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e);return n}return e}function He(e){return i.Math.isPowerOfTwo(e.width)&&i.Math.isPowerOfTwo(e.height)}function je(e){if(e.wrapS!==i.ClampToEdgeWrapping||e.wrapT!==i.ClampToEdgeWrapping)return true;if(e.minFilter!==i.NearestFilter&&e.minFilter!==i.LinearFilter)return true;return false}function We(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");t.width=i.Math.nearestPowerOfTwo(e.width);t.height=i.Math.nearestPowerOfTwo(e.height);var r=t.getContext("2d");r.drawImage(e,0,0,t.width,t.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e);return t}return e}function Xe(e,t){var r=Z.get(e);if(e.image.length===6){if(e.version>0&&r.__version!==e.version){if(!r.__image__webglTextureCube){e.addEventListener("dispose",he);r.__image__webglTextureCube=j.createTexture();z.textures++}K.activeTexture(j.TEXTURE0+t);K.bindTexture(j.TEXTURE_CUBE_MAP,r.__image__webglTextureCube);j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,e.flipY);var n=e instanceof i.CompressedTexture;var a=e.image[0]instanceof i.DataTexture;var o=[];for(var s=0;s<6;s++){if(M.autoScaleCubemaps&&!n&&!a){o[s]=ze(e.image[s],Y.maxCubemapSize)}else{o[s]=a?e.image[s].image:e.image[s]}}var h=o[0],u=He(h),l=Je(e.format),c=Je(e.type);Ne(j.TEXTURE_CUBE_MAP,e,u);for(var s=0;s<6;s++){if(!n){if(a){K.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,o[s].width,o[s].height,0,l,c,o[s].data)}else{K.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,l,c,o[s])}}else{var f,d=o[s].mipmaps;for(var p=0,m=d.length;p<m;p++){f=d[p];if(e.format!==i.RGBAFormat&&e.format!==i.RGBFormat){if(K.getCompressedTextureFormats().indexOf(l)>-1){K.compressedTexImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,f.width,f.height,0,f.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{K.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,f.width,f.height,0,l,c,f.data)}}}}if(e.generateMipmaps&&u){j.generateMipmap(j.TEXTURE_CUBE_MAP)}r.__version=e.version;if(e.onUpdate)e.onUpdate(e)}else{K.activeTexture(j.TEXTURE0+t);K.bindTexture(j.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}}}function qe(e,t){K.activeTexture(j.TEXTURE0+t);K.bindTexture(j.TEXTURE_CUBE_MAP,Z.get(e).__webglTexture)}function Ye(e,t,r){j.bindFramebuffer(j.FRAMEBUFFER,e);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,r,Z.get(t.texture).__webglTexture,0)}function Ke(e,t){j.bindRenderbuffer(j.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){j.renderbufferStorage(j.RENDERBUFFER,j.DEPTH_COMPONENT16,t.width,t.height);j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_ATTACHMENT,j.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){j.renderbufferStorage(j.RENDERBUFFER,j.DEPTH_STENCIL,t.width,t.height);j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_STENCIL_ATTACHMENT,j.RENDERBUFFER,e)}else{j.renderbufferStorage(j.RENDERBUFFER,j.RGBA4,t.width,t.height)}}this.setRenderTarget=function(e){var t=e instanceof i.WebGLRenderTargetCube;if(e&&Z.get(e).__webglFramebuffer===undefined){var r=Z.get(e);var n=Z.get(e.texture);if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",ue);n.__webglTexture=j.createTexture();z.textures++;var a=He(e),o=Je(e.texture.format),s=Je(e.texture.type);if(t){r.__webglFramebuffer=[];r.__webglRenderbuffer=[];K.bindTexture(j.TEXTURE_CUBE_MAP,n.__webglTexture);Ne(j.TEXTURE_CUBE_MAP,e.texture,a);for(var h=0;h<6;h++){r.__webglFramebuffer[h]=j.createFramebuffer();r.__webglRenderbuffer[h]=j.createRenderbuffer();K.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,o,e.width,e.height,0,o,s,null);Ye(r.__webglFramebuffer[h],e,j.TEXTURE_CUBE_MAP_POSITIVE_X+h);Ke(r.__webglRenderbuffer[h],e)}if(e.texture.generateMipmaps&&a)j.generateMipmap(j.TEXTURE_CUBE_MAP)}else{r.__webglFramebuffer=j.createFramebuffer();if(e.shareDepthFrom){r.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{r.__webglRenderbuffer=j.createRenderbuffer()}K.bindTexture(j.TEXTURE_2D,n.__webglTexture);Ne(j.TEXTURE_2D,e.texture,a);K.texImage2D(j.TEXTURE_2D,0,o,e.width,e.height,0,o,s,null);Ye(r.__webglFramebuffer,e,j.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_ATTACHMENT,j.RENDERBUFFER,r.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_STENCIL_ATTACHMENT,j.RENDERBUFFER,r.__webglRenderbuffer)}}else{Ke(r.__webglRenderbuffer,e)}if(e.texture.generateMipmaps&&a)j.generateMipmap(j.TEXTURE_2D)}if(t){K.bindTexture(j.TEXTURE_CUBE_MAP,null)}else{K.bindTexture(j.TEXTURE_2D,null)}j.bindRenderbuffer(j.RENDERBUFFER,null);j.bindFramebuffer(j.FRAMEBUFFER,null)}var u,l,c,f,d;if(e){var r=Z.get(e);if(t){u=r.__webglFramebuffer[e.activeCubeFace]}else{u=r.__webglFramebuffer}l=e.width;c=e.height;f=0;d=0}else{u=null;l=D;c=k;f=P;d=R}if(u!==T){j.bindFramebuffer(j.FRAMEBUFFER,u);j.viewport(f,d,l,c);T=u}if(t){var n=Z.get(e.texture);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,0)}F=l;O=c};this.readRenderTargetPixels=function(e,t,r,n,a,o){if(e instanceof i.WebGLRenderTarget===false){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var s=Z.get(e).__webglFramebuffer;if(s){var h=false;if(s!==T){j.bindFramebuffer(j.FRAMEBUFFER,s);h=true}try{var u=e.texture;if(u.format!==i.RGBAFormat&&Je(u.format)!==j.getParameter(j.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(u.type!==i.UnsignedByteType&&Je(u.type)!==j.getParameter(j.IMPLEMENTATION_COLOR_READ_TYPE)&&!(u.type===i.FloatType&&q.get("WEBGL_color_buffer_float"))&&!(u.type===i.HalfFloatType&&q.get("EXT_color_buffer_half_float"))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(j.checkFramebufferStatus(j.FRAMEBUFFER)===j.FRAMEBUFFER_COMPLETE){j.readPixels(t,r,n,a,Je(u.format),Je(u.type),o)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{if(h){j.bindFramebuffer(j.FRAMEBUFFER,T)}}}};function Ze(e){var t=e instanceof i.WebGLRenderTargetCube?j.TEXTURE_CUBE_MAP:j.TEXTURE_2D;var r=Z.get(e.texture).__webglTexture;K.bindTexture(t,r);j.generateMipmap(t);K.bindTexture(t,null)}function Qe(e){if(e===i.NearestFilter||e===i.NearestMipMapNearestFilter||e===i.NearestMipMapLinearFilter){return j.NEAREST}return j.LINEAR}function Je(e){var t;if(e===i.RepeatWrapping)return j.REPEAT;if(e===i.ClampToEdgeWrapping)return j.CLAMP_TO_EDGE;if(e===i.MirroredRepeatWrapping)return j.MIRRORED_REPEAT;if(e===i.NearestFilter)return j.NEAREST;if(e===i.NearestMipMapNearestFilter)return j.NEAREST_MIPMAP_NEAREST;if(e===i.NearestMipMapLinearFilter)return j.NEAREST_MIPMAP_LINEAR;if(e===i.LinearFilter)return j.LINEAR;if(e===i.LinearMipMapNearestFilter)return j.LINEAR_MIPMAP_NEAREST;if(e===i.LinearMipMapLinearFilter)return j.LINEAR_MIPMAP_LINEAR;if(e===i.UnsignedByteType)return j.UNSIGNED_BYTE;if(e===i.UnsignedShort4444Type)return j.UNSIGNED_SHORT_4_4_4_4;if(e===i.UnsignedShort5551Type)return j.UNSIGNED_SHORT_5_5_5_1;if(e===i.UnsignedShort565Type)return j.UNSIGNED_SHORT_5_6_5;if(e===i.ByteType)return j.BYTE;if(e===i.ShortType)return j.SHORT;if(e===i.UnsignedShortType)return j.UNSIGNED_SHORT;if(e===i.IntType)return j.INT;if(e===i.UnsignedIntType)return j.UNSIGNED_INT;if(e===i.FloatType)return j.FLOAT;t=q.get("OES_texture_half_float");if(t!==null){if(e===i.HalfFloatType)return t.HALF_FLOAT_OES}if(e===i.AlphaFormat)return j.ALPHA;if(e===i.RGBFormat)return j.RGB;if(e===i.RGBAFormat)return j.RGBA;if(e===i.LuminanceFormat)return j.LUMINANCE;if(e===i.LuminanceAlphaFormat)return j.LUMINANCE_ALPHA;if(e===i.AddEquation)return j.FUNC_ADD;if(e===i.SubtractEquation)return j.FUNC_SUBTRACT;if(e===i.ReverseSubtractEquation)return j.FUNC_REVERSE_SUBTRACT;if(e===i.ZeroFactor)return j.ZERO;if(e===i.OneFactor)return j.ONE;if(e===i.SrcColorFactor)return j.SRC_COLOR;if(e===i.OneMinusSrcColorFactor)return j.ONE_MINUS_SRC_COLOR;if(e===i.SrcAlphaFactor)return j.SRC_ALPHA;if(e===i.OneMinusSrcAlphaFactor)return j.ONE_MINUS_SRC_ALPHA;if(e===i.DstAlphaFactor)return j.DST_ALPHA;if(e===i.OneMinusDstAlphaFactor)return j.ONE_MINUS_DST_ALPHA;if(e===i.DstColorFactor)return j.DST_COLOR;if(e===i.OneMinusDstColorFactor)return j.ONE_MINUS_DST_COLOR;if(e===i.SrcAlphaSaturateFactor)return j.SRC_ALPHA_SATURATE;t=q.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===i.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===i.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=q.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===i.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===i.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===i.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===i.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=q.get("EXT_blend_minmax");if(t!==null){if(e===i.MinEquation)return t.MIN_EXT;if(e===i.MaxEquation)return t.MAX_EXT}return 0}this.supportsFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return q.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return q.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return q.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return q.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return q.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return q.get("EXT_blend_minmax")};this.supportsVertexTextures=function(){return Y.vertexTextures};this.supportsInstancedArrays=function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return q.get("ANGLE_instanced_arrays")};this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Object.defineProperties(this,{shadowMapEnabled:{get:function(){return ie.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");ie.enabled=e}},shadowMapType:{get:function(){return ie.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");ie.type=e}},shadowMapCullFace:{get:function(){return ie.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");ie.cullFace=e}},shadowMapDebug:{get:function(){return ie.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug.");ie.debug=e}}})};i.WebGLRenderTarget=function(e,t,r){this.uuid=i.Math.generateUUID();this.width=e;this.height=t;r=r||{};if(r.minFilter===undefined)r.minFilter=i.LinearFilter;this.texture=new i.Texture(undefined,undefined,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy);this.depthBuffer=r.depthBuffer!==undefined?r.depthBuffer:true;this.stencilBuffer=r.stencilBuffer!==undefined?r.stencilBuffer:true;this.shareDepthFrom=r.shareDepthFrom!==undefined?r.shareDepthFrom:null};i.WebGLRenderTarget.prototype={constructor:i.WebGLRenderTarget,get wrapS(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set wrapS(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=e},get wrapT(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set wrapT(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=e},get magFilter(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set magFilter(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=e},get minFilter(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set minFilter(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=e},get anisotropy(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set anisotropy(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=e},get offset(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set offset(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=e},get repeat(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set repeat(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=e},get format(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set format(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=e},get type(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set type(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=e},get generateMipmaps(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set generateMipmaps(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=e},setSize:function(e,t){if(this.width!==e||this.height!==t){this.width=e;this.height=t;this.dispose()}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.width=e.width;this.height=e.height;this.texture=e.texture.clone();this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.shareDepthFrom=e.shareDepthFrom;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube=function(e,t,r){i.WebGLRenderTarget.call(this,e,t,r);this.activeCubeFace=0};i.WebGLRenderTargetCube.prototype=Object.create(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube.prototype.constructor=i.WebGLRenderTargetCube;i.WebGLBufferRenderer=function(e,t,r){var n;function a(e){n=e}function o(t,i){e.drawArrays(n,t,i);r.calls++;r.vertices+=i;if(n===e.TRIANGLES)r.faces+=i/3}function s(e){var r=t.get("ANGLE_instanced_arrays");if(r===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var a=e.attributes.position;if(a instanceof i.InterleavedBufferAttribute){r.drawArraysInstancedANGLE(n,0,a.data.count,e.maxInstancedCount)}else{r.drawArraysInstancedANGLE(n,0,a.count,e.maxInstancedCount)}}this.setMode=a;this.render=o;this.renderInstances=s};i.WebGLIndexedBufferRenderer=function(e,t,r){var n;function i(e){n=e}var a,o;function s(r){if(r.array instanceof Uint32Array&&t.get("OES_element_index_uint")){a=e.UNSIGNED_INT;o=4}else{a=e.UNSIGNED_SHORT;o=2}}function h(t,i){e.drawElements(n,i,a,t*o);r.calls++;r.vertices+=i;if(n===e.TRIANGLES)r.faces+=i/3}function u(e){var r=t.get("ANGLE_instanced_arrays");if(r===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var i=e.index;r.drawElementsInstancedANGLE(n,i.array.length,a,0,e.maxInstancedCount)}this.setMode=i;this.setIndex=s;this.render=h;this.renderInstances=u};i.WebGLExtensions=function(e){var t={};this.get=function(r){if(t[r]!==undefined){return t[r]}var n;switch(r){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":
n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}if(n===null){console.warn("THREE.WebGLRenderer: "+r+" extension not supported.")}t[r]=n;return n}};i.WebGLCapabilities=function(e,t,r){function n(t){if(t==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0){return"highp"}t="mediump"}if(t==="mediump"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0){return"mediump"}}return"lowp"}this.getMaxPrecision=n;this.precision=r.precision!==undefined?r.precision:"highp",this.logarithmicDepthBuffer=r.logarithmicDepthBuffer!==undefined?r.logarithmicDepthBuffer:false;this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE);this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS);this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=this.maxVertexTextures>0;this.floatFragmentTextures=!!t.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var i=n(this.precision);if(i!==this.precision){console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",i,"instead.");this.precision=i}if(this.logarithmicDepthBuffer){this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth")}};i.WebGLGeometries=function(e,t,r){var n={};function a(e){var t=e.geometry;if(n[t.id]!==undefined){return n[t.id]}t.addEventListener("dispose",o);var a;if(t instanceof i.BufferGeometry){a=t}else if(t instanceof i.Geometry){if(t._bufferGeometry===undefined){t._bufferGeometry=(new i.BufferGeometry).setFromObject(e)}a=t._bufferGeometry}n[t.id]=a;r.memory.geometries++;return a}function o(e){var i=e.target;var a=n[i.id];u(a.attributes);i.removeEventListener("dispose",o);delete n[i.id];var s=t.get(i);if(s.wireframe)h(s.wireframe);r.memory.geometries--}function s(e){if(e instanceof i.InterleavedBufferAttribute){return t.get(e.data).__webglBuffer}return t.get(e).__webglBuffer}function h(t){var r=s(t);if(r!==undefined){e.deleteBuffer(r);l(t)}}function u(e){for(var t in e){h(e[t])}}function l(e){if(e instanceof i.InterleavedBufferAttribute){t.delete(e.data)}else{t.delete(e)}}this.get=a};i.WebGLObjects=function(e,t,r){var n=new i.WebGLGeometries(e,t,r);function a(t){var r=n.get(t);if(t.geometry instanceof i.Geometry){r.updateFromObject(t)}var a=r.index;var s=r.attributes;if(a!==null){o(a,e.ELEMENT_ARRAY_BUFFER)}for(var h in s){o(s[h],e.ARRAY_BUFFER)}var u=r.morphAttributes;for(var h in u){var l=u[h];for(var c=0,f=l.length;c<f;c++){o(l[c],e.ARRAY_BUFFER)}}return r}function o(e,r){var n=e instanceof i.InterleavedBufferAttribute?e.data:e;var a=t.get(n);if(a.__webglBuffer===undefined){s(a,n,r)}else if(a.version!==n.version){h(a,n,r)}}function s(t,r,n){t.__webglBuffer=e.createBuffer();e.bindBuffer(n,t.__webglBuffer);var i=r.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(n,r.array,i);t.version=r.version}function h(t,r,n){e.bindBuffer(n,t.__webglBuffer);if(r.dynamic===false||r.updateRange.count===-1){e.bufferSubData(n,0,r.array)}else if(r.updateRange.count===0){console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.")}else{e.bufferSubData(n,r.updateRange.offset*r.array.BYTES_PER_ELEMENT,r.array.subarray(r.updateRange.offset,r.updateRange.offset+r.updateRange.count));r.updateRange.count=0}t.version=r.version}function u(e){if(e instanceof i.InterleavedBufferAttribute){return t.get(e.data).__webglBuffer}return t.get(e).__webglBuffer}function l(r){var n=t.get(r);if(n.wireframe!==undefined){return n.wireframe}var a=[];var s=r.index;var h=r.attributes;var u=h.position;if(s!==null){var l={};var f=s.array;for(var d=0,p=f.length;d<p;d+=3){var m=f[d+0];var v=f[d+1];var g=f[d+2];if(c(l,m,v))a.push(m,v);if(c(l,v,g))a.push(v,g);if(c(l,g,m))a.push(g,m)}}else{var f=h.position.array;for(var d=0,p=f.length/3-1;d<p;d+=3){var m=d+0;var v=d+1;var g=d+2;a.push(m,v,v,g,g,m)}}var y=u.count>65535?Uint32Array:Uint16Array;var x=new i.BufferAttribute(new y(a),1);o(x,e.ELEMENT_ARRAY_BUFFER);n.wireframe=x;return x}function c(e,t,r){if(t>r){var n=t;t=r;r=n}var i=e[t];if(i===undefined){e[t]=[r];return true}else if(i.indexOf(r)===-1){i.push(r);return true}return false}this.getAttributeBuffer=u;this.getWireframeAttribute=l;this.update=a};i.WebGLProgram=function(){var e=0;function t(e){var t=[];for(var r in e){var n=e[r];if(n===false)continue;t.push("#define "+r+" "+n)}return t.join("\n")}function r(e,t,r){var n={};var i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(var a=0;a<i;a++){var o=e.getActiveUniform(t,a);var s=o.name;var h=e.getUniformLocation(t,s);var u=s.lastIndexOf("[0]");if(u!==-1&&u===s.length-3){n[s.substr(0,u)]=h}n[s]=h}return n}function n(e,t,r){var n={};var i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(var a=0;a<i;a++){var o=e.getActiveAttrib(t,a);var s=o.name;n[s]=e.getAttribLocation(t,s)}return n}function a(e){return e!==""}return function o(s,h,u,l){var c=s.context;var f=u.defines;var d=u.__webglShader.vertexShader;var p=u.__webglShader.fragmentShader;var m="SHADOWMAP_TYPE_BASIC";if(l.shadowMapType===i.PCFShadowMap){m="SHADOWMAP_TYPE_PCF"}else if(l.shadowMapType===i.PCFSoftShadowMap){m="SHADOWMAP_TYPE_PCF_SOFT"}var v="ENVMAP_TYPE_CUBE";var g="ENVMAP_MODE_REFLECTION";var y="ENVMAP_BLENDING_MULTIPLY";if(l.envMap){switch(u.envMap.mapping){case i.CubeReflectionMapping:case i.CubeRefractionMapping:v="ENVMAP_TYPE_CUBE";break;case i.EquirectangularReflectionMapping:case i.EquirectangularRefractionMapping:v="ENVMAP_TYPE_EQUIREC";break;case i.SphericalReflectionMapping:v="ENVMAP_TYPE_SPHERE";break}switch(u.envMap.mapping){case i.CubeRefractionMapping:case i.EquirectangularRefractionMapping:g="ENVMAP_MODE_REFRACTION";break}switch(u.combine){case i.MultiplyOperation:y="ENVMAP_BLENDING_MULTIPLY";break;case i.MixOperation:y="ENVMAP_BLENDING_MIX";break;case i.AddOperation:y="ENVMAP_BLENDING_ADD";break}}var x=s.gammaFactor>0?s.gammaFactor:1;var b=t(f);var w=c.createProgram();var _,M;if(u instanceof i.RawShaderMaterial){_="";M=""}else{_=["precision "+l.precision+" float;","precision "+l.precision+" int;","#define SHADER_NAME "+u.__webglShader.name,b,l.supportsVertexTextures?"#define VERTEX_TEXTURES":"",s.gammaInput?"#define GAMMA_INPUT":"",s.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,"#define MAX_BONES "+l.maxBones,l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+g:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===false?"#define USE_MORPHNORMALS":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+m:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(a).join("\n");M=[l.bumpMap||l.normalMap||l.flatShading||u.derivatives?"#extension GL_OES_standard_derivatives : enable":"",l.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+l.precision+" float;","precision "+l.precision+" int;","#define SHADER_NAME "+u.__webglShader.name,b,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,l.alphaTest?"#define ALPHATEST "+l.alphaTest:"",s.gammaInput?"#define GAMMA_INPUT":"",s.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+v:"",l.envMap?"#define "+g:"",l.envMap?"#define "+y:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.flatShading?"#define FLAT_SHADED":"",l.metal?"#define METAL":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+m:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(a).join("\n")}var S=_+d;var T=M+p;var E=i.WebGLShader(c,c.VERTEX_SHADER,S);var C=i.WebGLShader(c,c.FRAGMENT_SHADER,T);c.attachShader(w,E);c.attachShader(w,C);if(u.index0AttributeName!==undefined){c.bindAttribLocation(w,0,u.index0AttributeName)}else if(l.morphTargets===true){c.bindAttribLocation(w,0,"position")}c.linkProgram(w);var A=c.getProgramInfoLog(w);var L=c.getShaderInfoLog(E);var P=c.getShaderInfoLog(C);var R=true;var D=true;if(c.getProgramParameter(w,c.LINK_STATUS)===false){R=false;console.error("THREE.WebGLProgram: shader error: ",c.getError(),"gl.VALIDATE_STATUS",c.getProgramParameter(w,c.VALIDATE_STATUS),"gl.getProgramInfoLog",A,L,P)}else if(A!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A)}else if(L===""||P===""){D=false}if(D){this.diagnostics={runnable:R,material:u,programLog:A,vertexShader:{log:L,prefix:_},fragmentShader:{log:P,prefix:M}}}c.deleteShader(E);c.deleteShader(C);var k;this.getUniforms=function(){if(k===undefined){k=r(c,w)}return k};var F;this.getAttributes=function(){if(F===undefined){F=n(c,w)}return F};this.destroy=function(){c.deleteProgram(w);this.program=undefined};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=e++;this.code=h;this.usedTimes=1;this.program=w;this.vertexShader=E;this.fragmentShader=C;return this}}();i.WebGLPrograms=function(e,t){var r=[];var n={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"};var a=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","pointLightShadows","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];function o(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture){return 1024}else{var r=t.maxVertexUniforms;var n=Math.floor((r-20)/4);var a=n;if(e!==undefined&&e instanceof i.SkinnedMesh){a=Math.min(e.skeleton.bones.length,a);if(a<e.skeleton.bones.length){console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+a+" (try OpenGL instead of ANGLE)")}}return a}}function s(e){var t=0;var r=0;var n=0;var a=0;for(var o=0,s=e.length;o<s;o++){var h=e[o];if(h.visible===false)continue;if(h instanceof i.DirectionalLight)t++;if(h instanceof i.PointLight)r++;if(h instanceof i.SpotLight)n++;if(h instanceof i.HemisphereLight)a++}return{directional:t,point:r,spot:n,hemi:a}}function h(e){var t=0;var r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(!o.castShadow)continue;if(o instanceof i.SpotLight||o instanceof i.DirectionalLight)t++;if(o instanceof i.PointLight){t++;r++}}return{maxShadows:t,pointLightShadows:r}}this.getParameters=function(r,a,u,l){var c=n[r.type];var f=s(a);var d=h(a);var p=o(l);var m=e.getPrecision();if(r.precision!==null){m=t.getMaxPrecision(r.precision);if(m!==r.precision){console.warn("THREE.WebGLRenderer.initMaterial:",r.precision,"not supported, using",m,"instead.")}}var v={shaderID:c,precision:m,supportsVertexTextures:t.vertexTextures,map:!!r.map,envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,combine:r.combine,vertexColors:r.vertexColors,fog:u,useFog:r.fog,fogExp:u instanceof i.FogExp2,flatShading:r.shading===i.FlatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:r.skinning,maxBones:p,useVertexTexture:t.floatVertexTextures&&l&&l.skeleton&&l.skeleton.useVertexTexture,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,maxDirLights:f.directional,maxPointLights:f.point,maxSpotLights:f.spot,maxHemiLights:f.hemi,maxShadows:d.maxShadows,pointLightShadows:d.pointLightShadows,shadowMapEnabled:e.shadowMap.enabled&&l.receiveShadow&&d.maxShadows>0,shadowMapType:e.shadowMap.type,shadowMapDebug:e.shadowMap.debug,alphaTest:r.alphaTest,metal:r.metal,doubleSided:r.side===i.DoubleSide,flipSided:r.side===i.BackSide};return v};this.getProgramCode=function(e,t){var r=[];if(t.shaderID){r.push(t.shaderID)}else{r.push(e.fragmentShader);r.push(e.vertexShader)}if(e.defines!==undefined){for(var n in e.defines){r.push(n);r.push(e.defines[n])}}for(var i=0;i<a.length;i++){var o=a[i];r.push(o);r.push(t[o])}return r.join()};this.acquireProgram=function(t,n,a){var o;for(var s=0,h=r.length;s<h;s++){var u=r[s];if(u.code===a){o=u;++o.usedTimes;break}}if(o===undefined){o=new i.WebGLProgram(e,a,t,n);r.push(o)}return o};this.releaseProgram=function(e){if(--e.usedTimes===0){var t=r.indexOf(e);r[t]=r[r.length-1];r.pop();e.destroy()}};this.programs=r};i.WebGLProperties=function(){var e={};this.get=function(t){var r=t.uuid;var n=e[r];if(n===undefined){n={};e[r]=n}return n};this.delete=function(t){delete e[t.uuid]};this.clear=function(){e={}}};i.WebGLShader=function(){function e(e){var t=e.split("\n");for(var r=0;r<t.length;r++){t[r]=r+1+": "+t[r]}return t.join("\n")}return function t(r,n,i){var a=r.createShader(n);r.shaderSource(a,i);r.compileShader(a);if(r.getShaderParameter(a,r.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(r.getShaderInfoLog(a)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",n===r.VERTEX_SHADER?"vertex":"fragment",r.getShaderInfoLog(a),e(i))}return a}}();i.WebGLShadowMap=function(e,t,r){var n=e.context,a=e.state,o=new i.Frustum,s=new i.Matrix4,h=new i.Vector3,u=new i.Vector3,l=new i.Vector3,c=new i.Vector3,f=[],d=1,p=2,m=(d|p)+1,v=new Array(m),g=new Array(m);var y=[new i.Vector3(1,0,0),new i.Vector3(-1,0,0),new i.Vector3(0,0,1),new i.Vector3(0,0,-1),new i.Vector3(0,1,0),new i.Vector3(0,-1,0)];var x=[new i.Vector3(0,1,0),new i.Vector3(0,1,0),new i.Vector3(0,1,0),new i.Vector3(0,1,0),new i.Vector3(0,0,1),new i.Vector3(0,0,-1)];var b=[new i.Vector4,new i.Vector4,new i.Vector4,new i.Vector4,new i.Vector4,new i.Vector4];var w=new i.Vector4;var _=i.ShaderLib["depthRGBA"];var M=i.UniformsUtils.clone(_.uniforms);var S=i.ShaderLib["distanceRGBA"];var T=i.UniformsUtils.clone(S.uniforms);for(var E=0;E!==m;++E){var C=(E&d)!==0;var A=(E&p)!==0;var L=new i.ShaderMaterial({uniforms:M,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,morphTargets:C,skinning:A});L._shadowPass=true;v[E]=L;var P=new i.ShaderMaterial({uniforms:T,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,morphTargets:C,skinning:A});P._shadowPass=true;g[E]=P}var R=this;this.enabled=false;this.autoUpdate=true;this.needsUpdate=false;this.type=i.PCFShadowMap;this.cullFace=i.CullFaceFront;this.render=function(h){var u,d;if(R.enabled===false)return;if(R.autoUpdate===false&&R.needsUpdate===false)return;n.clearColor(1,1,1,1);a.disable(n.BLEND);a.enable(n.CULL_FACE);n.frontFace(n.CCW);n.cullFace(R.cullFace===i.CullFaceFront?n.FRONT:n.BACK);a.setDepthTest(true);e.getViewport(w);for(var p=0,m=t.length;p<m;p++){var v=t[p];if(v.castShadow===true){var g=v.shadow;var _=g.camera;var M=g.mapSize;if(v instanceof i.PointLight){u=6;d=true;var S=M.x/4;var T=M.y/2;b[0].set(S*2,T,S,T);b[1].set(0,T,S,T);b[2].set(S*3,T,S,T);b[3].set(S,T,S,T);b[4].set(S*3,0,S,T);b[5].set(S,0,S,T)}else{u=1;d=false}if(g.map===null){var E=i.LinearFilter;if(R.type===i.PCFSoftShadowMap){E=i.NearestFilter}var C={minFilter:E,magFilter:E,format:i.RGBAFormat};g.map=new i.WebGLRenderTarget(M.x,M.y,C);g.matrix=new i.Matrix4;if(v instanceof i.SpotLight){_.aspect=M.x/M.y}_.updateProjectionMatrix()}var A=g.map;var L=g.matrix;c.setFromMatrixPosition(v.matrixWorld);_.position.copy(c);e.setRenderTarget(A);e.clear();for(var P=0;P<u;P++){if(d){l.copy(_.position);l.add(y[P]);_.up.copy(x[P]);_.lookAt(l);var F=b[P];e.setViewport(F.x,F.y,F.z,F.w)}else{l.setFromMatrixPosition(v.target.matrixWorld);_.lookAt(l)}_.updateMatrixWorld();_.matrixWorldInverse.getInverse(_.matrixWorld);L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);L.multiply(_.projectionMatrix);L.multiply(_.matrixWorldInverse);s.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse);o.setFromMatrix(s);f.length=0;k(h,_);for(var O=0,U=f.length;O<U;O++){var B=f[O];var V=r.update(B);var I=B.material;if(I instanceof i.MeshFaceMaterial){var N=V.groups;var G=I.materials;for(var z=0,H=N.length;z<H;z++){var j=N[z];var W=G[j.materialIndex];if(W.visible===true){var X=D(B,W,d,c);e.renderBufferDirect(_,t,null,V,X,B,j)}}}else{var X=D(B,I,d,c);e.renderBufferDirect(_,t,null,V,X,B,null)}}}e.resetGLState()}}e.setViewport(w.x,w.y,w.z,w.w);var q=e.getClearColor(),Y=e.getClearAlpha();e.setClearColor(q,Y);a.enable(n.BLEND);if(R.cullFace===i.CullFaceFront){n.cullFace(n.BACK)}e.resetGLState();R.needsUpdate=false};function D(e,t,r,n){var a=e.geometry;var o=null;var s=v;var h=e.customDepthMaterial;if(r){s=g;h=e.customDistanceMaterial}if(!h){var u=a.morphTargets!==undefined&&a.morphTargets.length>0&&t.morphTargets;var l=e instanceof i.SkinnedMesh&&t.skinning;var c=0;if(u)c|=d;if(l)c|=p;o=s[c]}else{o=h}o.visible=t.visible;o.wireframe=t.wireframe;o.wireframeLinewidth=t.wireframeLinewidth;if(r&&o.uniforms.lightPos!==undefined){o.uniforms.lightPos.value.copy(n)}return o}function k(e,t){if(e.visible===false)return;if(e instanceof i.Mesh||e instanceof i.Line||e instanceof i.Points){if(e.castShadow&&(e.frustumCulled===false||o.intersectsObject(e)===true)){var r=e.material;if(r.visible===true){e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);f.push(e)}}}var n=e.children;for(var a=0,s=n.length;a<s;a++){k(n[a],t)}}};i.WebGLState=function(e,t,r){var n=this;var a=new Uint8Array(16);var o=new Uint8Array(16);var s=new Uint8Array(16);var h={};var u=null;var l=null;var c=null;var f=null;var d=null;var p=null;var m=null;var v=null;var g=null;var y=null;var x=null;var b=null;var w=null;var _=null;var M=null;var S=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);var T=undefined;var E={};this.init=function(){e.clearColor(0,0,0,1);e.clearDepth(1);e.clearStencil(0);this.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL);e.frontFace(e.CCW);e.cullFace(e.BACK);this.enable(e.CULL_FACE);this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)};this.initAttributes=function(){for(var e=0,t=a.length;e<t;e++){a[e]=0}};this.enableAttribute=function(r){a[r]=1;if(o[r]===0){e.enableVertexAttribArray(r);o[r]=1}if(s[r]!==0){var n=t.get("ANGLE_instanced_arrays");n.vertexAttribDivisorANGLE(r,0);s[r]=0}};this.enableAttributeAndDivisor=function(t,r,n){a[t]=1;if(o[t]===0){e.enableVertexAttribArray(t);o[t]=1}if(s[t]!==r){n.vertexAttribDivisorANGLE(t,r);s[t]=r}};this.disableUnusedAttributes=function(){for(var t=0,r=o.length;t<r;t++){if(o[t]!==a[t]){e.disableVertexAttribArray(t);o[t]=0}}};this.enable=function(t){if(h[t]!==true){e.enable(t);h[t]=true}};this.disable=function(t){if(h[t]!==false){e.disable(t);h[t]=false}};this.getCompressedTextureFormats=function(){if(u===null){u=[];if(t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")){var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS);for(var n=0;n<r.length;n++){u.push(r[n])}}}return u};this.setBlending=function(t,n,a,o,s,h,u){if(t!==l){if(t===i.NoBlending){this.disable(e.BLEND)}else if(t===i.AdditiveBlending){this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE)}else if(t===i.SubtractiveBlending){this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)}else if(t===i.MultiplyBlending){this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.SRC_COLOR)}else if(t===i.CustomBlending){this.enable(e.BLEND)}else{this.enable(e.BLEND);e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}l=t}if(t===i.CustomBlending){s=s||n;h=h||a;u=u||o;if(n!==c||s!==p){e.blendEquationSeparate(r(n),r(s));c=n;p=s}if(a!==f||o!==d||h!==m||u!==v){e.blendFuncSeparate(r(a),r(o),r(h),r(u));f=a;d=o;m=h;v=u}}else{c=null;f=null;d=null;p=null;m=null;v=null}};this.setDepthFunc=function(t){if(g!==t){if(t){switch(t){case i.NeverDepth:e.depthFunc(e.NEVER);break;case i.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case i.LessDepth:e.depthFunc(e.LESS);break;case i.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case i.EqualDepth:e.depthFunc(e.EQUAL);break;case i.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case i.GreaterDepth:e.depthFunc(e.GREATER);break;case i.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}}else{e.depthFunc(e.LEQUAL)}g=t}};this.setDepthTest=function(t){if(t){this.enable(e.DEPTH_TEST)}else{this.disable(e.DEPTH_TEST)}};this.setDepthWrite=function(t){if(y!==t){e.depthMask(t);y=t}};this.setColorWrite=function(t){if(x!==t){e.colorMask(t,t,t,t);x=t}};this.setFlipSided=function(t){if(b!==t){if(t){e.frontFace(e.CW)}else{e.frontFace(e.CCW)}b=t}};this.setLineWidth=function(t){if(t!==w){e.lineWidth(t);w=t}};this.setPolygonOffset=function(t,r,n){if(t){this.enable(e.POLYGON_OFFSET_FILL)}else{this.disable(e.POLYGON_OFFSET_FILL)}if(t&&(_!==r||M!==n)){e.polygonOffset(r,n);_=r;M=n}};this.setScissorTest=function(t){if(t){this.enable(e.SCISSOR_TEST)}else{this.disable(e.SCISSOR_TEST)}};this.activeTexture=function(t){if(t===undefined)t=e.TEXTURE0+S-1;if(T!==t){e.activeTexture(t);T=t}};this.bindTexture=function(t,r){if(T===undefined){n.activeTexture()}var i=E[T];if(i===undefined){i={type:undefined,texture:undefined};E[T]=i}if(i.type!==t||i.texture!==r){e.bindTexture(t,r);i.type=t;i.texture=r}};this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}};this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}};this.reset=function(){for(var t=0;t<o.length;t++){if(o[t]===1){e.disableVertexAttribArray(t);o[t]=0}}h={};u=null;l=null;y=null;x=null;b=null}};i.LensFlarePlugin=function(e,t){var r=e.context;var n=e.state;var a,o;var s,h,u;var l;var c,f;function d(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);a=r.createBuffer();o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);c=r.createTexture();f=r.createTexture();n.bindTexture(r.TEXTURE_2D,c);r.texImage2D(r.TEXTURE_2D,0,r.RGB,16,16,0,r.RGB,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);n.bindTexture(r.TEXTURE_2D,f);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,16,16,0,r.RGBA,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);l=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var i;if(l){i={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{i={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}s=p(i);h={vertex:r.getAttribLocation(s,"position"),uv:r.getAttribLocation(s,"uv")};u={renderType:r.getUniformLocation(s,"renderType"),map:r.getUniformLocation(s,"map"),occlusionMap:r.getUniformLocation(s,"occlusionMap"),opacity:r.getUniformLocation(s,"opacity"),color:r.getUniformLocation(s,"color"),scale:r.getUniformLocation(s,"scale"),rotation:r.getUniformLocation(s,"rotation"),screenPosition:r.getUniformLocation(s,"screenPosition")}}this.render=function(p,m,v,g){if(t.length===0)return;var y=new i.Vector3;var x=g/v,b=v*.5,w=g*.5;var _=16/g,M=new i.Vector2(_*x,_);var S=new i.Vector3(1,1,0),T=new i.Vector2(1,1);if(s===undefined){d()}r.useProgram(s);n.initAttributes();n.enableAttribute(h.vertex);n.enableAttribute(h.uv);n.disableUnusedAttributes();r.uniform1i(u.occlusionMap,0);r.uniform1i(u.map,1);r.bindBuffer(r.ARRAY_BUFFER,a);r.vertexAttribPointer(h.vertex,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(h.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);n.disable(r.CULL_FACE);r.depthMask(false);for(var E=0,C=t.length;E<C;E++){_=16/g;M.set(_*x,_);var A=t[E];y.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]);y.applyMatrix4(m.matrixWorldInverse);y.applyProjection(m.projectionMatrix);S.copy(y);T.x=S.x*b+b;T.y=S.y*w+w;if(l||T.x>0&&T.x<v&&T.y>0&&T.y<g){n.activeTexture(r.TEXTURE0);n.bindTexture(r.TEXTURE_2D,null);n.activeTexture(r.TEXTURE1);n.bindTexture(r.TEXTURE_2D,c);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGB,T.x-8,T.y-8,16,16,0);r.uniform1i(u.renderType,0);r.uniform2f(u.scale,M.x,M.y);r.uniform3f(u.screenPosition,S.x,S.y,S.z);n.disable(r.BLEND);n.enable(r.DEPTH_TEST);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);n.activeTexture(r.TEXTURE0);n.bindTexture(r.TEXTURE_2D,f);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,T.x-8,T.y-8,16,16,0);r.uniform1i(u.renderType,1);n.disable(r.DEPTH_TEST);n.activeTexture(r.TEXTURE1);n.bindTexture(r.TEXTURE_2D,c);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);A.positionScreen.copy(S);if(A.customUpdateCallback){A.customUpdateCallback(A);
}else{A.updateLensFlares()}r.uniform1i(u.renderType,2);n.enable(r.BLEND);for(var L=0,P=A.lensFlares.length;L<P;L++){var R=A.lensFlares[L];if(R.opacity>.001&&R.scale>.001){S.x=R.x;S.y=R.y;S.z=R.z;_=R.size*R.scale/g;M.x=_*x;M.y=_;r.uniform3f(u.screenPosition,S.x,S.y,S.z);r.uniform2f(u.scale,M.x,M.y);r.uniform1f(u.rotation,R.rotation);r.uniform1f(u.opacity,R.opacity);r.uniform3f(u.color,R.color.r,R.color.g,R.color.b);n.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst);e.setTexture(R.texture,1);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}}}}n.enable(r.CULL_FACE);n.enable(r.DEPTH_TEST);r.depthMask(true);e.resetGLState()};function p(t){var n=r.createProgram();var i=r.createShader(r.FRAGMENT_SHADER);var a=r.createShader(r.VERTEX_SHADER);var o="precision "+e.getPrecision()+" float;\n";r.shaderSource(i,o+t.fragmentShader);r.shaderSource(a,o+t.vertexShader);r.compileShader(i);r.compileShader(a);r.attachShader(n,i);r.attachShader(n,a);r.linkProgram(n);return n}};i.SpritePlugin=function(e,t){var r=e.context;var n=e.state;var a,o;var s,h,u;var l;var c=new i.Vector3;var f=new i.Quaternion;var d=new i.Vector3;function p(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);a=r.createBuffer();o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);s=m();h={position:r.getAttribLocation(s,"position"),uv:r.getAttribLocation(s,"uv")};u={uvOffset:r.getUniformLocation(s,"uvOffset"),uvScale:r.getUniformLocation(s,"uvScale"),rotation:r.getUniformLocation(s,"rotation"),scale:r.getUniformLocation(s,"scale"),color:r.getUniformLocation(s,"color"),map:r.getUniformLocation(s,"map"),opacity:r.getUniformLocation(s,"opacity"),modelViewMatrix:r.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(s,"projectionMatrix"),fogType:r.getUniformLocation(s,"fogType"),fogDensity:r.getUniformLocation(s,"fogDensity"),fogNear:r.getUniformLocation(s,"fogNear"),fogFar:r.getUniformLocation(s,"fogFar"),fogColor:r.getUniformLocation(s,"fogColor"),alphaTest:r.getUniformLocation(s,"alphaTest")};var n=document.createElement("canvas");n.width=8;n.height=8;var c=n.getContext("2d");c.fillStyle="white";c.fillRect(0,0,8,8);l=new i.Texture(n);l.needsUpdate=true}this.render=function(m,g){if(t.length===0)return;if(s===undefined){p()}r.useProgram(s);n.initAttributes();n.enableAttribute(h.position);n.enableAttribute(h.uv);n.disableUnusedAttributes();n.disable(r.CULL_FACE);n.enable(r.BLEND);r.bindBuffer(r.ARRAY_BUFFER,a);r.vertexAttribPointer(h.position,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(h.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);r.uniformMatrix4fv(u.projectionMatrix,false,g.projectionMatrix.elements);n.activeTexture(r.TEXTURE0);r.uniform1i(u.map,0);var y=0;var x=0;var b=m.fog;if(b){r.uniform3f(u.fogColor,b.color.r,b.color.g,b.color.b);if(b instanceof i.Fog){r.uniform1f(u.fogNear,b.near);r.uniform1f(u.fogFar,b.far);r.uniform1i(u.fogType,1);y=1;x=1}else if(b instanceof i.FogExp2){r.uniform1f(u.fogDensity,b.density);r.uniform1i(u.fogType,2);y=2;x=2}}else{r.uniform1i(u.fogType,0);y=0;x=0}for(var w=0,_=t.length;w<_;w++){var M=t[w];M.modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld);M.z=-M.modelViewMatrix.elements[14]}t.sort(v);var S=[];for(var w=0,_=t.length;w<_;w++){var M=t[w];var T=M.material;r.uniform1f(u.alphaTest,T.alphaTest);r.uniformMatrix4fv(u.modelViewMatrix,false,M.modelViewMatrix.elements);M.matrixWorld.decompose(c,f,d);S[0]=d.x;S[1]=d.y;var E=0;if(m.fog&&T.fog){E=x}if(y!==E){r.uniform1i(u.fogType,E);y=E}if(T.map!==null){r.uniform2f(u.uvOffset,T.map.offset.x,T.map.offset.y);r.uniform2f(u.uvScale,T.map.repeat.x,T.map.repeat.y)}else{r.uniform2f(u.uvOffset,0,0);r.uniform2f(u.uvScale,1,1)}r.uniform1f(u.opacity,T.opacity);r.uniform3f(u.color,T.color.r,T.color.g,T.color.b);r.uniform1f(u.rotation,T.rotation);r.uniform2fv(u.scale,S);n.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst);n.setDepthTest(T.depthTest);n.setDepthWrite(T.depthWrite);if(T.map&&T.map.image&&T.map.image.width){e.setTexture(T.map,0)}else{e.setTexture(l,0)}r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}n.enable(r.CULL_FACE);e.resetGLState()};function m(){var t=r.createProgram();var n=r.createShader(r.VERTEX_SHADER);var i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));r.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));r.compileShader(n);r.compileShader(i);r.attachShader(t,n);r.attachShader(t,i);r.linkProgram(t);return t}function v(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}};i.CurveUtils={tangentQuadraticBezier:function(e,t,r,n){return 2*(1-e)*(r-t)+2*e*(n-r)},tangentCubicBezier:function(e,t,r,n,i){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*i},tangentSpline:function(e,t,r,n,i){var a=6*e*e-6*e;var o=3*e*e-4*e+1;var s=-6*e*e+6*e;var h=3*e*e-2*e;return a+o+s+h},interpolate:function(e,t,r,n,i){var a=(r-e)*.5;var o=(n-t)*.5;var s=i*i;var h=i*s;return(2*t-2*r+a+o)*h+(-3*t+3*r-2*a-o)*s+a*i+t}};i.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;if(t instanceof i.Mesh){t.matrixAutoUpdate&&t.updateMatrix();n=t.matrix;t=t.geometry}e.merge(t,n,r)},center:function(e){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};i.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture is being deprecated. Use THREE.TextureLoader() instead.");var a=new i.TextureLoader;a.setCrossOrigin(this.crossOrigin);var o=a.load(e,r,undefined,n);if(t)o.mapping=t;return o},loadTextureCube:function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube is being deprecated. Use THREE.CubeTextureLoader() instead.");var a=new i.CubeTextureLoader;a.setCrossOrigin(this.crossOrigin);var o=a.load(e,r,undefined,n);if(t)o.mapping=t;return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};i.SceneUtils={createMultiMaterialObject:function(e,t){var r=new i.Group;for(var n=0,a=t.length;n<a;n++){r.add(new i.Mesh(e,t[n]))}return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld);t.remove(e);r.add(e)},attach:function(e,t,r){var n=new i.Matrix4;n.getInverse(r.matrixWorld);e.applyMatrix(n);t.remove(e);r.add(e)}};i.ShapeUtils={area:function(e){var t=e.length;var r=0;for(var n=t-1,i=0;i<t;n=i++){r+=e[n].x*e[i].y-e[i].x*e[n].y}return r*.5},triangulate:function(){function e(e,t,r,n,i,a){var o;var s,h,u,l;var c,f,d,p;s=e[a[t]].x;h=e[a[t]].y;u=e[a[r]].x;l=e[a[r]].y;c=e[a[n]].x;f=e[a[n]].y;if(Number.EPSILON>(u-s)*(f-h)-(l-h)*(c-s))return false;var m,v,g,y,x,b;var w,_,M,S,T,E;var C,A,L;m=c-u;v=f-l;g=s-c;y=h-f;x=u-s;b=l-h;for(o=0;o<i;o++){d=e[a[o]].x;p=e[a[o]].y;if(d===s&&p===h||d===u&&p===l||d===c&&p===f)continue;w=d-s;_=p-h;M=d-u;S=p-l;T=d-c;E=p-f;L=m*S-v*M;C=x*_-b*w;A=g*E-y*T;if(L>=-Number.EPSILON&&A>=-Number.EPSILON&&C>=-Number.EPSILON)return false}return true}return function(t,r){var n=t.length;if(n<3)return null;var a=[],o=[],s=[];var h,u,l;if(i.ShapeUtils.area(t)>0){for(u=0;u<n;u++)o[u]=u}else{for(u=0;u<n;u++)o[u]=n-1-u}var c=n;var f=2*c;for(u=c-1;c>2;){if(f--<=0){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");if(r)return s;return a}h=u;if(c<=h)h=0;u=h+1;if(c<=u)u=0;l=u+1;if(c<=l)l=0;if(e(t,h,u,l,c,o)){var d,p,m,v,g;d=o[h];p=o[u];m=o[l];a.push([t[d],t[p],t[m]]);s.push([o[h],o[u],o[l]]);for(v=u,g=u+1;g<c;v++,g++){o[v]=o[g]}c--;f=2*c}}if(r)return s;return a}}(),triangulateShape:function(e,t){function r(e,t,r){if(e.x!==t.x){if(e.x<t.x){return e.x<=r.x&&r.x<=t.x}else{return t.x<=r.x&&r.x<=e.x}}else{if(e.y<t.y){return e.y<=r.y&&r.y<=t.y}else{return t.y<=r.y&&r.y<=e.y}}}function n(e,t,n,i,a){var o=t.x-e.x,s=t.y-e.y;var h=i.x-n.x,u=i.y-n.y;var l=e.x-n.x;var c=e.y-n.y;var f=s*h-o*u;var d=s*l-o*c;if(Math.abs(f)>Number.EPSILON){var p;if(f>0){if(d<0||d>f)return[];p=u*l-h*c;if(p<0||p>f)return[]}else{if(d>0||d<f)return[];p=u*l-h*c;if(p>0||p<f)return[]}if(p===0){if(a&&(d===0||d===f))return[];return[e]}if(p===f){if(a&&(d===0||d===f))return[];return[t]}if(d===0)return[n];if(d===f)return[i];var m=p/f;return[{x:e.x+m*o,y:e.y+m*s}]}else{if(d!==0||u*l!==h*c)return[];var v=o===0&&s===0;var g=h===0&&u===0;if(v&&g){if(e.x!==n.x||e.y!==n.y)return[];return[e]}if(v){if(!r(n,i,e))return[];return[e]}if(g){if(!r(e,t,n))return[];return[n]}var y,x,b,w;var _,M,S,T;if(o!==0){if(e.x<t.x){y=e;b=e.x;x=t;w=t.x}else{y=t;b=t.x;x=e;w=e.x}if(n.x<i.x){_=n;S=n.x;M=i;T=i.x}else{_=i;S=i.x;M=n;T=n.x}}else{if(e.y<t.y){y=e;b=e.y;x=t;w=t.y}else{y=t;b=t.y;x=e;w=e.y}if(n.y<i.y){_=n;S=n.y;M=i;T=i.y}else{_=i;S=i.y;M=n;T=n.y}}if(b<=S){if(w<S)return[];if(w===S){if(a)return[];return[_]}if(w<=T)return[_,x];return[_,M]}else{if(b>T)return[];if(b===T){if(a)return[];return[y]}if(w<=T)return[y,x];return[y,M]}}}function a(e,t,r,n){var i=t.x-e.x,a=t.y-e.y;var o=r.x-e.x,s=r.y-e.y;var h=n.x-e.x,u=n.y-e.y;var l=i*s-a*o;var c=i*u-a*h;if(Math.abs(l)>Number.EPSILON){var f=h*s-u*o;if(l>0){return c>=0&&f>=0}else{return c>=0||f>=0}}else{return c>0}}function o(e,t){var r=e.concat();var i;function o(e,t){var n=r.length-1;var o=e-1;if(o<0)o=n;var s=e+1;if(s>n)s=0;var h=a(r[e],r[o],r[s],i[t]);if(!h){return false}var u=i.length-1;var l=t-1;if(l<0)l=u;var c=t+1;if(c>u)c=0;h=a(i[t],i[l],i[c],r[e]);if(!h){return false}return true}function s(e,t){var i,a,o;for(i=0;i<r.length;i++){a=i+1;a%=r.length;o=n(e,t,r[i],r[a],true);if(o.length>0)return true}return false}var h=[];function u(e,r){var i,a,o,s,u;for(i=0;i<h.length;i++){a=t[h[i]];for(o=0;o<a.length;o++){s=o+1;s%=a.length;u=n(e,r,a[o],a[s],true);if(u.length>0)return true}}return false}var l,c,f,d,p,m,v=[],g,y,x,b;for(var w=0,_=t.length;w<_;w++){h.push(w)}var M=0;var S=h.length*2;while(h.length>0){S--;if(S<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(c=M;c<r.length;c++){f=r[c];l=-1;for(var w=0;w<h.length;w++){p=h[w];m=f.x+":"+f.y+":"+p;if(v[m]!==undefined)continue;i=t[p];for(var T=0;T<i.length;T++){d=i[T];if(!o(c,T))continue;if(s(f,d))continue;if(u(f,d))continue;l=T;h.splice(w,1);g=r.slice(0,c+1);y=r.slice(c);x=i.slice(l);b=i.slice(0,l+1);r=g.concat(x).concat(b).concat(y);M=c;break}if(l>=0)break;v[m]=true}if(l>=0)break}}return r}var s,h,u,l,c,f,d={};var p=e.concat();for(var m=0,v=t.length;m<v;m++){Array.prototype.push.apply(p,t[m])}for(s=0,h=p.length;s<h;s++){c=p[s].x+":"+p[s].y;if(d[c]!==undefined){console.warn("THREE.Shape: Duplicate point",c)}d[c]=s}var g=o(e,t);var y=i.ShapeUtils.triangulate(g,false);for(s=0,h=y.length;s<h;s++){l=y[s];for(u=0;u<3;u++){c=l[u].x+":"+l[u].y;f=d[c];if(f!==undefined){l[u]=f}}}return y.concat()},isClockWise:function(e){return i.ShapeUtils.area(e)<0},b2:function(){function e(e,t){var r=1-e;return r*r*t}function t(e,t){return 2*(1-e)*e*t}function r(e,t){return e*e*t}return function(n,i,a,o){return e(n,i)+t(n,a)+r(n,o)}}(),b3:function(){function e(e,t){var r=1-e;return r*r*r*t}function t(e,t){var r=1-e;return 3*r*r*e*t}function r(e,t){var r=1-e;return 3*r*e*e*t}function n(e,t){return e*e*e*t}return function(i,a,o,s,h){return e(i,a)+t(i,o)+r(i,s)+n(i,h)}}()};i.Audio=function(e){i.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.playbackRate=1;this.isPlaying=false};i.Audio.prototype=Object.create(i.Object3D.prototype);i.Audio.prototype.constructor=i.Audio;i.Audio.prototype.load=function(e){var t=this;var r=new XMLHttpRequest;r.open("GET",e,true);r.responseType="arraybuffer";r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e;if(t.autoplay)t.play()})};r.send();return this};i.Audio.prototype.play=function(){if(this.isPlaying===true){console.warn("THREE.Audio: Audio is already playing.");return}var e=this.context.createBufferSource();e.buffer=this.source.buffer;e.loop=this.source.loop;e.onended=this.source.onended;e.start(0,this.startTime);e.playbackRate.value=this.playbackRate;this.isPlaying=true;this.source=e;this.connect()};i.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};i.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};i.Audio.prototype.connect=function(){if(this.filter!==undefined){this.source.connect(this.filter);this.filter.connect(this.panner)}else{this.source.connect(this.panner)}};i.Audio.prototype.disconnect=function(){if(this.filter!==undefined){this.source.disconnect(this.filter);this.filter.disconnect(this.panner)}else{this.source.disconnect(this.panner)}};i.Audio.prototype.setFilter=function(e){if(this.isPlaying===true){this.disconnect();this.filter=e;this.connect()}else{this.filter=e}};i.Audio.prototype.getFilter=function(){return this.filter};i.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e;if(this.isPlaying===true){this.source.playbackRate.value=this.playbackRate}};i.Audio.prototype.getPlaybackRate=function(){return this.playbackRate};i.Audio.prototype.onEnded=function(){this.isPlaying=false};i.Audio.prototype.setLoop=function(e){this.source.loop=e};i.Audio.prototype.getLoop=function(){return this.source.loop};i.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e};i.Audio.prototype.getRefDistance=function(){return this.panner.refDistance};i.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e};i.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor};i.Audio.prototype.setVolume=function(e){this.gain.gain.value=e};i.Audio.prototype.getVolume=function(){return this.gain.gain.value};i.Audio.prototype.updateMatrixWorld=function(){var e=new i.Vector3;return function t(r){i.Object3D.prototype.updateMatrixWorld.call(this,r);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();i.AudioListener=function(){i.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};i.AudioListener.prototype=Object.create(i.Object3D.prototype);i.AudioListener.prototype.constructor=i.AudioListener;i.AudioListener.prototype.updateMatrixWorld=function(){var e=new i.Vector3;var t=new i.Quaternion;var r=new i.Vector3;var n=new i.Vector3;return function a(o){i.Object3D.prototype.updateMatrixWorld.call(this,o);var s=this.context.listener;var h=this.up;this.matrixWorld.decompose(e,t,r);n.set(0,0,-1).applyQuaternion(t);s.setPosition(e.x,e.y,e.z);s.setOrientation(n.x,n.y,n.z,h.x,h.y,h.z)}}();i.Curve=function(){};i.Curve.prototype={constructor:i.Curve,getPoint:function(e){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPoint(t/e))}return r},getSpacedPoints:function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPointAt(t/e))}return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var r,n=this.getPoint(0);var i,a=0;t.push(0);for(i=1;i<=e;i++){r=this.getPoint(i/e);a+=r.distanceTo(n);t.push(a);n=r}this.cacheArcLengths=t;return t},updateArcLengths:function(){this.needsUpdate=true;this.getLengths()},getUtoTmapping:function(e,t){var r=this.getLengths();var n=0,i=r.length;var a;if(t){a=t}else{a=e*r[i-1]}var o=0,s=i-1,h;while(o<=s){n=Math.floor(o+(s-o)/2);h=r[n]-a;if(h<0){o=n+1}else if(h>0){s=n-1}else{s=n;break}}n=s;if(r[n]===a){var u=n/(i-1);return u}var l=r[n];var c=r[n+1];var f=c-l;var d=(a-l)/f;var u=(n+d)/(i-1);return u},getTangent:function(e){var t=1e-4;var r=e-t;var n=e+t;if(r<0)r=0;if(n>1)n=1;var i=this.getPoint(r);var a=this.getPoint(n);var o=a.clone().sub(i);return o.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}};i.Curve.Utils=i.CurveUtils;i.Curve.create=function(e,t){e.prototype=Object.create(i.Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};i.CurvePath=function(){this.curves=[];this.autoClose=false};i.CurvePath.prototype=Object.create(i.Curve.prototype);i.CurvePath.prototype.constructor=i.CurvePath;i.CurvePath.prototype.add=function(e){this.curves.push(e)};i.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new i.LineCurve(t,e))}};i.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var r=this.getCurveLengths();var n=0;while(n<r.length){if(r[n]>=t){var i=r[n]-t;var a=this.curves[n];var o=1-i/a.getLength();return a.getPointAt(o)}n++}return null};i.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};i.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}var e=[],t=0;for(var r=0,n=this.curves.length;r<n;r++){t+=this.curves[r].getLength();e.push(t)}this.cacheLengths=e;return e};i.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createGeometry=function(e){var t=new i.Geometry;for(var r=0,n=e.length;r<n;r++){var a=e[r];t.vertices.push(new i.Vector3(a.x,a.y,a.z||0))}return t};i.Path=function(e){i.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};i.Path.prototype=Object.create(i.CurvePath.prototype);i.Path.prototype.constructor=i.Path;i.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++){this.lineTo(e[t].x,e[t].y)}};i.Path.prototype.moveTo=function(e,t){this.actions.push({action:"moveTo",args:[e,t]})};i.Path.prototype.lineTo=function(e,t){var r=this.actions[this.actions.length-1].args;var n=r[r.length-2];var a=r[r.length-1];var o=new i.LineCurve(new i.Vector2(n,a),new i.Vector2(e,t));this.curves.push(o);this.actions.push({action:"lineTo",args:[e,t]})};i.Path.prototype.quadraticCurveTo=function(e,t,r,n){var a=this.actions[this.actions.length-1].args;var o=a[a.length-2];var s=a[a.length-1];var h=new i.QuadraticBezierCurve(new i.Vector2(o,s),new i.Vector2(e,t),new i.Vector2(r,n));this.curves.push(h);this.actions.push({action:"quadraticCurveTo",args:[e,t,r,n]})};i.Path.prototype.bezierCurveTo=function(e,t,r,n,a,o){var s=this.actions[this.actions.length-1].args;var h=s[s.length-2];var u=s[s.length-1];var l=new i.CubicBezierCurve(new i.Vector2(h,u),new i.Vector2(e,t),new i.Vector2(r,n),new i.Vector2(a,o));this.curves.push(l);this.actions.push({action:"bezierCurveTo",args:[e,t,r,n,a,o]})};i.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var n=r[r.length-2];var a=r[r.length-1];var o=[new i.Vector2(n,a)];Array.prototype.push.apply(o,e);var s=new i.SplineCurve(o);this.curves.push(s);this.actions.push({action:"splineThru",args:t})};i.Path.prototype.arc=function(e,t,r,n,i,a){var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];this.absarc(e+s,t+h,r,n,i,a)};i.Path.prototype.absarc=function(e,t,r,n,i,a){this.absellipse(e,t,r,r,n,i,a)};i.Path.prototype.ellipse=function(e,t,r,n,i,a,o,s){var h=this.actions[this.actions.length-1].args;var u=h[h.length-2];var l=h[h.length-1];this.absellipse(e+u,t+l,r,n,i,a,o,s)};i.Path.prototype.absellipse=function(e,t,r,n,a,o,s,h){var u=[e,t,r,n,a,o,s,h||0];var l=new i.EllipseCurve(e,t,r,n,a,o,s,h);this.curves.push(l);var c=l.getPoint(1);u.push(c.x);u.push(c.y);this.actions.push({action:"ellipse",args:u})};i.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var r=[];for(var n=0;n<e;n++){r.push(this.getPoint(n/e))}return r};i.Path.prototype.getPoints=function(e,t){e=e||12;var r=i.ShapeUtils.b2;var n=i.ShapeUtils.b3;var a=[];var o,s,h,u,l,c,f,d,p,m,v;for(var g=0,y=this.actions.length;g<y;g++){var x=this.actions[g];var b=x.action;var w=x.args;switch(b){case"moveTo":a.push(new i.Vector2(w[0],w[1]));break;case"lineTo":a.push(new i.Vector2(w[0],w[1]));break;case"quadraticCurveTo":o=w[2];s=w[3];l=w[0];c=w[1];if(a.length>0){p=a[a.length-1];f=p.x;d=p.y}else{p=this.actions[g-1].args;f=p[p.length-2];d=p[p.length-1]}for(var _=1;_<=e;_++){var M=_/e;m=r(M,f,l,o);v=r(M,d,c,s);a.push(new i.Vector2(m,v))}break;case"bezierCurveTo":o=w[4];s=w[5];l=w[0];c=w[1];h=w[2];u=w[3];if(a.length>0){p=a[a.length-1];f=p.x;d=p.y}else{p=this.actions[g-1].args;f=p[p.length-2];d=p[p.length-1]}for(var _=1;_<=e;_++){var M=_/e;m=n(M,f,l,h,o);v=n(M,d,c,u,s);a.push(new i.Vector2(m,v))}break;case"splineThru":p=this.actions[g-1].args;var S=new i.Vector2(p[p.length-2],p[p.length-1]);var T=[S];var E=e*w[0].length;T=T.concat(w[0]);var C=new i.SplineCurve(T);for(var _=1;_<=E;_++){a.push(C.getPointAt(_/E))}break;case"arc":var A=w[0],L=w[1],P=w[2],R=w[3],D=w[4],k=!!w[5];var F=D-R;var O;var U=e*2;for(var _=1;_<=U;_++){var M=_/U;if(!k){M=1-M}O=R+M*F;m=A+P*Math.cos(O);v=L+P*Math.sin(O);a.push(new i.Vector2(m,v))}break;case"ellipse":var A=w[0],L=w[1],B=w[2],V=w[3],R=w[4],D=w[5],k=!!w[6],I=w[7];var F=D-R;var O;var U=e*2;var N,G;if(I!==0){N=Math.cos(I);G=Math.sin(I)}for(var _=1;_<=U;_++){var M=_/U;if(!k){M=1-M}O=R+M*F;m=A+B*Math.cos(O);v=L+V*Math.sin(O);if(I!==0){var z=m,H=v;m=(z-A)*N-(H-L)*G+A;v=(z-A)*G+(H-L)*N+L}a.push(new i.Vector2(m,v))}break}}var j=a[a.length-1];if(Math.abs(j.x-a[0].x)<Number.EPSILON&&Math.abs(j.y-a[0].y)<Number.EPSILON)a.splice(a.length-1,1);if(t){a.push(a[0])}return a};i.Path.prototype.toShapes=function(e,t){function r(e){var t=[],r=new i.Path;for(var n=0,a=e.length;n<a;n++){var o=e[n];var s=o.args;var h=o.action;if(h==="moveTo"){if(r.actions.length!==0){t.push(r);r=new i.Path}}r[h].apply(r,s)}if(r.actions.length!==0){t.push(r)}return t}function n(e){var t=[];for(var r=0,n=e.length;r<n;r++){var a=e[r];var o=new i.Shape;o.actions=a.actions;o.curves=a.curves;t.push(o)}return t}function a(e,t){var r=t.length;var n=false;for(var i=r-1,a=0;a<r;i=a++){var o=t[i];var s=t[a];var h=s.x-o.x;var u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0){o=t[a];h=-h;s=t[i];u=-u}if(e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return true}else{var l=u*(e.x-o.x)-h*(e.y-o.y);if(l===0)return true;if(l<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return true}}return n}var o=i.ShapeUtils.isClockWise;var s=r(this.actions);if(s.length===0)return[];if(t===true)return n(s);var h,u,l,c=[];if(s.length===1){u=s[0];l=new i.Shape;l.actions=u.actions;l.curves=u.curves;c.push(l);return c}var f=!o(s[0].getPoints());f=e?!f:f;var d=[];var p=[];var m=[];var v=0;var g;p[v]=undefined;m[v]=[];for(var y=0,x=s.length;y<x;y++){u=s[y];g=u.getPoints();h=o(g);h=e?!h:h;if(h){if(!f&&p[v])v++;p[v]={s:new i.Shape,p:g};p[v].s.actions=u.actions;p[v].s.curves=u.curves;if(f)v++;m[v]=[]}else{m[v].push({h:u,p:g[0]})}}if(!p[0])return n(s);if(p.length>1){var b=false;var w=[];for(var _=0,M=p.length;_<M;_++){d[_]=[]}for(var _=0,M=p.length;_<M;_++){var S=m[_];for(var T=0;T<S.length;T++){var E=S[T];var C=true;for(var A=0;A<p.length;A++){if(a(E.p,p[A].p)){if(_!==A)w.push({froms:_,tos:A,hole:T});if(C){C=false;d[A].push(E)}else{b=true}}}if(C){d[_].push(E)}}}if(w.length>0){if(!b)m=d}}var L;for(var y=0,P=p.length;y<P;y++){l=p[y].s;c.push(l);L=m[y];for(var R=0,D=L.length;R<D;R++){l.holes.push(L[R].h)}}return c};i.Shape=function(){i.Path.apply(this,arguments);this.holes=[]};i.Shape.prototype=Object.create(i.Path.prototype);i.Shape.prototype.constructor=i.Shape;i.Shape.prototype.extrude=function(e){return new i.ExtrudeGeometry(this,e)};i.Shape.prototype.makeGeometry=function(e){return new i.ShapeGeometry(this,e)};i.Shape.prototype.getPointsHoles=function(e){var t=[];for(var r=0,n=this.holes.length;r<n;r++){t[r]=this.holes[r].getPoints(e)}return t};i.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}};i.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)};i.Shape.Utils=i.ShapeUtils;i.LineCurve=function(e,t){this.v1=e;this.v2=t};i.LineCurve.prototype=Object.create(i.Curve.prototype);i.LineCurve.prototype.constructor=i.LineCurve;i.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};i.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};i.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};i.QuadraticBezierCurve=function(e,t,r){this.v0=e;this.v1=t;this.v2=r};i.QuadraticBezierCurve.prototype=Object.create(i.Curve.prototype);i.QuadraticBezierCurve.prototype.constructor=i.QuadraticBezierCurve;i.QuadraticBezierCurve.prototype.getPoint=function(e){var t=i.ShapeUtils.b2;return new i.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))};i.QuadraticBezierCurve.prototype.getTangent=function(e){var t=i.CurveUtils.tangentQuadraticBezier;return new i.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()};i.CubicBezierCurve=function(e,t,r,n){this.v0=e;this.v1=t;this.v2=r;this.v3=n};i.CubicBezierCurve.prototype=Object.create(i.Curve.prototype);i.CubicBezierCurve.prototype.constructor=i.CubicBezierCurve;i.CubicBezierCurve.prototype.getPoint=function(e){var t=i.ShapeUtils.b3;return new i.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};i.CubicBezierCurve.prototype.getTangent=function(e){var t=i.CurveUtils.tangentCubicBezier;return new i.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()};i.SplineCurve=function(e){this.points=e==undefined?[]:e};i.SplineCurve.prototype=Object.create(i.Curve.prototype);i.SplineCurve.prototype.constructor=i.SplineCurve;i.SplineCurve.prototype.getPoint=function(e){var t=this.points;var r=(t.length-1)*e;var n=Math.floor(r);var a=r-n;var o=t[n===0?n:n-1];var s=t[n];var h=t[n>t.length-2?t.length-1:n+1];var u=t[n>t.length-3?t.length-1:n+2];var l=i.CurveUtils.interpolate;return new i.Vector2(l(o.x,s.x,h.x,u.x,a),l(o.y,s.y,h.y,u.y,a))};i.EllipseCurve=function(e,t,r,n,i,a,o,s){this.aX=e;this.aY=t;this.xRadius=r;this.yRadius=n;this.aStartAngle=i;this.aEndAngle=a;this.aClockwise=o;this.aRotation=s||0};i.EllipseCurve.prototype=Object.create(i.Curve.prototype);i.EllipseCurve.prototype.constructor=i.EllipseCurve;i.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(t<0)t+=Math.PI*2;if(t>Math.PI*2)t-=Math.PI*2;var r;if(this.aClockwise===true){r=this.aEndAngle+(1-e)*(Math.PI*2-t)}else{r=this.aStartAngle+e*t}var n=this.aX+this.xRadius*Math.cos(r);var a=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){var o=Math.cos(this.aRotation);var s=Math.sin(this.aRotation);var h=n,u=a;n=(h-this.aX)*o-(u-this.aY)*s+this.aX;a=(h-this.aX)*s+(u-this.aY)*o+this.aY}return new i.Vector2(n,a)};i.ArcCurve=function(e,t,r,n,a,o){i.EllipseCurve.call(this,e,t,r,r,n,a,o)};i.ArcCurve.prototype=Object.create(i.EllipseCurve.prototype);i.ArcCurve.prototype.constructor=i.ArcCurve;i.LineCurve3=i.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new i.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});i.QuadraticBezierCurve3=i.Curve.create(function(e,t,r){this.v0=e;this.v1=t;this.v2=r},function(e){var t=i.ShapeUtils.b2;return new i.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))});i.CubicBezierCurve3=i.Curve.create(function(e,t,r,n){this.v0=e;this.v1=t;this.v2=r;this.v3=n},function(e){var t=i.ShapeUtils.b3;return new i.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});i.SplineCurve3=i.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-1)*e;var n=Math.floor(r);var a=r-n;var o=t[n==0?n:n-1];var s=t[n];var h=t[n>t.length-2?t.length-1:n+1];var u=t[n>t.length-3?t.length-1:n+2];var l=i.CurveUtils.interpolate;return new i.Vector3(l(o.x,s.x,h.x,u.x,a),l(o.y,s.y,h.y,u.y,a),l(o.z,s.z,h.z,u.z,a))});i.CatmullRomCurve3=function(){var e=new i.Vector3,t=new a,r=new a,n=new a;function a(){}a.prototype.init=function(e,t,r,n){this.c0=e;this.c1=r;this.c2=-3*e+3*t-2*r-n;this.c3=2*e-2*t+r+n};a.prototype.initNonuniformCatmullRom=function(e,t,r,n,i,a,o){var s=(t-e)/i-(r-e)/(i+a)+(r-t)/a;var h=(r-t)/a-(n-t)/(a+o)+(n-r)/o;s*=a;h*=a;this.init(t,r,s,h)};a.prototype.initCatmullRom=function(e,t,r,n,i){this.init(t,r,i*(r-e),i*(n-t))};a.prototype.calc=function(e){var t=e*e;var r=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*r};return i.Curve.create(function(e){this.points=e||[]},function(a){var o=this.points,s,h,u,l;l=o.length;if(l<2)console.log("duh, you need at least 2 points");s=(l-1)*a;h=Math.floor(s);u=s-h;if(u===0&&h===l-1){h=l-2;u=1}var c,f,d,p;if(h===0){e.subVectors(o[0],o[1]).add(o[0]);c=e}else{c=o[h-1]}f=o[h];d=o[h+1];if(h+2<l){p=o[h+2]}else{e.subVectors(o[l-1],o[l-2]).add(o[l-2]);p=e}if(this.type===undefined||this.type==="centripetal"||this.type==="chordal"){var m=this.type==="chordal"?.5:.25;var v=Math.pow(c.distanceToSquared(f),m);var g=Math.pow(f.distanceToSquared(d),m);var y=Math.pow(d.distanceToSquared(p),m);if(g<1e-4)g=1;if(v<1e-4)v=g;if(y<1e-4)y=g;t.initNonuniformCatmullRom(c.x,f.x,d.x,p.x,v,g,y);r.initNonuniformCatmullRom(c.y,f.y,d.y,p.y,v,g,y);n.initNonuniformCatmullRom(c.z,f.z,d.z,p.z,v,g,y);
}else if(this.type==="catmullrom"){var x=this.tension!==undefined?this.tension:.5;t.initCatmullRom(c.x,f.x,d.x,p.x,x);r.initCatmullRom(c.y,f.y,d.y,p.y,x);n.initCatmullRom(c.z,f.z,d.z,p.z,x)}var b=new i.Vector3(t.calc(u),r.calc(u),n.calc(u));return b})}();i.ClosedSplineCurve3=i.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-0)*e;var n=Math.floor(r);var a=r-n;n+=n>0?0:(Math.floor(Math.abs(n)/t.length)+1)*t.length;var o=t[(n-1)%t.length];var s=t[n%t.length];var h=t[(n+1)%t.length];var u=t[(n+2)%t.length];var l=i.CurveUtils.interpolate;return new i.Vector3(l(o.x,s.x,h.x,u.x,a),l(o.y,s.y,h.y,u.y,a),l(o.z,s.z,h.z,u.z,a))});i.BoxGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:a,depthSegments:o};this.widthSegments=n||1;this.heightSegments=a||1;this.depthSegments=o||1;var s=this;var h=e/2;var u=t/2;var l=r/2;c("z","y",-1,-1,r,t,h,0);c("z","y",1,-1,r,t,-h,1);c("x","z",1,1,e,r,u,2);c("x","z",1,-1,e,r,-u,3);c("x","y",1,-1,e,t,l,4);c("x","y",-1,-1,e,t,-l,5);function c(e,t,r,n,a,o,h,u){var l,c,f,d=s.widthSegments,p=s.heightSegments,m=a/2,v=o/2,g=s.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){l="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){l="y";p=s.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){l="x";d=s.depthSegments}var y=d+1,x=p+1,b=a/d,w=o/p,_=new i.Vector3;_[l]=h>0?1:-1;for(f=0;f<x;f++){for(c=0;c<y;c++){var M=new i.Vector3;M[e]=(c*b-m)*r;M[t]=(f*w-v)*n;M[l]=h;s.vertices.push(M)}}for(f=0;f<p;f++){for(c=0;c<d;c++){var S=c+y*f;var T=c+y*(f+1);var E=c+1+y*(f+1);var C=c+1+y*f;var A=new i.Vector2(c/d,1-f/p);var L=new i.Vector2(c/d,1-(f+1)/p);var P=new i.Vector2((c+1)/d,1-(f+1)/p);var R=new i.Vector2((c+1)/d,1-f/p);var D=new i.Face3(S+g,T+g,C+g);D.normal.copy(_);D.vertexNormals.push(_.clone(),_.clone(),_.clone());D.materialIndex=u;s.faces.push(D);s.faceVertexUvs[0].push([A,L,R]);D=new i.Face3(T+g,E+g,C+g);D.normal.copy(_);D.vertexNormals.push(_.clone(),_.clone(),_.clone());D.materialIndex=u;s.faces.push(D);s.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}}this.mergeVertices()};i.BoxGeometry.prototype=Object.create(i.Geometry.prototype);i.BoxGeometry.prototype.constructor=i.BoxGeometry;i.BoxGeometry.prototype.clone=function(){var e=this.parameters;return new i.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)};i.CubeGeometry=i.BoxGeometry;i.CircleGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};this.fromBufferGeometry(new i.CircleBufferGeometry(e,t,r,n))};i.CircleGeometry.prototype=Object.create(i.Geometry.prototype);i.CircleGeometry.prototype.constructor=i.CircleGeometry;i.CircleGeometry.prototype.clone=function(){var e=this.parameters;return new i.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)};i.CircleBufferGeometry=function(e,t,r,n){i.BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};e=e||50;t=t!==undefined?Math.max(3,t):8;r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;var a=t+2;var o=new Float32Array(a*3);var s=new Float32Array(a*3);var h=new Float32Array(a*2);s[2]=1;h[0]=.5;h[1]=.5;for(var u=0,l=3,c=2;u<=t;u++,l+=3,c+=2){var f=r+u/t*n;o[l]=e*Math.cos(f);o[l+1]=e*Math.sin(f);s[l+2]=1;h[c]=(o[l]/e+1)/2;h[c+1]=(o[l+1]/e+1)/2}var d=[];for(var l=1;l<=t;l++){d.push(l,l+1,0)}this.setIndex(new i.BufferAttribute(new Uint16Array(d),1));this.addAttribute("position",new i.BufferAttribute(o,3));this.addAttribute("normal",new i.BufferAttribute(s,3));this.addAttribute("uv",new i.BufferAttribute(h,2));this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.CircleBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.CircleBufferGeometry.prototype.constructor=i.CircleBufferGeometry;i.CircleBufferGeometry.prototype.clone=function(){var e=this.parameters;return new i.CircleBufferGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)};i.CylinderGeometry=function(e,t,r,n,a,o,s,h){i.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:h};e=e!==undefined?e:20;t=t!==undefined?t:20;r=r!==undefined?r:100;n=n||8;a=a||1;o=o!==undefined?o:false;s=s!==undefined?s:0;h=h!==undefined?h:2*Math.PI;var u=r/2;var l,c,f=[],d=[];for(c=0;c<=a;c++){var p=[];var m=[];var v=c/a;var g=v*(t-e)+e;for(l=0;l<=n;l++){var y=l/n;var x=new i.Vector3;x.x=g*Math.sin(y*h+s);x.y=-v*r+u;x.z=g*Math.cos(y*h+s);this.vertices.push(x);p.push(this.vertices.length-1);m.push(new i.Vector2(y,1-v))}f.push(p);d.push(m)}var b=(t-e)/r;var w,_;for(l=0;l<n;l++){if(e!==0){w=this.vertices[f[0][l]].clone();_=this.vertices[f[0][l+1]].clone()}else{w=this.vertices[f[1][l]].clone();_=this.vertices[f[1][l+1]].clone()}w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize();_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize();for(c=0;c<a;c++){var M=f[c][l];var S=f[c+1][l];var T=f[c+1][l+1];var E=f[c][l+1];var C=w.clone();var A=w.clone();var L=_.clone();var P=_.clone();var R=d[c][l].clone();var D=d[c+1][l].clone();var k=d[c+1][l+1].clone();var F=d[c][l+1].clone();this.faces.push(new i.Face3(M,S,E,[C,A,P]));this.faceVertexUvs[0].push([R,D,F]);this.faces.push(new i.Face3(S,T,E,[A.clone(),L,P.clone()]));this.faceVertexUvs[0].push([D.clone(),k,F.clone()])}}if(o===false&&e>0){this.vertices.push(new i.Vector3(0,u,0));for(l=0;l<n;l++){var M=f[0][l];var S=f[0][l+1];var T=this.vertices.length-1;var C=new i.Vector3(0,1,0);var A=new i.Vector3(0,1,0);var L=new i.Vector3(0,1,0);var R=d[0][l].clone();var D=d[0][l+1].clone();var k=new i.Vector2(D.x,0);this.faces.push(new i.Face3(M,S,T,[C,A,L],undefined,1));this.faceVertexUvs[0].push([R,D,k])}}if(o===false&&t>0){this.vertices.push(new i.Vector3(0,-u,0));for(l=0;l<n;l++){var M=f[a][l+1];var S=f[a][l];var T=this.vertices.length-1;var C=new i.Vector3(0,-1,0);var A=new i.Vector3(0,-1,0);var L=new i.Vector3(0,-1,0);var R=d[a][l+1].clone();var D=d[a][l].clone();var k=new i.Vector2(D.x,1);this.faces.push(new i.Face3(M,S,T,[C,A,L],undefined,2));this.faceVertexUvs[0].push([R,D,k])}}this.computeFaceNormals()};i.CylinderGeometry.prototype=Object.create(i.Geometry.prototype);i.CylinderGeometry.prototype.constructor=i.CylinderGeometry;i.CylinderGeometry.prototype.clone=function(){var e=this.parameters;return new i.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)};i.EdgesGeometry=function(e,t){i.BufferGeometry.call(this);t=t!==undefined?t:1;var r=Math.cos(i.Math.degToRad(t));var n=[0,0],a={};function o(e,t){return e-t}var s=["a","b","c"];var h;if(e instanceof i.BufferGeometry){h=new i.Geometry;h.fromBufferGeometry(e)}else{h=e.clone()}h.mergeVertices();h.computeFaceNormals();var u=h.vertices;var l=h.faces;for(var c=0,f=l.length;c<f;c++){var d=l[c];for(var p=0;p<3;p++){n[0]=d[s[p]];n[1]=d[s[(p+1)%3]];n.sort(o);var m=n.toString();if(a[m]===undefined){a[m]={vert1:n[0],vert2:n[1],face1:c,face2:undefined}}else{a[m].face2=c}}}var v=[];for(var m in a){var g=a[m];if(g.face2===undefined||l[g.face1].normal.dot(l[g.face2].normal)<=r){var y=u[g.vert1];v.push(y.x);v.push(y.y);v.push(y.z);y=u[g.vert2];v.push(y.x);v.push(y.y);v.push(y.z)}}this.addAttribute("position",new i.BufferAttribute(new Float32Array(v),3))};i.EdgesGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.EdgesGeometry.prototype.constructor=i.EdgesGeometry;i.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}i.Geometry.call(this);this.type="ExtrudeGeometry";e=Array.isArray(e)?e:[e];this.addShapeList(e,t);this.computeFaceNormals()};i.ExtrudeGeometry.prototype=Object.create(i.Geometry.prototype);i.ExtrudeGeometry.prototype.constructor=i.ExtrudeGeometry;i.ExtrudeGeometry.prototype.addShapeList=function(e,t){var r=e.length;for(var n=0;n<r;n++){var i=e[n];this.addShape(i,t)}};i.ExtrudeGeometry.prototype.addShape=function(e,t){var r=t.amount!==undefined?t.amount:100;var n=t.bevelThickness!==undefined?t.bevelThickness:6;var a=t.bevelSize!==undefined?t.bevelSize:n-2;var o=t.bevelSegments!==undefined?t.bevelSegments:3;var s=t.bevelEnabled!==undefined?t.bevelEnabled:true;var h=t.curveSegments!==undefined?t.curveSegments:12;var u=t.steps!==undefined?t.steps:1;var l=t.extrudePath;var c,f=false;var d=t.UVGenerator!==undefined?t.UVGenerator:i.ExtrudeGeometry.WorldUVGenerator;var p,m,v,g;if(l){c=l.getSpacedPoints(u);f=true;s=false;p=t.frames!==undefined?t.frames:new i.TubeGeometry.FrenetFrames(l,u,false);m=new i.Vector3;v=new i.Vector3;g=new i.Vector3}if(!s){o=0;n=0;a=0}var y,x,b;var w=this;var _=this.vertices.length;var M=e.extractPoints(h);var S=M.shape;var T=M.holes;var E=!i.ShapeUtils.isClockWise(S);if(E){S=S.reverse();for(x=0,b=T.length;x<b;x++){y=T[x];if(i.ShapeUtils.isClockWise(y)){T[x]=y.reverse()}}E=false}var C=i.ShapeUtils.triangulateShape(S,T);var A=S;for(x=0,b=T.length;x<b;x++){y=T[x];S=S.concat(y)}function L(e,t,r){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(r).add(e)}var P,R,D,k,F,O=S.length,U,B=C.length;function V(e,t,r){var n,a,o=1;var s=e.x-t.x,h=e.y-t.y;var u=r.x-e.x,l=r.y-e.y;var c=s*s+h*h;var f=s*l-h*u;if(Math.abs(f)>Number.EPSILON){var d=Math.sqrt(c);var p=Math.sqrt(u*u+l*l);var m=t.x-h/d;var v=t.y+s/d;var g=r.x-l/p;var y=r.y+u/p;var x=((g-m)*l-(y-v)*u)/(s*l-h*u);n=m+s*x-e.x;a=v+h*x-e.y;var b=n*n+a*a;if(b<=2){return new i.Vector2(n,a)}else{o=Math.sqrt(b/2)}}else{var w=false;if(s>Number.EPSILON){if(u>Number.EPSILON){w=true}}else{if(s<-Number.EPSILON){if(u<-Number.EPSILON){w=true}}else{if(Math.sign(h)===Math.sign(l)){w=true}}}if(w){n=-h;a=s;o=Math.sqrt(c)}else{n=s;a=h;o=Math.sqrt(c/2)}}return new i.Vector2(n/o,a/o)}var I=[];for(var N=0,G=A.length,z=G-1,H=N+1;N<G;N++,z++,H++){if(z===G)z=0;if(H===G)H=0;I[N]=V(A[N],A[z],A[H])}var j=[],W,X=I.concat();for(x=0,b=T.length;x<b;x++){y=T[x];W=[];for(N=0,G=y.length,z=G-1,H=N+1;N<G;N++,z++,H++){if(z===G)z=0;if(H===G)H=0;W[N]=V(y[N],y[z],y[H])}j.push(W);X=X.concat(W)}for(P=0;P<o;P++){D=P/o;k=n*(1-D);R=a*Math.sin(D*Math.PI/2);for(N=0,G=A.length;N<G;N++){F=L(A[N],I[N],R);Q(F.x,F.y,-k)}for(x=0,b=T.length;x<b;x++){y=T[x];W=j[x];for(N=0,G=y.length;N<G;N++){F=L(y[N],W[N],R);Q(F.x,F.y,-k)}}}R=a;for(N=0;N<O;N++){F=s?L(S[N],X[N],R):S[N];if(!f){Q(F.x,F.y,0)}else{v.copy(p.normals[0]).multiplyScalar(F.x);m.copy(p.binormals[0]).multiplyScalar(F.y);g.copy(c[0]).add(v).add(m);Q(g.x,g.y,g.z)}}var q;for(q=1;q<=u;q++){for(N=0;N<O;N++){F=s?L(S[N],X[N],R):S[N];if(!f){Q(F.x,F.y,r/u*q)}else{v.copy(p.normals[q]).multiplyScalar(F.x);m.copy(p.binormals[q]).multiplyScalar(F.y);g.copy(c[q]).add(v).add(m);Q(g.x,g.y,g.z)}}}for(P=o-1;P>=0;P--){D=P/o;k=n*(1-D);R=a*Math.sin(D*Math.PI/2);for(N=0,G=A.length;N<G;N++){F=L(A[N],I[N],R);Q(F.x,F.y,r+k)}for(x=0,b=T.length;x<b;x++){y=T[x];W=j[x];for(N=0,G=y.length;N<G;N++){F=L(y[N],W[N],R);if(!f){Q(F.x,F.y,r+k)}else{Q(F.x,F.y+c[u-1].y,c[u-1].x+k)}}}}Y();K();function Y(){if(s){var e=0;var t=O*e;for(N=0;N<B;N++){U=C[N];J(U[2]+t,U[1]+t,U[0]+t)}e=u+o*2;t=O*e;for(N=0;N<B;N++){U=C[N];J(U[0]+t,U[1]+t,U[2]+t)}}else{for(N=0;N<B;N++){U=C[N];J(U[2],U[1],U[0])}for(N=0;N<B;N++){U=C[N];J(U[0]+O*u,U[1]+O*u,U[2]+O*u)}}}function K(){var e=0;Z(A,e);e+=A.length;for(x=0,b=T.length;x<b;x++){y=T[x];Z(y,e);e+=y.length}}function Z(e,t){var r,n;N=e.length;while(--N>=0){r=N;n=N-1;if(n<0)n=e.length-1;var i=0,a=u+o*2;for(i=0;i<a;i++){var s=O*i;var h=O*(i+1);var l=t+r+s,c=t+n+s,f=t+n+h,d=t+r+h;$(l,c,f,d,e,i,a,r,n)}}}function Q(e,t,r){w.vertices.push(new i.Vector3(e,t,r))}function J(e,t,r){e+=_;t+=_;r+=_;w.faces.push(new i.Face3(e,t,r,null,null,0));var n=d.generateTopUV(w,e,t,r);w.faceVertexUvs[0].push(n)}function $(e,t,r,n,a,o,s,h,u){e+=_;t+=_;r+=_;n+=_;w.faces.push(new i.Face3(e,t,n,null,null,1));w.faces.push(new i.Face3(t,r,n,null,null,1));var l=d.generateSideWallUV(w,e,t,r,n);w.faceVertexUvs[0].push([l[0],l[1],l[3]]);w.faceVertexUvs[0].push([l[1],l[2],l[3]])}};i.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n){var a=e.vertices;var o=a[t];var s=a[r];var h=a[n];return[new i.Vector2(o.x,o.y),new i.Vector2(s.x,s.y),new i.Vector2(h.x,h.y)]},generateSideWallUV:function(e,t,r,n,a){var o=e.vertices;var s=o[t];var h=o[r];var u=o[n];var l=o[a];if(Math.abs(s.y-h.y)<.01){return[new i.Vector2(s.x,1-s.z),new i.Vector2(h.x,1-h.z),new i.Vector2(u.x,1-u.z),new i.Vector2(l.x,1-l.z)]}else{return[new i.Vector2(s.y,1-s.z),new i.Vector2(h.y,1-h.z),new i.Vector2(u.y,1-u.z),new i.Vector2(l.y,1-l.z)]}}};i.ShapeGeometry=function(e,t){i.Geometry.call(this);this.type="ShapeGeometry";if(Array.isArray(e)===false)e=[e];this.addShapeList(e,t);this.computeFaceNormals()};i.ShapeGeometry.prototype=Object.create(i.Geometry.prototype);i.ShapeGeometry.prototype.constructor=i.ShapeGeometry;i.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,n=e.length;r<n;r++){this.addShape(e[r],t)}return this};i.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var r=t.curveSegments!==undefined?t.curveSegments:12;var n=t.material;var a=t.UVGenerator===undefined?i.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var o,s,h;var u=this.vertices.length;var l=e.extractPoints(r);var c=l.shape;var f=l.holes;var d=!i.ShapeUtils.isClockWise(c);if(d){c=c.reverse();for(o=0,s=f.length;o<s;o++){h=f[o];if(i.ShapeUtils.isClockWise(h)){f[o]=h.reverse()}}d=false}var p=i.ShapeUtils.triangulateShape(c,f);for(o=0,s=f.length;o<s;o++){h=f[o];c=c.concat(h)}var m,v=c.length;var g,y=p.length;for(o=0;o<v;o++){m=c[o];this.vertices.push(new i.Vector3(m.x,m.y,0))}for(o=0;o<y;o++){g=p[o];var x=g[0]+u;var b=g[1]+u;var w=g[2]+u;this.faces.push(new i.Face3(x,b,w,null,null,n));this.faceVertexUvs[0].push(a.generateTopUV(this,x,b,w))}};i.LatheGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:r,phiLength:n};t=t||12;r=r||0;n=n||2*Math.PI;var a=1/(e.length-1);var o=1/t;for(var s=0,h=t;s<=h;s++){var u=r+s*o*n;var l=Math.cos(u),c=Math.sin(u);for(var f=0,d=e.length;f<d;f++){var p=e[f];var m=new i.Vector3;m.x=l*p.x-c*p.y;m.y=c*p.x+l*p.y;m.z=p.z;this.vertices.push(m)}}var v=e.length;for(var s=0,h=t;s<h;s++){for(var f=0,d=e.length-1;f<d;f++){var g=f+v*s;var y=g;var x=g+v;var l=g+1+v;var b=g+1;var w=s*o;var _=f*a;var M=w+o;var S=_+a;this.faces.push(new i.Face3(y,x,b));this.faceVertexUvs[0].push([new i.Vector2(w,_),new i.Vector2(M,_),new i.Vector2(w,S)]);this.faces.push(new i.Face3(x,l,b));this.faceVertexUvs[0].push([new i.Vector2(M,_),new i.Vector2(M,S),new i.Vector2(w,S)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};i.LatheGeometry.prototype=Object.create(i.Geometry.prototype);i.LatheGeometry.prototype.constructor=i.LatheGeometry;i.PlaneGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};this.fromBufferGeometry(new i.PlaneBufferGeometry(e,t,r,n))};i.PlaneGeometry.prototype=Object.create(i.Geometry.prototype);i.PlaneGeometry.prototype.constructor=i.PlaneGeometry;i.PlaneGeometry.prototype.clone=function(){var e=this.parameters;return new i.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)};i.PlaneBufferGeometry=function(e,t,r,n){i.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var a=e/2;var o=t/2;var s=Math.floor(r)||1;var h=Math.floor(n)||1;var u=s+1;var l=h+1;var c=e/s;var f=t/h;var d=new Float32Array(u*l*3);var p=new Float32Array(u*l*3);var m=new Float32Array(u*l*2);var v=0;var g=0;for(var y=0;y<l;y++){var x=y*f-o;for(var b=0;b<u;b++){var w=b*c-a;d[v]=w;d[v+1]=-x;p[v+2]=1;m[g]=b/s;m[g+1]=1-y/h;v+=3;g+=2}}v=0;var _=new(d.length/3>65535?Uint32Array:Uint16Array)(s*h*6);for(var y=0;y<h;y++){for(var b=0;b<s;b++){var M=b+u*y;var S=b+u*(y+1);var T=b+1+u*(y+1);var E=b+1+u*y;_[v]=M;_[v+1]=S;_[v+2]=E;_[v+3]=S;_[v+4]=T;_[v+5]=E;v+=6}}this.setIndex(new i.BufferAttribute(_,1));this.addAttribute("position",new i.BufferAttribute(d,3));this.addAttribute("normal",new i.BufferAttribute(p,3));this.addAttribute("uv",new i.BufferAttribute(m,2))};i.PlaneBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.PlaneBufferGeometry.prototype.constructor=i.PlaneBufferGeometry;i.PlaneBufferGeometry.prototype.clone=function(){var e=this.parameters;return new i.PlaneBufferGeometry(e.width,e.height,e.widthSegments,e.heightSegments)};i.RingGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:a,thetaLength:o};e=e||0;t=t||50;a=a!==undefined?a:0;o=o!==undefined?o:Math.PI*2;r=r!==undefined?Math.max(3,r):8;n=n!==undefined?Math.max(1,n):8;var s,h,u=[],l=e,c=(t-e)/n;for(s=0;s<n+1;s++){for(h=0;h<r+1;h++){var f=new i.Vector3;var d=a+h/r*o;f.x=l*Math.cos(d);f.y=l*Math.sin(d);this.vertices.push(f);u.push(new i.Vector2((f.x/t+1)/2,(f.y/t+1)/2))}l+=c}var p=new i.Vector3(0,0,1);for(s=0;s<n;s++){var m=s*(r+1);for(h=0;h<r;h++){var d=h+m;var v=d;var g=d+r+1;var y=d+r+2;this.faces.push(new i.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([u[v].clone(),u[g].clone(),u[y].clone()]);v=d;g=d+r+2;y=d+1;this.faces.push(new i.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([u[v].clone(),u[g].clone(),u[y].clone()])}}this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,l)};i.RingGeometry.prototype=Object.create(i.Geometry.prototype);i.RingGeometry.prototype.constructor=i.RingGeometry;i.RingGeometry.prototype.clone=function(){var e=this.parameters;return new i.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)};i.SphereGeometry=function(e,t,r,n,a,o,s){i.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:a,thetaStart:o,thetaLength:s};this.fromBufferGeometry(new i.SphereBufferGeometry(e,t,r,n,a,o,s))};i.SphereGeometry.prototype=Object.create(i.Geometry.prototype);i.SphereGeometry.prototype.constructor=i.SphereGeometry;i.SphereGeometry.prototype.clone=function(){var e=this.parameters;return new i.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)};i.SphereBufferGeometry=function(e,t,r,n,a,o,s){i.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:a,thetaStart:o,thetaLength:s};e=e||50;t=Math.max(3,Math.floor(t)||8);r=Math.max(2,Math.floor(r)||6);n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;o=o!==undefined?o:0;s=s!==undefined?s:Math.PI;var h=o+s;var u=(t+1)*(r+1);var l=new i.BufferAttribute(new Float32Array(u*3),3);var c=new i.BufferAttribute(new Float32Array(u*3),3);var f=new i.BufferAttribute(new Float32Array(u*2),2);var d=0,p=[],m=new i.Vector3;for(var v=0;v<=r;v++){var g=[];var y=v/r;for(var x=0;x<=t;x++){var b=x/t;var w=-e*Math.cos(n+b*a)*Math.sin(o+y*s);var _=e*Math.cos(o+y*s);var M=e*Math.sin(n+b*a)*Math.sin(o+y*s);m.set(w,_,M).normalize();l.setXYZ(d,w,_,M);c.setXYZ(d,m.x,m.y,m.z);f.setXY(d,b,1-y);g.push(d);d++}p.push(g)}var S=[];for(var v=0;v<r;v++){for(var x=0;x<t;x++){var T=p[v][x+1];var E=p[v][x];var C=p[v+1][x];var A=p[v+1][x+1];if(v!==0||o>0)S.push(T,E,A);if(v!==r-1||h<Math.PI)S.push(E,C,A)}}this.setIndex(new(l.count>65535?i.Uint32Attribute:i.Uint16Attribute)(S,1));this.addAttribute("position",l);this.addAttribute("normal",c);this.addAttribute("uv",f);this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.SphereBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.SphereBufferGeometry.prototype.constructor=i.SphereBufferGeometry;i.SphereBufferGeometry.prototype.clone=function(){var e=this.parameters;return new i.SphereBufferGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)};i.TorusGeometry=function(e,t,r,n,a){i.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:a};e=e||100;t=t||40;r=r||8;n=n||6;a=a||Math.PI*2;var o=new i.Vector3,s=[],h=[];for(var u=0;u<=r;u++){for(var l=0;l<=n;l++){var c=l/n*a;var f=u/r*Math.PI*2;o.x=e*Math.cos(c);o.y=e*Math.sin(c);var d=new i.Vector3;d.x=(e+t*Math.cos(f))*Math.cos(c);d.y=(e+t*Math.cos(f))*Math.sin(c);d.z=t*Math.sin(f);this.vertices.push(d);s.push(new i.Vector2(l/n,u/r));h.push(d.clone().sub(o).normalize())}}for(var u=1;u<=r;u++){for(var l=1;l<=n;l++){var p=(n+1)*u+l-1;var m=(n+1)*(u-1)+l-1;var v=(n+1)*(u-1)+l;var g=(n+1)*u+l;var y=new i.Face3(p,m,g,[h[p].clone(),h[m].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[g].clone()]);y=new i.Face3(m,v,g,[h[m].clone(),h[v].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[m].clone(),s[v].clone(),s[g].clone()])}}this.computeFaceNormals()};i.TorusGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusGeometry.prototype.constructor=i.TorusGeometry;i.TorusGeometry.prototype.clone=function(){var e=this.parameters;return new i.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)};i.TorusKnotGeometry=function(e,t,r,n,a,o,s){i.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:a,q:o,heightScale:s};e=e||100;t=t||40;r=r||64;n=n||8;a=a||2;o=o||3;s=s||1;var h=new Array(r);var u=new i.Vector3;var l=new i.Vector3;var c=new i.Vector3;for(var f=0;f<r;++f){h[f]=new Array(n);var d=f/r*2*a*Math.PI;var p=R(d,o,a,e,s);var m=R(d+.01,o,a,e,s);u.subVectors(m,p);l.addVectors(m,p);c.crossVectors(u,l);l.crossVectors(c,u);c.normalize();l.normalize();for(var v=0;v<n;++v){var g=v/n*2*Math.PI;var y=-t*Math.cos(g);var x=t*Math.sin(g);var b=new i.Vector3;b.x=p.x+y*l.x+x*c.x;b.y=p.y+y*l.y+x*c.y;b.z=p.z+y*l.z+x*c.z;h[f][v]=this.vertices.push(b)-1}}for(var f=0;f<r;++f){for(var v=0;v<n;++v){var w=(f+1)%r;var _=(v+1)%n;var M=h[f][v];var S=h[w][v];var T=h[w][_];var E=h[f][_];var C=new i.Vector2(f/r,v/n);var A=new i.Vector2((f+1)/r,v/n);var L=new i.Vector2((f+1)/r,(v+1)/n);var P=new i.Vector2(f/r,(v+1)/n);this.faces.push(new i.Face3(M,S,E));this.faceVertexUvs[0].push([C,A,P]);this.faces.push(new i.Face3(S,T,E));this.faceVertexUvs[0].push([A.clone(),L,P.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function R(e,t,r,n,a){var o=Math.cos(e);var s=Math.sin(e);var h=t/r*e;var u=Math.cos(h);var l=n*(2+u)*.5*o;var c=n*(2+u)*s*.5;var f=a*n*Math.sin(h)*.5;return new i.Vector3(l,c,f)}};i.TorusKnotGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusKnotGeometry.prototype.constructor=i.TorusKnotGeometry;i.TorusKnotGeometry.prototype.clone=function(){var e=this.parameters;return new i.TorusKnotGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.heightScale)};i.TubeGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:a,taper:o};t=t||64;r=r||1;n=n||8;a=a||false;o=o||i.TubeGeometry.NoTaper;var s=[];var h=this,u,l,c,f=t+1,d,p,m,v,g,y,x=new i.Vector3,b,w,_,M,S,T,E,C,A,L,P,R;var D=new i.TubeGeometry.FrenetFrames(e,t,a),k=D.tangents,F=D.normals,O=D.binormals;this.tangents=k;this.normals=F;this.binormals=O;function U(e,t,r){return h.vertices.push(new i.Vector3(e,t,r))-1}for(b=0;b<f;b++){s[b]=[];d=b/(f-1);y=e.getPointAt(d);u=k[b];l=F[b];c=O[b];m=r*o(d);for(w=0;w<n;w++){p=w/n*2*Math.PI;v=-m*Math.cos(p);g=m*Math.sin(p);x.copy(y);x.x+=v*l.x+g*c.x;x.y+=v*l.y+g*c.y;x.z+=v*l.z+g*c.z;s[b][w]=U(x.x,x.y,x.z)}}for(b=0;b<t;b++){for(w=0;w<n;w++){_=a?(b+1)%t:b+1;M=(w+1)%n;S=s[b][w];T=s[_][w];E=s[_][M];C=s[b][M];A=new i.Vector2(b/t,w/n);L=new i.Vector2((b+1)/t,w/n);P=new i.Vector2((b+1)/t,(w+1)/n);R=new i.Vector2(b/t,(w+1)/n);this.faces.push(new i.Face3(S,T,C));this.faceVertexUvs[0].push([A,L,R]);this.faces.push(new i.Face3(T,E,C));this.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};i.TubeGeometry.prototype=Object.create(i.Geometry.prototype);i.TubeGeometry.prototype.constructor=i.TubeGeometry;i.TubeGeometry.prototype.clone=function(){return new this.constructor(this.parameters.path,this.parameters.segments,this.parameters.radius,this.parameters.radialSegments,this.parameters.closed,this.parameters.taper)};i.TubeGeometry.NoTaper=function(e){return 1};i.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)};i.TubeGeometry.FrenetFrames=function(e,t,r){var n=new i.Vector3,a=[],o=[],s=[],h=new i.Vector3,u=new i.Matrix4,l=t+1,c,f,d,p,m,v,g;this.tangents=a;this.normals=o;this.binormals=s;for(v=0;v<l;v++){g=v/(l-1);a[v]=e.getTangentAt(g);a[v].normalize()}y();function y(){o[0]=new i.Vector3;s[0]=new i.Vector3;f=Number.MAX_VALUE;d=Math.abs(a[0].x);p=Math.abs(a[0].y);m=Math.abs(a[0].z);if(d<=f){f=d;n.set(1,0,0)}if(p<=f){f=p;n.set(0,1,0)}if(m<=f){n.set(0,0,1)}h.crossVectors(a[0],n).normalize();o[0].crossVectors(a[0],h);s[0].crossVectors(a[0],o[0])}for(v=1;v<l;v++){o[v]=o[v-1].clone();s[v]=s[v-1].clone();h.crossVectors(a[v-1],a[v]);if(h.length()>Number.EPSILON){h.normalize();c=Math.acos(i.Math.clamp(a[v-1].dot(a[v]),-1,1));o[v].applyMatrix4(u.makeRotationAxis(h,c))}s[v].crossVectors(a[v],o[v])}if(r){c=Math.acos(i.Math.clamp(o[0].dot(o[l-1]),-1,1));c/=l-1;if(a[0].dot(h.crossVectors(o[0],o[l-1]))>0){c=-c}for(v=1;v<l;v++){o[v].applyMatrix4(u.makeRotationAxis(a[v],c*v));s[v].crossVectors(a[v],o[v])}}};i.PolyhedronGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:r,detail:n};r=r||1;n=n||0;var a=this;for(var o=0,s=e.length;o<s;o+=3){w(new i.Vector3(e[o],e[o+1],e[o+2]))}var h=this.vertices;var u=[];for(var o=0,l=0,s=t.length;o<s;o+=3,l++){var c=h[t[o]];var f=h[t[o+1]];var d=h[t[o+2]];u[l]=new i.Face3(c.index,f.index,d.index,[c.clone(),f.clone(),d.clone()],undefined,l)}var p=new i.Vector3;for(var o=0,s=u.length;o<s;o++){M(u[o],n)}for(var o=0,s=this.faceVertexUvs[0].length;o<s;o++){var m=this.faceVertexUvs[0][o];var v=m[0].x;var g=m[1].x;var y=m[2].x;var x=Math.max(v,g,y);var b=Math.min(v,g,y);if(x>.9&&b<.1){if(v<.2)m[0].x+=1;if(g<.2)m[1].x+=1;if(y<.2)m[2].x+=1}}for(var o=0,s=this.vertices.length;o<s;o++){this.vertices[o].multiplyScalar(r)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,r);function w(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var r=S(e)/2/Math.PI+.5;var n=T(e)/Math.PI+.5;t.uv=new i.Vector2(r,1-n);return t}function _(e,t,r,n){var o=new i.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()],undefined,n);a.faces.push(o);p.copy(e).add(t).add(r).divideScalar(3);var s=S(p);a.faceVertexUvs[0].push([E(e.uv,e,s),E(t.uv,t,s),E(r.uv,r,s)])}function M(e,t){var r=Math.pow(2,t);var n=w(a.vertices[e.a]);var i=w(a.vertices[e.b]);var o=w(a.vertices[e.c]);var s=[];var h=e.materialIndex;for(var u=0;u<=r;u++){s[u]=[];var l=w(n.clone().lerp(o,u/r));var c=w(i.clone().lerp(o,u/r));var f=r-u;for(var d=0;d<=f;d++){if(d===0&&u===r){s[u][d]=l}else{s[u][d]=w(l.clone().lerp(c,d/f))}}}for(var u=0;u<r;u++){for(var d=0;d<2*(r-u)-1;d++){var p=Math.floor(d/2);if(d%2===0){_(s[u][p+1],s[u+1][p],s[u][p],h)}else{_(s[u][p+1],s[u+1][p+1],s[u+1][p],h)}}}}function S(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function E(e,t,r){if(r<0&&e.x===1)e=new i.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new i.Vector2(r/2/Math.PI+.5,e.y);return e.clone()}};i.PolyhedronGeometry.prototype=Object.create(i.Geometry.prototype);i.PolyhedronGeometry.prototype.constructor=i.PolyhedronGeometry;i.PolyhedronGeometry.prototype.clone=function(){var e=this.parameters;return new i.PolyhedronGeometry(e.vertices,e.indices,e.radius,e.detail)};i.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;var n=1/r;var a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];var o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];i.PolyhedronGeometry.call(this,a,o,e,t);this.type="DodecahedronGeometry";this.parameters={radius:e,detail:t}};i.DodecahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.DodecahedronGeometry.prototype.constructor=i.DodecahedronGeometry;i.DodecahedronGeometry.prototype.clone=function(){var e=this.parameters;return new i.DodecahedronGeometry(e.radius,e.detail)};i.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;var n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];var a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];i.PolyhedronGeometry.call(this,n,a,e,t);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t}};i.IcosahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.IcosahedronGeometry.prototype.constructor=i.IcosahedronGeometry;i.IcosahedronGeometry.prototype.clone=function(){var e=this.parameters;return new i.IcosahedronGeometry(e.radius,e.detail)};i.OctahedronGeometry=function(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];i.PolyhedronGeometry.call(this,r,n,e,t);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t}};i.OctahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.OctahedronGeometry.prototype.constructor=i.OctahedronGeometry;i.OctahedronGeometry.prototype.clone=function(){var e=this.parameters;return new i.OctahedronGeometry(e.radius,e.detail)};i.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var n=[2,1,0,0,3,2,1,3,0,2,3,1];i.PolyhedronGeometry.call(this,r,n,e,t);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t}};i.TetrahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.TetrahedronGeometry.prototype.constructor=i.TetrahedronGeometry;i.TetrahedronGeometry.prototype.clone=function(){var e=this.parameters;return new i.TetrahedronGeometry(e.radius,e.detail)};i.ParametricGeometry=function(e,t,r){i.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:r};var n=this.vertices;var a=this.faces;var o=this.faceVertexUvs[0];var s,h,u;var l,c;var f=t+1;for(s=0;s<=r;s++){c=s/r;for(h=0;h<=t;h++){l=h/t;u=e(l,c);n.push(u)}}var d,p,m,v;var g,y,x,b;for(s=0;s<r;s++){for(h=0;h<t;h++){d=s*f+h;p=s*f+h+1;m=(s+1)*f+h+1;v=(s+1)*f+h;g=new i.Vector2(h/t,s/r);y=new i.Vector2((h+1)/t,s/r);x=new i.Vector2((h+1)/t,(s+1)/r);b=new i.Vector2(h/t,(s+1)/r);a.push(new i.Face3(d,p,v));o.push([g,y,b]);a.push(new i.Face3(p,m,v));o.push([y.clone(),x,b.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};i.ParametricGeometry.prototype=Object.create(i.Geometry.prototype);i.ParametricGeometry.prototype.constructor=i.ParametricGeometry;i.WireframeGeometry=function(e){i.BufferGeometry.call(this);var t=[0,0],r={};function n(e,t){return e-t}var a=["a","b","c"];if(e instanceof i.Geometry){var o=e.vertices;var s=e.faces;var h=0;var u=new Uint32Array(6*s.length);for(var l=0,c=s.length;l<c;l++){var f=s[l];for(var d=0;d<3;d++){t[0]=f[a[d]];t[1]=f[a[(d+1)%3]];t.sort(n);var p=t.toString();if(r[p]===undefined){u[2*h]=t[0];u[2*h+1]=t[1];r[p]=true;h++}}}var m=new Float32Array(h*2*3);for(var l=0,c=h;l<c;l++){for(var d=0;d<2;d++){var v=o[u[2*l+d]];var g=6*l+3*d;m[g+0]=v.x;m[g+1]=v.y;m[g+2]=v.z}}this.addAttribute("position",new i.BufferAttribute(m,3))}else if(e instanceof i.BufferGeometry){if(e.index!==null){var y=e.index.array;var o=e.attributes.position;var x=e.drawcalls;var h=0;if(x.length===0){
e.addGroup(0,y.length)}var u=new Uint32Array(2*y.length);for(var b=0,w=x.length;b<w;++b){var _=x[b];var M=_.start;var S=_.count;for(var l=M,T=M+S;l<T;l+=3){for(var d=0;d<3;d++){t[0]=y[l+d];t[1]=y[l+(d+1)%3];t.sort(n);var p=t.toString();if(r[p]===undefined){u[2*h]=t[0];u[2*h+1]=t[1];r[p]=true;h++}}}}var m=new Float32Array(h*2*3);for(var l=0,c=h;l<c;l++){for(var d=0;d<2;d++){var g=6*l+3*d;var E=u[2*l+d];m[g+0]=o.getX(E);m[g+1]=o.getY(E);m[g+2]=o.getZ(E)}}this.addAttribute("position",new i.BufferAttribute(m,3))}else{var o=e.attributes.position.array;var h=o.length/3;var C=h/3;var m=new Float32Array(h*2*3);for(var l=0,c=C;l<c;l++){for(var d=0;d<3;d++){var g=18*l+6*d;var A=9*l+3*d;m[g+0]=o[A];m[g+1]=o[A+1];m[g+2]=o[A+2];var E=9*l+3*((d+1)%3);m[g+3]=o[E];m[g+4]=o[E+1];m[g+5]=o[E+2]}}this.addAttribute("position",new i.BufferAttribute(m,3))}}};i.WireframeGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.WireframeGeometry.prototype.constructor=i.WireframeGeometry;i.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]);var r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var n=new i.BufferGeometry;n.addAttribute("position",new i.BufferAttribute(t,3));n.addAttribute("color",new i.BufferAttribute(r,3));var a=new i.LineBasicMaterial({vertexColors:i.VertexColors});i.LineSegments.call(this,n,a)};i.AxisHelper.prototype=Object.create(i.LineSegments.prototype);i.AxisHelper.prototype.constructor=i.AxisHelper;i.ArrowHelper=function(){var e=new i.Geometry;e.vertices.push(new i.Vector3(0,0,0),new i.Vector3(0,1,0));var t=new i.CylinderGeometry(0,.5,1,5,1);t.translate(0,-.5,0);return function r(n,a,o,s,h,u){i.Object3D.call(this);if(s===undefined)s=16776960;if(o===undefined)o=1;if(h===undefined)h=.2*o;if(u===undefined)u=.2*h;this.position.copy(a);if(h<o){this.line=new i.Line(e,new i.LineBasicMaterial({color:s}));this.line.matrixAutoUpdate=false;this.add(this.line)}this.cone=new i.Mesh(t,new i.MeshBasicMaterial({color:s}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(n);this.setLength(o,h,u)}}();i.ArrowHelper.prototype=Object.create(i.Object3D.prototype);i.ArrowHelper.prototype.constructor=i.ArrowHelper;i.ArrowHelper.prototype.setDirection=function(){var e=new i.Vector3;var t;return function r(n){if(n.y>.99999){this.quaternion.set(0,0,0,1)}else if(n.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(n.z,0,-n.x).normalize();t=Math.acos(n.y);this.quaternion.setFromAxisAngle(e,t)}}}();i.ArrowHelper.prototype.setLength=function(e,t,r){if(t===undefined)t=.2*e;if(r===undefined)r=.2*t;if(t<e){this.line.scale.set(1,e-t,1);this.line.updateMatrix()}this.cone.scale.set(r,t,r);this.cone.position.y=e;this.cone.updateMatrix()};i.ArrowHelper.prototype.setColor=function(e){if(this.line!==undefined)this.line.material.color.set(e);this.cone.material.color.set(e)};i.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(8*3);var n=new i.BufferGeometry;n.setIndex(new i.BufferAttribute(t,1));n.addAttribute("position",new i.BufferAttribute(r,3));i.LineSegments.call(this,n,new i.LineBasicMaterial({color:16776960}));if(e!==undefined){this.update(e)}};i.BoxHelper.prototype=Object.create(i.LineSegments.prototype);i.BoxHelper.prototype.constructor=i.BoxHelper;i.BoxHelper.prototype.update=function(){var e=new i.Box3;return function(t){e.setFromObject(t);if(e.empty())return;var r=e.min;var n=e.max;var i=this.geometry.attributes.position;var a=i.array;a[0]=n.x;a[1]=n.y;a[2]=n.z;a[3]=r.x;a[4]=n.y;a[5]=n.z;a[6]=r.x;a[7]=r.y;a[8]=n.z;a[9]=n.x;a[10]=r.y;a[11]=n.z;a[12]=n.x;a[13]=n.y;a[14]=r.z;a[15]=r.x;a[16]=n.y;a[17]=r.z;a[18]=r.x;a[19]=r.y;a[20]=r.z;a[21]=n.x;a[22]=r.y;a[23]=r.z;i.needsUpdate=true;this.geometry.computeBoundingSphere()}}();i.BoundingBoxHelper=function(e,t){var r=t!==undefined?t:8947848;this.object=e;this.box=new i.Box3;i.Mesh.call(this,new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:r,wireframe:true}))};i.BoundingBoxHelper.prototype=Object.create(i.Mesh.prototype);i.BoundingBoxHelper.prototype.constructor=i.BoundingBoxHelper;i.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};i.CameraHelper=function(e){var t=new i.Geometry;var r=new i.LineBasicMaterial({color:16777215,vertexColors:i.FaceColors});var n={};var a=16755200;var o=16711680;var s=43775;var h=16777215;var u=3355443;l("n1","n2",a);l("n2","n4",a);l("n4","n3",a);l("n3","n1",a);l("f1","f2",a);l("f2","f4",a);l("f4","f3",a);l("f3","f1",a);l("n1","f1",a);l("n2","f2",a);l("n3","f3",a);l("n4","f4",a);l("p","n1",o);l("p","n2",o);l("p","n3",o);l("p","n4",o);l("u1","u2",s);l("u2","u3",s);l("u3","u1",s);l("c","t",h);l("p","c",u);l("cn1","cn2",u);l("cn3","cn4",u);l("cf1","cf2",u);l("cf3","cf4",u);function l(e,t,r){c(e,r);c(t,r)}function c(e,r){t.vertices.push(new i.Vector3);t.colors.push(new i.Color(r));if(n[e]===undefined){n[e]=[]}n[e].push(t.vertices.length-1)}i.LineSegments.call(this,t,r);this.camera=e;this.camera.updateProjectionMatrix();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=n;this.update()};i.CameraHelper.prototype=Object.create(i.LineSegments.prototype);i.CameraHelper.prototype.constructor=i.CameraHelper;i.CameraHelper.prototype.update=function(){var e,t;var r=new i.Vector3;var n=new i.Camera;function a(i,a,o,s){r.set(a,o,s).unproject(n);var h=t[i];if(h!==undefined){for(var u=0,l=h.length;u<l;u++){e.vertices[h[u]].copy(r)}}}return function(){e=this.geometry;t=this.pointMap;var r=1,i=1;n.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-r,-i,-1);a("n2",r,-i,-1);a("n3",-r,i,-1);a("n4",r,i,-1);a("f1",-r,-i,1);a("f2",r,-i,1);a("f3",-r,i,1);a("f4",r,i,1);a("u1",r*.7,i*1.1,-1);a("u2",-r*.7,i*1.1,-1);a("u3",0,i*2,-1);a("cf1",-r,0,1);a("cf2",r,0,1);a("cf3",0,-i,1);a("cf4",0,i,1);a("cn1",-r,0,-1);a("cn2",r,0,-1);a("cn3",0,-i,-1);a("cn4",0,i,-1);e.verticesNeedUpdate=true}}();i.DirectionalLightHelper=function(e,t){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var r=new i.Geometry;r.vertices.push(new i.Vector3(-t,t,0),new i.Vector3(t,t,0),new i.Vector3(t,-t,0),new i.Vector3(-t,-t,0),new i.Vector3(-t,t,0));var n=new i.LineBasicMaterial({fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new i.Line(r,n);this.add(this.lightPlane);r=new i.Geometry;r.vertices.push(new i.Vector3,new i.Vector3);n=new i.LineBasicMaterial({fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new i.Line(r,n);this.add(this.targetLine);this.update()};i.DirectionalLightHelper.prototype=Object.create(i.Object3D.prototype);i.DirectionalLightHelper.prototype.constructor=i.DirectionalLightHelper;i.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};i.DirectionalLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);r.subVectors(t,e);this.lightPlane.lookAt(r);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(r);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();i.EdgesHelper=function(e,t,r){var n=t!==undefined?t:16777215;i.LineSegments.call(this,new i.EdgesGeometry(e.geometry,r),new i.LineBasicMaterial({color:n}));this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.EdgesHelper.prototype=Object.create(i.LineSegments.prototype);i.EdgesHelper.prototype.constructor=i.EdgesHelper;i.FaceNormalsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16776960;var o=n!==undefined?n:1;var s=0;var h=this.object.geometry;if(h instanceof i.Geometry){s=h.faces.length}else{console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.")}var u=new i.BufferGeometry;var l=new i.Float32Attribute(s*2*3,3);u.addAttribute("position",l);i.LineSegments.call(this,u,new i.LineBasicMaterial({color:a,linewidth:o}));this.matrixAutoUpdate=false;this.update()};i.FaceNormalsHelper.prototype=Object.create(i.LineSegments.prototype);i.FaceNormalsHelper.prototype.constructor=i.FaceNormalsHelper;i.FaceNormalsHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function n(){this.object.updateMatrixWorld(true);r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld;var i=this.geometry.attributes.position;var a=this.object.geometry;var o=a.vertices;var s=a.faces;var h=0;for(var u=0,l=s.length;u<l;u++){var c=s[u];var f=c.normal;e.copy(o[c.a]).add(o[c.b]).add(o[c.c]).divideScalar(3).applyMatrix4(n);t.copy(f).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e);i.setXYZ(h,e.x,e.y,e.z);h=h+1;i.setXYZ(h,t.x,t.y,t.z);h=h+1}i.needsUpdate=true;return this}}();i.GridHelper=function(e,t){var r=new i.Geometry;var n=new i.LineBasicMaterial({vertexColors:i.VertexColors});this.color1=new i.Color(4473924);this.color2=new i.Color(8947848);for(var a=-e;a<=e;a+=t){r.vertices.push(new i.Vector3(-e,0,a),new i.Vector3(e,0,a),new i.Vector3(a,0,-e),new i.Vector3(a,0,e));var o=a===0?this.color1:this.color2;r.colors.push(o,o,o,o)}i.LineSegments.call(this,r,n)};i.GridHelper.prototype=Object.create(i.LineSegments.prototype);i.GridHelper.prototype.constructor=i.GridHelper;i.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};i.HemisphereLightHelper=function(e,t){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new i.Color,new i.Color];var r=new i.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var n=0,a=8;n<a;n++){r.faces[n].color=this.colors[n<4?0:1]}var o=new i.MeshBasicMaterial({vertexColors:i.FaceColors,wireframe:true});this.lightSphere=new i.Mesh(r,o);this.add(this.lightSphere);this.update()};i.HemisphereLightHelper.prototype=Object.create(i.Object3D.prototype);i.HemisphereLightHelper.prototype.constructor=i.HemisphereLightHelper;i.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};i.HemisphereLightHelper.prototype.update=function(){var e=new i.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();i.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var r=new i.SphereGeometry(t,4,2);var n=new i.MeshBasicMaterial({wireframe:true,fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);i.Mesh.call(this,r,n);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};i.PointLightHelper.prototype=Object.create(i.Mesh.prototype);i.PointLightHelper.prototype.constructor=i.PointLightHelper;i.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};i.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};i.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new i.Geometry;for(var r=0;r<this.bones.length;r++){var n=this.bones[r];if(n.parent instanceof i.Bone){t.vertices.push(new i.Vector3);t.vertices.push(new i.Vector3);t.colors.push(new i.Color(0,0,1));t.colors.push(new i.Color(0,1,0))}}t.dynamic=true;var a=new i.LineBasicMaterial({vertexColors:i.VertexColors,depthTest:false,depthWrite:false,transparent:true});i.LineSegments.call(this,t,a);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.update()};i.SkeletonHelper.prototype=Object.create(i.LineSegments.prototype);i.SkeletonHelper.prototype.constructor=i.SkeletonHelper;i.SkeletonHelper.prototype.getBoneList=function(e){var t=[];if(e instanceof i.Bone){t.push(e)}for(var r=0;r<e.children.length;r++){t.push.apply(t,this.getBoneList(e.children[r]))}return t};i.SkeletonHelper.prototype.update=function(){var e=this.geometry;var t=(new i.Matrix4).getInverse(this.root.matrixWorld);var r=new i.Matrix4;var n=0;for(var a=0;a<this.bones.length;a++){var o=this.bones[a];if(o.parent instanceof i.Bone){r.multiplyMatrices(t,o.matrixWorld);e.vertices[n].setFromMatrixPosition(r);r.multiplyMatrices(t,o.parent.matrixWorld);e.vertices[n+1].setFromMatrixPosition(r);n+=2}}e.verticesNeedUpdate=true;e.computeBoundingSphere()};i.SpotLightHelper=function(e){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;var t=new i.CylinderGeometry(0,1,1,8,1,true);t.translate(0,-.5,0);t.rotateX(-Math.PI/2);var r=new i.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new i.Mesh(t,r);this.add(this.cone);this.update()};i.SpotLightHelper.prototype=Object.create(i.Object3D.prototype);i.SpotLightHelper.prototype.constructor=i.SpotLightHelper;i.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};i.SpotLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4;var n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();i.VertexNormalsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16711680;var o=n!==undefined?n:1;var s=0;var h=this.object.geometry;if(h instanceof i.Geometry){s=h.faces.length*3}else if(h instanceof i.BufferGeometry){s=h.attributes.normal.count}var u=new i.BufferGeometry;var l=new i.Float32Attribute(s*2*3,3);u.addAttribute("position",l);i.LineSegments.call(this,u,new i.LineBasicMaterial({color:a,linewidth:o}));this.matrixAutoUpdate=false;this.update()};i.VertexNormalsHelper.prototype=Object.create(i.LineSegments.prototype);i.VertexNormalsHelper.prototype.constructor=i.VertexNormalsHelper;i.VertexNormalsHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function n(){var n=["a","b","c"];this.object.updateMatrixWorld(true);r.getNormalMatrix(this.object.matrixWorld);var a=this.object.matrixWorld;var o=this.geometry.attributes.position;var s=this.object.geometry;if(s instanceof i.Geometry){var h=s.vertices;var u=s.faces;var l=0;for(var c=0,f=u.length;c<f;c++){var d=u[c];for(var p=0,m=d.vertexNormals.length;p<m;p++){var v=h[d[n[p]]];var g=d.vertexNormals[p];e.copy(v).applyMatrix4(a);t.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e);o.setXYZ(l,e.x,e.y,e.z);l=l+1;o.setXYZ(l,t.x,t.y,t.z);l=l+1}}}else if(s instanceof i.BufferGeometry){var y=s.attributes.position;var x=s.attributes.normal;var l=0;for(var p=0,m=y.count;p<m;p++){e.set(y.getX(p),y.getY(p),y.getZ(p)).applyMatrix4(a);t.set(x.getX(p),x.getY(p),x.getZ(p));t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e);o.setXYZ(l,e.x,e.y,e.z);l=l+1;o.setXYZ(l,t.x,t.y,t.z);l=l+1}}o.needsUpdate=true;return this}}();i.WireframeHelper=function(e,t){var r=t!==undefined?t:16777215;i.LineSegments.call(this,new i.WireframeGeometry(e.geometry),new i.LineBasicMaterial({color:r}));this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.WireframeHelper.prototype=Object.create(i.LineSegments.prototype);i.WireframeHelper.prototype.constructor=i.WireframeHelper;i.ImmediateRenderObject=function(e){i.Object3D.call(this);this.material=e;this.render=function(e){}};i.ImmediateRenderObject.prototype=Object.create(i.Object3D.prototype);i.ImmediateRenderObject.prototype.constructor=i.ImmediateRenderObject;i.MorphBlendMesh=function(e,t){i.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var r=this.geometry.morphTargets.length;var n="__default";var a=0;var o=r-1;var s=r/1;this.createAnimation(n,a,o,s);this.setAnimationWeight(n,1)};i.MorphBlendMesh.prototype=Object.create(i.Mesh.prototype);i.MorphBlendMesh.prototype.constructor=i.MorphBlendMesh;i.MorphBlendMesh.prototype.createAnimation=function(e,t,r,n){var i={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=i;this.animationsList.push(i)};i.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/;var r,n={};var i=this.geometry;for(var a=0,o=i.morphTargets.length;a<o;a++){var s=i.morphTargets[a];var h=s.name.match(t);if(h&&h.length>1){var u=h[1];if(!n[u])n[u]={start:Infinity,end:-Infinity};var l=n[u];if(a<l.start)l.start=a;if(a>l.end)l.end=a;if(!r)r=u}}for(var u in n){var l=n[u];this.createAnimation(u,l.start,l.end,e)}this.firstAnimation=r};i.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};i.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};i.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];if(r){r.fps=t;r.duration=(r.end-r.start)/r.fps}};i.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];if(r){r.duration=t;r.fps=(r.end-r.start)/r.duration}};i.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];if(r){r.weight=t}};i.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];if(r){r.time=t}};i.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var r=this.animationsMap[e];if(r){t=r.time}return t};i.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var r=this.animationsMap[e];if(r){t=r.duration}return t};i.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")}};i.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};i.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var n=this.animationsList[t];if(!n.active)continue;var a=n.duration/n.length;n.time+=n.direction*e;if(n.mirroredLoop){if(n.time>n.duration||n.time<0){n.direction*=-1;if(n.time>n.duration){n.time=n.duration;n.directionBackwards=true}if(n.time<0){n.time=0;n.directionBackwards=false}}}else{n.time=n.time%n.duration;if(n.time<0)n.time+=n.duration}var o=n.start+i.Math.clamp(Math.floor(n.time/a),0,n.length-1);var s=n.weight;if(o!==n.currentFrame){this.morphTargetInfluences[n.lastFrame]=0;this.morphTargetInfluences[n.currentFrame]=1*s;this.morphTargetInfluences[o]=0;n.lastFrame=n.currentFrame;n.currentFrame=o}var h=n.time%a/a;if(n.directionBackwards)h=1-h;if(n.currentFrame!==n.lastFrame){this.morphTargetInfluences[n.currentFrame]=h*s;this.morphTargetInfluences[n.lastFrame]=(1-h)*s}else{this.morphTargetInfluences[n.currentFrame]=s}}};if(typeof r!=="undefined"){if(typeof t!=="undefined"&&t.exports){r=t.exports=i}r.THREE=i}else{this["THREE"]=i}},{}],3:[function(e,t,r){"use strict";var n=e("three");var i=e("./passes/copy/CopyPass");var a=e("./Stack");var o=e("./Pass");function s(e,t){var r=e.getPixelRatio();this.width=Math.floor(e.context.canvas.width/r)||1;this.height=Math.floor(e.context.canvas.height/r)||1;this.output=null;this.input=null;this.read=null;this.write=null;this.settings=t||{};this.useRGBA=this.settings.useRGBA||false;this.renderer=e;this.copyPass=new i(this.settings);this.defaultMaterial=new n.MeshBasicMaterial({color:65280,wireframe:false});this.scene=new n.Scene;this.quad=new n.Mesh(new n.PlaneBufferGeometry(1,1),this.defaultMaterial);this.scene.add(this.quad);this.camera=new n.OrthographicCamera(1,1,1,1,-1e4,1e4);this.front=new n.WebGLRenderTarget(1,1,{minFilter:this.settings.minFilter!==undefined?this.settings.minFilter:n.LinearFilter,magFilter:this.settings.magFilter!==undefined?this.settings.magFilter:n.LinearFilter,wrapS:this.settings.wrapS!==undefined?this.settings.wrapS:n.ClampToEdgeWrapping,wrapT:this.settings.wrapT!==undefined?this.settings.wrapT:n.ClampToEdgeWrapping,format:this.useRGBA?n.RGBAFormat:n.RGBFormat,type:this.settings.type!==undefined?this.settings.type:n.UnsignedByteType,stencilBuffer:this.settings.stencilBuffer!==undefined?this.settings.stencilBuffer:true});this.back=this.front.clone();this.startTime=Date.now();this.passes={};this.setSize(this.width,this.height)}t.exports=s;s.prototype.swapBuffers=function(){this.output=this.write;this.input=this.read;var e=this.write;this.write=this.read;this.read=e};s.prototype.render=function(e,t,r,n){if(r)this.swapBuffers();this.renderer.render(e,t,n?n:this.write,true);if(!n)this.swapBuffers()};s.prototype.toScreen=function(){this.quad.material=this.copyPass.shader;this.quad.material.uniforms.tInput.value=this.read;this.quad.material.uniforms.resolution.value.set(this.width,this.height);this.renderer.render(this.scene,this.camera)};s.prototype.toTexture=function(e){this.quad.material=this.copyPass.shader;this.quad.material.uniforms.tInput.value=this.read;this.renderer.render(this.scene,this.camera,e,false)};s.prototype.pass=function(e){if(e instanceof a){this.passStack(e)}else{if(e instanceof n.ShaderMaterial){this.quad.material=e}if(e instanceof o){e.run(this);return}if(!e.isSim){this.quad.material.uniforms.tInput.value=this.read}this.quad.material.uniforms.resolution.value.set(this.width,this.height);this.quad.material.uniforms.time.value=.001*(Date.now()-this.startTime);this.renderer.render(this.scene,this.camera,this.write,false);this.swapBuffers()}};s.prototype.passStack=function(e){e.getPasses().forEach(function(e){this.pass(e)}.bind(this))};s.prototype.reset=function(){this.read=this.front;this.write=this.back;this.output=this.write;this.input=this.read};s.prototype.setSource=function(e){this.quad.material=this.copyPass.shader;this.quad.material.uniforms.tInput.value=e;this.renderer.render(this.scene,this.camera,this.write,true);this.swapBuffers()};s.prototype.setSize=function(e,t){this.width=e;this.height=t;this.camera.projectionMatrix.makeOrthographic(e/-2,e/2,t/2,t/-2,this.camera.near,this.camera.far);this.quad.scale.set(e,t,1);var r=this.front.clone();r.width=e;r.height=t;if(this.quad.material instanceof o){this.quad.material.uniforms.tInput.value=r}this.front=r;r=this.back.clone();r.width=e;r.height=t;this.back=r}},{"./Pass":4,"./Stack":5,"./passes/copy/CopyPass":11,three:2}],4:[function(e,t,r){"use strict";var n=e("three");var i=e("./utils/processShader");function a(){this.shader=null;this.loaded=null;this.params={};this.isSim=false}t.exports=a;a.prototype.setShader=function(e,t){this.shader=i(e,t)};a.prototype.run=function(e){e.pass(this.shader)};a.prototype.getOfflineTexture=function(e,t,r){return new n.WebGLRenderTarget(e,t,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:r?n.RGBAFormat:n.RGBFormat})}},{"./utils/processShader":14,three:2}],5:[function(e,t,r){"use strict";function n(e){this.passItems=[];this.shadersPool=e;this.passes=[]}t.exports=n;n.prototype.addPass=function(e,t,r,n){var i=0;var a={shaderName:e,enabled:t||false};this.passItems.push(a);i=this.passItems.length;this.updatePasses();if(n){return this.movePassToIndex(this.passItems[i],n)}else{return i-1}};n.prototype.removePass=function(e){this.passItems.splice(e,1);this.updatePasses()};n.prototype.enablePass=function(e){this.passItems[e].enabled=true;this.updatePasses()};n.prototype.disablePass=function(e){this.passItems[e].enabled=false;this.updatePasses()};n.prototype.isPassEnabled=function(e){return this.passItems[e].enabled};n.prototype.movePassToIndex=function(e,t){this.passItems.splice(t,0,this.passItems.splice(e,1)[0]);this.updatePasses();return t};n.prototype.reverse=function(){this.passItems.reverse();this.updatePasses()};n.prototype.updatePasses=function(){this.passes=this.shadersPool.getPasses(this.passItems);this.passItems.forEach(function(e,t){if(e.params===undefined){e.params=JSON.parse(JSON.stringify(this.passes[t].params))}}.bind(this))};n.prototype.getPasses=function(){return this.passes}},{}],6:[function(e,t,r){"use strict";var n=e("three");var i=e("../../Pass");var a="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var o="#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform sampler2D tInput2;\nuniform vec2 resolution;\nuniform vec2 resolution2;\nuniform float aspectRatio;\nuniform float aspectRatio2;\nuniform int mode;\nuniform int sizeMode;\nuniform float opacity;\n\nvec2 vUv2;\n\nfloat applyOverlayToChannel( float base, float blend ) {\n\n  return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n\n}\n\nfloat applySoftLightToChannel( float base, float blend ) {\n\n  return ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)));\n\n}\n\nfloat applyColorBurnToChannel( float base, float blend ) {\n\n  return ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0));\n\n}\n\nfloat applyColorDodgeToChannel( float base, float blend ) {\n\n  return ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0));\n\n}\n\nfloat applyLinearBurnToChannel( float base, float blend ) {\n\n  return max(base + blend - 1., 0.0 );\n\n}\n\nfloat applyLinearDodgeToChannel( float base, float blend ) {\n\n  return min( base + blend, 1. );\n\n}\n\nfloat applyLinearLightToChannel( float base, float blend ) {\n\n  return ( blend < .5 ) ? applyLinearBurnToChannel( base, 2. * blend ) : applyLinearDodgeToChannel( base, 2. * ( blend - .5 ) );\n\n}\n\nvoid main() {\n\n  vUv2 = vUv;\n  \n  if( sizeMode == 1 ) {\n    \n    if( aspectRatio2 > aspectRatio ) {\n      vUv2.x = vUv.x * aspectRatio / aspectRatio2;\n      vUv2.x += .5 * ( 1. - aspectRatio / aspectRatio2 ); \n      vUv2.y = vUv.y;\n    }\n\n    if( aspectRatio2 < aspectRatio ) {\n      vUv2.x = vUv.x;\n      vUv2.y = vUv.y * aspectRatio2 / aspectRatio;\n      vUv2.y += .5 * ( 1. - aspectRatio2 / aspectRatio );\n    }\n\n  }\n\n  vec4 base = texture2D( tInput, vUv );\n  vec4 blend = texture2D( tInput2, vUv2 );\n\n  if( mode == 1 ) { // normal\n\n    gl_FragColor = base;\n    gl_FragColor.a *= opacity;\n    return;\n\n  }\n\n  if( mode == 2 ) { // dissolve\n\n  }\n\n  if( mode == 3 ) { // darken\n\n    gl_FragColor = min( base, blend );\n    return;\n\n  }\n\n  if( mode == 4 ) { // multiply\n\n    gl_FragColor = base * blend;\n    return;\n\n  }\n\n  if( mode == 5 ) { // color burn\n\n    gl_FragColor = vec4(\n      applyColorBurnToChannel( base.r, blend.r ),\n      applyColorBurnToChannel( base.g, blend.g ),\n      applyColorBurnToChannel( base.b, blend.b ),\n      applyColorBurnToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 6 ) { // linear burn\n\n    gl_FragColor = max(base + blend - 1.0, 0.0);\n    return;\n\n  }\n\n  if( mode == 7 ) { // darker color\n\n  }\n\n  if( mode == 8 ) { // lighten\n\n    gl_FragColor = max( base, blend );\n    return;\n\n  }\n\n  if( mode == 9 ) { // screen\n\n    gl_FragColor = (1.0 - ((1.0 - base) * (1.0 - blend)));\n    gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n    return;\n\n  }\n\n  if( mode == 10 ) { // color dodge\n\n    gl_FragColor = vec4(\n      applyColorDodgeToChannel( base.r, blend.r ),\n      applyColorDodgeToChannel( base.g, blend.g ),\n      applyColorDodgeToChannel( base.b, blend.b ),\n      applyColorDodgeToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 11 ) { // linear dodge\n\n    gl_FragColor = min(base + blend, 1.0);\n    return;\n\n  }\n\n  if( mode == 12 ) { // lighter color\n\n  }\n\n  if( mode == 13 ) { // overlay\n\n    gl_FragColor = gl_FragColor = vec4( \n      applyOverlayToChannel( base.r, blend.r ),\n      applyOverlayToChannel( base.g, blend.g ),\n      applyOverlayToChannel( base.b, blend.b ),\n      applyOverlayToChannel( base.a, blend.a )\n    );\n    gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n  \n    return;\n\n  }\n\n  if( mode == 14 ) { // soft light\n\n    gl_FragColor = vec4( \n      applySoftLightToChannel( base.r, blend.r ),\n      applySoftLightToChannel( base.g, blend.g ),\n      applySoftLightToChannel( base.b, blend.b ),\n      applySoftLightToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 15 ) { // hard light\n\n    gl_FragColor = vec4( \n      applyOverlayToChannel( base.r, blend.r ),\n      applyOverlayToChannel( base.g, blend.g ),\n      applyOverlayToChannel( base.b, blend.b ),\n      applyOverlayToChannel( base.a, blend.a )\n    );\n    gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n    return;\n\n  }\n\n  if( mode == 16 ) { // vivid light\n\n  }\n\n  if( mode == 17 ) { // linear light\n\n    gl_FragColor = vec4( \n      applyLinearLightToChannel( base.r, blend.r ),\n      applyLinearLightToChannel( base.g, blend.g ),\n      applyLinearLightToChannel( base.b, blend.b ),\n      applyLinearLightToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 18 ) { // pin light\n\n  }\n\n  if( mode == 19 ) { // hard mix\n\n  }\n\n  if( mode == 20 ) { // difference\n\n    gl_FragColor = abs( base - blend );\n    gl_FragColor.a = base.a + blend.b;\n    return;\n\n  }\n\n  if( mode == 21 ) { // exclusion\n\n    gl_FragColor = base + blend - 2. * base * blend;\n    \n  }\n\n  if( mode == 22 ) { // substract\n\n  }\n\n  if( mode == 23 ) { // divide\n\n  }\n\n  gl_FragColor = vec4( 1., 0., 1., 1. );\n\n}";function s(e){i.call(this);e=e||{};this.setShader(a,o);this.params.mode=e.mode||1;this.params.opacity=e.opacity||1;this.params.tInput2=e.tInput2||null;this.params.resolution2=e.resolution2||new n.Vector2;this.params.sizeMode=e.sizeMode||1;this.params.aspectRatio=e.aspectRatio||1;this.params.aspectRatio2=e.aspectRatio2||1}t.exports=s;s.prototype=Object.create(i.prototype);s.prototype.constructor=s;s.prototype.run=function(e){this.shader.uniforms.mode.value=this.params.mode;this.shader.uniforms.opacity.value=this.params.opacity;this.shader.uniforms.tInput2.value=this.params.tInput2;this.shader.uniforms.sizeMode.value=this.params.sizeMode;this.shader.uniforms.aspectRatio.value=this.params.aspectRatio;this.shader.uniforms.aspectRatio2.value=this.params.aspectRatio2;e.pass(this.shader)}},{"../../Pass":4,three:2}],7:[function(e,t,r){"use strict";var n=e("three");var i=e("../../Pass");var a=e("../../Composer");var o=e("../../..").BlendMode;var s=e("../box-blur/FullBoxBlurPass");var h=e("../blend/BlendPass");var u=e("../zoom-blur/ZoomBlurPass");var l=e("../brightness-contrast/BrightnessContrastPass");function c(e){i.call(this);e=e||{};this.composer=null;this.tmpTexture=this.getOfflineTexture(e.width,e.height,true);this.blurPass=new s(2);this.blendPass=new h;this.zoomBlur=new u;this.brightnessContrastPass=new l;this.width=e.width||512;this.height=e.height||512;this.params.blurAmount=e.blurAmount||2;this.params.applyZoomBlur=e.applyZoomBlur||false;this.params.zoomBlurStrength=e.zoomBlurStrength||.2;this.params.useTexture=e.useTexture||false;this.params.zoomBlurCenter=e.zoomBlurCenter||new n.Vector2(.5,.5);this.params.blendMode=e.blendMode||o.Screen;this.params.glowTexture=null}t.exports=c;c.prototype=Object.create(i.prototype);c.prototype.constructor=c;
c.prototype.run=function(e){if(!this.composer){this.composer=new a(e.renderer,{useRGBA:true});this.composer.setSize(this.width,this.height)}this.composer.reset();if(this.params.useTexture===true){this.composer.setSource(this.params.glowTexture)}else{this.composer.setSource(e.output)}this.blurPass.params.amount=this.params.blurAmount;this.composer.pass(this.blurPass);if(this.params.applyZoomBlur){this.zoomBlur.params.center.set(.5,.5);this.zoomBlur.params.strength=this.params.zoomBlurStrength;this.composer.pass(this.zoomBlur)}if(this.params.useTexture===true){this.blendPass.params.mode=o.Screen;this.blendPass.params.tInput=this.params.glowTexture;e.pass(this.blendPass)}this.blendPass.params.mode=this.params.blendMode;this.blendPass.params.tInput2=this.composer.output;e.pass(this.blendPass)}},{"../../..":1,"../../Composer":3,"../../Pass":4,"../blend/BlendPass":6,"../box-blur/FullBoxBlurPass":9,"../brightness-contrast/BrightnessContrastPass":10,"../zoom-blur/ZoomBlurPass":13,three:2}],8:[function(e,t,r){"use strict";var n=e("three");var i=e("../../Pass");var a="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var o="#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 delta;\nuniform vec2 resolution;\n\nvoid main() {\n\n  vec4 sum = vec4( 0. );\n  vec2 inc = delta / resolution;\n\n  sum += texture2D( tInput, ( vUv - inc * 4. ) ) * 0.051;\n  sum += texture2D( tInput, ( vUv - inc * 3. ) ) * 0.0918;\n  sum += texture2D( tInput, ( vUv - inc * 2. ) ) * 0.12245;\n  sum += texture2D( tInput, ( vUv - inc * 1. ) ) * 0.1531;\n  sum += texture2D( tInput, ( vUv + inc * 0. ) ) * 0.1633;\n  sum += texture2D( tInput, ( vUv + inc * 1. ) ) * 0.1531;\n  sum += texture2D( tInput, ( vUv + inc * 2. ) ) * 0.12245;\n  sum += texture2D( tInput, ( vUv + inc * 3. ) ) * 0.0918;\n  sum += texture2D( tInput, ( vUv + inc * 4. ) ) * 0.051;\n\n  gl_FragColor = sum;\n\n}";function s(e,t){i.call(this);this.setShader(a,o);this.params.delta=new n.Vector2(e||0,t||0)}t.exports=s;s.prototype=Object.create(i.prototype);s.prototype.constructor=s;s.prototype.run=function(e){this.shader.uniforms.delta.value.copy(this.params.delta);e.pass(this.shader)}},{"../../Pass":4,three:2}],9:[function(e,t,r){"use strict";var n=e("../../Pass");var i=e("./BoxBlurPass");function a(e){n.call(this);e=e||2;this.boxPass=new i(e,e);this.params.amount=e}t.exports=a;a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.prototype.run=function(e){var t=this.params.amount;this.boxPass.params.delta.set(t,0);e.pass(this.boxPass);this.boxPass.params.delta.set(0,t);e.pass(this.boxPass)}},{"../../Pass":4,"./BoxBlurPass":8}],10:[function(e,t,r){"use strict";var n=e("../../Pass");var i="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var a="#define GLSLIFY 1\nuniform float brightness;\nuniform float contrast;\nuniform sampler2D tInput;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vec3 color = texture2D(tInput, vUv).rgb;\n  vec3 colorContrasted = (color) * contrast;\n  vec3 bright = colorContrasted + vec3(brightness,brightness,brightness);\n  gl_FragColor.rgb = bright;\n  gl_FragColor.a = 1.;\n\n}";function o(e,t){n.call(this);this.setShader(i,a);this.params.brightness=e||1;this.params.contrast=t||1}t.exports=o;o.prototype=Object.create(n.prototype);o.prototype.constructor=o;o.prototype.run=function(e){this.shader.uniforms.brightness.value=this.params.brightness;this.shader.uniforms.contrast.value=this.params.contrast;e.pass(this.shader)}},{"../../Pass":4}],11:[function(e,t,r){"use strict";var n=e("../../Pass");var i="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var a="#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D tInput;\n\nvoid main() {\n  gl_FragColor = texture2D( tInput, vUv );\n\n}";function o(){n.call(this);this.setShader(i,a)}t.exports=o;o.prototype=Object.create(n.prototype);o.prototype.constructor=o},{"../../Pass":4}],12:[function(e,t,r){"use strict";var n=e("../../Pass");var i="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var a="#define GLSLIFY 1\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\n\nvoid main() {\n\n    vec2 res = 1. / resolution;\n\n    vec3 rgbNW = texture2D( tInput, ( vUv.xy + vec2( -1.0, -1.0 ) * res ) ).xyz;\n    vec3 rgbNE = texture2D( tInput, ( vUv.xy + vec2( 1.0, -1.0 ) * res ) ).xyz;\n    vec3 rgbSW = texture2D( tInput, ( vUv.xy + vec2( -1.0, 1.0 ) * res ) ).xyz;\n    vec3 rgbSE = texture2D( tInput, ( vUv.xy + vec2( 1.0, 1.0 ) * res ) ).xyz;\n    vec4 rgbaM  = texture2D( tInput,  vUv.xy  * res );\n    vec3 rgbM  = rgbaM.xyz;\n    vec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n    float lumaNW = dot( rgbNW, luma );\n    float lumaNE = dot( rgbNE, luma );\n    float lumaSW = dot( rgbSW, luma );\n    float lumaSE = dot( rgbSE, luma );\n    float lumaM  = dot( rgbM,  luma );\n    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n\n    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n    dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\n          max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                dir * rcpDirMin)) * res;\n    vec4 rgbA = (1.0/2.0) * (\n    texture2D(tInput,  vUv.xy + dir * (1.0/3.0 - 0.5)) +\n    texture2D(tInput,  vUv.xy + dir * (2.0/3.0 - 0.5)));\n    vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n    texture2D(tInput,  vUv.xy + dir * (0.0/3.0 - 0.5)) +\n    texture2D(tInput,  vUv.xy + dir * (3.0/3.0 - 0.5)));\n    float lumaB = dot(rgbB, vec4(luma, 0.0));\n\n    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\n        gl_FragColor = rgbA;\n    } else {\n        gl_FragColor = rgbB;\n    }\n\n    //gl_FragColor = vec4( texture2D( tInput,vUv ).xyz, 1. );\n}";function o(){n.call(this);this.setShader(i,a)}t.exports=o;o.prototype=Object.create(n.prototype);o.prototype.constructor=o},{"../../Pass":4}],13:[function(e,t,r){"use strict";var n=e("three");var i=e("../../Pass");var a="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var o="#define GLSLIFY 1\nuniform sampler2D tInput;\nuniform vec2 center;\nuniform float strength;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nfloat random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}\n\nvoid main(){\n  vec4 color=vec4(0.0);\n  float total=0.0;\n  vec2 toCenter=center-vUv*resolution;\n  float offset=random(vec3(12.9898,78.233,151.7182),0.0);\n  for(float t=0.0;t<=40.0;t++){\n    float percent=(t+offset)/40.0;\n    float weight=4.0*(percent-percent*percent);\n    vec4 sample=texture2D(tInput,vUv+toCenter*percent*strength/resolution);\n    sample.rgb*=sample.a;\n    color+=sample*weight;\n    total+=weight;\n  }\n  gl_FragColor=color/total;\n  gl_FragColor.rgb/=gl_FragColor.a+0.00001;\n}";function s(e){i.call(this);e=e||{};this.setShader(a,o);this.params.center=new n.Vector2(e.centerX||.5,e.centerY||.5);this.params.strength=e.strength||.1}t.exports=s;s.prototype=Object.create(i.prototype);s.prototype.constructor=s;s.prototype.run=function(e){this.shader.uniforms.center.value.set(e.width*this.params.center.x,e.height*this.params.center.y);this.shader.uniforms.strength.value=this.params.strength;e.pass(this.shader)}},{"../../Pass":4,three:2}],14:[function(e,t,r){"use strict";var n=e("three");t.exports=function i(e,t){var r=/uniform\s+([^\s]+)\s+([^\s]+)\s*;/gi;var i=/uniform\s+([^\s]+)\s+([^\s]+)\s*\[\s*(\w+)\s*\]*\s*;/gi;var a={sampler2D:{type:"t",value:function(){return new n.Texture}},samplerCube:{type:"t",value:function(){}},bool:{type:"b",value:function(){return 0}},"int":{type:"i",value:function(){return 0}},"float":{type:"f",value:function(){return 0}},vec2:{type:"v2",value:function(){return new n.Vector2}},vec3:{type:"v3",value:function(){return new n.Vector3}},vec4:{type:"v4",value:function(){return new n.Vector4}},bvec2:{type:"v2",value:function(){return new n.Vector2}},bvec3:{type:"v3",value:function(){return new n.Vector3}},bvec4:{type:"v4",value:function(){return new n.Vector4}},ivec2:{type:"v2",value:function(){return new n.Vector2}},ivec3:{type:"v3",value:function(){return new n.Vector3}},ivec4:{type:"v4",value:function(){return new n.Vector4}},mat2:{type:"v2",value:function(){return new n.Matrix2}},mat3:{type:"v3",value:function(){return new n.Matrix3}},mat4:{type:"v4",value:function(){return new n.Matrix4}}};var o={"float":{type:"fv",value:function(){return[]}},vec3:{type:"v3v",value:function(){return[]}}};var s;var h={resolution:{type:"v2",value:new n.Vector2(1,1),"default":true},time:{type:"f",value:Date.now(),"default":true},tInput:{type:"t",value:new n.Texture,"default":true}};var u,l,c;while((s=r.exec(t))!==null){if(s.index===r.lastIndex){r.lastIndex++}u=s[1];l=s[2];h[l]={type:a[u].type,value:a[u].value()}}while((s=i.exec(t))!==null){if(s.index===r.lastIndex){r.lastIndex++}u=s[1];l=s[2];c=s[3];h[l]={type:o[u].type,value:o[u].value()}}var f=new n.ShaderMaterial({uniforms:h,vertexShader:e,fragmentShader:t,shading:n.FlatShading,depthWrite:false,depthTest:false,transparent:true});return f}},{three:2}],15:[function(e,t,r){"use strict";var n=e("component-emitter");var i=e("debounce");var a=t.exports;n(a);a.debounceDelay=50;a.onGlobalResize=function(){this.width=window.innerWidth;this.height=window.innerHeight;this.halfWidth=.5*this.width;this.halfHeight=.5*this.height;this.applyResize();if(this.debounceDelay>0){this.debounceResize()}else{this.applyResizeDebounce()}};a.applyResizeDebounce=function(){this.emit("resizeDebounce")};a.applyResize=function(){this.emit("resize")};a.addListener=function(e,t){this.on(t?"resize":"resizeDebounce",e)};a.removeListener=function(e){if(e){this.off("resize",e);this.off("resizeDebounce",e)}};a.debounceResize=i(a.applyResizeDebounce.bind(a),a.debounceDelay);a.onGlobalResize();window.addEventListener("resize",a.onGlobalResize.bind(a))},{"component-emitter":16,debounce:17}],16:[function(e,t,r){t.exports=n;function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],17:[function(e,t,r){var n=e("date-now");t.exports=function i(e,t,r){var i,a,o,s,h;if(null==t)t=100;function u(){var l=n()-s;if(l<t&&l>0){i=setTimeout(u,t-l)}else{i=null;if(!r){h=e.apply(o,a);if(!i)o=a=null}}}return function l(){o=this;a=arguments;s=n();var l=r&&!i;if(!i)i=setTimeout(u,t);if(l){h=e.apply(o,a);o=a=null}return h}}},{"date-now":18}],18:[function(e,t,r){t.exports=Date.now||n;function n(){return(new Date).getTime()}},{}],19:[function(e,t,r){var n=t.exports={};var i=[];var a=false;function o(){if(a){return}a=true;var e;var t=i.length;while(t){e=i;i=[];var r=-1;while(++r<t){e[r]()}t=i.length}a=false}n.nextTick=function(e){i.push(e);if(!a){setTimeout(o,0)}};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function s(){}n.on=s;n.addListener=s;n.once=s;n.off=s;n.removeListener=s;n.removeAllListeners=s;n.emit=s;n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],20:[function(e,t,r){t.exports=e("./vendor/dat.gui");t.exports.color=e("./vendor/dat.color")},{"./vendor/dat.color":21,"./vendor/dat.gui":22}],21:[function(e,t,r){var n=t.exports=n||{};n.color=n.color||{};n.utils=n.utils||{};n.utils.common=function(){var e=Array.prototype.forEach;var t=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(!this.isUndefined(t[r]))e[r]=t[r]},this);return e},defaults:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(this.isUndefined(e[r]))e[r]=t[r]},this);return e},compose:function(){var e=t.call(arguments);return function(){var r=t.call(arguments);for(var n=e.length-1;n>=0;n--){r=[e[n].apply(this,r)]}return r[0]}},each:function(t,r,n){if(e&&t.forEach===e){t.forEach(r,n)}else if(t.length===t.length+0){for(var i=0,a=t.length;i<a;i++)if(i in t&&r.call(n,t[i],i)===this.BREAK)return}else{for(var i in t)if(r.call(n,t[i],i)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},toArray:function(e){if(e.toArray)return e.toArray();return t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===false||e===true},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}();n.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var r=t.hex.toString(16);while(r.length<6){r="0"+r}return"#"+r}else{return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}}(n.utils.common);n.Color=n.color.Color=function(e,t,r,n){var i=function(){this.__state=e.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};i.COMPONENTS=["r","g","b","h","s","v","hex","a"];n.extend(i.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(i.prototype,"r",2);a(i.prototype,"g",1);a(i.prototype,"b",0);o(i.prototype,"h");o(i.prototype,"s");o(i.prototype,"v");Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(i.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(e){this.__state.space="HEX";this.__state.hex=e}});function a(e,t,r){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="RGB"){return this.__state[t]}s(this,t,r);return this.__state[t]},set:function(e){if(this.__state.space!=="RGB"){s(this,t,r);this.__state.space="RGB"}this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="HSV")return this.__state[t];h(this);return this.__state[t]},set:function(e){if(this.__state.space!=="HSV"){h(this);this.__state.space="HSV"}this.__state[t]=e}})}function s(e,r,i){if(e.__state.space==="HEX"){e.__state[r]=t.component_from_hex(e.__state.hex,i)}else if(e.__state.space==="HSV"){n.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}else{throw"Corrupted color state"}}function h(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:r.s,v:r.v});if(!n.isNaN(r.h)){e.__state.h=r.h}else if(n.isUndefined(e.__state.h)){e.__state.h=0}}return i}(n.color.interpret=function(e,t){var r,n;var i=function(){n=false;var e=arguments.length>1?t.toArray(arguments):arguments[0];t.each(a,function(i){if(i.litmus(e)){t.each(i.conversions,function(i,a){r=i.read(e);if(n===false&&r!==false){n=r;r.conversionName=a;r.conversion=i;return t.BREAK}});return t.BREAK}});return n};var a=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){if(e.length!=3)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){if(e.length!=4)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)){return{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)){return{space:"RGB",r:e.r,g:e.g,b:e.b}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)){return{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)){return{space:"HSV",h:e.h,s:e.s,v:e.v}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return i}(n.color.toString,n.utils.common),n.color.math=function(){var e;return{hsv_to_rgb:function(e,t,r){var n=Math.floor(e/60)%6;var i=e/60-Math.floor(e/60);var a=r*(1-t);var o=r*(1-i*t);var s=r*(1-(1-i)*t);var h=[[r,s,a],[o,r,a],[a,r,s],[a,o,r],[s,a,r],[r,a,o]][n];return{r:h[0]*255,g:h[1]*255,b:h[2]*255}},rgb_to_hsv:function(e,t,r){var n=Math.min(e,t,r),i=Math.max(e,t,r),a=i-n,o,s;if(i!=0){s=a/i}else{return{h:NaN,s:0,v:0}}if(e==i){o=(t-r)/a}else if(t==i){o=2+(r-e)/a}else{o=4+(e-t)/a}o/=6;if(o<0){o+=1}return{h:o*360,s:s,v:i/255}},rgb_to_hex:function(e,t,r){var n=this.hex_with_component(0,2,e);n=this.hex_with_component(n,1,t);n=this.hex_with_component(n,0,r);return n},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,r,n){return n<<(e=r*8)|t&~(255<<e)}}}(),n.color.toString,n.utils.common)},{}],22:[function(e,t,r){var n=t.exports=n||{};n.gui=n.gui||{};n.utils=n.utils||{};n.controllers=n.controllers||{};n.dom=n.dom||{};n.color=n.color||{};n.utils.css=function(){return{load:function(e,t){t=t||document;var r=t.createElement("link");r.type="text/css";r.rel="stylesheet";r.href=e;t.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){t=t||document;var r=document.createElement("style");r.type="text/css";r.innerHTML=e;t.getElementsByTagName("head")[0].appendChild(r)}}}();n.utils.common=function(){var e=Array.prototype.forEach;var t=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(!this.isUndefined(t[r]))e[r]=t[r]},this);return e},defaults:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(this.isUndefined(e[r]))e[r]=t[r]},this);return e},compose:function(){var e=t.call(arguments);return function(){var r=t.call(arguments);for(var n=e.length-1;n>=0;n--){r=[e[n].apply(this,r)]}return r[0]}},each:function(t,r,n){if(e&&t.forEach===e){t.forEach(r,n)}else if(t.length===t.length+0){for(var i=0,a=t.length;i<a;i++)if(i in t&&r.call(n,t[i],i)===this.BREAK)return}else{for(var i in t)if(r.call(n,t[i],i)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},toArray:function(e){if(e.toArray)return e.toArray();return t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===false||e===true},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}();n.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t];this.domElement=document.createElement("div");this.object=e;this.property=t;this.__onChange=undefined;this.__onFinishChange=undefined};e.extend(t.prototype,{onChange:function(e){this.__onChange=e;return this},onFinishChange:function(e){this.__onFinishChange=e;return this},setValue:function(e){this.object[this.property]=e;if(this.__onChange){this.__onChange.call(this,e)}this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return t}(n.utils.common);n.dom.dom=function(e){var t={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]};var r={};e.each(t,function(t,n){e.each(t,function(e){r[e]=n})});var n=/(\d+(\.\d+)?)px/;function i(t){if(t==="0"||e.isUndefined(t))return 0;var r=t.match(n);if(!e.isNull(r)){return parseFloat(r[1])}return 0}var a={makeSelectable:function(e,t){if(e===undefined||e.style===undefined)return;e.onselectstart=t?function(){return false}:function(){};e.style.MozUserSelect=t?"auto":"none";e.style.KhtmlUserSelect=t?"auto":"none";e.unselectable=t?"on":"off"},makeFullscreen:function(t,r,n){if(e.isUndefined(r))r=true;if(e.isUndefined(n))n=true;t.style.position="absolute";if(r){t.style.left=0;t.style.right=0}if(n){t.style.top=0;t.style.bottom=0}},fakeEvent:function(t,n,i,a){i=i||{};var o=r[n];if(!o){throw new Error("Event type "+n+" not supported.")}var s=document.createEvent(o);switch(o){case"MouseEvents":var h=i.x||i.clientX||0;var u=i.y||i.clientY||0;s.initMouseEvent(n,i.bubbles||false,i.cancelable||true,window,i.clickCount||1,0,0,h,u,false,false,false,false,0,null);break;case"KeyboardEvents":var l=s.initKeyboardEvent||s.initKeyEvent;e.defaults(i,{cancelable:true,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:undefined,charCode:undefined});l(n,i.bubbles||false,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(n,i.bubbles||false,i.cancelable||true);break}e.defaults(s,a);t.dispatchEvent(s)},bind:function(e,t,r,n){n=n||false;if(e.addEventListener)e.addEventListener(t,r,n);else if(e.attachEvent)e.attachEvent("on"+t,r);return a},unbind:function(e,t,r,n){n=n||false;if(e.removeEventListener)e.removeEventListener(t,r,n);else if(e.detachEvent)e.detachEvent("on"+t,r);return a},addClass:function(e,t){if(e.className===undefined){e.className=t}else if(e.className!==t){var r=e.className.split(/ +/);if(r.indexOf(t)==-1){r.push(t);e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}}return a},removeClass:function(e,t){if(t){if(e.className===undefined){}else if(e.className===t){e.removeAttribute("class")}else{var r=e.className.split(/ +/);var n=r.indexOf(t);if(n!=-1){r.splice(n,1);e.className=r.join(" ")}}}else{e.className=undefined}return a},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||false},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t["width"])},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t["height"])},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent){do{t.left+=e.offsetLeft;t.top+=e.offsetTop}while(e=e.offsetParent)}return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return a}(n.utils.common);n.controllers.OptionController=function(e,t,r){var n=function(e,i,a){n.superclass.call(this,e,i);var o=this;this.__select=document.createElement("select");if(r.isArray(a)){var s={};r.each(a,function(e){s[e]=e});a=s}r.each(a,function(e,t){var r=document.createElement("option");r.innerHTML=t;r.setAttribute("value",e);o.__select.appendChild(r)});this.updateDisplay();t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)});this.domElement.appendChild(this.__select)};n.superclass=e;r.extend(n.prototype,e.prototype,{setValue:function(e){var t=n.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}return t},updateDisplay:function(){this.__select.value=this.getValue();return n.superclass.prototype.updateDisplay.call(this)}});return n}(n.controllers.Controller,n.dom.dom,n.utils.common);n.controllers.NumberController=function(e,t){var r=function(e,i,a){r.superclass.call(this,e,i);a=a||{};this.__min=a.min;this.__max=a.max;this.__step=a.step;if(t.isUndefined(this.__step)){if(this.initialValue==0){this.__impliedStep=1}else{this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10}}else{this.__impliedStep=this.__step}this.__precision=n(this.__impliedStep)};r.superclass=e;t.extend(r.prototype,e.prototype,{setValue:function(e){if(this.__min!==undefined&&e<this.__min){e=this.__min}else if(this.__max!==undefined&&e>this.__max){e=this.__max}if(this.__step!==undefined&&e%this.__step!=0){e=Math.round(e/this.__step)*this.__step}return r.superclass.prototype.setValue.call(this,e)},min:function(e){this.__min=e;return this},max:function(e){this.__max=e;return this},step:function(e){this.__step=e;return this}});function n(e){e=e.toString();if(e.indexOf(".")>-1){return e.length-e.indexOf(".")-1}else{return 0}}return r}(n.controllers.Controller,n.utils.common);n.controllers.NumberControllerBox=function(e,t,r){var n=function(e,i,a){this.__truncationSuspended=false;n.superclass.call(this,e,i,a);var o=this;var s;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"change",h);t.bind(this.__input,"blur",u);t.bind(this.__input,"mousedown",l);t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){o.__truncationSuspended=true;this.blur();o.__truncationSuspended=false}});function h(){var e=parseFloat(o.__input.value);if(!r.isNaN(e))o.setValue(e)}function u(){h();if(o.__onFinishChange){o.__onFinishChange.call(o,o.getValue())}}function l(e){t.bind(window,"mousemove",c);t.bind(window,"mouseup",f);s=e.clientY}function c(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep);s=e.clientY}function f(){t.unbind(window,"mousemove",c);t.unbind(window,"mouseup",f)}this.updateDisplay();this.domElement.appendChild(this.__input)};n.superclass=e;r.extend(n.prototype,e.prototype,{updateDisplay:function(){this.__input.value=this.__truncationSuspended?this.getValue():i(this.getValue(),this.__precision);return n.superclass.prototype.updateDisplay.call(this)}});function i(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}return n}(n.controllers.NumberController,n.dom.dom,n.utils.common);n.controllers.NumberControllerSlider=function(e,t,r,n,i){var a=function(e,r,n,i,s){a.superclass.call(this,e,r,{min:n,max:i,step:s});var h=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");t.bind(this.__background,"mousedown",u);t.addClass(this.__background,"slider");t.addClass(this.__foreground,"slider-fg");function u(e){t.bind(window,"mousemove",l);t.bind(window,"mouseup",c);l(e)}function l(e){e.preventDefault();var r=t.getOffset(h.__background);var n=t.getWidth(h.__background);h.setValue(o(e.clientX,r.left,r.left+n,h.__min,h.__max));return false}function c(){t.unbind(window,"mousemove",l);t.unbind(window,"mouseup",c);if(h.__onFinishChange){h.__onFinishChange.call(h,h.getValue())}}this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};a.superclass=e;a.useDefaultStyles=function(){r.inject(i)};n.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=e*100+"%";return a.superclass.prototype.updateDisplay.call(this)}});function o(e,t,r,n,i){return n+(i-n)*((e-t)/(r-t))}return a}(n.controllers.NumberController,n.dom.dom,n.utils.css,n.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");n.controllers.FunctionController=function(e,t,r){var n=function(e,r,i){n.superclass.call(this,e,r);var a=this;this.__button=document.createElement("div");this.__button.innerHTML=i===undefined?"Fire":i;t.bind(this.__button,"click",function(e){e.preventDefault();a.fire();return false});t.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};n.superclass=e;r.extend(n.prototype,e.prototype,{fire:function(){if(this.__onChange){this.__onChange.call(this)}if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.getValue().call(this.object)}});return n}(n.controllers.Controller,n.dom.dom,n.utils.common);n.controllers.BooleanController=function(e,t,r){var n=function(e,r){n.superclass.call(this,e,r);var i=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");t.bind(this.__checkbox,"change",a,false);this.domElement.appendChild(this.__checkbox);this.updateDisplay();function a(){i.setValue(!i.__prev)}};n.superclass=e;r.extend(n.prototype,e.prototype,{setValue:function(e){var t=n.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.__prev=this.getValue();return t},updateDisplay:function(){if(this.getValue()===true){this.__checkbox.setAttribute("checked","checked");this.__checkbox.checked=true}else{this.__checkbox.checked=false}return n.superclass.prototype.updateDisplay.call(this)}});return n}(n.controllers.Controller,n.dom.dom,n.utils.common);n.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var r=t.hex.toString(16);while(r.length<6){r="0"+r}return"#"+r}else{return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")";
}}}(n.utils.common);n.color.interpret=function(e,t){var r,n;var i=function(){n=false;var e=arguments.length>1?t.toArray(arguments):arguments[0];t.each(a,function(i){if(i.litmus(e)){t.each(i.conversions,function(i,a){r=i.read(e);if(n===false&&r!==false){n=r;r.conversionName=a;r.conversion=i;return t.BREAK}});return t.BREAK}});return n};var a=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){if(e.length!=3)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){if(e.length!=4)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)){return{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)){return{space:"RGB",r:e.r,g:e.g,b:e.b}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)){return{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)){return{space:"HSV",h:e.h,s:e.s,v:e.v}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return i}(n.color.toString,n.utils.common);n.GUI=n.gui.GUI=function(e,t,r,n,i,a,o,s,h,u,l,c,f,d,p){e.inject(r);var m="dg";var v=72;var g=20;var y="Default";var x=function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(e){return false}}();var b;var w=true;var _;var M=false;var S=[];var T=function(e){var t=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);d.addClass(this.domElement,m);this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];e=e||{};e=p.defaults(e,{autoPlace:true,width:T.DEFAULT_WIDTH});e=p.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace});if(!p.isUndefined(e.load)){if(e.preset)e.load.preset=e.preset}else{e.load={preset:y}}if(p.isUndefined(e.parent)&&e.hideable){S.push(this)}e.resizable=p.isUndefined(e.parent)&&e.resizable;if(e.autoPlace&&p.isUndefined(e.scrollable)){e.scrollable=true}var r=x&&localStorage.getItem(P(this,"isLocal"))==="true";Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){if(t.parent){return t.getRoot().preset}else{return e.load.preset}},set:function(r){if(t.parent){t.getRoot().preset=r}else{e.load.preset=r}U(this);t.revert()}},width:{get:function(){return e.width},set:function(r){e.width=r;k(t,r)}},name:{get:function(){return e.name},set:function(t){e.name=t;if(i){i.innerHTML=e.name}}},closed:{get:function(){return e.closed},set:function(r){e.closed=r;if(e.closed){d.addClass(t.__ul,T.CLASS_CLOSED)}else{d.removeClass(t.__ul,T.CLASS_CLOSED)}this.onResize();if(t.__closeButton){t.__closeButton.innerHTML=r?T.TEXT_OPEN:T.TEXT_CLOSED}}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return r},set:function(e){if(x){r=e;if(e){d.bind(window,"unload",s)}else{d.unbind(window,"unload",s)}localStorage.setItem(P(t,"isLocal"),e)}}}});if(p.isUndefined(e.parent)){e.closed=false;d.addClass(this.domElement,T.CLASS_MAIN);d.makeSelectable(this.domElement,false);if(x){if(r){t.useLocalStorage=true;var n=localStorage.getItem(P(this,"gui"));if(n){e.load=JSON.parse(n)}}}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=T.TEXT_CLOSED;d.addClass(this.__closeButton,T.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);d.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{if(e.closed===undefined){e.closed=true}var i=document.createTextNode(e.name);d.addClass(i,"controller-name");var a=C(t,i);var o=function(e){e.preventDefault();t.closed=!t.closed;return false};d.addClass(this.__ul,T.CLASS_CLOSED);d.addClass(a,"title");d.bind(a,"click",o);if(!e.closed){this.closed=false}}if(e.autoPlace){if(p.isUndefined(e.parent)){if(w){_=document.createElement("div");d.addClass(_,m);d.addClass(_,T.CLASS_AUTO_PLACE_CONTAINER);document.body.appendChild(_);w=false}_.appendChild(this.domElement);d.addClass(this.domElement,T.CLASS_AUTO_PLACE)}if(!this.parent)k(t,e.width)}d.bind(window,"resize",function(){t.onResize()});d.bind(this.__ul,"webkitTransitionEnd",function(){t.onResize()});d.bind(this.__ul,"transitionend",function(){t.onResize()});d.bind(this.__ul,"oTransitionEnd",function(){t.onResize()});this.onResize();if(e.resizable){D(this)}function s(){localStorage.setItem(P(t,"gui"),JSON.stringify(t.getSaveObject()))}var h=t.getRoot();function u(){var e=t.getRoot();e.width+=1;p.defer(function(){e.width-=1})}if(!e.parent){u()}};T.toggleHide=function(){M=!M;p.each(S,function(e){e.domElement.style.zIndex=M?-999:999;e.domElement.style.opacity=M?0:1})};T.CLASS_AUTO_PLACE="a";T.CLASS_AUTO_PLACE_CONTAINER="ac";T.CLASS_MAIN="main";T.CLASS_CONTROLLER_ROW="cr";T.CLASS_TOO_TALL="taller-than-window";T.CLASS_CLOSED="closed";T.CLASS_CLOSE_BUTTON="close-button";T.CLASS_DRAG="drag";T.DEFAULT_WIDTH=245;T.TEXT_CLOSED="Close Controls";T.TEXT_OPEN="Open Controls";d.bind(window,"keydown",function(e){if(document.activeElement.type!=="text"&&(e.which===v||e.keyCode==v)){T.toggleHide()}},false);p.extend(T.prototype,{add:function(e,t){return E(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return E(this,e,t,{color:true})},remove:function(e){this.__ul.removeChild(e.__li);this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){if(this.autoPlace){_.removeChild(this.domElement)}},addFolder:function(e){if(this.__folders[e]!==undefined){throw new Error("You already have a folder in this GUI by the"+' name "'+e+'"')}var t={name:e,parent:this};t.autoPlace=this.autoPlace;if(this.load&&this.load.folders&&this.load.folders[e]){t.closed=this.load.folders[e].closed;t.load=this.load.folders[e]}var r=new T(t);this.__folders[e]=r;var n=C(this,r.domElement);d.addClass(n,"folder");return r},open:function(){this.closed=false},close:function(){this.closed=true},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=d.getOffset(e.__ul).top;var r=0;p.each(e.__ul.childNodes,function(t){if(!(e.autoPlace&&t===e.__save_row))r+=d.getHeight(t)});if(window.innerHeight-t-g<r){d.addClass(e.domElement,T.CLASS_TOO_TALL);e.__ul.style.height=window.innerHeight-t-g+"px"}else{d.removeClass(e.domElement,T.CLASS_TOO_TALL);e.__ul.style.height="auto"}}if(e.__resize_handle){p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})}if(e.__closeButton){e.__closeButton.style.width=e.width+"px"}},remember:function(){if(p.isUndefined(b)){b=new f;b.domElement.innerHTML=t}if(this.parent){throw new Error("You can only call remember on a top level GUI.")}var e=this;p.each(Array.prototype.slice.call(arguments),function(t){if(e.__rememberedObjects.length==0){R(e)}if(e.__rememberedObjects.indexOf(t)==-1){e.__rememberedObjects.push(t)}});if(this.autoPlace){k(this,this.width)}},getRoot:function(){var e=this;while(e.parent){e=e.parent}return e},getSaveObject:function(){var e=this.load;e.closed=this.closed;if(this.__rememberedObjects.length>0){e.preset=this.preset;if(!e.remembered){e.remembered={}}e.remembered[this.preset]=F(this)}e.folders={};p.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()});return e},save:function(){if(!this.load.remembered){this.load.remembered={}}this.load.remembered[this.preset]=F(this);B(this,false)},saveAs:function(e){if(!this.load.remembered){this.load.remembered={};this.load.remembered[y]=F(this,true)}this.load.remembered[e]=F(this);this.preset=e;O(this,e,true)},revert:function(e){p.each(this.__controllers,function(t){if(!this.getRoot().load.remembered){t.setValue(t.initialValue)}else{L(e||this.getRoot(),t)}},this);p.each(this.__folders,function(e){e.revert(e)});if(!e){B(this.getRoot(),false)}},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e);if(t)V(this.__listening)}});function E(e,t,r,a){if(t[r]===undefined){throw new Error("Object "+t+' has no property "'+r+'"')}var o;if(a.color){o=new l(t,r)}else{var s=[t,r].concat(a.factoryArgs);o=n.apply(e,s)}if(a.before instanceof i){a.before=a.before.__li}L(e,o);d.addClass(o.domElement,"c");var h=document.createElement("span");d.addClass(h,"property-name");h.innerHTML=o.property;var u=document.createElement("div");u.appendChild(h);u.appendChild(o.domElement);var c=C(e,u,a.before);d.addClass(c,T.CLASS_CONTROLLER_ROW);d.addClass(c,typeof o.getValue());A(e,c,o);e.__controllers.push(o);return o}function C(e,t,r){var n=document.createElement("li");if(t)n.appendChild(t);if(r){e.__ul.insertBefore(n,params.before)}else{e.__ul.appendChild(n)}e.onResize();return n}function A(e,t,r){r.__li=t;r.__gui=e;p.extend(r,{options:function(t){if(arguments.length>1){r.remove();return E(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[p.toArray(arguments)]})}if(p.isArray(t)||p.isObject(t)){r.remove();return E(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[t]})}},name:function(e){r.__li.firstElementChild.firstElementChild.innerHTML=e;return r},listen:function(){r.__gui.listen(r);return r},remove:function(){r.__gui.remove(r);return r}});if(r instanceof h){var n=new s(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});p.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=r[e];var i=n[e];r[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);t.apply(r,e);return i.apply(n,e)}});d.addClass(t,"has-slider");r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof s){var i=function(t){if(p.isNumber(r.__min)&&p.isNumber(r.__max)){r.remove();return E(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]})}return t};r.min=p.compose(i,r.min);r.max=p.compose(i,r.max)}else if(r instanceof a){d.bind(t,"click",function(){d.fakeEvent(r.__checkbox,"click")});d.bind(r.__checkbox,"click",function(e){e.stopPropagation()})}else if(r instanceof o){d.bind(t,"click",function(){d.fakeEvent(r.__button,"click")});d.bind(t,"mouseover",function(){d.addClass(r.__button,"hover")});d.bind(t,"mouseout",function(){d.removeClass(r.__button,"hover")})}else if(r instanceof l){d.addClass(t,"color");r.updateDisplay=p.compose(function(e){t.style.borderLeftColor=r.__color.toString();return e},r.updateDisplay);r.updateDisplay()}r.setValue=p.compose(function(t){if(e.getRoot().__preset_select&&r.isModified()){B(e.getRoot(),true)}return t},r.setValue)}function L(e,t){var r=e.getRoot();var n=r.__rememberedObjects.indexOf(t.object);if(n!=-1){var i=r.__rememberedObjectIndecesToControllers[n];if(i===undefined){i={};r.__rememberedObjectIndecesToControllers[n]=i}i[t.property]=t;if(r.load&&r.load.remembered){var a=r.load.remembered;var o;if(a[e.preset]){o=a[e.preset]}else if(a[y]){o=a[y]}else{return}if(o[n]&&o[n][t.property]!==undefined){var s=o[n][t.property];t.initialValue=s;t.setValue(s)}}}}function P(e,t){return document.location.href+"."+t}function R(e){var t=e.__save_row=document.createElement("li");d.addClass(e.domElement,"has-save");e.__ul.insertBefore(t,e.__ul.firstChild);d.addClass(t,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;";d.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save";d.addClass(n,"button");d.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New";d.addClass(i,"button");d.addClass(i,"save-as");var a=document.createElement("span");a.innerHTML="Revert";d.addClass(a,"button");d.addClass(a,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered){p.each(e.load.remembered,function(t,r){O(e,r,r==e.preset)})}else{O(e,y,false)}d.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++){e.__preset_select[t].innerHTML=e.__preset_select[t].value}e.preset=this.value});t.appendChild(o);t.appendChild(r);t.appendChild(n);t.appendChild(i);t.appendChild(a);if(x){var s=document.getElementById("dg-save-locally");var h=document.getElementById("dg-local-explain");s.style.display="block";var u=document.getElementById("dg-local-storage");if(localStorage.getItem(P(e,"isLocal"))==="true"){u.setAttribute("checked","checked")}function l(){h.style.display=e.useLocalStorage?"block":"none"}l();d.bind(u,"change",function(){e.useLocalStorage=!e.useLocalStorage;l()})}var c=document.getElementById("dg-new-constructor");d.bind(c,"keydown",function(e){if(e.metaKey&&(e.which===67||e.keyCode==67)){b.hide()}});d.bind(r,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),undefined,2);b.show();c.focus();c.select()});d.bind(n,"click",function(){e.save()});d.bind(i,"click",function(){var t=prompt("Enter a new preset name.");if(t)e.saveAs(t)});d.bind(a,"click",function(){e.revert()})}function D(e){e.__resize_handle=document.createElement("div");p.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var t;d.bind(e.__resize_handle,"mousedown",r);d.bind(e.__closeButton,"mousedown",r);e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild);function r(r){r.preventDefault();t=r.clientX;d.addClass(e.__closeButton,T.CLASS_DRAG);d.bind(window,"mousemove",n);d.bind(window,"mouseup",i);return false}function n(r){r.preventDefault();e.width+=t-r.clientX;e.onResize();t=r.clientX;return false}function i(){d.removeClass(e.__closeButton,T.CLASS_DRAG);d.unbind(window,"mousemove",n);d.unbind(window,"mouseup",i)}}function k(e,t){e.domElement.style.width=t+"px";if(e.__save_row&&e.autoPlace){e.__save_row.style.width=t+"px"}if(e.__closeButton){e.__closeButton.style.width=t+"px"}}function F(e,t){var r={};p.each(e.__rememberedObjects,function(n,i){var a={};var o=e.__rememberedObjectIndecesToControllers[i];p.each(o,function(e,r){a[r]=t?e.initialValue:e.getValue()});r[i]=a});return r}function O(e,t,r){var n=document.createElement("option");n.innerHTML=t;n.value=t;e.__preset_select.appendChild(n);if(r){e.__preset_select.selectedIndex=e.__preset_select.length-1}}function U(e){for(var t=0;t<e.__preset_select.length;t++){if(e.__preset_select[t].value==e.preset){e.__preset_select.selectedIndex=t}}}function B(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];if(t){r.innerHTML=r.value+"*"}else{r.innerHTML=r.value}}function V(e){if(e.length!=0){c(function(){V(e)})}p.each(e,function(e){e.updateDisplay()})}return T}(n.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",n.controllers.factory=function(e,t,r,n,i,a,o){return function(s,h){var u=s[h];if(o.isArray(arguments[2])||o.isObject(arguments[2])){return new e(s,h,arguments[2])}if(o.isNumber(u)){if(o.isNumber(arguments[2])&&o.isNumber(arguments[3])){return new r(s,h,arguments[2],arguments[3])}else{return new t(s,h,{min:arguments[2],max:arguments[3]})}}if(o.isString(u)){return new n(s,h)}if(o.isFunction(u)){return new i(s,h,"")}if(o.isBoolean(u)){return new a(s,h)}}}(n.controllers.OptionController,n.controllers.NumberControllerBox,n.controllers.NumberControllerSlider,n.controllers.StringController=function(e,t,r){var n=function(e,r){n.superclass.call(this,e,r);var i=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"keyup",a);t.bind(this.__input,"change",a);t.bind(this.__input,"blur",o);t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){this.blur()}});function a(){i.setValue(i.__input.value)}function o(){if(i.__onFinishChange){i.__onFinishChange.call(i,i.getValue())}}this.updateDisplay();this.domElement.appendChild(this.__input)};n.superclass=e;r.extend(n.prototype,e.prototype,{updateDisplay:function(){if(!t.isActive(this.__input)){this.__input.value=this.getValue()}return n.superclass.prototype.updateDisplay.call(this)}});return n}(n.controllers.Controller,n.dom.dom,n.utils.common),n.controllers.FunctionController,n.controllers.BooleanController,n.utils.common),n.controllers.Controller,n.controllers.BooleanController,n.controllers.FunctionController,n.controllers.NumberControllerBox,n.controllers.NumberControllerSlider,n.controllers.OptionController,n.controllers.ColorController=function(e,t,r,n,i){var a=function(e,o){a.superclass.call(this,e,o);this.__color=new r(this.getValue());this.__temp=new r(0);var u=this;this.domElement=document.createElement("div");t.makeSelectable(this.domElement,false);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){d.call(this)}});t.bind(this.__input,"blur",d);t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(u.__selector,"drag")})});var l=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});i.extend(l.style,{width:"100%",height:"100%",background:"none"});s(l,"top","rgba(0,0,0,0)","#000");i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});h(this.__hue_field);i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});t.bind(this.__saturation_field,"mousedown",c);t.bind(this.__field_knob,"mousedown",c);t.bind(this.__hue_field,"mousedown",function(e){v(e);t.bind(window,"mousemove",v);t.bind(window,"mouseup",p)});function c(e){m(e);t.bind(window,"mousemove",m);t.bind(window,"mouseup",f)}function f(){t.unbind(window,"mousemove",m);t.unbind(window,"mouseup",f)}function d(){var e=n(this.value);if(e!==false){u.__color.__state=e;u.setValue(u.__color.toOriginal())}else{this.value=u.__color.toString()}}function p(){t.unbind(window,"mousemove",v);t.unbind(window,"mouseup",p)}this.__saturation_field.appendChild(l);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay();function m(e){e.preventDefault();var r=t.getWidth(u.__saturation_field);var n=t.getOffset(u.__saturation_field);var i=(e.clientX-n.left+document.body.scrollLeft)/r;var a=1-(e.clientY-n.top+document.body.scrollTop)/r;if(a>1)a=1;else if(a<0)a=0;if(i>1)i=1;else if(i<0)i=0;u.__color.v=a;u.__color.s=i;u.setValue(u.__color.toOriginal());return false}function v(e){e.preventDefault();var r=t.getHeight(u.__hue_field);var n=t.getOffset(u.__hue_field);var i=1-(e.clientY-n.top+document.body.scrollTop)/r;if(i>1)i=1;else if(i<0)i=0;u.__color.h=i*360;u.setValue(u.__color.toOriginal());return false}};a.superclass=e;i.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=n(this.getValue());if(e!==false){var t=false;i.each(r.COMPONENTS,function(r){if(!i.isUndefined(e[r])&&!i.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r]){t=true;return{}}},this);if(t){i.extend(this.__color.__state,e)}}i.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var a=this.__color.v<.5||this.__color.s>.5?255:0;var o=255-a;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+a+","+a+","+a+")"});this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px";this.__temp.s=1;this.__temp.v=1;s(this.__saturation_field,"left","#fff",this.__temp.toString());i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+a+","+a+","+a+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];function s(e,t,r,n){e.style.background="";i.each(o,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+r+" 0%, "+n+" 100%); "})}function h(e){e.style.background="";e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}return a}(n.controllers.Controller,n.dom.dom,n.color.Color=function(e,t,r,n){var i=function(){this.__state=e.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};i.COMPONENTS=["r","g","b","h","s","v","hex","a"];n.extend(i.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(i.prototype,"r",2);a(i.prototype,"g",1);a(i.prototype,"b",0);o(i.prototype,"h");o(i.prototype,"s");o(i.prototype,"v");Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(i.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(e){this.__state.space="HEX";this.__state.hex=e}});function a(e,t,r){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="RGB"){return this.__state[t]}s(this,t,r);return this.__state[t]},set:function(e){if(this.__state.space!=="RGB"){s(this,t,r);this.__state.space="RGB"}this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="HSV")return this.__state[t];h(this);return this.__state[t]},set:function(e){if(this.__state.space!=="HSV"){h(this);this.__state.space="HSV"}this.__state[t]=e}})}function s(e,r,i){if(e.__state.space==="HEX"){e.__state[r]=t.component_from_hex(e.__state.hex,i)}else if(e.__state.space==="HSV"){n.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}else{throw"Corrupted color state"}}function h(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:r.s,v:r.v});if(!n.isNaN(r.h)){e.__state.h=r.h}else if(n.isUndefined(e.__state.h)){e.__state.h=0}}return i}(n.color.interpret,n.color.math=function(){var e;return{hsv_to_rgb:function(e,t,r){var n=Math.floor(e/60)%6;var i=e/60-Math.floor(e/60);var a=r*(1-t);var o=r*(1-i*t);var s=r*(1-(1-i)*t);var h=[[r,s,a],[o,r,a],[a,r,s],[a,o,r],[s,a,r],[r,a,o]][n];return{r:h[0]*255,g:h[1]*255,b:h[2]*255}},rgb_to_hsv:function(e,t,r){var n=Math.min(e,t,r),i=Math.max(e,t,r),a=i-n,o,s;if(i!=0){s=a/i}else{return{h:NaN,s:0,v:0}}if(e==i){o=(t-r)/a}else if(t==i){o=2+(r-e)/a}else{o=4+(e-t)/a}o/=6;if(o<0){o+=1}return{h:o*360,s:s,v:i/255}},rgb_to_hex:function(e,t,r){var n=this.hex_with_component(0,2,e);n=this.hex_with_component(n,1,t);n=this.hex_with_component(n,0,r);return n},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,r,n){return n<<(e=r*8)|t&~(255<<e)}}}(),n.color.toString,n.utils.common),n.color.interpret,n.utils.common),n.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),n.dom.CenteredDiv=function(e,t){
var r=function(){this.backgroundElement=document.createElement("div");t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});e.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var r=this;e.bind(this.backgroundElement,"click",function(){r.hide()})};r.prototype.show=function(){var e=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();t.defer(function(){e.backgroundElement.style.opacity=1;e.domElement.style.opacity=1;e.domElement.style.webkitTransform="scale(1)"})};r.prototype.hide=function(){var t=this;var r=function(){t.domElement.style.display="none";t.backgroundElement.style.display="none";e.unbind(t.domElement,"webkitTransitionEnd",r);e.unbind(t.domElement,"transitionend",r);e.unbind(t.domElement,"oTransitionEnd",r)};e.bind(this.domElement,"webkitTransitionEnd",r);e.bind(this.domElement,"transitionend",r);e.bind(this.domElement,"oTransitionEnd",r);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};r.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"};function n(e){console.log(e)}return r}(n.dom.dom,n.utils.common),n.dom.dom,n.utils.common)},{}],23:[function(e,t,r){"use strict";t.exports=d;var n=e("robust-orientation");var i=e("simplicial-complex").compareCells;function a(e,t){return e-t}function o(e,t,r){this.vertices=e;this.adjacent=t;this.boundary=r;this.lastVisited=-1}o.prototype.flip=function(){var e=this.vertices[0];this.vertices[0]=this.vertices[1];this.vertices[1]=e;var t=this.adjacent[0];this.adjacent[0]=this.adjacent[1];this.adjacent[1]=t};function s(e,t,r){this.vertices=e;this.cell=t;this.index=r}function h(e,t){return i(e.vertices,t.vertices)}function u(e){var t=["function orient(){var tuple=this.tuple;return test("];for(var r=0;r<=e;++r){if(r>0){t.push(",")}t.push("tuple[",r,"]")}t.push(")}return orient");var i=new Function("test",t.join(""));var a=n[e+1];if(!a){a=n}return i(a)}var l=[];function c(e,t,r){this.dimension=e;this.vertices=t;this.simplices=r;this.interior=r.filter(function(e){return!e.boundary});this.tuple=new Array(e+1);for(var n=0;n<=e;++n){this.tuple[n]=this.vertices[n]}var i=l[e];if(!i){i=l[e]=u(e)}this.orient=i}var f=c.prototype;f.handleBoundaryDegeneracy=function(e,t){var r=this.dimension;var n=this.vertices.length-1;var i=this.tuple;var a=this.vertices;var o=[e];e.lastVisited=-n;while(o.length>0){e=o.pop();var s=e.vertices;var h=e.adjacent;for(var u=0;u<=r;++u){var l=h[u];if(!l.boundary||l.lastVisited<=-n){continue}var c=l.vertices;for(var f=0;f<=r;++f){var d=c[f];if(d<0){i[f]=t}else{i[f]=a[d]}}var p=this.orient();if(p>0){return l}l.lastVisited=-n;if(p===0){o.push(l)}}}return null};f.walk=function(e,t){var r=this.vertices.length-1;var n=this.dimension;var i=this.vertices;var a=this.tuple;var o=t?this.interior.length*Math.random()|0:this.interior.length-1;var s=this.interior[o];e:while(!s.boundary){var h=s.vertices;var u=s.adjacent;for(var l=0;l<=n;++l){a[l]=i[h[l]]}s.lastVisited=r;for(var l=0;l<=n;++l){var c=u[l];if(c.lastVisited>=r){continue}var f=a[l];a[l]=e;var d=this.orient();a[l]=f;if(d<0){s=c;continue e}else{if(!c.boundary){c.lastVisited=r}else{c.lastVisited=-r}}}return}return s};f.addPeaks=function(e,t){var r=this.vertices.length-1;var n=this.dimension;var i=this.vertices;var a=this.tuple;var u=this.interior;var l=this.simplices;var c=[t];t.lastVisited=r;t.vertices[t.vertices.indexOf(-1)]=r;t.boundary=false;u.push(t);var f=[];while(c.length>0){var t=c.pop();var d=t.vertices;var p=t.adjacent;var m=d.indexOf(r);if(m<0){continue}for(var v=0;v<=n;++v){if(v===m){continue}var g=p[v];if(!g.boundary||g.lastVisited>=r){continue}var y=g.vertices;if(g.lastVisited!==-r){var x=0;for(var b=0;b<=n;++b){if(y[b]<0){x=b;a[b]=e}else{a[b]=i[y[b]]}}var w=this.orient();if(w>0){y[x]=r;g.boundary=false;u.push(g);c.push(g);g.lastVisited=r;continue}else{g.lastVisited=-r}}var _=g.adjacent;var M=d.slice();var S=p.slice();var T=new o(M,S,true);l.push(T);var E=_.indexOf(t);if(E<0){continue}_[E]=T;S[m]=g;M[v]=-1;S[v]=t;p[v]=T;T.flip();for(var b=0;b<=n;++b){var C=M[b];if(C<0||C===r){continue}var A=new Array(n-1);var L=0;for(var P=0;P<=n;++P){var R=M[P];if(R<0||P===b){continue}A[L++]=R}f.push(new s(A,T,b))}}}f.sort(h);for(var v=0;v+1<f.length;v+=2){var D=f[v];var k=f[v+1];var F=D.index;var O=k.index;if(F<0||O<0){continue}D.cell.adjacent[D.index]=k.cell;k.cell.adjacent[k.index]=D.cell}};f.insert=function(e,t){var r=this.vertices;r.push(e);var n=this.walk(e,t);if(!n){return}var i=this.dimension;var a=this.tuple;for(var o=0;o<=i;++o){var s=n.vertices[o];if(s<0){a[o]=e}else{a[o]=r[s]}}var h=this.orient(a);if(h<0){return}else if(h===0){n=this.handleBoundaryDegeneracy(n,e);if(!n){return}}this.addPeaks(e,n)};f.boundary=function(){var e=this.dimension;var t=[];var r=this.simplices;var n=r.length;for(var i=0;i<n;++i){var a=r[i];if(a.boundary){var o=new Array(e);var s=a.vertices;var h=0;var u=0;for(var l=0;l<=e;++l){if(s[l]>=0){o[h++]=s[l]}else{u=l&1}}if(u===(e&1)){var c=o[0];o[0]=o[1];o[1]=c}t.push(o)}}return t};function d(e,t){var r=e.length;if(r===0){throw new Error("Must have at least d+1 points")}var i=e[0].length;if(r<=i){throw new Error("Must input at least d+1 points")}var a=e.slice(0,i+1);var s=n.apply(void 0,a);if(s===0){throw new Error("Input not in general position")}var h=new Array(i+1);for(var u=0;u<=i;++u){h[u]=u}if(s<0){h[0]=1;h[1]=0}var l=new o(h,new Array(i+1),false);var f=l.adjacent;var d=new Array(i+2);for(var u=0;u<=i;++u){var p=h.slice();for(var m=0;m<=i;++m){if(m===u){p[m]=-1}}var v=p[0];p[0]=p[1];p[1]=v;var g=new o(p,new Array(i+1),true);f[u]=g;d[u]=g}d[i+1]=l;for(var u=0;u<=i;++u){var p=f[u].vertices;var y=f[u].adjacent;for(var m=0;m<=i;++m){var x=p[m];if(x<0){y[m]=l;continue}for(var b=0;b<=i;++b){if(f[b].vertices.indexOf(x)<0){y[m]=f[b]}}}}var w=new c(i,a,d);var _=!!t;for(var u=i+1;u<r;++u){w.insert(e[u],_)}return w.boundary()}},{"robust-orientation":29,"simplicial-complex":32}],24:[function(e,t,r){"use strict";t.exports=n;function n(e,t,r){var n=e+t;var i=n-e;var a=n-i;var o=t-i;var s=e-a;if(r){r[0]=s+o;r[1]=n;return r}return[s+o,n]}},{}],25:[function(e,t,r){"use strict";var n=e("two-product");var i=e("two-sum");t.exports=a;function a(e,t){var r=e.length;if(r===1){var a=n(e[0],t);if(a[0]){return a}return[a[1]]}var o=new Array(2*r);var s=[.1,.1];var h=[.1,.1];var u=0;n(e[0],t,s);if(s[0]){o[u++]=s[0]}for(var l=1;l<r;++l){n(e[l],t,h);var c=s[1];i(c,h[0],s);if(s[0]){o[u++]=s[0]}var f=h[1];var d=s[1];var p=f+d;var m=p-f;var v=d-m;s[1]=p;if(v){o[u++]=v}}if(s[1]){o[u++]=s[1]}if(u===0){o[u++]=0}o.length=u;return o}},{"two-product":28,"two-sum":24}],26:[function(e,t,r){"use strict";t.exports=i;function n(e,t){var r=e+t;var n=r-e;var i=r-n;var a=t-n;var o=e-i;var s=o+a;if(s){return[s,r]}return[r]}function i(e,t){var r=e.length|0;var i=t.length|0;if(r===1&&i===1){return n(e[0],-t[0])}var a=r+i;var o=new Array(a);var s=0;var h=0;var u=0;var l=Math.abs;var c=e[h];var f=l(c);var d=-t[u];var p=l(d);var m,v;if(f<p){v=c;h+=1;if(h<r){c=e[h];f=l(c)}}else{v=d;u+=1;if(u<i){d=-t[u];p=l(d)}}if(h<r&&f<p||u>=i){m=c;h+=1;if(h<r){c=e[h];f=l(c)}}else{m=d;u+=1;if(u<i){d=-t[u];p=l(d)}}var g=m+v;var y=g-m;var x=v-y;var b=x;var w=g;var _,M,S,T,E;while(h<r&&u<i){if(f<p){m=c;h+=1;if(h<r){c=e[h];f=l(c)}}else{m=d;u+=1;if(u<i){d=-t[u];p=l(d)}}v=b;g=m+v;y=g-m;x=v-y;if(x){o[s++]=x}_=w+g;M=_-w;S=_-M;T=g-M;E=w-S;b=E+T;w=_}while(h<r){m=c;v=b;g=m+v;y=g-m;x=v-y;if(x){o[s++]=x}_=w+g;M=_-w;S=_-M;T=g-M;E=w-S;b=E+T;w=_;h+=1;if(h<r){c=e[h]}}while(u<i){m=d;v=b;g=m+v;y=g-m;x=v-y;if(x){o[s++]=x}_=w+g;M=_-w;S=_-M;T=g-M;E=w-S;b=E+T;w=_;u+=1;if(u<i){d=-t[u]}}if(b){o[s++]=b}if(w){o[s++]=w}if(!s){o[s++]=0}o.length=s;return o}},{}],27:[function(e,t,r){"use strict";t.exports=i;function n(e,t){var r=e+t;var n=r-e;var i=r-n;var a=t-n;var o=e-i;var s=o+a;if(s){return[s,r]}return[r]}function i(e,t){var r=e.length|0;var i=t.length|0;if(r===1&&i===1){return n(e[0],t[0])}var a=r+i;var o=new Array(a);var s=0;var h=0;var u=0;var l=Math.abs;var c=e[h];var f=l(c);var d=t[u];var p=l(d);var m,v;if(f<p){v=c;h+=1;if(h<r){c=e[h];f=l(c)}}else{v=d;u+=1;if(u<i){d=t[u];p=l(d)}}if(h<r&&f<p||u>=i){m=c;h+=1;if(h<r){c=e[h];f=l(c)}}else{m=d;u+=1;if(u<i){d=t[u];p=l(d)}}var g=m+v;var y=g-m;var x=v-y;var b=x;var w=g;var _,M,S,T,E;while(h<r&&u<i){if(f<p){m=c;h+=1;if(h<r){c=e[h];f=l(c)}}else{m=d;u+=1;if(u<i){d=t[u];p=l(d)}}v=b;g=m+v;y=g-m;x=v-y;if(x){o[s++]=x}_=w+g;M=_-w;S=_-M;T=g-M;E=w-S;b=E+T;w=_}while(h<r){m=c;v=b;g=m+v;y=g-m;x=v-y;if(x){o[s++]=x}_=w+g;M=_-w;S=_-M;T=g-M;E=w-S;b=E+T;w=_;h+=1;if(h<r){c=e[h]}}while(u<i){m=d;v=b;g=m+v;y=g-m;x=v-y;if(x){o[s++]=x}_=w+g;M=_-w;S=_-M;T=g-M;E=w-S;b=E+T;w=_;u+=1;if(u<i){d=t[u]}}if(b){o[s++]=b}if(w){o[s++]=w}if(!s){o[s++]=0}o.length=s;return o}},{}],28:[function(e,t,r){"use strict";t.exports=i;var n=+(Math.pow(2,27)+1);function i(e,t,r){var i=e*t;var a=n*e;var o=a-e;var s=a-o;var h=e-s;var u=n*t;var l=u-t;var c=u-l;var f=t-c;var d=i-s*c;var p=d-h*c;var m=p-s*f;var v=h*f-m;if(r){r[0]=v;r[1]=i;return r}return[v,i]}},{}],29:[function(e,t,r){"use strict";var n=e("two-product");var i=e("robust-sum");var a=e("robust-scale");var o=e("robust-subtract");var s=5;var h=1.1102230246251565e-16;var u=(3+16*h)*h;var l=(7+56*h)*h;function c(e,t){var r=new Array(e.length-1);for(var n=1;n<e.length;++n){var i=r[n-1]=new Array(e.length-1);for(var a=0,o=0;a<e.length;++a){if(a===t){continue}i[o++]=e[n][a]}}return r}function f(e){var t=new Array(e);for(var r=0;r<e;++r){t[r]=new Array(e);for(var n=0;n<e;++n){t[r][n]=["m",n,"[",e-r-1,"]"].join("")}}return t}function d(e){if(e&1){return"-"}return""}function p(e){if(e.length===1){return e[0]}else if(e.length===2){return["sum(",e[0],",",e[1],")"].join("")}else{var t=e.length>>1;return["sum(",p(e.slice(0,t)),",",p(e.slice(t)),")"].join("")}}function m(e){if(e.length===2){return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")]}else{var t=[];for(var r=0;r<e.length;++r){t.push(["scale(",p(m(c(e,r))),",",d(r),e[0][r],")"].join(""))}return t}}function v(e){var t=[];var r=[];var s=f(e);var h=[];for(var u=0;u<e;++u){if((u&1)===0){t.push.apply(t,m(c(s,u)))}else{r.push.apply(r,m(c(s,u)))}h.push("m"+u)}var l=p(t);var d=p(r);var v="orientation"+e+"Exact";var g=["function ",v,"(",h.join(),"){var p=",l,",n=",d,",d=sub(p,n);return d[d.length-1];};return ",v].join("");var y=new Function("sum","prod","scale","sub",g);return y(i,n,a,o)}var g=v(3);var y=v(4);var x=[function _(){return 0},function M(){return 0},function S(e,t){return t[0]-e[0]},function T(e,t,r){var n=(e[1]-r[1])*(t[0]-r[0]);var i=(e[0]-r[0])*(t[1]-r[1]);var a=n-i;var o;if(n>0){if(i<=0){return a}else{o=n+i}}else if(n<0){if(i>=0){return a}else{o=-(n+i)}}else{return a}var s=u*o;if(a>=s||a<=-s){return a}return g(e,t,r)},function E(e,t,r,n){var i=e[0]-n[0];var a=t[0]-n[0];var o=r[0]-n[0];var s=e[1]-n[1];var h=t[1]-n[1];var u=r[1]-n[1];var c=e[2]-n[2];var f=t[2]-n[2];var d=r[2]-n[2];var p=a*u;var m=o*h;var v=o*s;var g=i*u;var x=i*h;var b=a*s;var w=c*(p-m)+f*(v-g)+d*(x-b);var _=(Math.abs(p)+Math.abs(m))*Math.abs(c)+(Math.abs(v)+Math.abs(g))*Math.abs(f)+(Math.abs(x)+Math.abs(b))*Math.abs(d);var M=l*_;if(w>M||-w>M){return w}return y(e,t,r,n)}];function b(e){var t=x[e.length];if(!t){t=x[e.length]=v(e.length)}return t.apply(undefined,e)}function w(){while(x.length<=s){x.push(v(x.length))}var e=[];var r=["slow"];for(var n=0;n<=s;++n){e.push("a"+n);r.push("o"+n)}var i=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(var n=2;n<=s;++n){i.push("case ",n,":return o",n,"(",e.slice(0,n).join(),");")}i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation");r.push(i.join(""));var a=Function.apply(undefined,r);t.exports=a.apply(undefined,[b].concat(x));for(var n=0;n<=s;++n){t.exports[n]=x[n]}}w()},{"robust-scale":25,"robust-subtract":26,"robust-sum":27,"two-product":28}],30:[function(e,t,r){"use strict";"use restrict";var n=32;r.INT_BITS=n;r.INT_MAX=2147483647;r.INT_MIN=-1<<n-1;r.sign=function(e){return(e>0)-(e<0)};r.abs=function(e){var t=e>>n-1;return(e^t)-t};r.min=function(e,t){return t^(e^t)&-(e<t)};r.max=function(e,t){return e^(e^t)&-(e<t)};r.isPow2=function(e){return!(e&e-1)&&!!e};r.log2=function(e){var t,r;t=(e>65535)<<4;e>>>=t;r=(e>255)<<3;e>>>=r;t|=r;r=(e>15)<<2;e>>>=r;t|=r;r=(e>3)<<1;e>>>=r;t|=r;return t|e>>1};r.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0};r.popCount=function(e){e=e-(e>>>1&1431655765);e=(e&858993459)+(e>>>2&858993459);return(e+(e>>>4)&252645135)*16843009>>>24};function i(e){var t=32;e&=-e;if(e)t--;if(e&65535)t-=16;if(e&16711935)t-=8;if(e&252645135)t-=4;if(e&858993459)t-=2;if(e&1431655765)t-=1;return t}r.countTrailingZeros=i;r.nextPow2=function(e){e+=e===0;--e;e|=e>>>1;e|=e>>>2;e|=e>>>4;e|=e>>>8;e|=e>>>16;return e+1};r.prevPow2=function(e){e|=e>>>1;e|=e>>>2;e|=e>>>4;e|=e>>>8;e|=e>>>16;return e-(e>>>1)};r.parity=function(e){e^=e>>>16;e^=e>>>8;e^=e>>>4;e&=15;return 27030>>>e&1};var a=new Array(256);(function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1){n<<=1;n|=r&1;--i}e[t]=n<<i&255}})(a);r.reverse=function(e){return a[e&255]<<24|a[e>>>8&255]<<16|a[e>>>16&255]<<8|a[e>>>24&255]};r.interleave2=function(e,t){e&=65535;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;t&=65535;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;return e|t<<1};r.deinterleave2=function(e,t){e=e>>>t&1431655765;e=(e|e>>>1)&858993459;e=(e|e>>>2)&252645135;e=(e|e>>>4)&16711935;e=(e|e>>>16)&65535;return e<<16>>16};r.interleave3=function(e,t,r){e&=1023;e=(e|e<<16)&4278190335;e=(e|e<<8)&251719695;e=(e|e<<4)&3272356035;e=(e|e<<2)&1227133513;t&=1023;t=(t|t<<16)&4278190335;t=(t|t<<8)&251719695;t=(t|t<<4)&3272356035;t=(t|t<<2)&1227133513;e|=t<<1;r&=1023;r=(r|r<<16)&4278190335;r=(r|r<<8)&251719695;r=(r|r<<4)&3272356035;r=(r|r<<2)&1227133513;return e|r<<2};r.deinterleave3=function(e,t){e=e>>>t&1227133513;e=(e|e>>>2)&3272356035;e=(e|e>>>4)&251719695;e=(e|e>>>8)&4278190335;e=(e|e>>>16)&1023;return e<<22>>22};r.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>i(e)+1}},{}],31:[function(e,t,r){"use strict";"use restrict";t.exports=n;function n(e){this.roots=new Array(e);this.ranks=new Array(e);for(var t=0;t<e;++t){this.roots[t]=t;this.ranks[t]=0}}var i=n.prototype;Object.defineProperty(i,"length",{get:function(){return this.roots.length}});i.makeSet=function(){var e=this.roots.length;this.roots.push(e);this.ranks.push(0);return e};i.find=function(e){var t=e;var r=this.roots;while(r[e]!==e){e=r[e]}while(r[t]!==e){var n=r[t];r[t]=e;t=n}return e};i.link=function(e,t){var r=this.find(e),n=this.find(t);if(r===n){return}var i=this.ranks,a=this.roots,o=i[r],s=i[n];if(o<s){a[r]=n}else if(s<o){a[n]=r}else{a[n]=r;++i[r]}}},{}],32:[function(e,t,r){"use strict";"use restrict";var n=e("bit-twiddle"),i=e("union-find");function a(e){var t=0,r=Math.max;for(var n=0,i=e.length;n<i;++n){t=r(t,e[n].length)}return t-1}r.dimension=a;function o(e){var t=-1,r=Math.max;for(var n=0,i=e.length;n<i;++n){var a=e[n];for(var o=0,s=a.length;o<s;++o){t=r(t,a[o])}}return t+1}r.countVertices=o;function s(e){var t=new Array(e.length);for(var r=0,n=e.length;r<n;++r){t[r]=e[r].slice(0)}return t}r.cloneCells=s;function h(e,t){var r=e.length,n=e.length-t.length,i=Math.min;if(n){return n}switch(r){case 0:return 0;case 1:return e[0]-t[0];case 2:var a=e[0]+e[1]-t[0]-t[1];if(a){return a}return i(e[0],e[1])-i(t[0],t[1]);case 3:var o=e[0]+e[1],s=t[0]+t[1];a=o+e[2]-(s+t[2]);if(a){return a}var h=i(e[0],e[1]),u=i(t[0],t[1]),a=i(h,e[2])-i(u,t[2]);if(a){return a}return i(h+e[2],o)-i(u+t[2],s);default:var l=e.slice(0);l.sort();var c=t.slice(0);c.sort();for(var f=0;f<r;++f){n=l[f]-c[f];if(n){return n}}return 0}}r.compareCells=h;function u(e,t){return h(e[0],t[0])}function l(e,t){if(t){var r=e.length;var n=new Array(r);for(var i=0;i<r;++i){n[i]=[e[i],t[i]]}n.sort(u);for(var i=0;i<r;++i){e[i]=n[i][0];t[i]=n[i][1]}return e}else{e.sort(h);return e}}r.normalize=l;function c(e){if(e.length===0){return[]}var t=1,r=e.length;for(var n=1;n<r;++n){var i=e[n];if(h(i,e[n-1])){if(n===t){t++;continue}e[t++]=i}}e.length=t;return e}r.unique=c;function f(e,t){var r=0,n=e.length-1,i=-1;while(r<=n){var a=r+n>>1,o=h(e[a],t);if(o<=0){if(o===0){i=a}r=a+1}else if(o>0){n=a-1}}return i}r.findCell=f;function d(e,t){var r=new Array(e.length);for(var i=0,a=r.length;i<a;++i){r[i]=[]}var o=[];for(var i=0,s=t.length;i<s;++i){var u=t[i];var l=u.length;for(var c=1,d=1<<l;c<d;++c){o.length=n.popCount(c);var p=0;for(var m=0;m<l;++m){if(c&1<<m){o[p++]=u[m]}}var v=f(e,o);if(v<0){continue}while(true){r[v++].push(i);if(v>=e.length||h(e[v],o)!==0){break}}}}return r}r.incidence=d;function p(e,t){if(!t){return d(c(v(e,0)),e,0)}var r=new Array(t);for(var n=0;n<t;++n){r[n]=[]}for(var n=0,i=e.length;n<i;++n){var a=e[n];for(var o=0,s=a.length;o<s;++o){r[a[o]].push(n)}}return r}r.dual=p;function m(e){var t=[];for(var r=0,n=e.length;r<n;++r){var i=e[r],a=i.length|0;for(var o=1,s=1<<a;o<s;++o){var h=[];for(var u=0;u<a;++u){if(o>>>u&1){h.push(i[u])}}t.push(h)}}return l(t)}r.explode=m;function v(e,t){if(t<0){return[]}var r=[],i=(1<<t+1)-1;for(var a=0;a<e.length;++a){var o=e[a];for(var s=i;s<1<<o.length;s=n.nextCombination(s)){var h=new Array(t+1),u=0;for(var c=0;c<o.length;++c){if(s&1<<c){h[u++]=o[c]}}r.push(h)}}return l(r)}r.skeleton=v;function g(e){var t=[];for(var r=0,n=e.length;r<n;++r){var i=e[r];for(var a=0,o=i.length;a<o;++a){var s=new Array(i.length-1);for(var h=0,u=0;h<o;++h){if(h!==a){s[u++]=i[h]}}t.push(s)}}return l(t)}r.boundary=g;function y(e,t){var r=new i(t);for(var n=0;n<e.length;++n){var a=e[n];for(var o=0;o<a.length;++o){for(var s=o+1;s<a.length;++s){r.link(a[o],a[s])}}}var h=[],u=r.ranks;for(var n=0;n<u.length;++n){u[n]=-1}for(var n=0;n<e.length;++n){var l=r.find(e[n][0]);if(u[l]<0){u[l]=h.length;h.push([e[n].slice(0)])}else{h[u[l]].push(e[n].slice(0))}}return h}function x(e){var t=c(l(v(e,0))),r=new i(t.length);for(var n=0;n<e.length;++n){var a=e[n];for(var o=0;o<a.length;++o){var s=f(t,[a[o]]);for(var h=o+1;h<a.length;++h){r.link(s,f(t,[a[h]]))}}}var u=[],d=r.ranks;for(var n=0;n<d.length;++n){d[n]=-1}for(var n=0;n<e.length;++n){var p=r.find(f(t,[e[n][0]]));if(d[p]<0){d[p]=u.length;u.push([e[n].slice(0)])}else{u[d[p]].push(e[n].slice(0))}}return u}function b(e,t){if(t){return y(e,t)}return x(e)}r.connectedComponents=b},{"bit-twiddle":30,"union-find":31}],33:[function(e,t,r){"use strict";function n(e,t){var r=1,n=e.length,i=e[0],a=e[0];for(var o=1;o<n;++o){a=i;i=e[o];if(t(i,a)){if(o===r){r++;continue}e[r++]=i}}e.length=r;return e}function i(e){var t=1,r=e.length,n=e[0],i=e[0];for(var a=1;a<r;++a,i=n){i=n;n=e[a];if(n!==i){if(a===t){t++;continue}e[t++]=n}}e.length=t;return e}function a(e,t,r){if(e.length===0){return e}if(t){if(!r){e.sort(t)}return n(e,t)}if(!r){e.sort()}return i(e)}t.exports=a},{}],34:[function(e,t,r){"use strict";var n=e("incremental-convex-hull");var i=e("uniq");t.exports=h;function a(e,t){this.point=e;this.index=t}function o(e,t){var r=e.point;var n=t.point;var i=r.length;for(var a=0;a<i;++a){var o=n[a]-r[a];if(o){return o}}return 0}function s(e,t,r){if(e===1){if(r){return[[-1,0]]}else{return[]}}var n=t.map(function(e,t){return[e[0],t]});n.sort(function(e,t){return e[0]-t[0]});var i=new Array(e-1);for(var a=1;a<e;++a){var o=n[a-1];var s=n[a];i[a-1]=[o[1],s[1]]}if(r){i.push([-1,i[0][1]],[i[e-1][1],-1])}return i}function h(e,t){var r=e.length;if(r===0){return[]}var h=e[0].length;if(h<1){return[]}if(h===1){return s(r,e,t)}var u=new Array(r);var l=1;for(var c=0;c<r;++c){var f=e[c];var d=new Array(h+1);var p=0;for(var m=0;m<h;++m){var v=f[m];d[m]=v;p+=v*v}d[h]=p;u[c]=new a(d,c);l=Math.max(p,l)}i(u,o);r=u.length;var g=new Array(r+h+1);var y=new Array(r+h+1);var x=(h+1)*(h+1)*l;var b=new Array(h+1);for(var c=0;c<=h;++c){b[c]=0}b[h]=x;g[0]=b.slice();y[0]=-1;for(var c=0;c<=h;++c){var d=b.slice();d[c]=1;g[c+1]=d;y[c+1]=-1}for(var c=0;c<r;++c){var w=u[c];g[c+h+1]=w.point;y[c+h+1]=w.index}var _=n(g,false);if(t){_=_.filter(function(e){var t=0;for(var r=0;r<=h;++r){var n=y[e[r]];if(n<0){if(++t>=2){return false}}e[r]=n}return true})}else{_=_.filter(function(e){for(var t=0;t<=h;++t){var r=y[e[t]];if(r<0){return false}e[t]=r}return true})}if(h&1){for(var c=0;c<_.length;++c){var w=_[c];var d=w[0];w[0]=w[1];w[1]=d}}return _}},{"incremental-convex-hull":23,uniq:33}],35:[function(e,t,r){!function(e,r){if(typeof t!="undefined")t.exports=r();else if(typeof define=="function"&&typeof define.amd=="object")define(r);else this[e]=r()}("domready",function(){var e=[],t,r=document,n=r.documentElement.doScroll,i="DOMContentLoaded",a=(n?/^loaded|^c/:/^loaded|^i|^c/).test(r.readyState);if(!a)r.addEventListener(i,t=function(){r.removeEventListener(i,t);a=1;while(t=e.shift())t()});return function(t){a?setTimeout(t,0):e.push(t)}})},{}],36:[function(e,t,r){var n=e("lodash._baseflatten"),i=e("lodash._createwrapper"),a=e("lodash.functions"),o=e("lodash.restparam");var s=1;var h=o(function(e,t){t=t.length?n(t):a(e);var r=-1,o=t.length;while(++r<o){var h=t[r];e[h]=i(e[h],s,e)}return e});t.exports=h},{"lodash._baseflatten":37,"lodash._createwrapper":40,"lodash.functions":44,"lodash.restparam":50}],37:[function(e,t,r){var n=e("lodash.isarguments"),i=e("lodash.isarray");function a(e){return!!e&&typeof e=="object"}var o=9007199254740991;function s(e,t){var r=-1,n=t.length,i=e.length;while(++r<n){e[i+r]=t[r]}return e}function h(e,t,r,o){o||(o=[]);var u=-1,l=e.length;while(++u<l){var f=e[u];if(a(f)&&c(f)&&(r||i(f)||n(f))){if(t){h(f,t,r,o)}else{s(o,f)}}else if(!r){o[o.length]=f}}return o}function u(e){return function(t){return t==null?undefined:t[e]}}var l=u("length");function c(e){return e!=null&&f(l(e))}function f(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=o}t.exports=h},{"lodash.isarguments":38,"lodash.isarray":39}],38:[function(e,t,r){function n(e){return!!e&&typeof e=="object"}var i=Object.prototype;var a=i.hasOwnProperty;var o=i.propertyIsEnumerable;var s=9007199254740991;function h(e){return function(t){return t==null?undefined:t[e]}}var u=h("length");function l(e){return e!=null&&c(u(e))}function c(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=s}function f(e){return n(e)&&l(e)&&a.call(e,"callee")&&!o.call(e,"callee")}t.exports=f},{}],39:[function(e,t,r){var n="[object Array]",i="[object Function]";var a=/^\[object .+?Constructor\]$/;function o(e){return!!e&&typeof e=="object"}var s=Object.prototype;var h=Function.prototype.toString;var u=s.hasOwnProperty;var l=s.toString;var c=RegExp("^"+h.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var f=p(Array,"isArray");var d=9007199254740991;function p(e,t){var r=e==null?undefined:e[t];return x(r)?r:undefined}function m(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=d}var v=f||function(e){return o(e)&&m(e.length)&&l.call(e)==n};function g(e){return y(e)&&l.call(e)==i}function y(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function x(e){if(e==null){return false}if(g(e)){return c.test(h.call(e))}return o(e)&&a.test(e)}t.exports=v},{}],40:[function(e,t,r){(function(r){var n=e("lodash._arraycopy"),i=e("lodash._basecreate"),a=e("lodash._replaceholders");var o=1,s=2,h=4,u=8,l=16,c=32,f=64,d=128;var p="Expected a function";var m=/^\d+$/;var v=Math.max,g=Math.min;var y=9007199254740991;function x(e,t,r){var n=r.length,i=-1,a=v(e.length-n,0),o=-1,s=t.length,h=Array(s+a);while(++o<s){h[o]=t[o]}while(++i<n){h[r[i]]=e[i]}while(a--){h[o++]=e[i++]}return h}function b(e,t,r){var n=-1,i=r.length,a=-1,o=v(e.length-i,0),s=-1,h=t.length,u=Array(o+h);while(++a<o){u[a]=e[a]}var l=a;while(++s<h){u[l+s]=t[s]}while(++n<i){u[l+r[n]]=e[a++]}return u}function w(e,t){var n=_(e);function i(){var a=this&&this!==r&&this instanceof i?n:e;return a.apply(t,arguments)}return i}function _(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=i(e.prototype),n=e.apply(r,t);return A(n)?n:r}}function M(e,t,i,p,m,g,y,w,S,T){var E=t&d,A=t&o,L=t&s,P=t&u,R=t&h,D=t&l,k=L?undefined:_(e);function F(){var h=arguments.length,u=h,l=Array(h);while(u--){l[u]=arguments[u]}if(p){l=x(l,p,m)}if(g){l=b(l,g,y)}if(P||D){var d=F.placeholder,O=a(l,d);h-=O.length;if(h<T){var U=w?n(w):undefined,B=v(T-h,0),V=P?O:undefined,I=P?undefined:O,N=P?l:undefined,G=P?undefined:l;t|=P?c:f;t&=~(P?f:c);if(!R){t&=~(o|s)}var z=M(e,t,i,N,V,G,I,U,S,B);z.placeholder=d;return z}}var H=A?i:this,j=L?H[e]:e;if(w){l=C(l,w)}if(E&&S<l.length){l.length=S}if(this&&this!==r&&this instanceof F){j=k||_(e)}return j.apply(H,l)}return F}function S(e,t,n,i){var a=t&o,s=_(e);function h(){var t=-1,o=arguments.length,u=-1,l=i.length,c=Array(l+o);while(++u<l){c[u]=i[u]}while(o--){c[u++]=arguments[++t]}var f=this&&this!==r&&this instanceof h?s:e;return f.apply(a?n:this,c)}return h}function T(e,t,r,n,i,a,h,u){var l=t&s;if(!l&&typeof e!="function"){throw new TypeError(p)}var d=n?n.length:0;if(!d){t&=~(c|f);n=i=undefined}d-=i?i.length:0;if(t&f){var m=n,g=i;n=i=undefined}var y=[e,t,r,n,i,m,g,a,h,u];y[9]=u==null?l?0:e.length:v(u-d,0)||0;if(t==o){var x=w(y[0],y[2])}else if((t==c||t==(o|c))&&!y[4].length){x=S.apply(undefined,y)}else{x=M.apply(undefined,y)}return x}function E(e,t){e=typeof e=="number"||m.test(e)?+e:-1;t=t==null?y:t;return e>-1&&e%1==0&&e<t}function C(e,t){var r=e.length,i=g(t.length,r),a=n(e);while(i--){var o=t[i];e[i]=E(o,r)?a[o]:undefined}return e}function A(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}t.exports=T}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"lodash._arraycopy":41,"lodash._basecreate":42,"lodash._replaceholders":43}],41:[function(e,t,r){function n(e,t){var r=-1,n=e.length;t||(t=Array(n));while(++r<n){t[r]=e[r]}return t}t.exports=n},{}],42:[function(e,t,r){var n=function(){function e(){}return function(t){if(i(t)){e.prototype=t;var r=new e;e.prototype=undefined}return r||{}}}();function i(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}t.exports=n},{}],43:[function(e,t,r){var n="__lodash_placeholder__";function i(e,t){var r=-1,i=e.length,a=-1,o=[];while(++r<i){if(e[r]===t){e[r]=n;o[++a]=r}}return o}t.exports=i},{}],44:[function(e,t,r){var n=e("lodash._basefunctions"),i=e("lodash.keysin");function a(e){return n(e,i(e))}t.exports=a},{"lodash._basefunctions":45,"lodash.keysin":47}],45:[function(e,t,r){var n=e("lodash.isfunction");function i(e,t){var r=-1,i=t.length,a=-1,o=[];while(++r<i){var s=t[r];if(n(e[s])){o[++a]=s}}return o}t.exports=i},{"lodash.isfunction":46}],46:[function(e,t,r){var n="[object Function]";var i=Object.prototype;var a=i.toString;function o(e){return s(e)&&a.call(e)==n}function s(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}t.exports=o},{}],47:[function(e,t,r){var n=e("lodash.isarguments"),i=e("lodash.isarray");var a=/^\d+$/;var o=Object.prototype;var s=o.hasOwnProperty;var h=9007199254740991;function u(e,t){e=typeof e=="number"||a.test(e)?+e:-1;t=t==null?h:t;return e>-1&&e%1==0&&e<t}function l(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=h}function c(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function f(e){if(e==null){return[]}if(!c(e)){e=Object(e)}var t=e.length;t=t&&l(t)&&(i(e)||n(e))&&t||0;var r=e.constructor,a=-1,o=typeof r=="function"&&r.prototype===e,h=Array(t),f=t>0;while(++a<t){h[a]=a+""}for(var d in e){if(!(f&&u(d,t))&&!(d=="constructor"&&(o||!s.call(e,d)))){h.push(d)}}return h}t.exports=f},{"lodash.isarguments":48,"lodash.isarray":49}],48:[function(e,t,r){arguments[4][38][0].apply(r,arguments)},{dup:38}],49:[function(e,t,r){arguments[4][39][0].apply(r,arguments)},{dup:39}],50:[function(e,t,r){var n="Expected a function";var i=Math.max;function a(e,t){if(typeof e!="function"){throw new TypeError(n)}t=i(t===undefined?e.length-1:+t||0,0);return function(){var r=arguments,n=-1,a=i(r.length-t,0),o=Array(a);while(++n<a){o[n]=r[t+n]}switch(t){case 0:return e.call(this,o);case 1:return e.call(this,r[0],o);case 2:return e.call(this,r[0],r[1],o)}var s=Array(t+1);n=-1;while(++n<t){s[n]=r[n]}s[t]=o;return e.apply(this,s)}}t.exports=a},{}],51:[function(e,t,r){var n=e("performance-now"),i=typeof window==="undefined"?{}:window,a=["moz","webkit"],o="AnimationFrame",s=i["request"+o],h=i["cancel"+o]||i["cancelRequest"+o];for(var u=0;u<a.length&&!s;u++){s=i[a[u]+"Request"+o];h=i[a[u]+"Cancel"+o]||i[a[u]+"CancelRequest"+o]}if(!s||!h){var l=0,c=0,f=[],d=1e3/60;s=function(e){if(f.length===0){var t=n(),r=Math.max(0,d-(t-l));l=r+t;setTimeout(function(){var e=f.slice(0);f.length=0;for(var t=0;t<e.length;t++){if(!e[t].cancelled){try{e[t].callback(l)}catch(r){setTimeout(function(){throw r},0)}}}},Math.round(r))}f.push({handle:++c,callback:e,cancelled:false});return c};h=function(e){for(var t=0;t<f.length;t++){if(f[t].handle===e){f[t].cancelled=true}}}}t.exports=function(e){return s.call(i,e)};t.exports.cancel=function(){h.apply(i,arguments)}},{"performance-now":52}],52:[function(e,t,r){(function(e){(function(){var r,n,i;if(typeof performance!=="undefined"&&performance!==null&&performance.now){t.exports=function(){return performance.now()}}else if(typeof e!=="undefined"&&e!==null&&e.hrtime){t.exports=function(){return(r()-i)/1e6};n=e.hrtime;r=function(){var e;e=n();return e[0]*1e9+e[1]};i=r()}else if(Date.now){t.exports=function(){return Date.now()-i};i=Date.now()}else{t.exports=function(){return(new Date).getTime()-i};i=(new Date).getTime()}}).call(this)}).call(this,e("_process"))},{_process:19}],53:[function(e,t,r){arguments[4][30][0].apply(r,arguments)},{dup:30}],54:[function(e,t,r){arguments[4][31][0].apply(r,arguments)},{dup:31}],55:[function(e,t,r){arguments[4][32][0].apply(r,arguments)},{"bit-twiddle":53,dup:32,"union-find":54}],56:[function(e,t,r){var n=function(){var e=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now;var t=e(),r=t;var n=0,i=0;function a(e,t,r){var n=document.createElement(e);n.id=t;n.style.cssText=r;return n}function o(e,t,r){var n=a("div",e,"padding:0 0 3px 3px;text-align:left;background:"+r);var i=a("div",e+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+t);i.innerHTML=e.toUpperCase();n.appendChild(i);var o=a("div",e+"Graph","width:74px;height:30px;background:"+t);n.appendChild(o);for(var s=0;s<74;s++){o.appendChild(a("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+r))}return n}function s(e){var t=u.children;for(var r=0;r<t.length;r++){t[r].style.display=r===e?"block":"none"}i=e}function h(e,t){var r=e.appendChild(e.firstChild);r.style.height=Math.min(30,30-t*30)+"px"}var u=a("div","stats","width:80px;opacity:0.9;cursor:pointer");u.addEventListener("mousedown",function(e){e.preventDefault();s(++i%u.children.length)},false);var l=0,c=Infinity,f=0;var d=o("fps","#0ff","#002");var p=d.children[0];var m=d.children[1];u.appendChild(d);var v=0,g=Infinity,y=0;var x=o("ms","#0f0","#020");var b=x.children[0];var w=x.children[1];u.appendChild(x);if(self.performance&&self.performance.memory){
var _=0,M=Infinity,S=0;var T=o("mb","#f08","#201");var E=T.children[0];var C=T.children[1];u.appendChild(T)}s(i);return{REVISION:14,domElement:u,setMode:s,begin:function(){t=e()},end:function(){var i=e();v=i-t;g=Math.min(g,v);y=Math.max(y,v);b.textContent=(v|0)+" MS ("+(g|0)+"-"+(y|0)+")";h(w,v/200);n++;if(i>r+1e3){l=Math.round(n*1e3/(i-r));c=Math.min(c,l);f=Math.max(f,l);p.textContent=l+" FPS ("+c+"-"+f+")";h(m,l/100);r=i;n=0;if(_!==undefined){var a=performance.memory.usedJSHeapSize;var o=performance.memory.jsHeapSizeLimit;_=Math.round(a*9.54e-7);M=Math.min(M,_);S=Math.max(S,_);E.textContent=_+" MB ("+M+"-"+S+")";h(C,a/o)}}return i},update:function(){t=this.end()}}};if(typeof t==="object"){t.exports=n}},{}],57:[function(e,t,r){var n=e("inherits");t.exports=function(e){function t(r){if(!(this instanceof t))return new t(r);e.Geometry.call(this);this.dynamic=true;if(r)this.update(r)}n(t,e.Geometry);t.prototype._updatePositions=function(t){for(var r=0;r<t.length;r++){var n=t[r];if(r>this.vertices.length-1)this.vertices.push((new e.Vector3).fromArray(n));else this.vertices[r].fromArray(n)}this.vertices.length=t.length;this.verticesNeedUpdate=true};t.prototype._updateCells=function(t){for(var r=0;r<t.length;r++){var n=t[r];if(r>this.faces.length-1)this.faces.push(new e.Face3(n[0],n[1],n[2]));else{var i=this.faces[r];i.a=n[0];i.b=n[1];i.c=n[2]}}this.faces.length=t.length;this.elementsNeedUpdate=true};t.prototype.update=function(e){this._updatePositions(e.positions);this._updateCells(e.cells)};return t}},{inherits:58}],58:[function(e,t,r){if(typeof Object.create==="function"){t.exports=function n(e,t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})}}else{t.exports=function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.prototype.constructor=e}}},{}],59:[function(e,t,r){var n=n||{};var i={REVISION:"72"};if(typeof define==="function"&&define.amd){define("three",i)}else if("undefined"!==typeof r&&"undefined"!==typeof t){t.exports=i}if(n.requestAnimationFrame===undefined||n.cancelAnimationFrame===undefined){(function(){var e=0;var t=["ms","moz","webkit","o"];for(var r=0;r<t.length&&!n.requestAnimationFrame;++r){n.requestAnimationFrame=n[t[r]+"RequestAnimationFrame"];n.cancelAnimationFrame=n[t[r]+"CancelAnimationFrame"]||n[t[r]+"CancelRequestAnimationFrame"]}if(n.requestAnimationFrame===undefined&&n.setTimeout!==undefined){n.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e));var a=n.setTimeout(function(){t(r+i)},i);e=r+i;return a}}if(n.cancelAnimationFrame===undefined&&n.clearTimeout!==undefined){n.cancelAnimationFrame=function(e){n.clearTimeout(e)}}})()}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:+e}}if(Function.prototype.name===undefined&&Object.defineProperty!==undefined){Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}})}i.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};i.CullFaceNone=0;i.CullFaceBack=1;i.CullFaceFront=2;i.CullFaceFrontBack=3;i.FrontFaceDirectionCW=0;i.FrontFaceDirectionCCW=1;i.BasicShadowMap=0;i.PCFShadowMap=1;i.PCFSoftShadowMap=2;i.FrontSide=0;i.BackSide=1;i.DoubleSide=2;i.FlatShading=1;i.SmoothShading=2;i.NoColors=0;i.FaceColors=1;i.VertexColors=2;i.NoBlending=0;i.NormalBlending=1;i.AdditiveBlending=2;i.SubtractiveBlending=3;i.MultiplyBlending=4;i.CustomBlending=5;i.AddEquation=100;i.SubtractEquation=101;i.ReverseSubtractEquation=102;i.MinEquation=103;i.MaxEquation=104;i.ZeroFactor=200;i.OneFactor=201;i.SrcColorFactor=202;i.OneMinusSrcColorFactor=203;i.SrcAlphaFactor=204;i.OneMinusSrcAlphaFactor=205;i.DstAlphaFactor=206;i.OneMinusDstAlphaFactor=207;i.DstColorFactor=208;i.OneMinusDstColorFactor=209;i.SrcAlphaSaturateFactor=210;i.NeverDepth=0;i.AlwaysDepth=1;i.LessDepth=2;i.LessEqualDepth=3;i.EqualDepth=4;i.GreaterEqualDepth=5;i.GreaterDepth=6;i.NotEqualDepth=7;i.MultiplyOperation=0;i.MixOperation=1;i.AddOperation=2;i.UVMapping=300;i.CubeReflectionMapping=301;i.CubeRefractionMapping=302;i.EquirectangularReflectionMapping=303;i.EquirectangularRefractionMapping=304;i.SphericalReflectionMapping=305;i.RepeatWrapping=1e3;i.ClampToEdgeWrapping=1001;i.MirroredRepeatWrapping=1002;i.NearestFilter=1003;i.NearestMipMapNearestFilter=1004;i.NearestMipMapLinearFilter=1005;i.LinearFilter=1006;i.LinearMipMapNearestFilter=1007;i.LinearMipMapLinearFilter=1008;i.UnsignedByteType=1009;i.ByteType=1010;i.ShortType=1011;i.UnsignedShortType=1012;i.IntType=1013;i.UnsignedIntType=1014;i.FloatType=1015;i.HalfFloatType=1025;i.UnsignedShort4444Type=1016;i.UnsignedShort5551Type=1017;i.UnsignedShort565Type=1018;i.AlphaFormat=1019;i.RGBFormat=1020;i.RGBAFormat=1021;i.LuminanceFormat=1022;i.LuminanceAlphaFormat=1023;i.RGBEFormat=i.RGBAFormat;i.RGB_S3TC_DXT1_Format=2001;i.RGBA_S3TC_DXT1_Format=2002;i.RGBA_S3TC_DXT3_Format=2003;i.RGBA_S3TC_DXT5_Format=2004;i.RGB_PVRTC_4BPPV1_Format=2100;i.RGB_PVRTC_2BPPV1_Format=2101;i.RGBA_PVRTC_4BPPV1_Format=2102;i.RGBA_PVRTC_2BPPV1_Format=2103;i.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};i.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};i.Color=function(e){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(e)};i.Color.prototype={constructor:i.Color,r:1,g:1,b:1,set:function(e){if(e instanceof i.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,r){this.r=e;this.g=t;this.b=r;return this},setHSL:function(){function e(e,t,r){if(r<0)r+=1;if(r>1)r-=1;if(r<1/6)return e+(t-e)*6*r;if(r<1/2)return t;if(r<2/3)return e+(t-e)*6*(2/3-r);return e}return function(t,r,n){t=i.Math.euclideanModulo(t,1);r=i.Math.clamp(r,0,1);n=i.Math.clamp(n,0,1);if(r===0){this.r=this.g=this.b=n}else{var a=n<=.5?n*(1+r):n+r-n*r;var o=2*n-a;this.r=e(o,a,t+1/3);this.g=e(o,a,t);this.b=e(o,a,t-1/3)}return this}}(),setStyle:function(e){var t=function(t){var r=parseFloat(t);if(r<1){console.warn("THREE.Color: Alpha component of color "+e+" will be ignored.")}return r};var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n;var a=r[1];var o=r[2];switch(a){case"rgb":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*$/.exec(o)){this.r=Math.min(255,parseInt(n[1],10))/255;this.g=Math.min(255,parseInt(n[2],10))/255;this.b=Math.min(255,parseInt(n[3],10))/255;return this}if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(o)){this.r=Math.min(100,parseInt(n[1],10))/100;this.g=Math.min(100,parseInt(n[2],10))/100;this.b=Math.min(100,parseInt(n[3],10))/100;return this}break;case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(o)){this.r=Math.min(255,parseInt(n[1],10))/255;this.g=Math.min(255,parseInt(n[2],10))/255;this.b=Math.min(255,parseInt(n[3],10))/255;t(n[4]);return this}if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(o)){this.r=Math.min(100,parseInt(n[1],10))/100;this.g=Math.min(100,parseInt(n[2],10))/100;this.b=Math.min(100,parseInt(n[3],10))/100;t(n[4]);return this}break;case"hsl":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(o)){var s=parseFloat(n[1]);var h=parseInt(n[2],10)/100;var u=parseInt(n[3],10)/100;return this.setHSL(s,h,u)}break;case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(o)){var s=parseFloat(n[1]);var h=parseInt(n[2],10)/100;var u=parseInt(n[3],10)/100;t(n[4]);return this.setHSL(s,h,u)}break}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=r[1];var c=l.length;if(c===3){this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255;this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255;this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255;return this}else if(c===6){this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255;this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255;this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255;return this}}if(e&&e.length>0){var l=i.ColorKeywords[e];if(l!==undefined){this.setHex(l)}else{console.warn("THREE.Color: Unknown color "+e)}}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e,t){if(t===undefined)t=2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},copyLinearToGamma:function(e,t){if(t===undefined)t=2;var r=t>0?1/t:1;this.r=Math.pow(e.r,r);this.g=Math.pow(e.g,r);this.b=Math.pow(e.b,r);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;this.r=e*e;this.g=t*t;this.b=r*r;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var r=this.r,n=this.g,i=this.b;var a=Math.max(r,n,i);var o=Math.min(r,n,i);var s,h;var u=(o+a)/2;if(o===a){s=0;h=0}else{var l=a-o;h=u<=.5?l/(a+o):l/(2-a-o);switch(a){case r:s=(n-i)/l+(n<i?6:0);break;case n:s=(i-r)/l+2;break;case i:s=(r-n)/l+4;break}s/=6}t.h=s;t.s=h;t.l=u;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,r){var n=this.getHSL();n.h+=e;n.s+=t;n.l+=r;this.setHSL(n.h,n.s,n.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){this.r=e[0];this.g=e[1];this.b=e[2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e}};i.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};i.Quaternion=function(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._w=n!==undefined?n:1};i.Quaternion.prototype={constructor:i.Quaternion,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e;this.onChangeCallback()},set:function(e,t,r,n){this._x=e;this._y=t;this._z=r;this._w=n;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(e instanceof i.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=Math.cos(e._x/2);var n=Math.cos(e._y/2);var a=Math.cos(e._z/2);var o=Math.sin(e._x/2);var s=Math.sin(e._y/2);var h=Math.sin(e._z/2);var u=e.order;if(u==="XYZ"){this._x=o*n*a+r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a-o*s*h}else if(u==="YXZ"){this._x=o*n*a+r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a+o*s*h}else if(u==="ZXY"){this._x=o*n*a-r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a-o*s*h}else if(u==="ZYX"){this._x=o*n*a-r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a+o*s*h}else if(u==="YZX"){this._x=o*n*a+r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a-o*s*h}else if(u==="XZY"){this._x=o*n*a-r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a+o*s*h}if(t!==false)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);this._x=e.x*n;this._y=e.y*n;this._z=e.z*n;this._w=Math.cos(r);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],n=t[4],i=t[8],a=t[1],o=t[5],s=t[9],h=t[2],u=t[6],l=t[10],c=r+o+l,f;if(c>0){f=.5/Math.sqrt(c+1);this._w=.25/f;this._x=(u-s)*f;this._y=(i-h)*f;this._z=(a-n)*f}else if(r>o&&r>l){f=2*Math.sqrt(1+r-o-l);this._w=(u-s)/f;this._x=.25*f;this._y=(n+a)/f;this._z=(i+h)/f}else if(o>l){f=2*Math.sqrt(1+o-r-l);this._w=(i-h)/f;this._x=(n+a)/f;this._y=.25*f;this._z=(s+u)/f}else{f=2*Math.sqrt(1+l-r-o);this._w=(a-n)/f;this._x=(i+h)/f;this._y=(s+u)/f;this._z=.25*f}this.onChangeCallback();return this},setFromUnitVectors:function(){var e,t;var r=1e-6;return function(n,a){if(e===undefined)e=new i.Vector3;t=n.dot(a)+1;if(t<r){t=0;if(Math.abs(n.x)>Math.abs(n.z)){e.set(-n.y,n.x,0)}else{e.set(0,-n.z,n.y)}}else{e.crossVectors(n,a)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this.onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w;var o=t._x,s=t._y,h=t._z,u=t._w;this._x=r*u+a*o+n*h-i*s;this._y=n*u+a*s+i*o-r*h;this._z=i*u+a*h+r*s-n*o;this._w=a*u-r*o-n*s-i*h;this.onChangeCallback();return this},multiplyVector3:function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w;var o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=a;this._x=r;this._y=n;this._z=i;return this}var s=Math.acos(o);var h=Math.sqrt(1-o*o);if(Math.abs(h)<.001){this._w=.5*(a+this._w);this._x=.5*(r+this._x);this._y=.5*(n+this._y);this._z=.5*(i+this._z);return this}var u=Math.sin((1-t)*s)/h,l=Math.sin(t*s)/h;this._w=a*u+this._w*l;this._x=r*u+this._x*l;this._y=n*u+this._y*l;this._z=i*u+this._z*l;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){}};i.Quaternion.slerp=function(e,t,r,n){return r.copy(e).slerp(t,n)};i.Vector2=function(e,t){this.x=e||0;this.y=t||0};i.Vector2.prototype={constructor:i.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subScalar:function(e){this.x-=e;this.y-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t}else{this.x=0;this.y=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},clampScalar:function(){var e,t;return function r(n,a){if(e===undefined){e=new i.Vector2;t=new i.Vector2}e.set(n,n);t.set(a,a);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];return this}};i.Vector3=function(e,t,r){this.x=e||0;this.y=t||0;this.z=r||0};i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,r){this.x=e;this.y=t;this.z=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function t(r){if(r instanceof i.Euler===false){console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromEuler(r));return this}}(),applyAxisAngle:function(){var e;return function t(r,n){if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromAxisAngle(r,n));return this}}(),applyMatrix3:function(e){var t=this.x;var r=this.y;var n=this.z;var i=e.elements;this.x=i[0]*t+i[3]*r+i[6]*n;this.y=i[1]*t+i[4]*r+i[7]*n;this.z=i[2]*t+i[5]*r+i[8]*n;return this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z;var i=e.elements;this.x=i[0]*t+i[4]*r+i[8]*n+i[12];this.y=i[1]*t+i[5]*r+i[9]*n+i[13];this.z=i[2]*t+i[6]*r+i[10]*n+i[14];return this},applyProjection:function(e){var t=this.x,r=this.y,n=this.z;var i=e.elements;var a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a;this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a;this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a;return this},applyQuaternion:function(e){var t=this.x;var r=this.y;var n=this.z;var i=e.x;var a=e.y;var o=e.z;var s=e.w;var h=s*t+a*n-o*r;var u=s*r+o*t-i*n;var l=s*n+i*r-a*t;var c=-i*t-a*r-o*n;this.x=h*s+c*-i+u*-o-l*-a;this.y=u*s+c*-a+l*-i-h*-o;this.z=l*s+c*-o+h*-a-u*-i;return this},project:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.multiplyMatrices(r.projectionMatrix,e.getInverse(r.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z;var i=e.elements;this.x=i[0]*t+i[4]*r+i[8]*n;this.y=i[1]*t+i[5]*r+i[9]*n;this.z=i[2]*t+i[6]*r+i[10]*n;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},clampScalar:function(){var e,t;return function r(n,a){if(e===undefined){e=new i.Vector3;t=new i.Vector3}e.set(n,n,n);t.set(a,a,a);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},cross:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var r=this.x,n=this.y,i=this.z;this.x=n*e.z-i*e.y;this.y=i*e.x-r*e.z;this.z=r*e.y-n*e.x;return this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z;var a=t.x,o=t.y,s=t.z;this.x=n*s-i*o;this.y=i*a-r*s;this.z=r*o-n*a;return this},projectOnVector:function(){var e,t;return function r(n){if(e===undefined)e=new i.Vector3;e.copy(n).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function t(r){if(e===undefined)e=new i.Vector3;e.copy(this).projectOnVector(r);return this.sub(e)}}(),reflect:function(){var e;return function t(r){if(e===undefined)e=new i.Vector3;return this.sub(e.copy(r).multiplyScalar(2*this.dot(r)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var r=this.y-e.y;var n=this.z-e.z;return t*t+r*r+n*n},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var r=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=r;this.z=n;return this},setFromMatrixColumn:function(e,t){var r=e*4;var n=t.elements;this.x=n[r];this.y=n[r+1];this.z=n[r+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];return this}};i.Vector4=function(e,t,r,n){this.x=e||0;this.y=t||0;this.z=r||0;this.w=n!==undefined?n:1};i.Vector4.prototype={constructor:i.Vector4,set:function(e,t,r,n){this.x=e;this.y=t;this.z=r;this.w=n;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;
this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var r=this.y;var n=this.z;var i=this.w;var a=e.elements;this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i;this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i;this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i;this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t;this.w*=t}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=.01,o=.1,s=e.elements,h=s[0],u=s[4],l=s[8],c=s[1],f=s[5],d=s[9],p=s[2],m=s[6],v=s[10];if(Math.abs(u-c)<a&&Math.abs(l-p)<a&&Math.abs(d-m)<a){if(Math.abs(u+c)<o&&Math.abs(l+p)<o&&Math.abs(d+m)<o&&Math.abs(h+f+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(h+1)/2;var y=(f+1)/2;var x=(v+1)/2;var b=(u+c)/4;var w=(l+p)/4;var _=(d+m)/4;if(g>y&&g>x){if(g<a){r=0;n=.707106781;i=.707106781}else{r=Math.sqrt(g);n=b/r;i=w/r}}else if(y>x){if(y<a){r=.707106781;n=0;i=.707106781}else{n=Math.sqrt(y);r=b/n;i=_/n}}else{if(x<a){r=.707106781;n=.707106781;i=0}else{i=Math.sqrt(x);r=w/i;n=_/i}}this.set(r,n,i,t);return this}var M=Math.sqrt((m-d)*(m-d)+(l-p)*(l-p)+(c-u)*(c-u));if(Math.abs(M)<.001)M=1;this.x=(m-d)/M;this.y=(l-p)/M;this.z=(c-u)/M;this.w=Math.acos((h+f+v-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},clampScalar:function(){var e,t;return function r(n,a){if(e===undefined){e=new i.Vector4;t=new i.Vector4}e.set(n,n,n,n);t.set(a,a,a,a);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];this.w=e.array[t+3];return this}};i.Euler=function(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._order=n||i.Euler.DefaultOrder};i.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];i.Euler.DefaultOrder="XYZ";i.Euler.prototype={constructor:i.Euler,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e;this.onChangeCallback()},set:function(e,t,r,n){this._x=e;this._y=t;this._z=r;this._order=n||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t,r){var n=i.Math.clamp;var a=e.elements;var o=a[0],s=a[4],h=a[8];var u=a[1],l=a[5],c=a[9];var f=a[2],d=a[6],p=a[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(n(h,-1,1));if(Math.abs(h)<.99999){this._x=Math.atan2(-c,p);this._z=Math.atan2(-s,o)}else{this._x=Math.atan2(d,l);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-n(c,-1,1));if(Math.abs(c)<.99999){this._y=Math.atan2(h,p);this._z=Math.atan2(u,l)}else{this._y=Math.atan2(-f,o);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(n(d,-1,1));if(Math.abs(d)<.99999){this._y=Math.atan2(-f,p);this._z=Math.atan2(-s,l)}else{this._y=0;this._z=Math.atan2(u,o)}}else if(t==="ZYX"){this._y=Math.asin(-n(f,-1,1));if(Math.abs(f)<.99999){this._x=Math.atan2(d,p);this._z=Math.atan2(u,o)}else{this._x=0;this._z=Math.atan2(-s,l)}}else if(t==="YZX"){this._z=Math.asin(n(u,-1,1));if(Math.abs(u)<.99999){this._x=Math.atan2(-c,l);this._y=Math.atan2(-f,o)}else{this._x=0;this._y=Math.atan2(h,p)}}else if(t==="XZY"){this._z=Math.asin(-n(s,-1,1));if(Math.abs(s)<.99999){this._x=Math.atan2(d,l);this._y=Math.atan2(h,o)}else{this._x=Math.atan2(-c,p);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t)}this._order=t;if(r!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var e;return function(t,r,n){if(e===undefined)e=new i.Matrix4;e.makeRotationFromQuaternion(t);this.setFromRotationMatrix(e,r,n);return this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new i.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e},toVector3:function(e){if(e){return e.set(this._x,this._y,this._z)}else{return new i.Vector3(this._x,this._y,this._z)}},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){}};i.Line3=function(e,t){this.start=e!==undefined?e:new i.Vector3;this.end=t!==undefined?t:new i.Vector3};i.Line3.prototype={constructor:i.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new i.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new i.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r,n){e.subVectors(r,this.start);t.subVectors(this.end,this.start);var a=t.dot(t);var o=t.dot(e);var s=o/a;if(n){s=i.Math.clamp(s,0,1)}return s}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);var a=r||new i.Vector3;return this.delta(a).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}};i.Box2=function(e,t){this.min=e!==undefined?e:new i.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new i.Vector2(-Infinity,-Infinity)};i.Box2.prototype={constructor:i.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new i.Vector2;return function(t,r){var n=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(n);this.max.copy(t).add(n);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new i.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var r=t||new i.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var r=t||new i.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};i.Box3=function(e,t){this.min=e!==undefined?e:new i.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new i.Vector3(-Infinity,-Infinity,-Infinity)};i.Box3.prototype={constructor:i.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new i.Vector3;return function(t,r){var n=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(n);this.max.copy(t).add(n);return this}}(),setFromObject:function(){var e=new i.Vector3;return function(t){var r=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){var n=t.geometry;if(n!==undefined){if(n instanceof i.Geometry){var a=n.vertices;for(var o=0,s=a.length;o<s;o++){e.copy(a[o]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}else if(n instanceof i.BufferGeometry&&n.attributes["position"]!==undefined){var h=n.attributes["position"].array;for(var o=0,s=h.length;o<s;o+=3){e.set(h[o],h[o+1],h[o+2]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var r=t||new i.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var r=t||new i.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new i.Vector3;return function(t){var r=t||new i.Sphere;r.center=this.center();r.radius=this.size(e).length()*.5;return r}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};i.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};i.Matrix3.prototype={constructor:i.Matrix3,set:function(e,t,r,n,i,a,o,s,h){var u=this.elements;u[0]=e;u[3]=t;u[6]=r;u[1]=n;u[4]=i;u[7]=a;u[2]=o;u[5]=s;u[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,n){if(e===undefined)e=new i.Vector3;if(r===undefined)r=0;if(n===undefined)n=t.length;for(var a=0,o=r;a<n;a+=3,o+=3){e.fromArray(t,o);e.applyMatrix3(this);e.toArray(t,o)}return t}}(),applyToBuffer:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Vector3;if(n===undefined)n=0;if(a===undefined)a=r.length/r.itemSize;for(var o=0,s=n;o<a;o++,s++){e.x=r.getX(s);e.y=r.getY(s);e.z=r.getZ(s);e.applyMatrix3(this);r.setXYZ(e.x,e.y,e.z)}return r}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],h=e[7],u=e[8];return t*a*u-t*o*h-r*i*u+r*o*s+n*i*h-n*a*s},getInverse:function(e,t){var r=e.elements;var n=this.elements;n[0]=r[10]*r[5]-r[6]*r[9];n[1]=-r[10]*r[1]+r[2]*r[9];n[2]=r[6]*r[1]-r[2]*r[5];n[3]=-r[10]*r[4]+r[6]*r[8];n[4]=r[10]*r[0]-r[2]*r[8];n[5]=-r[6]*r[0]+r[2]*r[4];n[6]=r[9]*r[4]-r[5]*r[8];n[7]=-r[9]*r[0]+r[1]*r[8];n[8]=r[5]*r[0]-r[1]*r[4];var i=r[0]*n[0]+r[1]*n[3]+r[2]*n[6];if(i===0){var a="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(a)}else{console.warn(a)}this.identity();return this}this.multiplyScalar(1/i);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];return e},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}};i.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};i.Matrix4.prototype={constructor:i.Matrix4,set:function(e,t,r,n,i,a,o,s,h,u,l,c,f,d,p,m){var v=this.elements;v[0]=e;v[4]=t;v[8]=r;v[12]=n;v[1]=i;v[5]=a;v[9]=o;v[13]=s;v[2]=h;v[6]=u;v[10]=l;v[14]=c;v[3]=f;v[7]=d;v[11]=p;v[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new i.Matrix4).fromArray(this.elements)},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var r=e.elements;t[12]=r[12];t[13]=r[13];t[14]=r[14];return this},extractBasis:function(e,t,r){var n=this.elements;e.set(n[0],n[1],n[2]);t.set(n[4],n[5],n[6]);r.set(n[8],n[9],n[10]);return this},makeBasis:function(e,t,r){this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1);return this},extractRotation:function(){var e;return function(t){if(e===undefined)e=new i.Vector3;var r=this.elements;var n=t.elements;var a=1/e.set(n[0],n[1],n[2]).length();var o=1/e.set(n[4],n[5],n[6]).length();var s=1/e.set(n[8],n[9],n[10]).length();r[0]=n[0]*a;r[1]=n[1]*a;r[2]=n[2]*a;r[4]=n[4]*o;r[5]=n[5]*o;r[6]=n[6]*o;r[8]=n[8]*s;r[9]=n[9]*s;r[10]=n[10]*s;return this}}(),makeRotationFromEuler:function(e){if(e instanceof i.Euler===false){console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var r=e.x,n=e.y,a=e.z;var o=Math.cos(r),s=Math.sin(r);var h=Math.cos(n),u=Math.sin(n);var l=Math.cos(a),c=Math.sin(a);if(e.order==="XYZ"){var f=o*l,d=o*c,p=s*l,m=s*c;t[0]=h*l;t[4]=-h*c;t[8]=u;t[1]=d+p*u;t[5]=f-m*u;t[9]=-s*h;t[2]=m-f*u;t[6]=p+d*u;t[10]=o*h}else if(e.order==="YXZ"){var v=h*l,g=h*c,y=u*l,x=u*c;t[0]=v+x*s;t[4]=y*s-g;t[8]=o*u;t[1]=o*c;t[5]=o*l;t[9]=-s;t[2]=g*s-y;t[6]=x+v*s;t[10]=o*h}else if(e.order==="ZXY"){var v=h*l,g=h*c,y=u*l,x=u*c;t[0]=v-x*s;t[4]=-o*c;t[8]=y+g*s;t[1]=g+y*s;t[5]=o*l;t[9]=x-v*s;t[2]=-o*u;t[6]=s;t[10]=o*h}else if(e.order==="ZYX"){var f=o*l,d=o*c,p=s*l,m=s*c;t[0]=h*l;t[4]=p*u-d;t[8]=f*u+m;t[1]=h*c;t[5]=m*u+f;t[9]=d*u-p;t[2]=-u;t[6]=s*h;t[10]=o*h}else if(e.order==="YZX"){var b=o*h,w=o*u,_=s*h,M=s*u;t[0]=h*l;t[4]=M-b*c;t[8]=_*c+w;t[1]=c;t[5]=o*l;t[9]=-s*l;t[2]=-u*l;t[6]=w*c+_;t[10]=b-M*c}else if(e.order==="XZY"){var b=o*h,w=o*u,_=s*h,M=s*u;t[0]=h*l;t[4]=-c;t[8]=u*l;t[1]=b*c+M;t[5]=o*l;t[9]=w*c-_;t[2]=_*c-w;t[6]=s*l;t[10]=M*c+b}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var r=e.x,n=e.y,i=e.z,a=e.w;var o=r+r,s=n+n,h=i+i;var u=r*o,l=r*s,c=r*h;var f=n*s,d=n*h,p=i*h;var m=a*o,v=a*s,g=a*h;t[0]=1-(f+p);t[4]=l-g;t[8]=c+v;t[1]=l+g;t[5]=1-(u+p);t[9]=d-m;t[2]=c-v;t[6]=d+m;t[10]=1-(u+f);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e,t,r;return function(n,a,o){if(e===undefined)e=new i.Vector3;if(t===undefined)t=new i.Vector3;if(r===undefined)r=new i.Vector3;var s=this.elements;r.subVectors(n,a).normalize();if(r.length()===0){r.z=1}e.crossVectors(o,r).normalize();if(e.length()===0){r.x+=1e-4;e.crossVectors(o,r).normalize()}t.crossVectors(r,e);s[0]=e.x;s[4]=t.x;s[8]=r.x;s[1]=e.y;s[5]=t.y;s[9]=r.y;s[2]=e.z;s[6]=t.z;s[10]=r.z;return this}}(),multiply:function(e,t){if(t!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements;var n=t.elements;var i=this.elements;var a=r[0],o=r[4],s=r[8],h=r[12];var u=r[1],l=r[5],c=r[9],f=r[13];var d=r[2],p=r[6],m=r[10],v=r[14];var g=r[3],y=r[7],x=r[11],b=r[15];var w=n[0],_=n[4],M=n[8],S=n[12];var T=n[1],E=n[5],C=n[9],A=n[13];var L=n[2],P=n[6],R=n[10],D=n[14];var k=n[3],F=n[7],O=n[11],U=n[15];i[0]=a*w+o*T+s*L+h*k;i[4]=a*_+o*E+s*P+h*F;i[8]=a*M+o*C+s*R+h*O;i[12]=a*S+o*A+s*D+h*U;i[1]=u*w+l*T+c*L+f*k;i[5]=u*_+l*E+c*P+f*F;i[9]=u*M+l*C+c*R+f*O;i[13]=u*S+l*A+c*D+f*U;i[2]=d*w+p*T+m*L+v*k;i[6]=d*_+p*E+m*P+v*F;i[10]=d*M+p*C+m*R+v*O;i[14]=d*S+p*A+m*D+v*U;i[3]=g*w+y*T+x*L+b*k;i[7]=g*_+y*E+x*P+b*F;i[11]=g*M+y*C+x*R+b*O;i[15]=g*S+y*A+x*D+b*U;return this},multiplyToArray:function(e,t,r){var n=this.elements;this.multiplyMatrices(e,t);r[0]=n[0];r[1]=n[1];r[2]=n[2];r[3]=n[3];r[4]=n[4];r[5]=n[5];r[6]=n[6];r[7]=n[7];r[8]=n[8];r[9]=n[9];r[10]=n[10];r[11]=n[11];r[12]=n[12];r[13]=n[13];r[14]=n[14];r[15]=n[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,n){if(e===undefined)e=new i.Vector3;if(r===undefined)r=0;if(n===undefined)n=t.length;for(var a=0,o=r;a<n;a+=3,o+=3){e.fromArray(t,o);e.applyMatrix4(this);e.toArray(t,o)}return t}}(),applyToBuffer:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Vector3;if(n===undefined)n=0;if(a===undefined)a=r.length/r.itemSize;for(var o=0,s=n;o<a;o++,s++){e.x=r.getX(s);e.y=r.getY(s);e.z=r.getZ(s);e.applyMatrix4(this);r.setXYZ(e.x,e.y,e.z)}return r}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],r=e[4],n=e[8],i=e[12];var a=e[1],o=e[5],s=e[9],h=e[13];var u=e[2],l=e[6],c=e[10],f=e[14];var d=e[3],p=e[7],m=e[11],v=e[15];return d*(+i*s*l-n*h*l-i*o*c+r*h*c+n*o*f-r*s*f)+p*(+t*s*f-t*h*c+i*a*c-n*a*f+n*h*u-i*s*u)+m*(+t*h*l-t*o*f-i*a*l+r*a*f+i*o*u-r*h*u)+v*(-n*o*u-t*s*l+t*o*c+n*a*l-r*a*c+r*s*u)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];e[t+9]=r[9];e[t+10]=r[10];e[t+11]=r[11];e[t+12]=r[12];e[t+13]=r[13];e[t+14]=r[14];e[t+15]=r[15];return e},getPosition:function(){var e;return function(){if(e===undefined)e=new i.Vector3;console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var r=this.elements;var n=e.elements;var i=n[0],a=n[4],o=n[8],s=n[12];var h=n[1],u=n[5],l=n[9],c=n[13];var f=n[2],d=n[6],p=n[10],m=n[14];var v=n[3],g=n[7],y=n[11],x=n[15];r[0]=l*m*g-c*p*g+c*d*y-u*m*y-l*d*x+u*p*x;r[4]=s*p*g-o*m*g-s*d*y+a*m*y+o*d*x-a*p*x;r[8]=o*c*g-s*l*g+s*u*y-a*c*y-o*u*x+a*l*x;r[12]=s*l*d-o*c*d-s*u*p+a*c*p+o*u*m-a*l*m;r[1]=c*p*v-l*m*v-c*f*y+h*m*y+l*f*x-h*p*x;r[5]=o*m*v-s*p*v+s*f*y-i*m*y-o*f*x+i*p*x;r[9]=s*l*v-o*c*v-s*h*y+i*c*y+o*h*x-i*l*x;r[13]=o*c*f-s*l*f+s*h*p-i*c*p-o*h*m+i*l*m;r[2]=u*m*v-c*d*v+c*f*g-h*m*g-u*f*x+h*d*x;r[6]=s*d*v-a*m*v-s*f*g+i*m*g+a*f*x-i*d*x;r[10]=a*c*v-s*u*v+s*h*g-i*c*g-a*h*x+i*u*x;r[14]=s*u*f-a*c*f-s*h*d+i*c*d+a*h*m-i*u*m;r[3]=l*d*v-u*p*v-l*f*g+h*p*g+u*f*y-h*d*y;r[7]=a*p*v-o*d*v+o*f*g-i*p*g-a*f*y+i*d*y;r[11]=o*u*v-a*l*v-o*h*g+i*l*g+a*h*y-i*u*y;r[15]=a*l*f-o*u*f+o*h*d-i*l*d-a*h*p+i*u*p;var b=i*r[0]+h*r[4]+f*r[8]+v*r[12];if(b===0){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(w)}else{console.warn(w)}this.identity();return this}this.multiplyScalar(1/b);return this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var r=e.x,n=e.y,i=e.z;t[0]*=r;t[4]*=n;t[8]*=i;t[1]*=r;t[5]*=n;t[9]*=i;t[2]*=r;t[6]*=n;t[10]*=i;t[3]*=r;t[7]*=n;t[11]*=i;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,n)))},makeTranslation:function(e,t,r){this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var r=Math.cos(t);var n=Math.sin(t);var i=1-r;var a=e.x,o=e.y,s=e.z;var h=i*a,u=i*o;this.set(h*a+r,h*o-n*s,h*s+n*o,0,h*o+n*s,u*o+r,u*s-n*a,0,h*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1);return this},makeScale:function(e,t,r){this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1);return this},compose:function(e,t,r){this.makeRotationFromQuaternion(t);this.scale(r);this.setPosition(e);return this},decompose:function(){var e,t;return function(r,n,a){if(e===undefined)e=new i.Vector3;if(t===undefined)t=new i.Matrix4;var o=this.elements;var s=e.set(o[0],o[1],o[2]).length();var h=e.set(o[4],o[5],o[6]).length();var u=e.set(o[8],o[9],o[10]).length();var l=this.determinant();if(l<0){s=-s}r.x=o[12];r.y=o[13];r.z=o[14];t.elements.set(this.elements);var c=1/s;var f=1/h;var d=1/u;t.elements[0]*=c;t.elements[1]*=c;t.elements[2]*=c;t.elements[4]*=f;t.elements[5]*=f;t.elements[6]*=f;t.elements[8]*=d;t.elements[9]*=d;t.elements[10]*=d;n.setFromRotationMatrix(t);a.x=s;a.y=h;a.z=u;return this}}(),makeFrustum:function(e,t,r,n,i,a){var o=this.elements;var s=2*i/(t-e);var h=2*i/(n-r);var u=(t+e)/(t-e);var l=(n+r)/(n-r);var c=-(a+i)/(a-i);var f=-2*a*i/(a-i);o[0]=s;o[4]=0;o[8]=u;o[12]=0;o[1]=0;o[5]=h;o[9]=l;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=f;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,r,n){var a=r*Math.tan(i.Math.degToRad(e*.5));var o=-a;var s=o*t;var h=a*t;return this.makeFrustum(s,h,o,a,r,n)},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements;var s=t-e;var h=r-n;var u=a-i;var l=(t+e)/s;var c=(r+n)/h;var f=(a+i)/u;o[0]=2/s;o[4]=0;o[8]=0;o[12]=-l;o[1]=0;o[5]=2/h;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/u;o[14]=-f;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},equals:function(e){var t=this.elements;var r=e.elements;for(var n=0;n<16;n++){if(t[n]!==r[n])return false}return true},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}};i.Ray=function(e,t){this.origin=e!==undefined?e:new i.Vector3;this.direction=t!==undefined?t:new i.Vector3};i.Ray.prototype={constructor:i.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var r=t||new i.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new i.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var r=t||new i.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);if(n<0){return r.copy(this.origin)}return r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new i.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);if(r<0){return this.origin.distanceToSquared(t)}e.copy(this.direction).multiplyScalar(r).add(this.origin);return e.distanceToSquared(t)}}(),distanceSqToSegment:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(n,i,a,o){e.copy(n).add(i).multiplyScalar(.5);t.copy(i).sub(n).normalize();r.copy(this.origin).sub(e);var s=n.distanceTo(i)*.5;var h=-this.direction.dot(t);var u=r.dot(this.direction);var l=-r.dot(t);var c=r.lengthSq();var f=Math.abs(1-h*h);var d,p,m,v;if(f>0){d=h*l-u;p=h*u-l;v=s*f;if(d>=0){if(p>=-v){if(p<=v){var g=1/f;d*=g;p*=g;m=d*(d+h*p+2*u)+p*(h*d+p+2*l)+c}else{p=s;d=Math.max(0,-(h*p+u));m=-d*d+p*(p+2*l)+c}}else{p=-s;d=Math.max(0,-(h*p+u));m=-d*d+p*(p+2*l)+c}}else{if(p<=-v){
d=Math.max(0,-(-h*s+u));p=d>0?-s:Math.min(Math.max(-s,-l),s);m=-d*d+p*(p+2*l)+c}else if(p<=v){d=0;p=Math.min(Math.max(-s,-l),s);m=p*(p+2*l)+c}else{d=Math.max(0,-(h*s+u));p=d>0?s:Math.min(Math.max(-s,-l),s);m=-d*d+p*(p+2*l)+c}}}else{p=h>0?-s:s;d=Math.max(0,-(h*p+u));m=-d*d+p*(p+2*l)+c}if(a){a.copy(this.direction).multiplyScalar(d).add(this.origin)}if(o){o.copy(t).multiplyScalar(p).add(e)}return m}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new i.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction);var i=e.dot(e)-n*n;var a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i);var s=n-o;var h=n+o;if(s<0&&h<0)return null;if(s<0)return this.at(h,r);return this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var r=e.normal.dot(this.direction);if(r*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0){if(e.distanceToPoint(this.origin)===0){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(r===null){return null}return this.at(r,t)},isIntersectionBox:function(){var e=new i.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var r,n,i,a,o,s;var h=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z;var c=this.origin;if(h>=0){r=(e.min.x-c.x)*h;n=(e.max.x-c.x)*h}else{r=(e.max.x-c.x)*h;n=(e.min.x-c.x)*h}if(u>=0){i=(e.min.y-c.y)*u;a=(e.max.y-c.y)*u}else{i=(e.max.y-c.y)*u;a=(e.min.y-c.y)*u}if(r>a||i>n)return null;if(i>r||r!==r)r=i;if(a<n||n!==n)n=a;if(l>=0){o=(e.min.z-c.z)*l;s=(e.max.z-c.z)*l}else{o=(e.max.z-c.z)*l;s=(e.min.z-c.z)*l}if(r>s||o>n)return null;if(o>r||r!==r)r=o;if(s<n||n!==n)n=s;if(n<0)return null;return this.at(r>=0?r:n,t)},intersectTriangle:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;var n=new i.Vector3;return function(i,a,o,s,h){t.subVectors(a,i);r.subVectors(o,i);n.crossVectors(t,r);var u=this.direction.dot(n);var l;if(u>0){if(s)return null;l=1}else if(u<0){l=-1;u=-u}else{return null}e.subVectors(this.origin,i);var c=l*this.direction.dot(r.crossVectors(e,r));if(c<0){return null}var f=l*this.direction.dot(t.cross(e));if(f<0){return null}if(c+f>u){return null}var d=-l*e.dot(n);if(d<0){return null}return this.at(d/u,h)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}};i.Sphere=function(e,t){this.center=e!==undefined?e:new i.Vector3;this.radius=t!==undefined?t:0};i.Sphere.prototype={constructor:i.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new i.Box3;return function(t,r){var n=this.center;if(r!==undefined){n.copy(r)}else{e.setFromPoints(t).center(n)}var i=0;for(var a=0,o=t.length;a<o;a++){i=Math.max(i,n.distanceToSquared(t[a]))}this.radius=Math.sqrt(i);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);var n=t||new i.Vector3;n.copy(e);if(r>this.radius*this.radius){n.sub(this.center).normalize();n.multiplyScalar(this.radius).add(this.center)}return n},getBoundingBox:function(e){var t=e||new i.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}};i.Frustum=function(e,t,r,n,a,o){this.planes=[e!==undefined?e:new i.Plane,t!==undefined?t:new i.Plane,r!==undefined?r:new i.Plane,n!==undefined?n:new i.Plane,a!==undefined?a:new i.Plane,o!==undefined?o:new i.Plane]};i.Frustum.prototype={constructor:i.Frustum,set:function(e,t,r,n,i,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(r);o[3].copy(n);o[4].copy(i);o[5].copy(a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=this.planes;for(var r=0;r<6;r++){t[r].copy(e.planes[r])}return this},setFromMatrix:function(e){var t=this.planes;var r=e.elements;var n=r[0],i=r[1],a=r[2],o=r[3];var s=r[4],h=r[5],u=r[6],l=r[7];var c=r[8],f=r[9],d=r[10],p=r[11];var m=r[12],v=r[13],g=r[14],y=r[15];t[0].setComponents(o-n,l-s,p-c,y-m).normalize();t[1].setComponents(o+n,l+s,p+c,y+m).normalize();t[2].setComponents(o+i,l+h,p+f,y+v).normalize();t[3].setComponents(o-i,l-h,p-f,y-v).normalize();t[4].setComponents(o-a,l-u,p-d,y-g).normalize();t[5].setComponents(o+a,l+u,p+d,y+g).normalize();return this},intersectsObject:function(){var e=new i.Sphere;return function(t){var r=t.geometry;if(r.boundingSphere===null)r.computeBoundingSphere();e.copy(r.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var r=e.center;var n=-e.radius;for(var i=0;i<6;i++){var a=t[i].distanceToPoint(r);if(a<n){return false}}return true},intersectsBox:function(){var e=new i.Vector3,t=new i.Vector3;return function(r){var n=this.planes;for(var i=0;i<6;i++){var a=n[i];e.x=a.normal.x>0?r.min.x:r.max.x;t.x=a.normal.x>0?r.max.x:r.min.x;e.y=a.normal.y>0?r.min.y:r.max.y;t.y=a.normal.y>0?r.max.y:r.min.y;e.z=a.normal.z>0?r.min.z:r.max.z;t.z=a.normal.z>0?r.max.z:r.min.z;var o=a.distanceToPoint(e);var s=a.distanceToPoint(t);if(o<0&&s<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var r=0;r<6;r++){if(t[r].distanceToPoint(e)<0){return false}}return true}};i.Plane=function(e,t){this.normal=e!==undefined?e:new i.Vector3(1,0,0);this.constant=t!==undefined?t:0};i.Plane.prototype={constructor:i.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,r,n){this.normal.set(e,t,r);this.constant=n;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r,n,i){var a=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();this.setFromNormalAndCoplanarPoint(a,r);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);var n=t||new i.Vector3;return n.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new i.Vector3;return function(t,r){var n=r||new i.Vector3;var a=t.delta(e);var o=this.normal.dot(a);if(o===0){if(this.distanceToPoint(t.start)===0){return n.copy(t.start)}return undefined}var s=-(t.start.dot(this.normal)+this.constant)/o;if(s<0||s>1){return undefined}return n.copy(a).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t=e||new i.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function(n,i){var a=i||r.getNormalMatrix(n);var o=e.copy(this.normal).applyMatrix3(a);var s=this.coplanarPoint(t);s.applyMatrix4(n);this.setFromNormalAndCoplanarPoint(o,s);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}};i.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var r=0,n;return function(){for(var i=0;i<36;i++){if(i===8||i===13||i===18||i===23){t[i]="-"}else if(i===14){t[i]="4"}else{if(r<=2)r=33554432+Math.random()*16777216|0;n=r&15;r=r>>4;t[i]=e[i===19?n&3|8:n]}}return t.join("")}}(),clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},smoothstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*(3-2*e)},smootherstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},nextPowerOfTwo:function(e){e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;e++;return e}};i.Spline=function(e){this.points=e;var t=[],r={x:0,y:0,z:0},n,a,o,s,h,u,l,c,f;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){n=(this.points.length-1)*e;a=Math.floor(n);o=n-a;t[0]=a===0?a:a-1;t[1]=a;t[2]=a>this.points.length-2?this.points.length-1:a+1;t[3]=a>this.points.length-3?this.points.length-1:a+2;u=this.points[t[0]];l=this.points[t[1]];c=this.points[t[2]];f=this.points[t[3]];s=o*o;h=o*s;r.x=d(u.x,l.x,c.x,f.x,o,s,h);r.y=d(u.y,l.y,c.y,f.y,o,s,h);r.z=d(u.z,l.z,c.z,f.z,o,s,h);return r};this.getControlPointsArray=function(){var e,t,r=this.points.length,n=[];for(e=0;e<r;e++){t=this.points[e];n[e]=[t.x,t.y,t.z]}return n};this.getLength=function(e){var t,r,n,a,o=0,s=0,h=0,u=new i.Vector3,l=new i.Vector3,c=[],f=0;c[0]=0;if(!e)e=100;n=this.points.length*e;u.copy(this.points[0]);for(t=1;t<n;t++){r=t/n;a=this.getPoint(r);l.copy(a);f+=l.distanceTo(u);u.copy(a);o=(this.points.length-1)*r;s=Math.floor(o);if(s!==h){c[s]=f;h=s}}c[c.length]=f;return{chunks:c,total:f}};this.reparametrizeByArcLength=function(e){var t,r,n,a,o,s,h,u,l=[],c=new i.Vector3,f=this.getLength();l.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){s=f.chunks[t]-f.chunks[t-1];h=Math.ceil(e*s/f.total);a=(t-1)/(this.points.length-1);o=t/(this.points.length-1);for(r=1;r<h-1;r++){n=a+r*(1/h)*(o-a);u=this.getPoint(n);l.push(c.copy(u).clone())}l.push(c.copy(this.points[t]).clone())}this.points=l};function d(e,t,r,n,i,a,o){var s=(r-e)*.5,h=(n-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*i+t}};i.Triangle=function(e,t,r){this.a=e!==undefined?e:new i.Vector3;this.b=t!==undefined?t:new i.Vector3;this.c=r!==undefined?r:new i.Vector3};i.Triangle.normal=function(){var e=new i.Vector3;return function(t,r,n,a){var o=a||new i.Vector3;o.subVectors(n,r);e.subVectors(t,r);o.cross(e);var s=o.lengthSq();if(s>0){return o.multiplyScalar(1/Math.sqrt(s))}return o.set(0,0,0)}}();i.Triangle.barycoordFromPoint=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(n,a,o,s,h){e.subVectors(s,a);t.subVectors(o,a);r.subVectors(n,a);var u=e.dot(e);var l=e.dot(t);var c=e.dot(r);var f=t.dot(t);var d=t.dot(r);var p=u*f-l*l;var m=h||new i.Vector3;if(p===0){return m.set(-2,-1,-1)}var v=1/p;var g=(f*c-l*d)*v;var y=(u*d-l*c)*v;return m.set(1-g-y,y,g)}}();i.Triangle.containsPoint=function(){var e=new i.Vector3;return function(t,r,n,a){var o=i.Triangle.barycoordFromPoint(t,r,n,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}();i.Triangle.prototype={constructor:i.Triangle,set:function(e,t,r){this.a.copy(e);this.b.copy(t);this.c.copy(r);return this},setFromPointsAndIndices:function(e,t,r,n){this.a.copy(e[t]);this.b.copy(e[r]);this.c.copy(e[n]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new i.Vector3;var t=new i.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new i.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return i.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new i.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return i.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return i.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};i.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};i.Clock.prototype={constructor:i.Clock,start:function(){this.startTime=n.performance!==undefined&&n.performance.now!==undefined?n.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=n.performance!==undefined&&n.performance.now!==undefined?n.performance.now():Date.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};i.EventDispatcher=function(){};i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(e){e.addEventListener=i.EventDispatcher.prototype.addEventListener;e.hasEventListener=i.EventDispatcher.prototype.hasEventListener;e.removeEventListener=i.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var r=this._listeners;if(r[e]===undefined){r[e]=[]}if(r[e].indexOf(t)===-1){r[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var r=this._listeners;if(r[e]!==undefined&&r[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var r=this._listeners;var n=r[e];if(n!==undefined){var i=n.indexOf(t);if(i!==-1){n.splice(i,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var r=t[e.type];if(r!==undefined){e.target=this;var n=[];var i=r.length;for(var a=0;a<i;a++){n[a]=r[a]}for(var a=0;a<i;a++){n[a].call(this,e)}}}};(function(e){e.Raycaster=function(t,r,n,i){this.ray=new e.Ray(t,r);this.near=n||0;this.far=i||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};function t(e,t){return e.distance-t.distance}var r=function(e,t,n,i){if(e.visible===false)return;e.raycast(t,n);if(i===true){var a=e.children;for(var o=0,s=a.length;o<s;o++){r(a[o],t,n,true)}}};e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){if(r instanceof e.PerspectiveCamera){this.ray.origin.setFromMatrixPosition(r.matrixWorld);this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize()}else if(r instanceof e.OrthographicCamera){this.ray.origin.set(t.x,t.y,-1).unproject(r);this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)}else{console.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(e,n){var i=[];r(e,this,i,n);i.sort(t);return i},intersectObjects:function(e,n){var i=[];if(Array.isArray(e)===false){console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return i}for(var a=0,o=e.length;a<o;a++){r(e[a],this,i,n)}i.sort(t);return i}}})(i);i.Object3D=function(){Object.defineProperty(this,"id",{value:i.Object3DIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=i.Object3D.DefaultUp.clone();var e=new i.Vector3;var t=new i.Euler;var r=new i.Quaternion;var n=new i.Vector3(1,1,1);var a=function(){r.setFromEuler(t,false)};var o=function(){t.setFromQuaternion(r,undefined,false)};t.onChange(a);r.onChange(o);Object.defineProperties(this,{position:{enumerable:true,value:e},rotation:{enumerable:true,value:t},quaternion:{enumerable:true,value:r},scale:{enumerable:true,value:n},modelViewMatrix:{value:new i.Matrix4},normalMatrix:{value:new i.Matrix3}});this.rotationAutoUpdate=true;this.matrix=new i.Matrix4;this.matrixWorld=new i.Matrix4;this.matrixAutoUpdate=i.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};i.Object3D.DefaultUp=new i.Vector3(0,1,0);i.Object3D.DefaultMatrixAutoUpdate=true;i.Object3D.prototype={constructor:i.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i.Quaternion;return function(t,r){e.setFromAxisAngle(t,r);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new i.Vector3;return function(t,r){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(r));return this}}(),translate:function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},translateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new i.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e instanceof i.Object3D){if(e.parent!==null){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}}var r=this.children.indexOf(e);if(r!==-1){e.parent=null;e.dispatchEvent({type:"removed"});this.children.splice(r,1)}},getChildByName:function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r];var a=i.getObjectByProperty(e,t);if(a!==undefined){return a}}return undefined},getWorldPosition:function(e){var t=e||new i.Vector3;this.updateMatrixWorld(true);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r){var n=r||new i.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,n,t);return n}}(),getWorldRotation:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Euler;this.getWorldQuaternion(e);return r.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new i.Vector3;var t=new i.Quaternion;return function(r){var n=r||new i.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,n);return n}}(),getWorldDirection:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;this.getWorldQuaternion(e);return r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);var t=this.children;for(var r=0,n=t.length;r<n;r++){t[r].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);var t=this.children;for(var r=0,n=t.length;r<n;r++){t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;if(t!==null){e(t);t.traverseAncestors(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,r=this.children.length;t<r;t++){this.children[t].updateMatrixWorld(e)}},toJSON:function(e){var t=e===undefined;var r={};if(t){e={geometries:{},materials:{},textures:{},images:{}};r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"}}r.uuid=this.uuid;r.type=this.type;if(this.name!=="")r.name=this.name;if(JSON.stringify(this.userData)!=="{}")r.userData=this.userData;if(this.visible!==true)r.visible=this.visible;r.matrix=this.matrix.toArray();if(this.children.length>0){r.children=[];for(var n=0;n<this.children.length;n++){r.children.push(this.children[n].toJSON(e).object)}}var i={};if(t){var a=u(e.geometries);var o=u(e.materials);var s=u(e.textures);var h=u(e.images);if(a.length>0)i.geometries=a;if(o.length>0)i.materials=o;if(s.length>0)i.textures=s;if(h.length>0)i.images=h}i.object=r;return i;function u(e){var t=[];for(var r in e){var n=e[r];delete n.metadata;t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(t===undefined)t=true;this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.rotationAutoUpdate=e.rotationAutoUpdate;this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(t===true){for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}}return this}};i.EventDispatcher.prototype.apply(i.Object3D.prototype);i.Object3DIdCount=0;i.Face3=function(e,t,r,n,a,o){this.a=e;this.b=t;this.c=r;this.normal=n instanceof i.Vector3?n:new i.Vector3;this.vertexNormals=Array.isArray(n)?n:[];this.color=a instanceof i.Color?a:new i.Color;this.vertexColors=Array.isArray(a)?a:[];this.materialIndex=o!==undefined?o:0};i.Face3.prototype={constructor:i.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a;this.b=e.b;this.c=e.c;this.normal.copy(e.normal);this.color.copy(e.color);this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++){this.vertexNormals[t]=e.vertexNormals[t].clone()}for(var t=0,r=e.vertexColors.length;t<r;t++){this.vertexColors[t]=e.vertexColors[t].clone()}return this}};i.Face4=function(e,t,r,n,a,o,s){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new i.Face3(e,t,r,a,o,s)};i.BufferAttribute=function(e,t){this.uuid=i.Math.generateUUID();this.array=e;this.itemSize=t;this.dynamic=false;this.updateRange={offset:0,count:-1};this.version=0};i.BufferAttribute.prototype={constructor:i.BufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){if(e===true)this.version++},setDynamic:function(e){this.dynamic=e;return this},copy:function(e){this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.dynamic=e.dynamic;return this},copyAt:function(e,t,r){e*=this.itemSize;r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++){this.array[e+n]=t.array[r+n]}return this},copyArray:function(e){this.array.set(e);return this},copyColorsArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n);o=new i.Color}t[r++]=o.r;t[r++]=o.g;t[r++]=o.b}return this},copyIndicesArray:function(e){var t=this.array,r=0;for(var n=0,i=e.length;n<i;n++){var a=e[n];t[r++]=a.a;t[r++]=a.b;t[r++]=a.c}return this},copyVector2sArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n);o=new i.Vector2}t[r++]=o.x;t[r++]=o.y}return this},copyVector3sArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n);o=new i.Vector3}t[r++]=o.x;t[r++]=o.y;t[r++]=o.z}return this},copyVector4sArray:function(e){var t=this.array,r=0;for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o===undefined){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n);o=new i.Vector4}t[r++]=o.x;t[r++]=o.y;t[r++]=o.z;t[r++]=o.w}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){this.array[e*this.itemSize]=t;return this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){this.array[e*this.itemSize+3]=t;return this},setXY:function(e,t,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;return this},setXYZ:function(e,t,r,n){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;this.array[e+2]=n;return this},setXYZW:function(e,t,r,n,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;this.array[e+2]=n;this.array[e+3]=i;return this},clone:function(){return(new this.constructor).copy(this)}};i.Int8Attribute=function(e,t){return new i.BufferAttribute(new Int8Array(e),t)};i.Uint8Attribute=function(e,t){return new i.BufferAttribute(new Uint8Array(e),t)};i.Uint8ClampedAttribute=function(e,t){return new i.BufferAttribute(new Uint8ClampedArray(e),t)};i.Int16Attribute=function(e,t){return new i.BufferAttribute(new Int16Array(e),t)};i.Uint16Attribute=function(e,t){return new i.BufferAttribute(new Uint16Array(e),t)};i.Int32Attribute=function(e,t){return new i.BufferAttribute(new Int32Array(e),t)};i.Uint32Attribute=function(e,t){return new i.BufferAttribute(new Uint32Array(e),t)};i.Float32Attribute=function(e,t){return new i.BufferAttribute(new Float32Array(e),t)};i.Float64Attribute=function(e,t){return new i.BufferAttribute(new Float64Array(e),t)};i.DynamicBufferAttribute=function(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new i.BufferAttribute(e,t).setDynamic(true)};i.InstancedBufferAttribute=function(e,t,r){i.BufferAttribute.call(this,e,t);this.meshPerAttribute=r||1};i.InstancedBufferAttribute.prototype=Object.create(i.BufferAttribute.prototype);i.InstancedBufferAttribute.prototype.constructor=i.InstancedBufferAttribute;i.InstancedBufferAttribute.prototype.copy=function(e){i.BufferAttribute.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this};i.InterleavedBuffer=function(e,t){this.uuid=i.Math.generateUUID();this.array=e;this.stride=t;this.dynamic=false;this.updateRange={offset:0,count:-1};this.version=0};i.InterleavedBuffer.prototype={constructor:i.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){if(e===true)this.version++},setDynamic:function(e){this.dynamic=e;return this},copy:function(e){this.array=new e.array.constructor(e.array);this.stride=e.stride;this.dynamic=e.dynamic},copyAt:function(e,t,r){e*=this.stride;r*=t.stride;for(var n=0,i=this.stride;n<i;n++){this.array[e+n]=t.array[r+n]}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},clone:function(){return(new this.constructor).copy(this)}};i.InstancedInterleavedBuffer=function(e,t,r){i.InterleavedBuffer.call(this,e,t);this.meshPerAttribute=r||1};i.InstancedInterleavedBuffer.prototype=Object.create(i.InterleavedBuffer.prototype);i.InstancedInterleavedBuffer.prototype.constructor=i.InstancedInterleavedBuffer;i.InstancedInterleavedBuffer.prototype.copy=function(e){i.InterleavedBuffer.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this};i.InterleavedBufferAttribute=function(e,t,r){this.uuid=i.Math.generateUUID();this.data=e;this.itemSize=t;this.offset=r};i.InterleavedBufferAttribute.prototype={constructor:i.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this},setY:function(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this},setZ:function(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this},setW:function(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3];
},setXY:function(e,t,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;return this},setXYZ:function(e,t,r,n){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;this.data.array[e+2]=n;return this},setXYZW:function(e,t,r,n,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;this.data.array[e+2]=n;this.data.array[e+3]=i;return this}};i.Geometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};i.Geometry.prototype={constructor:i.Geometry,applyMatrix:function(e){var t=(new i.Matrix3).getNormalMatrix(e);for(var r=0,n=this.vertices.length;r<n;r++){var a=this.vertices[r];a.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var s=0,h=o.vertexNormals.length;s<h;s++){o.vertexNormals[s].applyMatrix3(t).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},rotateX:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationX(r);this.applyMatrix(e);return this}}(),rotateY:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationY(r);this.applyMatrix(e);return this}}(),rotateZ:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationZ(r);this.applyMatrix(e);return this}}(),translate:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeTranslation(r,n,a);this.applyMatrix(e);return this}}(),scale:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeScale(r,n,a);this.applyMatrix(e);return this}}(),lookAt:function(){var e;return function t(r){if(e===undefined)e=new i.Object3D;e.lookAt(r);e.updateMatrix();this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this;var r=e.index!==null?e.index.array:undefined;var n=e.attributes;var a=n.position.array;var o=n.normal!==undefined?n.normal.array:undefined;var s=n.color!==undefined?n.color.array:undefined;var h=n.uv!==undefined?n.uv.array:undefined;var u=n.uv2!==undefined?n.uv2.array:undefined;if(u!==undefined)this.faceVertexUvs[1]=[];var l=[];var c=[];var f=[];for(var d=0,p=0,m=0;d<a.length;d+=3,p+=2,m+=4){t.vertices.push(new i.Vector3(a[d],a[d+1],a[d+2]));if(o!==undefined){l.push(new i.Vector3(o[d],o[d+1],o[d+2]))}if(s!==undefined){t.colors.push(new i.Color(s[d],s[d+1],s[d+2]))}if(h!==undefined){c.push(new i.Vector2(h[p],h[p+1]))}if(u!==undefined){f.push(new i.Vector2(u[p],u[p+1]))}}var v=function(e,r,n){var a=o!==undefined?[l[e].clone(),l[r].clone(),l[n].clone()]:[];var d=s!==undefined?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[];var p=new i.Face3(e,r,n,a,d);t.faces.push(p);if(h!==undefined){t.faceVertexUvs[0].push([c[e].clone(),c[r].clone(),c[n].clone()])}if(u!==undefined){t.faceVertexUvs[1].push([f[e].clone(),f[r].clone(),f[n].clone()])}};if(r!==undefined){var g=e.groups;if(g.length>0){for(var d=0;d<g.length;d++){var y=g[d];var x=y.start;var b=y.count;for(var p=x,w=x+b;p<w;p+=3){v(r[p],r[p+1],r[p+2])}}}else{for(var d=0;d<r.length;d+=3){v(r[d],r[d+1],r[d+2])}}}else{for(var d=0;d<a.length/3;d+=3){v(d,d+1,d+2)}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.translate(e.x,e.y,e.z);return e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center;var t=this.boundingSphere.radius;var r=t===0?1:1/t;var n=new i.Matrix4;n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1);this.applyMatrix(n);return this},computeFaceNormals:function(){var e=new i.Vector3,t=new i.Vector3;for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];var o=this.vertices[a.a];var s=this.vertices[a.b];var h=this.vertices[a.c];e.subVectors(h,s);t.subVectors(o,s);e.cross(t);e.normalize();a.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,a,o,s;s=new Array(this.vertices.length);for(t=0,r=this.vertices.length;t<r;t++){s[t]=new i.Vector3}if(e){var h,u,l;var c=new i.Vector3,f=new i.Vector3;for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];h=this.vertices[o.a];u=this.vertices[o.b];l=this.vertices[o.c];c.subVectors(l,u);f.subVectors(h,u);c.cross(f);s[o.a].add(c);s[o.b].add(c);s[o.c].add(c)}}else{for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];s[o.a].add(o.normal);s[o.b].add(o.normal);s[o.c].add(o.normal)}}for(t=0,r=this.vertices.length;t<r;t++){s[t].normalize()}for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];var d=o.vertexNormals;if(d.length===3){d[0].copy(s[o.a]);d[1].copy(s[o.b]);d[2].copy(s[o.c])}else{d[0]=s[o.a].clone();d[1]=s[o.b].clone();d[2]=s[o.c].clone()}}},computeMorphNormals:function(){var e,t,r,n,a;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(!a.__originalFaceNormal){a.__originalFaceNormal=a.normal.clone()}else{a.__originalFaceNormal.copy(a.normal)}if(!a.__originalVertexNormals)a.__originalVertexNormals=[];for(e=0,t=a.vertexNormals.length;e<t;e++){if(!a.__originalVertexNormals[e]){a.__originalVertexNormals[e]=a.vertexNormals[e].clone()}else{a.__originalVertexNormals[e].copy(a.vertexNormals[e])}}}var o=new i.Geometry;o.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals;var h=this.morphNormals[e].vertexNormals;var u,l;for(r=0,n=this.faces.length;r<n;r++){u=new i.Vector3;l={a:new i.Vector3,b:new i.Vector3,c:new i.Vector3};s.push(u);h.push(l)}}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices;o.computeFaceNormals();o.computeVertexNormals();var u,l;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];u=c.faceNormals[r];l=c.vertexNormals[r];u.copy(a.normal);l.a.copy(a.vertexNormals[0]);l.b.copy(a.vertexNormals[1]);l.c.copy(a.vertexNormals[2])}}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];a.normal=a.__originalFaceNormal;a.vertexNormals=a.__originalVertexNormals}},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){var e=0;var t=this.vertices;for(var r=0,n=t.length;r<n;r++){if(r>0){e+=t[r].distanceTo(t[r-1])}this.lineDistances[r]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof i.Geometry===false){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var n,a=this.vertices.length,o=this.vertices,s=e.vertices,h=this.faces,u=e.faces,l=this.faceVertexUvs[0],c=e.faceVertexUvs[0];if(r===undefined)r=0;if(t!==undefined){n=(new i.Matrix3).getNormalMatrix(t)}for(var f=0,d=s.length;f<d;f++){var p=s[f];var m=p.clone();if(t!==undefined)m.applyMatrix4(t);o.push(m)}for(f=0,d=u.length;f<d;f++){var v=u[f],g,y,x,b=v.vertexNormals,w=v.vertexColors;g=new i.Face3(v.a+a,v.b+a,v.c+a);g.normal.copy(v.normal);if(n!==undefined){g.normal.applyMatrix3(n).normalize()}for(var _=0,M=b.length;_<M;_++){y=b[_].clone();if(n!==undefined){y.applyMatrix3(n).normalize()}g.vertexNormals.push(y)}g.color.copy(v.color);for(var _=0,M=w.length;_<M;_++){x=w[_];g.vertexColors.push(x.clone())}g.materialIndex=v.materialIndex+r;h.push(g)}for(f=0,d=c.length;f<d;f++){var S=c[f],T=[];if(S===undefined){continue}for(var _=0,M=S.length;_<M;_++){T.push(S[_].clone())}l.push(T)}},mergeMesh:function(e){if(e instanceof i.Mesh===false){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix();this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={};var t=[],r=[];var n,i;var a=4;var o=Math.pow(10,a);var s,h,u;var l,c,f;for(s=0,h=this.vertices.length;s<h;s++){n=this.vertices[s];i=Math.round(n.x*o)+"_"+Math.round(n.y*o)+"_"+Math.round(n.z*o);if(e[i]===undefined){e[i]=s;t.push(this.vertices[s]);r[s]=t.length-1}else{r[s]=r[e[i]]}}var d=[];for(s=0,h=this.faces.length;s<h;s++){u=this.faces[s];u.a=r[u.a];u.b=r[u.b];u.c=r[u.c];l=[u.a,u.b,u.c];var p=-1;for(var m=0;m<3;m++){if(l[m]===l[(m+1)%3]){p=m;d.push(s);break}}}for(s=d.length-1;s>=0;s--){var v=d[s];this.faces.splice(v,1);for(c=0,f=this.faceVertexUvs.length;c<f;c++){this.faceVertexUvs[c].splice(v,1)}}var g=this.vertices.length-t.length;this.vertices=t;return g},toJSON:function(){var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var r in t){if(t[r]!==undefined)e[r]=t[r]}return e}var n=[];for(var i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}var o=[];var s=[];var h={};var u=[];var l={};var c=[];var f={};for(var i=0;i<this.faces.length;i++){var d=this.faces[i];var p=false;var m=false;var v=this.faceVertexUvs[0][i]!==undefined;var g=d.normal.length()>0;var y=d.vertexNormals.length>0;var x=d.color.r!==1||d.color.g!==1||d.color.b!==1;var b=d.vertexColors.length>0;var w=0;w=T(w,0,0);w=T(w,1,p);w=T(w,2,m);w=T(w,3,v);w=T(w,4,g);w=T(w,5,y);w=T(w,6,x);w=T(w,7,b);o.push(w);o.push(d.a,d.b,d.c);if(v){var _=this.faceVertexUvs[0][i];o.push(A(_[0]),A(_[1]),A(_[2]))}if(g){o.push(E(d.normal))}if(y){var M=d.vertexNormals;o.push(E(M[0]),E(M[1]),E(M[2]))}if(x){o.push(C(d.color))}if(b){var S=d.vertexColors;o.push(C(S[0]),C(S[1]),C(S[2]))}}function T(e,t,r){return r?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(h[t]!==undefined){return h[t]}h[t]=s.length/3;s.push(e.x,e.y,e.z);return h[t]}function C(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(l[t]!==undefined){return l[t]}l[t]=u.length;u.push(e.getHex());return l[t]}function A(e){var t=e.x.toString()+e.y.toString();if(f[t]!==undefined){return f[t]}f[t]=c.length/2;c.push(e.x,e.y);return f[t]}e.data={};e.data.vertices=n;e.data.normals=s;if(u.length>0)e.data.colors=u;if(c.length>0)e.data.uvs=[c];e.data.faces=o;return e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];var t=e.vertices;for(var r=0,n=t.length;r<n;r++){this.vertices.push(t[r].clone())}var i=e.faces;for(var r=0,n=i.length;r<n;r++){this.faces.push(i[r].clone())}for(var r=0,n=e.faceVertexUvs.length;r<n;r++){var a=e.faceVertexUvs[r];if(this.faceVertexUvs[r]===undefined){this.faceVertexUvs[r]=[]}for(var o=0,s=a.length;o<s;o++){var h=a[o],u=[];for(var l=0,c=h.length;l<c;l++){var f=h[l];u.push(f.clone())}this.faceVertexUvs[r].push(u)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Geometry.prototype);i.GeometryIdCount=0;i.DirectGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.uvsNeedUpdate=false;this.groupsNeedUpdate=false};i.DirectGeometry.prototype={constructor:i.DirectGeometry,computeBoundingBox:i.Geometry.prototype.computeBoundingBox,computeBoundingSphere:i.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){var t;var r=[];var n;var i=e.faces;for(var a=0;a<i.length;a++){var o=i[a];if(o.materialIndex!==n){n=o.materialIndex;if(t!==undefined){t.count=a*3-t.start;r.push(t)}t={start:a*3,materialIndex:n}}}if(t!==undefined){t.count=a*3-t.start;r.push(t)}this.groups=r},fromGeometry:function(e){var t=e.faces;var r=e.vertices;var n=e.faceVertexUvs;var a=n[0]&&n[0].length>0;var o=n[1]&&n[1].length>0;var s=e.morphTargets;var h=s.length;if(h>0){var u=[];for(var l=0;l<h;l++){u[l]=[]}this.morphTargets.position=u}var c=e.morphNormals;var f=c.length;if(f>0){var d=[];for(var l=0;l<f;l++){d[l]=[]}this.morphTargets.normal=d}var p=e.skinIndices;var m=e.skinWeights;var v=p.length===r.length;var g=m.length===r.length;for(var l=0;l<t.length;l++){var y=t[l];this.vertices.push(r[y.a],r[y.b],r[y.c]);var x=y.vertexNormals;if(x.length===3){this.normals.push(x[0],x[1],x[2])}else{var b=y.normal;this.normals.push(b,b,b)}var w=y.vertexColors;if(w.length===3){this.colors.push(w[0],w[1],w[2])}else{var _=y.color;this.colors.push(_,_,_)}if(a===true){var M=n[0][l];if(M!==undefined){this.uvs.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l);this.uvs.push(new i.Vector2,new i.Vector2,new i.Vector2)}}if(o===true){var M=n[1][l];if(M!==undefined){this.uvs2.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l);this.uvs2.push(new i.Vector2,new i.Vector2,new i.Vector2)}}for(var S=0;S<h;S++){var T=s[S].vertices;u[S].push(T[y.a],T[y.b],T[y.c])}for(var S=0;S<f;S++){var E=c[S].vertexNormals[l];d[S].push(E.a,E.b,E.c)}if(v){this.skinIndices.push(p[y.a],p[y.b],p[y.c])}if(g){this.skinWeights.push(m[y.a],m[y.b],m[y.c])}}this.computeGroups(e);this.verticesNeedUpdate=e.verticesNeedUpdate;this.normalsNeedUpdate=e.normalsNeedUpdate;this.colorsNeedUpdate=e.colorsNeedUpdate;this.uvsNeedUpdate=e.uvsNeedUpdate;this.groupsNeedUpdate=e.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.DirectGeometry.prototype);i.BufferGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity}};i.BufferGeometry.prototype={constructor:i.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){if(t instanceof i.BufferAttribute===false&&t instanceof i.InterleavedBufferAttribute===false){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.addAttribute(e,new i.BufferAttribute(arguments[1],arguments[2]));return}if(e==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(t)}this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups},get offsets(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups},addDrawCall:function(e,t,r){if(r!==undefined){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r!==undefined?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e;this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.applyToVector3Array(t.array);t.needsUpdate=true}var r=this.attributes.normal;if(r!==undefined){var n=(new i.Matrix3).getNormalMatrix(e);n.applyToVector3Array(r.array);r.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},rotateX:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationX(r);this.applyMatrix(e);return this}}(),rotateY:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationY(r);this.applyMatrix(e);return this}}(),rotateZ:function(){var e;return function t(r){if(e===undefined)e=new i.Matrix4;e.makeRotationZ(r);this.applyMatrix(e);return this}}(),translate:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeTranslation(r,n,a);this.applyMatrix(e);return this}}(),scale:function(){var e;return function t(r,n,a){if(e===undefined)e=new i.Matrix4;e.makeScale(r,n,a);this.applyMatrix(e);return this}}(),lookAt:function(){var e;return function t(r){if(e===undefined)e=new i.Object3D;e.lookAt(r);e.updateMatrix();this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.translate(e.x,e.y,e.z);return e},setFromObject:function(e){var t=e.geometry;if(e instanceof i.Points||e instanceof i.Line){var r=new i.Float32Attribute(t.vertices.length*3,3);var n=new i.Float32Attribute(t.colors.length*3,3);this.addAttribute("position",r.copyVector3sArray(t.vertices));this.addAttribute("color",n.copyColorsArray(t.colors));if(t.lineDistances&&t.lineDistances.length===t.vertices.length){var a=new i.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",a.copyArray(t.lineDistances))}if(t.boundingSphere!==null){this.boundingSphere=t.boundingSphere.clone()}if(t.boundingBox!==null){this.boundingBox=t.boundingBox.clone()}}else if(e instanceof i.Mesh){if(t instanceof i.Geometry){this.fromGeometry(t)}}return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof i.Mesh){var r=t.__directGeometry;if(r===undefined){return this.fromGeometry(t)}r.verticesNeedUpdate=t.verticesNeedUpdate;r.normalsNeedUpdate=t.normalsNeedUpdate;r.colorsNeedUpdate=t.colorsNeedUpdate;r.uvsNeedUpdate=t.uvsNeedUpdate;r.groupsNeedUpdate=t.groupsNeedUpdate;t.verticesNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.uvsNeedUpdate=false;t.groupsNeedUpdate=false;t=r}if(t.verticesNeedUpdate===true){var n=this.attributes.position;if(n!==undefined){n.copyVector3sArray(t.vertices);n.needsUpdate=true}t.verticesNeedUpdate=false}if(t.normalsNeedUpdate===true){var n=this.attributes.normal;if(n!==undefined){n.copyVector3sArray(t.normals);n.needsUpdate=true}t.normalsNeedUpdate=false}if(t.colorsNeedUpdate===true){var n=this.attributes.color;if(n!==undefined){n.copyColorsArray(t.colors);n.needsUpdate=true}t.colorsNeedUpdate=false}if(t.lineDistancesNeedUpdate){var n=this.attributes.lineDistance;if(n!==undefined){n.copyArray(t.lineDistances);n.needsUpdate=true}t.lineDistancesNeedUpdate=false}if(t.groupsNeedUpdate){t.computeGroups(e.geometry);this.groups=t.groups;t.groupsNeedUpdate=false}return this},fromGeometry:function(e){e.__directGeometry=(new i.DirectGeometry).fromGeometry(e);return this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);this.addAttribute("position",new i.BufferAttribute(t,3).copyVector3sArray(e.vertices));if(e.normals.length>0){var r=new Float32Array(e.normals.length*3);this.addAttribute("normal",new i.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(e.colors.length*3);this.addAttribute("color",new i.BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(e.uvs.length*2);this.addAttribute("uv",new i.BufferAttribute(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(e.uvs2.length*2);this.addAttribute("uv2",new i.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var s=e.vertices.length>65535?Uint32Array:Uint16Array;var h=new s(e.indices.length*3);this.setIndex(new i.BufferAttribute(h,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var u in e.morphTargets){var l=[];var c=e.morphTargets[u];for(var f=0,d=c.length;f<d;f++){var p=c[f];var m=new i.Float32Attribute(p.length*3,3);l.push(m.copyVector3sArray(p))}this.morphAttributes[u]=l}if(e.skinIndices.length>0){var v=new i.Float32Attribute(e.skinIndices.length*4,4);this.addAttribute("skinIndex",v.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var g=new i.Float32Attribute(e.skinWeights.length*4,4);this.addAttribute("skinWeight",g.copyVector4sArray(e.skinWeights))}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}return this},computeBoundingBox:function(){var e=new i.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var n=0,a=t.length;n<a;n+=3){e.fromArray(t,n);r.expandByPoint(e)}}if(t===undefined||t.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}}(),computeBoundingSphere:function(){var e=new i.Box3;var t=new i.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}var r=this.attributes.position.array;if(r){e.makeEmpty();var n=this.boundingSphere.center;for(var a=0,o=r.length;a<o;a+=3){t.fromArray(r,a);e.expandByPoint(t)}e.center(n);var s=0;for(var a=0,o=r.length;a<o;a+=3){t.fromArray(r,a);s=Math.max(s,n.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(s);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index;var t=this.attributes;var r=this.groups;if(t.position){var n=t.position.array;if(t.normal===undefined){this.addAttribute("normal",new i.BufferAttribute(new Float32Array(n.length),3))}else{var a=t.normal.array;for(var o=0,s=a.length;o<s;o++){a[o]=0}}var a=t.normal.array;var h,u,l,c=new i.Vector3,f=new i.Vector3,d=new i.Vector3,p=new i.Vector3,m=new i.Vector3;if(e){var v=e.array;if(r.length===0){this.addGroup(0,v.length)}for(var g=0,y=r.length;g<y;++g){var x=r[g];var b=x.start;var w=x.count;for(var o=b,s=b+w;o<s;o+=3){h=v[o+0]*3;u=v[o+1]*3;l=v[o+2]*3;c.fromArray(n,h);f.fromArray(n,u);d.fromArray(n,l);p.subVectors(d,f);m.subVectors(c,f);p.cross(m);a[h]+=p.x;a[h+1]+=p.y;a[h+2]+=p.z;a[u]+=p.x;a[u+1]+=p.y;a[u+2]+=p.z;a[l]+=p.x;a[l+1]+=p.y;a[l+2]+=p.z}}}else{for(var o=0,s=n.length;o<s;o+=9){c.fromArray(n,o);f.fromArray(n,o+3);d.fromArray(n,o+6);p.subVectors(d,f);m.subVectors(c,f);p.cross(m);a[o]=p.x;a[o+1]=p.y;a[o+2]=p.z;a[o+3]=p.x;a[o+4]=p.y;a[o+5]=p.z;a[o+6]=p.x;a[o+7]=p.y;a[o+8]=p.z}}this.normalizeNormals();t.normal.needsUpdate=true}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(e instanceof i.BufferGeometry===false){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===undefined)t=0;var r=this.attributes;for(var n in r){if(e.attributes[n]===undefined)continue;var a=r[n];var o=a.array;var s=e.attributes[n];var h=s.array;var u=s.itemSize;for(var l=0,c=u*t;l<h.length;l++,c++){o[c]=h[l]}}return this},normalizeNormals:function(){var e=this.attributes.normal.array;var t,r,n,i;for(var a=0,o=e.length;a<o;a+=3){t=e[a];r=e[a+1];n=e[a+2];i=1/Math.sqrt(t*t+r*r+n*n);e[a]*=i;e[a+1]*=i;e[a+2]*=i}},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var r in t){if(t[r]!==undefined)e[r]=t[r]}return e}e.data={attributes:{}};var n=this.index;if(n!==null){var i=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:i}}var a=this.attributes;for(var r in a){var o=a[r];var i=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:i}}var s=this.groups;if(s.length>0){e.data.groups=JSON.parse(JSON.stringify(s))}var h=this.boundingSphere;if(h!==null){e.data.boundingSphere={center:h.center.toArray(),radius:h.radius}}return e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;if(t!==null){this.setIndex(t.clone())}var r=e.attributes;for(var n in r){var i=r[n];this.addAttribute(n,i.clone())}var a=e.groups;for(var o=0,s=a.length;o<s;o++){var h=a[o];this.addGroup(h.start,h.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.BufferGeometry.prototype);i.BufferGeometry.MaxIndex=65535;i.InstancedBufferGeometry=function(){i.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=undefined};i.InstancedBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.InstancedBufferGeometry.prototype.constructor=i.InstancedBufferGeometry;i.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})};i.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;if(t!==null){this.setIndex(t.clone())}var r=e.attributes;for(var n in r){var i=r[n];this.addAttribute(n,i.clone())}var a=e.groups;for(var o=0,s=a.length;o<s;o++){var h=a[o];this.addGroup(h.start,h.count,h.instances)}return this};i.EventDispatcher.prototype.apply(i.InstancedBufferGeometry.prototype);i.Camera=function(){i.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new i.Matrix4;this.projectionMatrix=new i.Matrix4};i.Camera.prototype=Object.create(i.Object3D.prototype);i.Camera.prototype.constructor=i.Camera;i.Camera.prototype.getWorldDirection=function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;this.getWorldQuaternion(e);return r.set(0,0,-1).applyQuaternion(e)}}();i.Camera.prototype.lookAt=function(){var e=new i.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();i.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};i.Camera.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);return this};i.CubeCamera=function(e,t,r){i.Object3D.call(this);this.type="CubeCamera";var n=90,a=1;var o=new i.PerspectiveCamera(n,a,e,t);o.up.set(0,-1,0);o.lookAt(new i.Vector3(1,0,0));this.add(o);var s=new i.PerspectiveCamera(n,a,e,t);s.up.set(0,-1,0);s.lookAt(new i.Vector3(-1,0,0));this.add(s);var h=new i.PerspectiveCamera(n,a,e,t);h.up.set(0,0,1);h.lookAt(new i.Vector3(0,1,0));this.add(h);var u=new i.PerspectiveCamera(n,a,e,t);u.up.set(0,0,-1);u.lookAt(new i.Vector3(0,-1,0));this.add(u);var l=new i.PerspectiveCamera(n,a,e,t);l.up.set(0,-1,0);l.lookAt(new i.Vector3(0,0,1));this.add(l);var c=new i.PerspectiveCamera(n,a,e,t);c.up.set(0,-1,0);c.lookAt(new i.Vector3(0,0,-1));this.add(c);this.renderTarget=new i.WebGLRenderTargetCube(r,r,{format:i.RGBFormat,magFilter:i.LinearFilter,minFilter:i.LinearFilter});this.updateCubeMap=function(e,t){if(this.parent===null)this.updateMatrixWorld();var r=this.renderTarget;var n=r.generateMipmaps;r.generateMipmaps=false;r.activeCubeFace=0;e.render(t,o,r);r.activeCubeFace=1;e.render(t,s,r);r.activeCubeFace=2;e.render(t,h,r);r.activeCubeFace=3;e.render(t,u,r);r.activeCubeFace=4;e.render(t,l,r);r.generateMipmaps=n;r.activeCubeFace=5;e.render(t,c,r);e.setRenderTarget(null)}};i.CubeCamera.prototype=Object.create(i.Object3D.prototype);i.CubeCamera.prototype.constructor=i.CubeCamera;i.OrthographicCamera=function(e,t,r,n,a,o){i.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=t;this.top=r;this.bottom=n;this.near=a!==undefined?a:.1;this.far=o!==undefined?o:2e3;this.updateProjectionMatrix()};i.OrthographicCamera.prototype=Object.create(i.Camera.prototype);i.OrthographicCamera.prototype.constructor=i.OrthographicCamera;i.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var r=(this.right+this.left)/2;var n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,n+t,n-t,this.near,this.far)};i.OrthographicCamera.prototype.copy=function(e){i.Camera.prototype.copy.call(this,e);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;return this};i.OrthographicCamera.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.zoom=this.zoom;t.object.left=this.left;t.object.right=this.right;t.object.top=this.top;t.object.bottom=this.bottom;t.object.near=this.near;t.object.far=this.far;return t};i.PerspectiveCamera=function(e,t,r,n){i.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=r!==undefined?r:.1;this.far=n!==undefined?n:2e3;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype);i.PerspectiveCamera.prototype.constructor=i.PerspectiveCamera;i.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*i.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,n,i,a){this.fullWidth=e;this.fullHeight=t;this.x=r;this.y=n;this.width=i;this.height=a;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=i.Math.radToDeg(2*Math.atan(Math.tan(i.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight;var r=Math.tan(i.Math.degToRad(e*.5))*this.near;var n=-r;var a=t*n;var o=t*r;var s=Math.abs(o-a);var h=Math.abs(r-n);this.projectionMatrix.makeFrustum(a+this.x*s/this.fullWidth,a+(this.x+this.width)*s/this.fullWidth,r-(this.y+this.height)*h/this.fullHeight,r-this.y*h/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)}};i.PerspectiveCamera.prototype.copy=function(e){i.Camera.prototype.copy.call(this,e);this.fov=e.fov;this.aspect=e.aspect;this.near=e.near;this.far=e.far;this.zoom=e.zoom;return this};i.PerspectiveCamera.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.zoom=this.zoom;t.object.fov=this.fov;t.object.aspect=this.aspect;t.object.near=this.near;t.object.far=this.far;return t};i.Light=function(e){i.Object3D.call(this);this.type="Light";this.color=new i.Color(e)};i.Light.prototype=Object.create(i.Object3D.prototype);i.Light.prototype.constructor=i.Light;i.Light.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.color.copy(e.color);return this};i.AmbientLight=function(e){i.Light.call(this,e);
this.type="AmbientLight"};i.AmbientLight.prototype=Object.create(i.Light.prototype);i.AmbientLight.prototype.constructor=i.AmbientLight;i.AmbientLight.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();return t};i.DirectionalLight=function(e,t){i.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.updateMatrix();this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};i.DirectionalLight.prototype=Object.create(i.Light.prototype);i.DirectionalLight.prototype.constructor=i.DirectionalLight;i.DirectionalLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.intensity=e.intensity;this.target=e.target.clone();this.castShadow=e.castShadow;this.onlyShadow=e.onlyShadow;this.shadowCameraNear=e.shadowCameraNear;this.shadowCameraFar=e.shadowCameraFar;this.shadowCameraLeft=e.shadowCameraLeft;this.shadowCameraRight=e.shadowCameraRight;this.shadowCameraTop=e.shadowCameraTop;this.shadowCameraBottom=e.shadowCameraBottom;this.shadowCameraVisible=e.shadowCameraVisible;this.shadowBias=e.shadowBias;this.shadowDarkness=e.shadowDarkness;this.shadowMapWidth=e.shadowMapWidth;this.shadowMapHeight=e.shadowMapHeight;return this};i.DirectionalLight.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();t.object.intensity=this.intensity;return t};i.HemisphereLight=function(e,t,r){i.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,1,0);this.updateMatrix();this.groundColor=new i.Color(t);this.intensity=r!==undefined?r:1};i.HemisphereLight.prototype=Object.create(i.Light.prototype);i.HemisphereLight.prototype.constructor=i.HemisphereLight;i.HemisphereLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);this.intensity=e.intensity;return this};i.HemisphereLight.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();t.object.groundColor=this.groundColor.getHex();t.object.intensity=this.intensity;return t};i.PointLight=function(e,t,r,n){i.Light.call(this,e);this.type="PointLight";this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.decay=n!==undefined?n:1};i.PointLight.prototype=Object.create(i.Light.prototype);i.PointLight.prototype.constructor=i.PointLight;i.PointLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.intensity=e.intensity;this.distance=e.distance;this.decay=e.decay;return this};i.PointLight.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();t.object.intensity=this.intensity;t.object.distance=this.distance;t.object.decay=this.decay;return t};i.SpotLight=function(e,t,r,n,a,o){i.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.updateMatrix();this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.angle=n!==undefined?n:Math.PI/3;this.exponent=a!==undefined?a:10;this.decay=o!==undefined?o:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};i.SpotLight.prototype=Object.create(i.Light.prototype);i.SpotLight.prototype.constructor=i.SpotLight;i.SpotLight.prototype.copy=function(e){i.Light.prototype.copy.call(this,e);this.intensity=e.intensity;this.distance=e.distance;this.angle=e.angle;this.exponent=e.exponent;this.decay=e.decay;this.target=e.target.clone();this.castShadow=e.castShadow;this.onlyShadow=e.onlyShadow;this.shadowCameraNear=e.shadowCameraNear;this.shadowCameraFar=e.shadowCameraFar;this.shadowCameraFov=e.shadowCameraFov;this.shadowCameraVisible=e.shadowCameraVisible;this.shadowBias=e.shadowBias;this.shadowDarkness=e.shadowDarkness;this.shadowMapWidth=e.shadowMapWidth;this.shadowMapHeight=e.shadowMapHeight;return this};i.SpotLight.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();t.object.intensity=this.intensity;t.object.distance=this.distance;t.object.angle=this.angle;t.object.exponent=this.exponent;t.object.decay=this.decay;return t};i.Cache={enabled:false,files:{},add:function(e,t){if(this.enabled===false)return;this.files[e]=t},get:function(e){if(this.enabled===false)return;return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};i.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};i.Loader.prototype={constructor:i.Loader,crossOrigin:undefined,extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t,r){var n=[];for(var i=0;i<e.length;++i){n[i]=this.createMaterial(e[i],t,r)}return n},createMaterial:function(){var e;return function t(r,n,a){var o=this;if(a===undefined&&o.crossOrigin!==undefined)a=o.crossOrigin;if(e===undefined)e=new i.ImageLoader;function s(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function h(t,r,o,h,u,l,c){var f=n+o;var d;var p=i.Loader.Handlers.get(f);if(p!==null){d=p.load(f)}else{d=new i.Texture;p=e;p.setCrossOrigin(a);p.load(f,function(e){if(i.Math.isPowerOfTwo(e.width)===false||i.Math.isPowerOfTwo(e.height)===false){var t=s(e.width);var r=s(e.height);var n=document.createElement("canvas");n.width=t;n.height=r;var a=n.getContext("2d");a.drawImage(e,0,0,t,r);d.image=n}else{d.image=e}d.needsUpdate=true})}d.sourceFile=o;if(h){d.repeat.set(h[0],h[1]);if(h[0]!==1)d.wrapS=i.RepeatWrapping;if(h[1]!==1)d.wrapT=i.RepeatWrapping}if(u){d.offset.set(u[0],u[1])}if(l){var m={repeat:i.RepeatWrapping,mirror:i.MirroredRepeatWrapping};if(m[l[0]]!==undefined)d.wrapS=m[l[0]];if(m[l[1]]!==undefined)d.wrapT=m[l[1]]}if(c){d.anisotropy=c}t[r]=d}function u(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var l="MeshLambertMaterial";var c={};if(r.shading){var f=r.shading.toLowerCase();if(f==="phong")l="MeshPhongMaterial";else if(f==="basic")l="MeshBasicMaterial"}if(r.blending!==undefined&&i[r.blending]!==undefined){c.blending=i[r.blending]}if(r.transparent!==undefined){c.transparent=r.transparent}if(r.opacity!==undefined&&r.opacity<1){c.transparent=true}if(r.depthTest!==undefined){c.depthTest=r.depthTest}if(r.depthWrite!==undefined){c.depthWrite=r.depthWrite}if(r.visible!==undefined){c.visible=r.visible}if(r.flipSided!==undefined){c.side=i.BackSide}if(r.doubleSided!==undefined){c.side=i.DoubleSide}if(r.wireframe!==undefined){c.wireframe=r.wireframe}if(r.vertexColors!==undefined){if(r.vertexColors==="face"){c.vertexColors=i.FaceColors}else if(r.vertexColors){c.vertexColors=i.VertexColors}}if(r.colorDiffuse){c.color=u(r.colorDiffuse)}else if(r.DbgColor){c.color=r.DbgColor}if(r.colorEmissive){c.emissive=u(r.colorEmissive)}if(l==="MeshPhongMaterial"){if(r.colorSpecular){c.specular=u(r.colorSpecular)}if(r.specularCoef){c.shininess=r.specularCoef}}if(r.transparency!==undefined){console.warn("THREE.Loader: transparency has been renamed to opacity");r.opacity=r.transparency}if(r.opacity!==undefined){c.opacity=r.opacity}if(n){if(r.mapDiffuse){h(c,"map",r.mapDiffuse,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy)}if(r.mapLight){h(c,"lightMap",r.mapLight,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy)}if(r.mapAO){h(c,"aoMap",r.mapAO,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy)}if(r.mapBump){h(c,"bumpMap",r.mapBump,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy)}if(r.mapNormal){h(c,"normalMap",r.mapNormal,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy)}if(r.mapSpecular){h(c,"specularMap",r.mapSpecular,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy)}if(r.mapAlpha){h(c,"alphaMap",r.mapAlpha,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy)}}if(r.mapBumpScale){c.bumpScale=r.mapBumpScale}if(r.mapNormalFactor){c.normalScale=new i.Vector2(r.mapNormalFactor,r.mapNormalFactor)}var d=new i[l](c);if(r.DbgName!==undefined)d.name=r.DbgName;return d}}()};i.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;t<r;t+=2){var n=this.handlers[t];var i=this.handlers[t+1];if(n.test(e)){return i}}return null}};i.XHRLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.XHRLoader.prototype={constructor:i.XHRLoader,load:function(e,t,r,n){var a=this;var o=i.Cache.get(e);if(o!==undefined){if(t){setTimeout(function(){t(o)},0)}return o}var s=new XMLHttpRequest;s.open("GET",e,true);s.addEventListener("load",function(r){i.Cache.add(e,this.response);if(t)t(this.response);a.manager.itemEnd(e)},false);if(r!==undefined){s.addEventListener("progress",function(e){r(e)},false)}s.addEventListener("error",function(t){if(n)n(t);a.manager.itemError(e)},false);if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)s.responseType=this.responseType;if(this.withCredentials!==undefined)s.withCredentials=this.withCredentials;s.send(null);a.manager.itemStart(e);return s},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}};i.ImageLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.ImageLoader.prototype={constructor:i.ImageLoader,load:function(e,t,r,n){var a=this;var o=i.Cache.get(e);if(o!==undefined){if(t){setTimeout(function(){t(o)},0)}return o}var s=document.createElement("img");s.addEventListener("load",function(r){i.Cache.add(e,this);if(t)t(this);a.manager.itemEnd(e)},false);if(r!==undefined){s.addEventListener("progress",function(e){r(e)},false)}s.addEventListener("error",function(t){if(n)n(t);a.manager.itemError(e)},false);if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;a.manager.itemStart(e);s.src=e;return s},setCrossOrigin:function(e){this.crossOrigin=e}};i.JSONLoader=function(e){if(typeof e==="boolean"){console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor.");e=undefined}this.manager=e!==undefined?e:i.DefaultLoadingManager;this.withCredentials=false};i.JSONLoader.prototype={constructor:i.JSONLoader,get statusDomElement(){if(this._statusDomElement===undefined){this._statusDomElement=document.createElement("div")}console.warn("THREE.JSONLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(e,t,r,n){var a=this;var o=this.texturePath&&typeof this.texturePath==="string"?this.texturePath:i.Loader.prototype.extractUrlBase(e);var s=new i.XHRLoader(this.manager);s.setCrossOrigin(this.crossOrigin);s.setWithCredentials(this.withCredentials);s.load(e,function(r){var n=JSON.parse(r);var i=n.metadata;if(i!==undefined){if(i.type==="object"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");return}if(i.type==="scene"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.");return}}var s=a.parse(n,o);t(s.geometry,s.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){var r=new i.Geometry,n=e.scale!==undefined?1/e.scale:1;a(n);o();s(n);r.computeFaceNormals();r.computeBoundingSphere();function a(t){function n(e,t){return e&1<<t}var a,o,s,h,u,l,c,f,d,p,m,v,g,y,x,b,w,_,M,S,T,E,C,A,L,P,R,D=e.faces,k=e.vertices,F=e.normals,O=e.colors,U=0;if(e.uvs!==undefined){for(a=0;a<e.uvs.length;a++){if(e.uvs[a].length)U++}for(a=0;a<U;a++){r.faceVertexUvs[a]=[]}}h=0;u=k.length;while(h<u){_=new i.Vector3;_.x=k[h++]*t;_.y=k[h++]*t;_.z=k[h++]*t;r.vertices.push(_)}h=0;u=D.length;while(h<u){p=D[h++];m=n(p,0);v=n(p,1);g=n(p,3);y=n(p,4);x=n(p,5);b=n(p,6);w=n(p,7);if(m){S=new i.Face3;S.a=D[h];S.b=D[h+1];S.c=D[h+3];T=new i.Face3;T.a=D[h+1];T.b=D[h+2];T.c=D[h+3];h+=4;if(v){d=D[h++];S.materialIndex=d;T.materialIndex=d}s=r.faces.length;if(g){for(a=0;a<U;a++){A=e.uvs[a];r.faceVertexUvs[a][s]=[];r.faceVertexUvs[a][s+1]=[];for(o=0;o<4;o++){f=D[h++];P=A[f*2];R=A[f*2+1];L=new i.Vector2(P,R);if(o!==2)r.faceVertexUvs[a][s].push(L);if(o!==0)r.faceVertexUvs[a][s+1].push(L)}}}if(y){c=D[h++]*3;S.normal.set(F[c++],F[c++],F[c]);T.normal.copy(S.normal)}if(x){for(a=0;a<4;a++){c=D[h++]*3;C=new i.Vector3(F[c++],F[c++],F[c]);if(a!==2)S.vertexNormals.push(C);if(a!==0)T.vertexNormals.push(C)}}if(b){l=D[h++];E=O[l];S.color.setHex(E);T.color.setHex(E)}if(w){for(a=0;a<4;a++){l=D[h++];E=O[l];if(a!==2)S.vertexColors.push(new i.Color(E));if(a!==0)T.vertexColors.push(new i.Color(E))}}r.faces.push(S);r.faces.push(T)}else{M=new i.Face3;M.a=D[h++];M.b=D[h++];M.c=D[h++];if(v){d=D[h++];M.materialIndex=d}s=r.faces.length;if(g){for(a=0;a<U;a++){A=e.uvs[a];r.faceVertexUvs[a][s]=[];for(o=0;o<3;o++){f=D[h++];P=A[f*2];R=A[f*2+1];L=new i.Vector2(P,R);r.faceVertexUvs[a][s].push(L)}}}if(y){c=D[h++]*3;M.normal.set(F[c++],F[c++],F[c])}if(x){for(a=0;a<3;a++){c=D[h++]*3;C=new i.Vector3(F[c++],F[c++],F[c]);M.vertexNormals.push(C)}}if(b){l=D[h++];M.color.setHex(O[l])}if(w){for(a=0;a<3;a++){l=D[h++];M.vertexColors.push(new i.Color(O[l]))}}r.faces.push(M)}}}function o(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var n=0,a=e.skinWeights.length;n<a;n+=t){var o=e.skinWeights[n];var s=t>1?e.skinWeights[n+1]:0;var h=t>2?e.skinWeights[n+2]:0;var u=t>3?e.skinWeights[n+3]:0;r.skinWeights.push(new i.Vector4(o,s,h,u))}}if(e.skinIndices){for(var n=0,a=e.skinIndices.length;n<a;n+=t){var l=e.skinIndices[n];var c=t>1?e.skinIndices[n+1]:0;var f=t>2?e.skinIndices[n+2]:0;var d=t>3?e.skinIndices[n+3]:0;r.skinIndices.push(new i.Vector4(l,c,f,d))}}r.bones=e.bones;if(r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)){console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}r.animation=e.animation;r.animations=e.animations}function s(t){if(e.morphTargets!==undefined){var n,a,o,s,h,u;for(n=0,a=e.morphTargets.length;n<a;n++){r.morphTargets[n]={};r.morphTargets[n].name=e.morphTargets[n].name;r.morphTargets[n].vertices=[];h=r.morphTargets[n].vertices;u=e.morphTargets[n].vertices;for(o=0,s=u.length;o<s;o+=3){var l=new i.Vector3;l.x=u[o]*t;l.y=u[o+1]*t;l.z=u[o+2]*t;h.push(l)}}}if(e.morphColors!==undefined){var n,a,c,f,d,p,m;for(n=0,a=e.morphColors.length;n<a;n++){r.morphColors[n]={};r.morphColors[n].name=e.morphColors[n].name;r.morphColors[n].colors=[];d=r.morphColors[n].colors;p=e.morphColors[n].colors;for(c=0,f=p.length;c<f;c+=3){m=new i.Color(16755200);m.setRGB(p[c],p[c+1],p[c+2]);d.push(m)}}}}if(e.materials===undefined||e.materials.length===0){return{geometry:r}}else{var h=i.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:r,materials:h}}}};i.LoadingManager=function(e,t,r){var n=this;var i=false,a=0,o=0;this.onStart=undefined;this.onLoad=e;this.onProgress=t;this.onError=r;this.itemStart=function(e){o++;if(i===false){if(n.onStart!==undefined){n.onStart(e,a,o)}}i=true};this.itemEnd=function(e){a++;if(n.onProgress!==undefined){n.onProgress(e,a,o)}if(a===o){i=false;if(n.onLoad!==undefined){n.onLoad()}}};this.itemError=function(e){if(n.onError!==undefined){n.onError(e)}}};i.DefaultLoadingManager=new i.LoadingManager;i.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.BufferGeometryLoader.prototype={constructor:i.BufferGeometryLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.BufferGeometry;var r=e.data.index;if(r!==undefined){var a=new n[r.type](r.array);t.setIndex(new i.BufferAttribute(a,1))}var o=e.data.attributes;for(var s in o){var h=o[s];var a=new n[h.type](h.array);t.addAttribute(s,new i.BufferAttribute(a,h.itemSize))}var u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==undefined){for(var l=0,c=u.length;l!==c;++l){var f=u[l];t.addGroup(f.start,f.count)}}var d=e.data.boundingSphere;if(d!==undefined){var p=new i.Vector3;if(d.center!==undefined){p.fromArray(d.center)}t.boundingSphere=new i.Sphere(p,d.radius)}return t}};i.MaterialLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this.textures={}};i.MaterialLoader.prototype={constructor:i.MaterialLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;if(t[e]===undefined){console.warn("THREE.MaterialLoader: Undefined texture",e)}return t[e]},parse:function(e){var t=new i[e.type];t.uuid=e.uuid;if(e.name!==undefined)t.name=e.name;if(e.color!==undefined)t.color.setHex(e.color);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.uniforms!==undefined)t.uniforms=e.uniforms;if(e.vertexShader!==undefined)t.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)t.fragmentShader=e.fragmentShader;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.shading!==undefined)t.shading=e.shading;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.alphaTest!==undefined)t.alphaTest=e.alphaTest;if(e.depthTest!==undefined)t.depthTest=e.depthTest;if(e.depthWrite!==undefined)t.depthWrite=e.depthWrite;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.wireframeLinewidth!==undefined)t.wireframeLinewidth=e.wireframeLinewidth;if(e.size!==undefined)t.size=e.size;if(e.sizeAttenuation!==undefined)t.sizeAttenuation=e.sizeAttenuation;if(e.map!==undefined)t.map=this.getTexture(e.map);if(e.alphaMap!==undefined){t.alphaMap=this.getTexture(e.alphaMap);t.transparent=true}if(e.bumpMap!==undefined)t.bumpMap=this.getTexture(e.bumpMap);if(e.bumpScale!==undefined)t.bumpScale=e.bumpScale;if(e.normalMap!==undefined)t.normalMap=this.getTexture(e.normalMap);if(e.normalScale)t.normalScale=new i.Vector2(e.normalScale,e.normalScale);if(e.displacementMap!==undefined)t.displacementMap=this.getTexture(e.displacementMap);if(e.displacementScale!==undefined)t.displacementScale=e.displacementScale;if(e.displacementBias!==undefined)t.displacementBias=e.displacementBias;if(e.specularMap!==undefined)t.specularMap=this.getTexture(e.specularMap);if(e.envMap!==undefined){t.envMap=this.getTexture(e.envMap);t.combine=i.MultiplyOperation}if(e.reflectivity)t.reflectivity=e.reflectivity;if(e.lightMap!==undefined)t.lightMap=this.getTexture(e.lightMap);if(e.lightMapIntensity!==undefined)t.lightMapIntensity=e.lightMapIntensity;if(e.aoMap!==undefined)t.aoMap=this.getTexture(e.aoMap);if(e.aoMapIntensity!==undefined)t.aoMapIntensity=e.aoMapIntensity;if(e.materials!==undefined){for(var r=0,n=e.materials.length;r<n;r++){t.materials.push(this.parse(e.materials[r]))}}return t}};i.ObjectLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this.texturePath=""};i.ObjectLoader.prototype={constructor:i.ObjectLoader,load:function(e,t,r,n){if(this.texturePath===""){this.texturePath=e.substring(0,e.lastIndexOf("/")+1)}var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){a.parse(JSON.parse(e),t)},r,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries);var n=this.parseImages(e.images,function(){if(t!==undefined)t(o)});var i=this.parseTextures(e.textures,n);var a=this.parseMaterials(e.materials,i);var o=this.parseObject(e.object,r,a);if(e.images===undefined||e.images.length===0){if(t!==undefined)t(o)}return o},parseGeometries:function(e){var t={};if(e!==undefined){var r=new i.JSONLoader;var n=new i.BufferGeometryLoader;for(var a=0,o=e.length;a<o;a++){var s;var h=e[a];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new i[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new i.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleBufferGeometry":s=new i.CircleBufferGeometry(h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CircleGeometry":s=new i.CircleGeometry(h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":s=new i.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":s=new i.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"SphereBufferGeometry":s=new i.SphereBufferGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":s=new i.DodecahedronGeometry(h.radius,h.detail);break;case"IcosahedronGeometry":s=new i.IcosahedronGeometry(h.radius,h.detail);break;case"OctahedronGeometry":s=new i.OctahedronGeometry(h.radius,h.detail);break;case"TetrahedronGeometry":s=new i.TetrahedronGeometry(h.radius,h.detail);break;case"RingGeometry":s=new i.RingGeometry(h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":s=new i.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new i.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"TextGeometry":s=new i.TextGeometry(h.text,h.data);break;case"BufferGeometry":s=n.parse(h);break;case"Geometry":s=r.parse(h.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}s.uuid=h.uuid;if(h.name!==undefined)s.name=h.name;t[h.uuid]=s}}return t},parseMaterials:function(e,t){var r={};if(e!==undefined){var n=new i.MaterialLoader;n.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=n.parse(e[a]);r[s.uuid]=s}}return r},parseImages:function(e,t){var r=this;var n={};function a(e){r.manager.itemStart(e);return s.load(e,function(){r.manager.itemEnd(e)})}if(e!==undefined&&e.length>0){var o=new i.LoadingManager(t);var s=new i.ImageLoader(o);s.setCrossOrigin(this.crossOrigin);for(var h=0,u=e.length;h<u;h++){var l=e[h];var c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;n[l.uuid]=a(c)}}return n},parseTextures:function(e,t){function r(e){if(typeof e==="number")return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return i[e]}var n={};if(e!==undefined){for(var a=0,o=e.length;a<o;a++){var s=e[a];if(s.image===undefined){console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid)}if(t[s.image]===undefined){console.warn("THREE.ObjectLoader: Undefined image",s.image)}var h=new i.Texture(t[s.image]);h.needsUpdate=true;h.uuid=s.uuid;if(s.name!==undefined)h.name=s.name;if(s.mapping!==undefined)h.mapping=r(s.mapping);if(s.offset!==undefined)h.offset=new i.Vector2(s.offset[0],s.offset[1]);if(s.repeat!==undefined)h.repeat=new i.Vector2(s.repeat[0],s.repeat[1]);if(s.minFilter!==undefined)h.minFilter=r(s.minFilter);if(s.magFilter!==undefined)h.magFilter=r(s.magFilter);if(s.anisotropy!==undefined)h.anisotropy=s.anisotropy;if(Array.isArray(s.wrap)){h.wrapS=r(s.wrap[0]);h.wrapT=r(s.wrap[1])}n[s.uuid]=h}}return n},parseObject:function(){var e=new i.Matrix4;return function(t,r,n){var a;var o=function(e){if(r[e]===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",e)}return r[e]};var s=function(e){if(n[e]===undefined){console.warn("THREE.ObjectLoader: Undefined material",e)}return n[e]};switch(t.type){case"Scene":a=new i.Scene;break;case"PerspectiveCamera":a=new i.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new i.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new i.AmbientLight(t.color);break;case"DirectionalLight":a=new i.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new i.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new i.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":a=new i.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":a=new i.Mesh(o(t.geometry),s(t.material));break;case"LOD":a=new i.LOD;break;case"Line":a=new i.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":case"Points":a=new i.Points(o(t.geometry),s(t.material));break;case"Sprite":a=new i.Sprite(s(t.material));break;case"Group":a=new i.Group;break;default:a=new i.Object3D}a.uuid=t.uuid;if(t.name!==undefined)a.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(a.position,a.quaternion,a.scale)}else{if(t.position!==undefined)a.position.fromArray(t.position);if(t.rotation!==undefined)a.rotation.fromArray(t.rotation);if(t.scale!==undefined)a.scale.fromArray(t.scale)}if(t.castShadow!==undefined)a.castShadow=t.castShadow;if(t.receiveShadow!==undefined)a.receiveShadow=t.receiveShadow;if(t.visible!==undefined)a.visible=t.visible;if(t.userData!==undefined)a.userData=t.userData;if(t.children!==undefined){for(var h in t.children){a.add(this.parseObject(t.children[h],r,n))}}if(t.type==="LOD"){var u=t.levels;for(var l=0;l<u.length;l++){var c=u[l];var h=a.getObjectByProperty("uuid",c.object);if(h!==undefined){a.addLevel(h,c.distance)}}}return a}}()};i.TextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.TextureLoader.prototype={constructor:i.TextureLoader,load:function(e,t,r,n){var a=this;var o=new i.ImageLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){var r=new i.Texture(e);r.needsUpdate=true;if(t!==undefined){t(r)}},r,n)},setCrossOrigin:function(e){this.crossOrigin=e}};i.DataTextureLoader=i.BinaryTextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this._parser=null};i.BinaryTextureLoader.prototype={constructor:i.BinaryTextureLoader,load:function(e,t,r,n){var a=this;var o=new i.DataTexture;var s=new i.XHRLoader(this.manager);s.setCrossOrigin(this.crossOrigin);s.setResponseType("arraybuffer");s.load(e,function(e){var r=a._parser(e);if(!r)return;if(undefined!==r.image){o.image=r.image}else if(undefined!==r.data){o.image.width=r.width;o.image.height=r.height;o.image.data=r.data}o.wrapS=undefined!==r.wrapS?r.wrapS:i.ClampToEdgeWrapping;o.wrapT=undefined!==r.wrapT?r.wrapT:i.ClampToEdgeWrapping;o.magFilter=undefined!==r.magFilter?r.magFilter:i.LinearFilter;o.minFilter=undefined!==r.minFilter?r.minFilter:i.LinearMipMapLinearFilter;o.anisotropy=undefined!==r.anisotropy?r.anisotropy:1;if(undefined!==r.format){o.format=r.format}if(undefined!==r.type){o.type=r.type}if(undefined!==r.mipmaps){o.mipmaps=r.mipmaps}if(1===r.mipmapCount){o.minFilter=i.LinearFilter}o.needsUpdate=true;if(t)t(o,r)},r,n);return o},setCrossOrigin:function(e){this.crossOrigin=e}};i.CompressedTextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager;this._parser=null};i.CompressedTextureLoader.prototype={constructor:i.CompressedTextureLoader,load:function(e,t,r,n){var a=this;var o=[];var s=new i.CompressedTexture;s.image=o;var h=new i.XHRLoader(this.manager);h.setCrossOrigin(this.crossOrigin);h.setResponseType("arraybuffer");if(Array.isArray(e)){var u=0;var l=function(l){h.load(e[l],function(e){var r=a._parser(e,true);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps};u+=1;if(u===6){if(r.mipmapCount===1)s.minFilter=i.LinearFilter;s.format=r.format;s.needsUpdate=true;if(t)t(s)}},r,n)};for(var c=0,f=e.length;c<f;++c){l(c)}}else{h.load(e,function(e){var r=a._parser(e,true);if(r.isCubemap){var n=r.mipmaps.length/r.mipmapCount;for(var h=0;h<n;h++){o[h]={mipmaps:[]};for(var u=0;u<r.mipmapCount;u++){o[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+u]);o[h].format=r.format;o[h].width=r.width;o[h].height=r.height}}}else{s.image.width=r.width;s.image.height=r.height;s.mipmaps=r.mipmaps}if(r.mipmapCount===1){s.minFilter=i.LinearFilter}s.format=r.format;s.needsUpdate=true;if(t)t(s)},r,n)}return s},setCrossOrigin:function(e){this.crossOrigin=e}};i.Material=function(){Object.defineProperty(this,"id",{value:i.MaterialIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Material";this.side=i.FrontSide;this.opacity=1;this.transparent=false;this.blending=i.NormalBlending;this.blendSrc=i.SrcAlphaFactor;this.blendDst=i.OneMinusSrcAlphaFactor;this.blendEquation=i.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=i.LessEqualDepth;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.precision=null;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};i.Material.prototype={constructor:i.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},setValues:function(e){if(e===undefined)return;for(var t in e){var r=e[t];if(r===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}var n=this[t];if(n===undefined){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}if(n instanceof i.Color){n.set(r)}else if(n instanceof i.Vector3&&r instanceof i.Vector3){n.copy(r)}else if(t==="overdraw"){this[t]=Number(r)}else{this[t]=r}}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};t.uuid=this.uuid;t.type=this.type;if(this.name!=="")t.name=this.name;if(this.color instanceof i.Color)t.color=this.color.getHex();if(this.emissive instanceof i.Color)t.emissive=this.emissive.getHex();if(this.specular instanceof i.Color)t.specular=this.specular.getHex();if(this.shininess!==undefined)t.shininess=this.shininess;if(this.map instanceof i.Texture)t.map=this.map.toJSON(e).uuid;if(this.alphaMap instanceof i.Texture)t.alphaMap=this.alphaMap.toJSON(e).uuid;if(this.lightMap instanceof i.Texture)t.lightMap=this.lightMap.toJSON(e).uuid;if(this.bumpMap instanceof i.Texture){t.bumpMap=this.bumpMap.toJSON(e).uuid;t.bumpScale=this.bumpScale}if(this.normalMap instanceof i.Texture){t.normalMap=this.normalMap.toJSON(e).uuid;t.normalScale=this.normalScale}if(this.displacementMap instanceof i.Texture){t.displacementMap=this.displacementMap.toJSON(e).uuid;t.displacementScale=this.displacementScale;t.displacementBias=this.displacementBias}if(this.specularMap instanceof i.Texture)t.specularMap=this.specularMap.toJSON(e).uuid;if(this.envMap instanceof i.Texture){t.envMap=this.envMap.toJSON(e).uuid;t.reflectivity=this.reflectivity}if(this.size!==undefined)t.size=this.size;if(this.sizeAttenuation!==undefined)t.sizeAttenuation=this.sizeAttenuation;if(this.vertexColors!==undefined&&this.vertexColors!==i.NoColors)t.vertexColors=this.vertexColors;if(this.shading!==undefined&&this.shading!==i.SmoothShading)t.shading=this.shading;if(this.blending!==undefined&&this.blending!==i.NormalBlending)t.blending=this.blending;
if(this.side!==undefined&&this.side!==i.FrontSide)t.side=this.side;if(this.opacity<1)t.opacity=this.opacity;if(this.transparent===true)t.transparent=this.transparent;if(this.alphaTest>0)t.alphaTest=this.alphaTest;if(this.wireframe===true)t.wireframe=this.wireframe;if(this.wireframeLinewidth>1)t.wireframeLinewidth=this.wireframeLinewidth;return t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name;this.side=e.side;this.opacity=e.opacity;this.transparent=e.transparent;this.blending=e.blending;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.alphaTest=e.alphaTest;this.overdraw=e.overdraw;this.visible=e.visible;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new i.Color}};i.EventDispatcher.prototype.apply(i.Material.prototype);i.MaterialIdCount=0;i.LineBasicMaterial=function(e){i.Material.call(this);this.type="LineBasicMaterial";this.color=new i.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=i.NoColors;this.fog=true;this.setValues(e)};i.LineBasicMaterial.prototype=Object.create(i.Material.prototype);i.LineBasicMaterial.prototype.constructor=i.LineBasicMaterial;i.LineBasicMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;this.vertexColors=e.vertexColors;this.fog=e.fog;return this};i.LineDashedMaterial=function(e){i.Material.call(this);this.type="LineDashedMaterial";this.color=new i.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};i.LineDashedMaterial.prototype=Object.create(i.Material.prototype);i.LineDashedMaterial.prototype.constructor=i.LineDashedMaterial;i.LineDashedMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;this.vertexColors=e.vertexColors;this.fog=e.fog;return this};i.MeshBasicMaterial=function(e){i.Material.call(this);this.type="MeshBasicMaterial";this.color=new i.Color(16777215);this.map=null;this.aoMap=null;this.aoMapIntensity=1;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};i.MeshBasicMaterial.prototype=Object.create(i.Material.prototype);i.MeshBasicMaterial.prototype.constructor=i.MeshBasicMaterial;i.MeshBasicMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.fog=e.fog;this.shading=e.shading;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;return this};i.MeshLambertMaterial=function(e){i.Material.call(this);this.type="MeshLambertMaterial";this.color=new i.Color(16777215);this.emissive=new i.Color(0);this.map=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshLambertMaterial.prototype=Object.create(i.Material.prototype);i.MeshLambertMaterial.prototype.constructor=i.MeshLambertMaterial;i.MeshLambertMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.emissive.copy(e.emissive);this.map=e.map;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.fog=e.fog;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};i.MeshPhongMaterial=function(e){i.Material.call(this);this.type="MeshPhongMaterial";this.color=new i.Color(16777215);this.emissive=new i.Color(0);this.specular=new i.Color(1118481);this.shininess=30;this.metal=false;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshPhongMaterial.prototype=Object.create(i.Material.prototype);i.MeshPhongMaterial.prototype.constructor=i.MeshPhongMaterial;i.MeshPhongMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.emissive.copy(e.emissive);this.specular.copy(e.specular);this.shininess=e.shininess;this.metal=e.metal;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissiveMap=e.emissiveMap;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.fog=e.fog;this.shading=e.shading;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};i.MeshDepthMaterial=function(e){i.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};i.MeshDepthMaterial.prototype=Object.create(i.Material.prototype);i.MeshDepthMaterial.prototype.constructor=i.MeshDepthMaterial;i.MeshDepthMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};i.MeshNormalMaterial=function(e){i.Material.call(this,e);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};i.MeshNormalMaterial.prototype=Object.create(i.Material.prototype);i.MeshNormalMaterial.prototype.constructor=i.MeshNormalMaterial;i.MeshNormalMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};i.MultiMaterial=function(e){this.uuid=i.Math.generateUUID();this.type="MultiMaterial";this.materials=e instanceof Array?e:[];this.visible=true};i.MultiMaterial.prototype={constructor:i.MultiMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,r=this.materials.length;t<r;t++){e.materials.push(this.materials[t].toJSON())}e.visible=this.visible;return e},clone:function(){var e=new this.constructor;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}e.visible=this.visible;return e}};i.MeshFaceMaterial=i.MultiMaterial;i.PointsMaterial=function(e){i.Material.call(this);this.type="PointsMaterial";this.color=new i.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=i.NoColors;this.fog=true;this.setValues(e)};i.PointsMaterial.prototype=Object.create(i.Material.prototype);i.PointsMaterial.prototype.constructor=i.PointsMaterial;i.PointsMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;this.vertexColors=e.vertexColors;this.fog=e.fog;return this};i.PointCloudMaterial=function(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new i.PointsMaterial(e)};i.ParticleBasicMaterial=function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new i.PointsMaterial(e)};i.ParticleSystemMaterial=function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new i.PointsMaterial(e)};i.ShaderMaterial=function(e){i.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=i.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.derivatives=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;if(e!==undefined){if(e.attributes!==undefined){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}this.setValues(e)}};i.ShaderMaterial.prototype=Object.create(i.Material.prototype);i.ShaderMaterial.prototype.constructor=i.ShaderMaterial;i.ShaderMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=i.UniformsUtils.clone(e.uniforms);this.attributes=e.attributes;this.defines=e.defines;this.shading=e.shading;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.fog=e.fog;this.lights=e.lights;this.vertexColors=e.vertexColors;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;this.derivatives=e.derivatives;return this};i.ShaderMaterial.prototype.toJSON=function(e){var t=i.Material.prototype.toJSON.call(this,e);t.uniforms=this.uniforms;t.attributes=this.attributes;t.vertexShader=this.vertexShader;t.fragmentShader=this.fragmentShader;return t};i.RawShaderMaterial=function(e){i.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};i.RawShaderMaterial.prototype=Object.create(i.ShaderMaterial.prototype);i.RawShaderMaterial.prototype.constructor=i.RawShaderMaterial;i.SpriteMaterial=function(e){i.Material.call(this);this.type="SpriteMaterial";this.color=new i.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};i.SpriteMaterial.prototype=Object.create(i.Material.prototype);i.SpriteMaterial.prototype.constructor=i.SpriteMaterial;i.SpriteMaterial.prototype.copy=function(e){i.Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.rotation=e.rotation;this.fog=e.fog;return this};i.Texture=function(e,t,r,n,a,o,s,h,u){Object.defineProperty(this,"id",{value:i.TextureIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.sourceFile="";this.image=e!==undefined?e:i.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:i.Texture.DEFAULT_MAPPING;this.wrapS=r!==undefined?r:i.ClampToEdgeWrapping;this.wrapT=n!==undefined?n:i.ClampToEdgeWrapping;this.magFilter=a!==undefined?a:i.LinearFilter;this.minFilter=o!==undefined?o:i.LinearMipMapLinearFilter;this.anisotropy=u!==undefined?u:1;this.format=s!==undefined?s:i.RGBAFormat;this.type=h!==undefined?h:i.UnsignedByteType;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.version=0;this.onUpdate=null};i.Texture.DEFAULT_IMAGE=undefined;i.Texture.DEFAULT_MAPPING=i.UVMapping;i.Texture.prototype={constructor:i.Texture,set needsUpdate(e){if(e===true)this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;return this},toJSON:function(e){if(e.textures[this.uuid]!==undefined){return e.textures[this.uuid]}function t(e){var t;if(e.toDataURL!==undefined){t=e}else{t=document.createElement("canvas");t.width=e.width;t.height=e.height;t.getContext("2d").drawImage(e,0,0,e.width,e.height)}if(t.width>2048||t.height>2048){return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}var r={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(this.image!==undefined){var n=this.image;if(n.uuid===undefined){n.uuid=i.Math.generateUUID()}if(e.images[n.uuid]===undefined){e.images[n.uuid]={uuid:n.uuid,url:t(n)}}r.image=n.uuid}e.textures[this.uuid]=r;return r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==i.UVMapping)return;e.multiply(this.repeat);e.add(this.offset);if(e.x<0||e.x>1){switch(this.wrapS){case i.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case i.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case i.MirroredRepeatWrapping:if(Math.abs(Math.floor(e.x)%2)===1){e.x=Math.ceil(e.x)-e.x}else{e.x=e.x-Math.floor(e.x)}break}}if(e.y<0||e.y>1){switch(this.wrapT){case i.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case i.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case i.MirroredRepeatWrapping:if(Math.abs(Math.floor(e.y)%2)===1){e.y=Math.ceil(e.y)-e.y}else{e.y=e.y-Math.floor(e.y)}break}}if(this.flipY){e.y=1-e.y}}};i.EventDispatcher.prototype.apply(i.Texture.prototype);i.TextureIdCount=0;i.CanvasTexture=function(e,t,r,n,a,o,s,h,u){i.Texture.call(this,e,t,r,n,a,o,s,h,u);this.needsUpdate=true};i.CanvasTexture.prototype=Object.create(i.Texture.prototype);i.CanvasTexture.prototype.constructor=i.CanvasTexture;i.CubeTexture=function(e,t,r,n,a,o,s,h,u){t=t!==undefined?t:i.CubeReflectionMapping;i.Texture.call(this,e,t,r,n,a,o,s,h,u);this.images=e;this.flipY=false};i.CubeTexture.prototype=Object.create(i.Texture.prototype);i.CubeTexture.prototype.constructor=i.CubeTexture;i.CubeTexture.prototype.copy=function(e){i.Texture.prototype.copy.call(this,e);this.images=e.images;return this};i.CompressedTexture=function(e,t,r,n,a,o,s,h,u,l,c){i.Texture.call(this,null,o,s,h,u,l,n,a,c);this.image={width:t,height:r};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false};i.CompressedTexture.prototype=Object.create(i.Texture.prototype);i.CompressedTexture.prototype.constructor=i.CompressedTexture;i.DataTexture=function(e,t,r,n,a,o,s,h,u,l,c){i.Texture.call(this,null,o,s,h,u,l,n,a,c);this.image={data:e,width:t,height:r};this.magFilter=u!==undefined?u:i.NearestFilter;this.minFilter=l!==undefined?l:i.NearestFilter;this.flipY=false;this.generateMipmaps=false};i.DataTexture.prototype=Object.create(i.Texture.prototype);i.DataTexture.prototype.constructor=i.DataTexture;i.VideoTexture=function(e,t,r,n,a,o,s,h,u){i.Texture.call(this,e,t,r,n,a,o,s,h,u);this.generateMipmaps=false;var l=this;var c=function(){requestAnimationFrame(c);if(e.readyState===e.HAVE_ENOUGH_DATA){l.needsUpdate=true}};c()};i.VideoTexture.prototype=Object.create(i.Texture.prototype);i.VideoTexture.prototype.constructor=i.VideoTexture;i.Group=function(){i.Object3D.call(this);this.type="Group"};i.Group.prototype=Object.create(i.Object3D.prototype);i.Group.prototype.constructor=i.Group;i.Points=function(e,t){i.Object3D.call(this);this.type="Points";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.PointsMaterial({color:Math.random()*16777215})};i.Points.prototype=Object.create(i.Object3D.prototype);i.Points.prototype.constructor=i.Points;i.Points.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;return function r(n,a){var o=this;var s=o.geometry;var h=n.params.Points.threshold;e.getInverse(this.matrixWorld);t.copy(n.ray).applyMatrix4(e);if(s.boundingBox!==null){if(t.isIntersectionBox(s.boundingBox)===false){return}}var u=h/((this.scale.x+this.scale.y+this.scale.z)/3);var l=u*u;var c=new i.Vector3;function f(e,r){var i=t.distanceSqToPoint(e);if(i<l){var s=t.closestPointToPoint(e);s.applyMatrix4(o.matrixWorld);var h=n.ray.origin.distanceTo(s);if(h<n.near||h>n.far)return;a.push({distance:h,distanceToRay:Math.sqrt(i),point:s.clone(),index:r,face:null,object:o})}}if(s instanceof i.BufferGeometry){var d=s.index;var p=s.attributes;var m=p.position.array;if(d!==null){var v=d.array;for(var g=0,y=v.length;g<y;g++){var x=v[g];c.fromArray(m,x*3);f(c,x)}}else{for(var g=0,b=m.length/3;g<b;g++){c.fromArray(m,g*3);f(c,g)}}}else{var w=s.vertices;for(var g=0,b=w.length;g<b;g++){f(w[g],g)}}}}();i.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};i.Points.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);if(e.geometries[this.geometry.uuid]===undefined){e.geometries[this.geometry.uuid]=this.geometry.toJSON()}if(e.materials[this.material.uuid]===undefined){e.materials[this.material.uuid]=this.material.toJSON()}t.object.geometry=this.geometry.uuid;t.object.material=this.material.uuid;return t};i.PointCloud=function(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new i.Points(e,t)};i.ParticleSystem=function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new i.Points(e,t)};i.Line=function(e,t,r){if(r===1){console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.");return new i.LineSegments(e,t)}i.Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.LineBasicMaterial({color:Math.random()*16777215})};i.Line.prototype=Object.create(i.Object3D.prototype);i.Line.prototype.constructor=i.Line;i.Line.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;var r=new i.Sphere;return function n(a,o){var s=a.linePrecision;var h=s*s;var u=this.geometry;if(u.boundingSphere===null)u.computeBoundingSphere();r.copy(u.boundingSphere);r.applyMatrix4(this.matrixWorld);if(a.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(a.ray).applyMatrix4(e);var l=new i.Vector3;var c=new i.Vector3;var f=new i.Vector3;var d=new i.Vector3;var p=this instanceof i.LineSegments?2:1;if(u instanceof i.BufferGeometry){var m=u.index;var v=u.attributes;if(m!==null){var g=m.array;var y=v.position.array;for(var x=0,b=g.length-1;x<b;x+=p){var w=g[x];var _=g[x+1];l.fromArray(y,w*3);c.fromArray(y,_*3);var M=t.distanceSqToSegment(l,c,d,f);if(M>h)continue;d.applyMatrix4(this.matrixWorld);var S=a.ray.origin.distanceTo(d);if(S<a.near||S>a.far)continue;o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{var y=v.position.array;for(var x=0,b=y.length/3-1;x<b;x+=p){l.fromArray(y,3*x);c.fromArray(y,3*x+3);var M=t.distanceSqToSegment(l,c,d,f);if(M>h)continue;d.applyMatrix4(this.matrixWorld);var S=a.ray.origin.distanceTo(d);if(S<a.near||S>a.far)continue;o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(u instanceof i.Geometry){var T=u.vertices;var E=T.length;for(var x=0;x<E-1;x+=p){var M=t.distanceSqToSegment(T[x],T[x+1],d,f);if(M>h)continue;d.applyMatrix4(this.matrixWorld);var S=a.ray.origin.distanceTo(d);if(S<a.near||S>a.far)continue;o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}();i.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};i.Line.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);if(e.geometries[this.geometry.uuid]===undefined){e.geometries[this.geometry.uuid]=this.geometry.toJSON()}if(e.materials[this.material.uuid]===undefined){e.materials[this.material.uuid]=this.material.toJSON()}t.object.geometry=this.geometry.uuid;t.object.material=this.material.uuid;return t};i.LineStrip=0;i.LinePieces=1;i.LineSegments=function(e,t){i.Line.call(this,e,t);this.type="LineSegments"};i.LineSegments.prototype=Object.create(i.Line.prototype);i.LineSegments.prototype.constructor=i.LineSegments;i.Mesh=function(e,t){i.Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};i.Mesh.prototype=Object.create(i.Object3D.prototype);i.Mesh.prototype.constructor=i.Mesh;i.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};i.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};i.Mesh.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;var r=new i.Sphere;var n=new i.Vector3;var a=new i.Vector3;var o=new i.Vector3;var s=new i.Vector3;var h=new i.Vector3;var u=new i.Vector3;var l=new i.Vector2;var c=new i.Vector2;var f=new i.Vector2;var d=new i.Vector3;var p=new i.Vector3;var m=new i.Vector3;function v(e,t,r,n,a,o,s){i.Triangle.barycoordFromPoint(e,t,r,n,d);a.multiplyScalar(d.x);o.multiplyScalar(d.y);s.multiplyScalar(d.z);a.add(o).add(s);return a.clone()}return function g(d,y){var x=this.geometry;var b=this.material;if(b===undefined)return;if(x.boundingSphere===null)x.computeBoundingSphere();r.copy(x.boundingSphere);r.applyMatrix4(this.matrixWorld);if(d.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(d.ray).applyMatrix4(e);if(x.boundingBox!==null){if(t.isIntersectionBox(x.boundingBox)===false){return}}var w,_,M;if(x instanceof i.BufferGeometry){var S=x.index;var T=x.attributes;if(S!==null){var E=S.array;var C=T.position.array;for(var A=0,L=E.length;A<L;A+=3){w=E[A];_=E[A+1];M=E[A+2];n.fromArray(C,w*3);a.fromArray(C,_*3);o.fromArray(C,M*3);if(b.side===i.BackSide){if(t.intersectTriangle(o,a,n,true,p)===null)continue}else{if(t.intersectTriangle(n,a,o,b.side!==i.DoubleSide,p)===null)continue}m.copy(p);m.applyMatrix4(this.matrixWorld);var P=d.ray.origin.distanceTo(m);if(P<d.near||P>d.far)continue;var R;if(T.uv!==undefined){var D=T.uv.array;l.fromArray(D,w*2);c.fromArray(D,_*2);f.fromArray(D,M*2);R=v(p,n,a,o,l,c,f)}y.push({distance:P,point:m.clone(),uv:R,face:new i.Face3(w,_,M,i.Triangle.normal(n,a,o)),faceIndex:Math.floor(A/3),object:this})}}else{var C=T.position.array;for(var A=0,L=C.length;A<L;A+=9){n.fromArray(C,A);a.fromArray(C,A+3);o.fromArray(C,A+6);if(b.side===i.BackSide){if(t.intersectTriangle(o,a,n,true,p)===null)continue}else{if(t.intersectTriangle(n,a,o,b.side!==i.DoubleSide,p)===null)continue}m.copy(p);m.applyMatrix4(this.matrixWorld);var P=d.ray.origin.distanceTo(m);if(P<d.near||P>d.far)continue;var R;if(T.uv!==undefined){var D=T.uv.array;l.fromArray(D,A);c.fromArray(D,A+2);f.fromArray(D,A+4);R=v(p,n,a,o,l,c,f)}w=A/3;_=w+1;M=w+2;y.push({distance:P,point:m.clone(),uv:R,face:new i.Face3(w,_,M,i.Triangle.normal(n,a,o)),index:w,object:this})}}}else if(x instanceof i.Geometry){var k=b instanceof i.MeshFaceMaterial;var F=k===true?b.materials:null;var O=x.vertices;var U=x.faces;for(var B=0,V=U.length;B<V;B++){var I=U[B];var N=k===true?F[I.materialIndex]:b;if(N===undefined)continue;w=O[I.a];_=O[I.b];M=O[I.c];if(N.morphTargets===true){var G=x.morphTargets;var z=this.morphTargetInfluences;n.set(0,0,0);a.set(0,0,0);o.set(0,0,0);for(var H=0,j=G.length;H<j;H++){var W=z[H];if(W===0)continue;var X=G[H].vertices;n.addScaledVector(s.subVectors(X[I.a],w),W);a.addScaledVector(h.subVectors(X[I.b],_),W);o.addScaledVector(u.subVectors(X[I.c],M),W)}n.add(w);a.add(_);o.add(M);w=n;_=a;M=o}if(N.side===i.BackSide){if(t.intersectTriangle(M,_,w,true,p)===null)continue}else{if(t.intersectTriangle(w,_,M,N.side!==i.DoubleSide,p)===null)continue}m.copy(p);m.applyMatrix4(this.matrixWorld);var P=d.ray.origin.distanceTo(m);if(P<d.near||P>d.far)continue;var R;if(x.faceVertexUvs[0].length>0){var D=x.faceVertexUvs[0][B];l.copy(D[0]);c.copy(D[1]);f.copy(D[2]);R=v(p,w,_,M,l,c,f)}y.push({distance:P,point:m.clone(),uv:R,face:I,faceIndex:B,object:this})}}}}();i.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};i.Mesh.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);if(e.geometries[this.geometry.uuid]===undefined){e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)}if(e.materials[this.material.uuid]===undefined){e.materials[this.material.uuid]=this.material.toJSON(e)}t.object.geometry=this.geometry.uuid;t.object.material=this.material.uuid;return t};i.Bone=function(e){i.Object3D.call(this);this.type="Bone";this.skin=e};i.Bone.prototype=Object.create(i.Object3D.prototype);i.Bone.prototype.constructor=i.Bone;i.Bone.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.skin=e.skin;return this};i.Skeleton=function(e,t,r){this.useVertexTexture=r!==undefined?r:true;this.identityMatrix=new i.Matrix4;e=e||[];this.bones=e.slice(0);if(this.useVertexTexture){var n=Math.sqrt(this.bones.length*4);n=i.Math.nextPowerOfTwo(Math.ceil(n));n=Math.max(n,4);this.boneTextureWidth=n;this.boneTextureHeight=n;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new i.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,i.RGBAFormat,i.FloatType)}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{console.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var a=0,o=this.bones.length;a<o;a++){this.boneInverses.push(new i.Matrix4)}}}};i.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new i.Matrix4;if(this.bones[e]){r.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(r)}};i.Skeleton.prototype.pose=function(){var e;for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){if(e.parent){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}};i.Skeleton.prototype.update=function(){var e=new i.Matrix4;return function t(){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(n,this.boneInverses[t]);e.flattenToArrayOffset(this.boneMatrices,t*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();i.Skeleton.prototype.clone=function(){return new i.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)};i.SkinnedMesh=function(e,t,r){i.Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new i.Matrix4;this.bindMatrixInverse=new i.Matrix4;var n=[];if(this.geometry&&this.geometry.bones!==undefined){var a,o;for(var s=0,h=this.geometry.bones.length;s<h;++s){o=this.geometry.bones[s];a=new i.Bone(this);n.push(a);a.name=o.name;a.position.fromArray(o.pos);a.quaternion.fromArray(o.rotq);if(o.scl!==undefined)a.scale.fromArray(o.scl)}for(var s=0,h=this.geometry.bones.length;s<h;++s){o=this.geometry.bones[s];if(o.parent!==-1){n[o.parent].add(n[s])}else{this.add(n[s])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new i.Skeleton(n,undefined,r),this.matrixWorld)};i.SkinnedMesh.prototype=Object.create(i.Mesh.prototype);i.SkinnedMesh.prototype.constructor=i.SkinnedMesh;i.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);this.skeleton.calculateInverses();t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)};i.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};i.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof i.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var r=1/t.lengthManhattan();if(r!==Infinity){t.multiplyScalar(r)}else{t.set(1)}}}else{}};i.SkinnedMesh.prototype.updateMatrixWorld=function(e){i.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)}};i.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)};i.MorphAnimMesh=function(e,t){i.Mesh.call(this,e,t);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,e.morphTargets.length-1)};i.MorphAnimMesh.prototype=Object.create(i.Mesh.prototype);i.MorphAnimMesh.prototype.constructor=i.MorphAnimMesh;i.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};i.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};i.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};i.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;
if(!e.animations)e.animations={};var t,r=e.animations;var n=/([a-z]+)_?(\d+)/;for(var i=0,a=e.morphTargets.length;i<a;i++){var o=e.morphTargets[i];var s=o.name.match(n);if(s&&s.length>1){var h=s[1];if(!r[h])r[h]={start:Infinity,end:-Infinity};var u=r[h];if(i<u.start)u.start=i;if(i>u.end)u.end=i;if(!t)t=h}}e.firstAnimation=t};i.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:r}};i.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];if(r){this.setFrameRange(r.start,r.end);this.duration=1e3*((r.end-r.start)/t);this.time=0}else{console.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")}};i.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var r=this.startKeyframe+i.Math.clamp(Math.floor(this.time/t),0,this.length-1);var n=this.morphTargetInfluences;if(r!==this.currentKeyframe){n[this.lastKeyframe]=0;n[this.currentKeyframe]=1;n[r]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=r}var a=this.time%t/t;if(this.directionBackwards){a=1-a}n[this.currentKeyframe]=a;n[this.lastKeyframe]=1-a};i.MorphAnimMesh.prototype.interpolateTargets=function(e,t,r){var n=this.morphTargetInfluences;for(var i=0,a=n.length;i<a;i++){n[i]=0}if(e>-1)n[e]=1-r;if(t>-1)n[t]=r};i.MorphAnimMesh.prototype.copy=function(e){i.Mesh.prototype.copy.call(this,e);this.duration=e.duration;this.mirroredLoop=e.mirroredLoop;this.time=e.time;this.lastKeyframe=e.lastKeyframe;this.currentKeyframe=e.currentKeyframe;this.direction=e.direction;this.directionBackwards=e.directionBackwards;return this};i.LOD=function(){i.Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:true,value:[]},objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}})};i.LOD.prototype=Object.create(i.Object3D.prototype);i.LOD.prototype.constructor=i.LOD;i.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);var r=this.levels;for(var n=0;n<r.length;n++){if(t<r[n].distance){break}}r.splice(n,0,{distance:t,object:e});this.add(e)};i.LOD.prototype.getObjectForDistance=function(e){var t=this.levels;for(var r=1,n=t.length;r<n;r++){if(e<t[r].distance){break}}return t[r-1].object};i.LOD.prototype.raycast=function(){var e=new i.Vector3;return function t(r,n){e.setFromMatrixPosition(this.matrixWorld);var i=r.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(r,n)}}();i.LOD.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function r(n){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(n.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var a=e.distanceTo(t);i[0].object.visible=true;for(var o=1,s=i.length;o<s;o++){if(a>=i[o].distance){i[o-1].object.visible=false;i[o].object.visible=true}else{break}}for(;o<s;o++){i[o].object.visible=false}}}}();i.LOD.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e,false);var t=e.levels;for(var r=0,n=t.length;r<n;r++){var a=t[r];this.addLevel(a.object.clone(),a.distance)}return this};i.LOD.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];var r=this.levels;for(var n=0,a=r.length;n<a;n++){var o=r[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t};i.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]);var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var r=new Float32Array([0,0,1,0,1,1,0,1]);var n=new i.BufferGeometry;n.setIndex(new i.BufferAttribute(e,1));n.addAttribute("position",new i.BufferAttribute(t,3));n.addAttribute("uv",new i.BufferAttribute(r,2));return function a(e){i.Object3D.call(this);this.type="Sprite";this.geometry=n;this.material=e!==undefined?e:new i.SpriteMaterial}}();i.Sprite.prototype=Object.create(i.Object3D.prototype);i.Sprite.prototype.constructor=i.Sprite;i.Sprite.prototype.raycast=function(){var e=new i.Vector3;return function t(r,n){e.setFromMatrixPosition(this.matrixWorld);var i=r.ray.distanceSqToPoint(e);var a=this.scale.x*this.scale.y;if(i>a){return}n.push({distance:Math.sqrt(i),point:this.position,face:null,object:this})}}();i.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)};i.Sprite.prototype.toJSON=function(e){var t=i.Object3D.prototype.toJSON.call(this,e);if(e.materials[this.material.uuid]===undefined){e.materials[this.material.uuid]=this.material.toJSON()}t.object.material=this.material.uuid;return t};i.Particle=i.Sprite;i.LensFlare=function(e,t,r,n,a){i.Object3D.call(this);this.lensFlares=[];this.positionScreen=new i.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,r,n,a)}};i.LensFlare.prototype=Object.create(i.Object3D.prototype);i.LensFlare.prototype.constructor=i.LensFlare;i.LensFlare.prototype.add=function(e,t,r,n,a,o){if(t===undefined)t=-1;if(r===undefined)r=0;if(o===undefined)o=1;if(a===undefined)a=new i.Color(16777215);if(n===undefined)n=i.NormalBlending;r=Math.min(r,Math.max(0,r));this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:a,blending:n})};i.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var r;var n=-this.positionScreen.x*2;var i=-this.positionScreen.y*2;for(e=0;e<t;e++){r=this.lensFlares[e];r.x=this.positionScreen.x+n*r.distance;r.y=this.positionScreen.y+i*r.distance;r.wantedRotation=r.x*Math.PI*.25;r.rotation+=(r.wantedRotation-r.rotation)*.25}};i.LensFlare.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);this.positionScreen.copy(e.positionScreen);this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;t<r;t++){this.lensFlares.push(e.lensFlares[t])}return this};i.Scene=function(){i.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};i.Scene.prototype=Object.create(i.Object3D.prototype);i.Scene.prototype.constructor=i.Scene;i.Scene.prototype.copy=function(e){i.Object3D.prototype.copy.call(this,e);if(e.fog!==null)this.fog=e.fog.clone();if(e.overrideMaterial!==null)this.overrideMaterial=e.overrideMaterial.clone();this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this};i.Fog=function(e,t,r){this.name="";this.color=new i.Color(e);this.near=t!==undefined?t:1;this.far=r!==undefined?r:1e3};i.Fog.prototype.clone=function(){return new i.Fog(this.color.getHex(),this.near,this.far)};i.FogExp2=function(e,t){this.name="";this.color=new i.Color(e);this.density=t!==undefined?t:25e-5};i.FogExp2.prototype.clone=function(){return new i.FogExp2(this.color.getHex(),this.density)};i.ShaderChunk={};i.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";i.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";i.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";i.ShaderChunk["aomap_fragment"]="#ifdef USE_AOMAP\n\n	totalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n";i.ShaderChunk["aomap_pars_fragment"]="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif";i.ShaderChunk["begin_vertex"]="\nvec3 transformed = vec3( position );\n";i.ShaderChunk["beginnormal_vertex"]="\nvec3 objectNormal = vec3( normal );\n";i.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n";i.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif";i.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";i.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";i.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif";i.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n	// Original approximation by Christophe Schlick '94\n	//;float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n	// Optimized variant (presented by Epic at SIGGRAPH '13)\n	float fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n	// geometry term is (nl)(nv) / 4(nl)(nv)\n\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n	// factor of 1/PI in distribution term omitted\n\n	return ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n	vec3 halfDir = normalize( lightDir + viewDir );\n\n	//float dotNL = saturate( dot( normal, lightDir ) );\n	//float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotLH = saturate( dot( lightDir, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n";i.ShaderChunk["defaultnormal_vertex"]="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";i.ShaderChunk["displacementmap_vertex"]="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n";i.ShaderChunk["displacementmap_pars_vertex"]="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n";i.ShaderChunk["emissivemap_fragment"]="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n";i.ShaderChunk["emissivemap_pars_fragment"]="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n";i.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n";i.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n";i.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n";i.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n";i.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";i.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";i.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n	totalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n";i.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif";i.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n";i.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		// attenuation\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n			// attenuation\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n			// diffuse\n\n			float dotProduct = dot( normal, lightDir );\n\n			vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			float hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack += ambientLightColor;\n\n#endif\n";i.ShaderChunk["lights_phong_fragment"]="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lightPosition = pointLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		// attenuation\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		// diffuse\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n		// specular\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n			// attenuation\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n			// diffuse\n\n			float cosineTerm = saturate( dot( normal, lightDir ) );\n\n			totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n			// specular\n\n			vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n			totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n		// diffuse\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * cosineTerm;\n\n		// specular\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalDiffuseLight += lightColor;\n\n		// specular (sky term only)\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * max( dotProduct, 0.0 );\n\n	}\n\n#endif\n\n#ifdef METAL\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\n\n#else\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\n\n#endif\n";i.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n";i.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n";i.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n";i.ShaderChunk["linear_to_gamma_fragment"]="\n	outgoingLight = linearToOutput( outgoingLight );\n";i.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";i.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n";i.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";i.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";i.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n";i.ShaderChunk["map_pars_fragment"]="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";i.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";i.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n";i.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n";i.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";i.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n";i.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";i.ShaderChunk["project_vertex"]="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";i.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			if ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n		#endif\n\n	}\n\n	outgoingLight = outgoingLight * shadowColor;\n\n#endif\n";
i.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif";i.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";i.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";i.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";i.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";i.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";i.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n";i.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";i.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";i.ShaderChunk["uv2_pars_fragment"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif";i.ShaderChunk["uv2_pars_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif";i.ShaderChunk["uv2_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif";i.ShaderChunk["uv_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n\n#endif";i.ShaderChunk["uv_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";i.ShaderChunk["uv_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";i.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n";i.UniformsUtils={merge:function(e){var t={};for(var r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n){t[i]=n[i]}}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var n in e[r]){var a=e[r][n];if(a instanceof i.Color||a instanceof i.Vector2||a instanceof i.Vector3||a instanceof i.Vector4||a instanceof i.Matrix3||a instanceof i.Matrix4||a instanceof i.Texture){t[r][n]=a.clone()}else if(Array.isArray(a)){t[r][n]=a.slice()}else{t[r][n]=a}}}return t}};i.UniformsLib={common:{diffuse:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new i.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};i.ShaderLib={basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["aomap"],i.UniformsLib["fog"],i.UniformsLib["shadowmap"]]),vertexShader:[i.ShaderChunk["common"],i.ShaderChunk["uv_pars_vertex"],i.ShaderChunk["uv2_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["uv_vertex"],i.ShaderChunk["uv2_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["skinbase_vertex"],"	#ifdef USE_ENVMAP",i.ShaderChunk["beginnormal_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"	#endif",i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["uv_pars_fragment"],i.ShaderChunk["uv2_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["aomap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = vec3( 1.0 );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["aomap_fragment"],"	outgoingLight = diffuseColor.rgb * totalAmbientLight;",i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{emissive:{type:"c",value:new i.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk["common"],i.ShaderChunk["uv_pars_vertex"],i.ShaderChunk["uv2_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_lambert_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["uv_vertex"],i.ShaderChunk["uv2_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["beginnormal_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_lambert_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["uv_pars_fragment"],i.ShaderChunk["uv2_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * vLightFront + emissive;","		else","			outgoingLight += diffuseColor.rgb * vLightBack + emissive;","	#else","		outgoingLight += diffuseColor.rgb * vLightFront + emissive;","	#endif",i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["aomap"],i.UniformsLib["lightmap"],i.UniformsLib["emissivemap"],i.UniformsLib["bumpmap"],i.UniformsLib["normalmap"],i.UniformsLib["displacementmap"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",i.ShaderChunk["common"],i.ShaderChunk["uv_pars_vertex"],i.ShaderChunk["uv2_pars_vertex"],i.ShaderChunk["displacementmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_phong_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["uv_vertex"],i.ShaderChunk["uv2_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["beginnormal_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",i.ShaderChunk["begin_vertex"],i.ShaderChunk["displacementmap_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"	vViewPosition = - mvPosition.xyz;",i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_phong_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["uv_pars_fragment"],i.ShaderChunk["uv2_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["aomap_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["emissivemap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["lights_phong_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["bumpmap_pars_fragment"],i.ShaderChunk["normalmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 totalEmissiveLight = emissive;",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["aomap_fragment"],i.ShaderChunk["emissivemap_fragment"],i.ShaderChunk["lights_phong_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:i.UniformsUtils.merge([i.UniformsLib["points"],i.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_particle_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_particle_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["alphatest_fragment"],"	outgoingLight = diffuseColor.rgb;",i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",i.ShaderChunk["common"],i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["color_fragment"],"	outgoingLight = diffuseColor.rgb;",i.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vNormal = normalize( normalMatrix * normal );",i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[i.ShaderChunk["common"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["begin_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["project_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[i.ShaderChunk["common"],i.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}};i.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",i.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),r=e.context!==undefined?e.context:null,n=t.width,a=t.height,o=1,s=e.alpha!==undefined?e.alpha:false,h=e.depth!==undefined?e.depth:true,u=e.stencil!==undefined?e.stencil:true,l=e.antialias!==undefined?e.antialias:false,c=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,f=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,d=new i.Color(0),p=0;var m=[];var v=[];var g=-1;var y=[];var x=-1;var b=[];var w=-1;var _=[];var M=-1;var S=new Float32Array(8);var T=[];var E=[];this.domElement=t;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;var C=this,A=null,L=null,P=-1,R="",D=null,k=0,F=0,O=0,U=t.width,B=t.height,V=0,I=0,N=new i.Frustum,G=new i.Matrix4,z=new i.Vector3,H=new i.Vector3,j=true,W={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},X={geometries:0,textures:0},q={calls:0,vertices:0,faces:0,points:0};this.info={render:q,memory:X,programs:null};var Y;try{var K={alpha:s,depth:h,stencil:u,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:f};Y=r||t.getContext("webgl",K)||t.getContext("experimental-webgl",K);if(Y===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}t.addEventListener("webglcontextlost",ce,false)}catch(Z){console.error("THREE.WebGLRenderer: "+Z)}var Q=new i.WebGLExtensions(Y);Q.get("OES_texture_float");Q.get("OES_texture_float_linear");Q.get("OES_texture_half_float");Q.get("OES_texture_half_float_linear");Q.get("OES_standard_derivatives");Q.get("ANGLE_instanced_arrays");if(Q.get("OES_element_index_uint")){i.BufferGeometry.MaxIndex=4294967296}var J=new i.WebGLCapabilities(Y,Q,e);var $=new i.WebGLState(Y,Q,tt);var ee=new i.WebGLProperties;var te=new i.WebGLObjects(Y,ee,this.info);var re=new i.WebGLPrograms(this,J);this.info.programs=re.programs;var ne=new i.WebGLBufferRenderer(Y,Q,q);var ie=new i.WebGLIndexedBufferRenderer(Y,Q,q);function ae(e,t,r,n){if(c===true){e*=n;t*=n;r*=n}Y.clearColor(e,t,r,n)}function oe(){$.init();Y.viewport(F,O,U,B);ae(d.r,d.g,d.b,p)}function se(){A=null;D=null;R="";P=-1;j=true;$.reset()}oe();this.context=Y;this.capabilities=J;this.extensions=Q;this.state=$;var he=new i.WebGLShadowMap(this,m,te);this.shadowMap=he;var ue=new i.SpritePlugin(this,T);var le=new i.LensFlarePlugin(this,E);this.getContext=function(){return Y};this.getContextAttributes=function(){return Y.getContextAttributes()};this.forceContextLoss=function(){Q.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){var e;return function t(){if(e!==undefined)return e;var t=Q.get("EXT_texture_filter_anisotropic");if(t!==null){e=Y.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{e=0}return e}}();this.getPrecision=function(){return J.precision};this.getPixelRatio=function(){return o};this.setPixelRatio=function(e){if(e!==undefined)o=e};this.getSize=function(){return{width:n,height:a}};this.setSize=function(e,r,i){n=e;a=r;t.width=e*o;t.height=r*o;if(i!==false){t.style.width=e+"px";t.style.height=r+"px"}this.setViewport(0,0,e,r)};this.setViewport=function(e,t,r,n){F=e*o;O=t*o;U=r*o;B=n*o;Y.viewport(F,O,U,B)};this.setScissor=function(e,t,r,n){Y.scissor(e*o,t*o,r*o,n*o)};this.enableScissorTest=function(e){$.setScissorTest(e)};this.getClearColor=function(){return d};this.setClearColor=function(e,t){d.set(e);p=t!==undefined?t:1;ae(d.r,d.g,d.b,p)};this.getClearAlpha=function(){return p};this.setClearAlpha=function(e){p=e;ae(d.r,d.g,d.b,p)};this.clear=function(e,t,r){var n=0;if(e===undefined||e)n|=Y.COLOR_BUFFER_BIT;if(t===undefined||t)n|=Y.DEPTH_BUFFER_BIT;if(r===undefined||r)n|=Y.STENCIL_BUFFER_BIT;Y.clear(n)};this.clearColor=function(){Y.clear(Y.COLOR_BUFFER_BIT)};this.clearDepth=function(){Y.clear(Y.DEPTH_BUFFER_BIT)};this.clearStencil=function(){Y.clear(Y.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,r,n){this.setRenderTarget(e);this.clear(t,r,n)};this.resetGLState=se;this.dispose=function(){t.removeEventListener("webglcontextlost",ce,false)};function ce(e){e.preventDefault();se();oe();ee.clear()}function fe(e){var t=e.target;t.removeEventListener("dispose",fe);me(t);X.textures--}function de(e){var t=e.target;t.removeEventListener("dispose",de);ve(t);X.textures--}function pe(e){var t=e.target;t.removeEventListener("dispose",pe);ge(t)}function me(e){var t=ee.get(e);if(e.image&&t.__image__webglTextureCube){Y.deleteTexture(t.__image__webglTextureCube)}else{if(t.__webglInit===undefined)return;Y.deleteTexture(t.__webglTexture)}ee.delete(e)}function ve(e){var t=ee.get(e);if(!e||t.__webglTexture===undefined)return;Y.deleteTexture(t.__webglTexture);if(e instanceof i.WebGLRenderTargetCube){for(var r=0;r<6;r++){Y.deleteFramebuffer(t.__webglFramebuffer[r]);Y.deleteRenderbuffer(t.__webglRenderbuffer[r])}}else{Y.deleteFramebuffer(t.__webglFramebuffer);Y.deleteRenderbuffer(t.__webglRenderbuffer)}ee.delete(e)}function ge(e){ye(e);ee.delete(e)}function ye(e){var t=ee.get(e).program;e.program=undefined;if(t!==undefined){re.releaseProgram(t)}}this.renderBufferImmediate=function(e,t,r){$.initAttributes();var n=ee.get(e);if(e.hasPositions&&!n.position)n.position=Y.createBuffer();if(e.hasNormals&&!n.normal)n.normal=Y.createBuffer();if(e.hasUvs&&!n.uv)n.uv=Y.createBuffer();if(e.hasColors&&!n.color)n.color=Y.createBuffer();var a=t.getAttributes();if(e.hasPositions){Y.bindBuffer(Y.ARRAY_BUFFER,n.position);Y.bufferData(Y.ARRAY_BUFFER,e.positionArray,Y.DYNAMIC_DRAW);$.enableAttribute(a.position);Y.vertexAttribPointer(a.position,3,Y.FLOAT,false,0,0)}if(e.hasNormals){Y.bindBuffer(Y.ARRAY_BUFFER,n.normal);if(r.type!=="MeshPhongMaterial"&&r.shading===i.FlatShading){for(var o=0,s=e.count*3;o<s;o+=9){var h=e.normalArray;var u=(h[o+0]+h[o+3]+h[o+6])/3;var l=(h[o+1]+h[o+4]+h[o+7])/3;var c=(h[o+2]+h[o+5]+h[o+8])/3;h[o+0]=u;h[o+1]=l;h[o+2]=c;h[o+3]=u;h[o+4]=l;h[o+5]=c;h[o+6]=u;h[o+7]=l;h[o+8]=c}}Y.bufferData(Y.ARRAY_BUFFER,e.normalArray,Y.DYNAMIC_DRAW);$.enableAttribute(a.normal);Y.vertexAttribPointer(a.normal,3,Y.FLOAT,false,0,0)}if(e.hasUvs&&r.map){Y.bindBuffer(Y.ARRAY_BUFFER,n.uv);Y.bufferData(Y.ARRAY_BUFFER,e.uvArray,Y.DYNAMIC_DRAW);$.enableAttribute(a.uv);Y.vertexAttribPointer(a.uv,2,Y.FLOAT,false,0,0)}if(e.hasColors&&r.vertexColors!==i.NoColors){Y.bindBuffer(Y.ARRAY_BUFFER,n.color);Y.bufferData(Y.ARRAY_BUFFER,e.colorArray,Y.DYNAMIC_DRAW);$.enableAttribute(a.color);Y.vertexAttribPointer(a.color,3,Y.FLOAT,false,0,0)}$.disableUnusedAttributes();Y.drawArrays(Y.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,r,n,a,s,h){Le(a);var u=Re(e,t,r,a,s);var l=false;var c=n.id+"_"+u.id+"_"+a.wireframe;if(c!==R){R=c;l=true}var f=s.morphTargetInfluences;if(f!==undefined){var d=[];for(var p=0,m=f.length;p<m;p++){var v=f[p];d.push([v,p])}d.sort(be);if(d.length>8){d.length=8}var g=n.morphAttributes;for(var p=0,m=d.length;p<m;p++){var v=d[p];S[p]=v[0];if(v[0]!==0){var y=v[1];if(a.morphTargets===true&&g.position)n.addAttribute("morphTarget"+p,g.position[y]);if(a.morphNormals===true&&g.normal)n.addAttribute("morphNormal"+p,g.normal[y])}else{if(a.morphTargets===true)n.removeAttribute("morphTarget"+p);if(a.morphNormals===true)n.removeAttribute("morphNormal"+p)}}var x=u.getUniforms();if(x.morphTargetInfluences!==null){Y.uniform1fv(x.morphTargetInfluences,S)}l=true}var y=n.index;var b=n.attributes.position;if(a.wireframe===true){y=te.getWireframeAttribute(n)}var w;if(y!==null){w=ie;w.setIndex(y)}else{w=ne}if(l){xe(a,u,n);if(y!==null){Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,te.getAttributeBuffer(y))}}if(h===undefined){var _;if(y!==null){_=y.count}else if(b instanceof i.InterleavedBufferAttribute){_=b.data.array.length/3}else{_=b.count}var M=n.drawRange;h={start:M.start,count:Math.min(M.count,_)}}if(s instanceof i.Mesh){if(a.wireframe===true){$.setLineWidth(a.wireframeLinewidth*o);w.setMode(Y.LINES)}else{w.setMode(Y.TRIANGLES)}if(n instanceof i.InstancedBufferGeometry&&n.maxInstancedCount>0){w.renderInstances(n)}else{w.render(h.start,h.count)}}else if(s instanceof i.Line){var T=a.linewidth;if(T===undefined)T=1;$.setLineWidth(T*o);if(s instanceof i.LineSegments){w.setMode(Y.LINES)}else{w.setMode(Y.LINE_STRIP)}w.render(h.start,h.count)}else if(s instanceof i.Points){w.setMode(Y.POINTS);w.render(h.start,h.count)}};function xe(e,t,r,n){var a;if(r instanceof i.InstancedBufferGeometry){a=Q.get("ANGLE_instanced_arrays");if(a===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}if(n===undefined)n=0;$.initAttributes();var o=r.attributes;var s=t.getAttributes();var h=e.defaultAttributeValues;for(var u in s){var l=s[u];if(l>=0){var c=o[u];if(c!==undefined){$.enableAttribute(l);var f=c.itemSize;var d=te.getAttributeBuffer(c);if(c instanceof i.InterleavedBufferAttribute){var p=c.data;var m=p.stride;var v=c.offset;Y.bindBuffer(Y.ARRAY_BUFFER,d);
Y.vertexAttribPointer(l,f,Y.FLOAT,false,m*p.array.BYTES_PER_ELEMENT,(n*m+v)*p.array.BYTES_PER_ELEMENT);if(p instanceof i.InstancedInterleavedBuffer){if(a===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.");return}a.vertexAttribDivisorANGLE(l,p.meshPerAttribute);if(r.maxInstancedCount===undefined){r.maxInstancedCount=p.meshPerAttribute*p.count}}}else{Y.bindBuffer(Y.ARRAY_BUFFER,d);Y.vertexAttribPointer(l,f,Y.FLOAT,false,0,n*f*4);if(c instanceof i.InstancedBufferAttribute){if(a===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.");return}a.vertexAttribDivisorANGLE(l,c.meshPerAttribute);if(r.maxInstancedCount===undefined){r.maxInstancedCount=c.meshPerAttribute*c.count}}}}else if(h!==undefined){var g=h[u];if(g!==undefined){switch(g.length){case 2:Y.vertexAttrib2fv(l,g);break;case 3:Y.vertexAttrib3fv(l,g);break;case 4:Y.vertexAttrib4fv(l,g);break;default:Y.vertexAttrib1fv(l,g)}}}}}$.disableUnusedAttributes()}function be(e,t){return t[0]-e[0]}function we(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function _e(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}this.render=function(e,t,r,n){if(t instanceof i.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var a=e.fog;R="";P=-1;D=null;j=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===null)t.updateMatrixWorld();t.matrixWorldInverse.getInverse(t.matrixWorld);G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);N.setFromMatrix(G);m.length=0;g=-1;x=-1;w=-1;M=-1;T.length=0;E.length=0;Te(e);v.length=g+1;y.length=x+1;b.length=w+1;_.length=M+1;if(C.sortObjects===true){v.sort(we);y.sort(_e)}he.render(e,t);q.calls=0;q.vertices=0;q.faces=0;q.points=0;this.setRenderTarget(r);if(this.autoClear||n){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}if(e.overrideMaterial){var o=e.overrideMaterial;Ee(v,t,m,a,o);Ee(y,t,m,a,o);Ce(b,t,m,a,o);Ce(_,t,m,a,o)}else{$.setBlending(i.NoBlending);Ee(v,t,m,a);Ce(b,t,m,a);Ee(y,t,m,a);Ce(_,t,m,a)}ue.render(e,t);le.render(e,t,V,I);if(r&&r.generateMipmaps&&r.minFilter!==i.NearestFilter&&r.minFilter!==i.LinearFilter){$e(r)}$.setDepthTest(true);$.setDepthWrite(true);$.setColorWrite(true)};function Me(e){var t,r;if(e.material.transparent){t=_;r=++M}else{t=b;r=++w}if(r<t.length){t[r]=e}else{t.push(e)}}function Se(e,t,r,n,i){var a,o;if(r.transparent){a=y;o=++x}else{a=v;o=++g}var s=a[o];if(s!==undefined){s.id=e.id;s.object=e;s.geometry=t;s.material=r;s.z=z.z;s.group=i}else{s={id:e.id,object:e,geometry:t,material:r,z:z.z,group:i};a.push(s)}}function Te(e){if(e.visible===false)return;if(e instanceof i.Light){m.push(e)}else if(e instanceof i.Sprite){T.push(e)}else if(e instanceof i.LensFlare){E.push(e)}else if(e instanceof i.ImmediateRenderObject){Me(e)}else if(e instanceof i.Mesh||e instanceof i.Line||e instanceof i.Points){if(e instanceof i.SkinnedMesh){e.skeleton.update()}if(e.frustumCulled===false||N.intersectsObject(e)===true){var t=e.material;if(t.visible===true){if(C.sortObjects===true){z.setFromMatrixPosition(e.matrixWorld);z.applyProjection(G)}var r=te.update(e);if(t instanceof i.MeshFaceMaterial){var n=r.groups;var a=t.materials;for(var o=0,s=n.length;o<s;o++){var h=n[o];var u=a[h.materialIndex];if(u.visible===true){Se(e,r,u,z.z,h)}}}else{Se(e,r,t,z.z)}}}}var l=e.children;for(var o=0,s=l.length;o<s;o++){Te(l[o])}}function Ee(e,t,r,n,i){for(var a=0,o=e.length;a<o;a++){var s=e[a];var h=s.object;var u=s.geometry;var l=i===undefined?s.material:i;var c=s.group;h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);C.renderBufferDirect(t,r,n,u,l,h,c)}}function Ce(e,t,r,n,i){var a=i;for(var o=0,s=e.length;o<s;o++){var h=e[o];h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);if(i===undefined)a=h.material;Le(a);var u=Re(t,r,n,a,h);R="";h.render(function(e){C.renderBufferImmediate(e,u,a)})}}function Ae(e,t,r,n){var a=ee.get(e);var o=re.getParameters(e,t,r,n);var s=re.getProgramCode(e,o);var h=a.program;var u=true;if(h===undefined){e.addEventListener("dispose",pe)}else if(h.code!==s){ye(e)}else if(o.shaderID!==undefined){return}else{u=false}if(u){if(o.shaderID){var l=i.ShaderLib[o.shaderID];a.__webglShader={name:e.type,uniforms:i.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else{a.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}e.__webglShader=a.__webglShader;h=re.acquireProgram(e,o,s);a.program=h;e.program=h}var c=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<C.maxMorphTargets;f++){if(c["morphTarget"+f]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<C.maxMorphNormals;f++){if(c["morphNormal"+f]>=0){e.numSupportedMorphNormals++}}}a.uniformsList=[];var d=a.program.getUniforms();for(var p in a.__webglShader.uniforms){var m=d[p];if(m){a.uniformsList.push([a.__webglShader.uniforms[p],m])}}}function Le(e){Pe(e);if(e.transparent===true){$.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha)}else{$.setBlending(i.NoBlending)}$.setDepthFunc(e.depthFunc);$.setDepthTest(e.depthTest);$.setDepthWrite(e.depthWrite);$.setColorWrite(e.colorWrite);$.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Pe(e){e.side!==i.DoubleSide?$.enable(Y.CULL_FACE):$.disable(Y.CULL_FACE);$.setFlipSided(e.side===i.BackSide)}function Re(e,t,r,n,a){k=0;var o=ee.get(n);if(n.needsUpdate||!o.program){Ae(n,t,r,a);n.needsUpdate=false}var s=false;var h=false;var u=false;var l=o.program,c=l.getUniforms(),f=o.__webglShader.uniforms;if(l.id!==A){Y.useProgram(l.program);A=l.id;s=true;h=true;u=true}if(n.id!==P){if(P===-1)u=true;P=n.id;h=true}if(s||e!==D){Y.uniformMatrix4fv(c.projectionMatrix,false,e.projectionMatrix.elements);if(J.logarithmicDepthBuffer){Y.uniform1f(c.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2))}if(e!==D)D=e;if(n instanceof i.ShaderMaterial||n instanceof i.MeshPhongMaterial||n.envMap){if(c.cameraPosition!==undefined){z.setFromMatrixPosition(e.matrixWorld);Y.uniform3f(c.cameraPosition,z.x,z.y,z.z)}}if(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshBasicMaterial||n instanceof i.ShaderMaterial||n.skinning){if(c.viewMatrix!==undefined){Y.uniformMatrix4fv(c.viewMatrix,false,e.matrixWorldInverse.elements)}}}if(n.skinning){if(a.bindMatrix&&c.bindMatrix!==undefined){Y.uniformMatrix4fv(c.bindMatrix,false,a.bindMatrix.elements)}if(a.bindMatrixInverse&&c.bindMatrixInverse!==undefined){Y.uniformMatrix4fv(c.bindMatrixInverse,false,a.bindMatrixInverse.elements)}if(J.floatVertexTextures&&a.skeleton&&a.skeleton.useVertexTexture){if(c.boneTexture!==undefined){var d=ze();Y.uniform1i(c.boneTexture,d);C.setTexture(a.skeleton.boneTexture,d)}if(c.boneTextureWidth!==undefined){Y.uniform1i(c.boneTextureWidth,a.skeleton.boneTextureWidth)}if(c.boneTextureHeight!==undefined){Y.uniform1i(c.boneTextureHeight,a.skeleton.boneTextureHeight)}}else if(a.skeleton&&a.skeleton.boneMatrices){if(c.boneGlobalMatrices!==undefined){Y.uniformMatrix4fv(c.boneGlobalMatrices,false,a.skeleton.boneMatrices)}}}if(h){if(r&&n.fog){Ue(f,r)}if(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n.lights){if(j){u=true;We(t,e);j=false}if(u){Ve(f,W);Ie(f,true)}else{Ie(f,false)}}if(n instanceof i.MeshBasicMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshPhongMaterial){De(f,n)}if(n instanceof i.LineBasicMaterial){ke(f,n)}else if(n instanceof i.LineDashedMaterial){ke(f,n);Fe(f,n)}else if(n instanceof i.PointsMaterial){Oe(f,n)}else if(n instanceof i.MeshPhongMaterial){Be(f,n)}else if(n instanceof i.MeshDepthMaterial){f.mNear.value=e.near;f.mFar.value=e.far;f.opacity.value=n.opacity}else if(n instanceof i.MeshNormalMaterial){f.opacity.value=n.opacity}if(a.receiveShadow&&!n._shadowPass){Ne(f,t)}He(o.uniformsList)}Ge(c,a);if(c.modelMatrix!==undefined){Y.uniformMatrix4fv(c.modelMatrix,false,a.matrixWorld.elements)}return l}function De(e,t){e.opacity.value=t.opacity;e.diffuse.value=t.color;if(t.emissive){e.emissive.value=t.emissive}e.map.value=t.map;e.specularMap.value=t.specularMap;e.alphaMap.value=t.alphaMap;if(t.aoMap){e.aoMap.value=t.aoMap;e.aoMapIntensity.value=t.aoMapIntensity}var r;if(t.map){r=t.map}else if(t.specularMap){r=t.specularMap}else if(t.displacementMap){r=t.displacementMap}else if(t.normalMap){r=t.normalMap}else if(t.bumpMap){r=t.bumpMap}else if(t.alphaMap){r=t.alphaMap}else if(t.emissiveMap){r=t.emissiveMap}if(r!==undefined){var n=r.offset;var a=r.repeat;e.offsetRepeat.value.set(n.x,n.y,a.x,a.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof i.WebGLRenderTargetCube?1:-1;e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio}function ke(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function Fe(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Oe(e,r){e.psColor.value=r.color;e.opacity.value=r.opacity;e.size.value=r.size;e.scale.value=t.height/2;e.map.value=r.map;if(r.map!==null){var n=r.map.offset;var i=r.map.repeat;e.offsetRepeat.value.set(n.x,n.y,i.x,i.y)}}function Ue(e,t){e.fogColor.value=t.color;if(t instanceof i.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof i.FogExp2){e.fogDensity.value=t.density}}function Be(e,t){e.specular.value=t.specular;e.shininess.value=t.shininess;if(t.lightMap){e.lightMap.value=t.lightMap;e.lightMapIntensity.value=t.lightMapIntensity}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function Ve(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.pointLightDecay.value=t.point.decays;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.spotLightDecay.value=t.spot.decays;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function Ie(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLightColor.needsUpdate=t;e.directionalLightDirection.needsUpdate=t;e.pointLightColor.needsUpdate=t;e.pointLightPosition.needsUpdate=t;e.pointLightDistance.needsUpdate=t;e.pointLightDecay.needsUpdate=t;e.spotLightColor.needsUpdate=t;e.spotLightPosition.needsUpdate=t;e.spotLightDistance.needsUpdate=t;e.spotLightDirection.needsUpdate=t;e.spotLightAngleCos.needsUpdate=t;e.spotLightExponent.needsUpdate=t;e.spotLightDecay.needsUpdate=t;e.hemisphereLightSkyColor.needsUpdate=t;e.hemisphereLightGroundColor.needsUpdate=t;e.hemisphereLightDirection.needsUpdate=t}function Ne(e,t){if(e.shadowMatrix){var r=0;for(var n=0,a=t.length;n<a;n++){var o=t[n];if(!o.castShadow)continue;if(o instanceof i.SpotLight||o instanceof i.DirectionalLight){e.shadowMap.value[r]=o.shadowMap;e.shadowMapSize.value[r]=o.shadowMapSize;e.shadowMatrix.value[r]=o.shadowMatrix;e.shadowDarkness.value[r]=o.shadowDarkness;e.shadowBias.value[r]=o.shadowBias;r++}}}}function Ge(e,t){Y.uniformMatrix4fv(e.modelViewMatrix,false,t.modelViewMatrix.elements);if(e.normalMatrix){Y.uniformMatrix3fv(e.normalMatrix,false,t.normalMatrix.elements)}}function ze(){var e=k;if(e>=J.maxTextures){console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+J.maxTextures)}k+=1;return e}function He(e){var t,r;for(var n=0,a=e.length;n<a;n++){var o=e[n][0];if(o.needsUpdate===false)continue;var s=o.type;var h=o.value;var u=e[n][1];switch(s){case"1i":Y.uniform1i(u,h);break;case"1f":Y.uniform1f(u,h);break;case"2f":Y.uniform2f(u,h[0],h[1]);break;case"3f":Y.uniform3f(u,h[0],h[1],h[2]);break;case"4f":Y.uniform4f(u,h[0],h[1],h[2],h[3]);break;case"1iv":Y.uniform1iv(u,h);break;case"3iv":Y.uniform3iv(u,h);break;case"1fv":Y.uniform1fv(u,h);break;case"2fv":Y.uniform2fv(u,h);break;case"3fv":Y.uniform3fv(u,h);break;case"4fv":Y.uniform4fv(u,h);break;case"Matrix3fv":Y.uniformMatrix3fv(u,false,h);break;case"Matrix4fv":Y.uniformMatrix4fv(u,false,h);break;case"i":Y.uniform1i(u,h);break;case"f":Y.uniform1f(u,h);break;case"v2":Y.uniform2f(u,h.x,h.y);break;case"v3":Y.uniform3f(u,h.x,h.y,h.z);break;case"v4":Y.uniform4f(u,h.x,h.y,h.z,h.w);break;case"c":Y.uniform3f(u,h.r,h.g,h.b);break;case"iv1":Y.uniform1iv(u,h);break;case"iv":Y.uniform3iv(u,h);break;case"fv1":Y.uniform1fv(u,h);break;case"fv":Y.uniform3fv(u,h);break;case"v2v":if(o._array===undefined){o._array=new Float32Array(2*h.length)}for(var l=0,c=0,f=h.length;l<f;l++,c+=2){o._array[c+0]=h[l].x;o._array[c+1]=h[l].y}Y.uniform2fv(u,o._array);break;case"v3v":if(o._array===undefined){o._array=new Float32Array(3*h.length)}for(var l=0,d=0,f=h.length;l<f;l++,d+=3){o._array[d+0]=h[l].x;o._array[d+1]=h[l].y;o._array[d+2]=h[l].z}Y.uniform3fv(u,o._array);break;case"v4v":if(o._array===undefined){o._array=new Float32Array(4*h.length)}for(var l=0,p=0,f=h.length;l<f;l++,p+=4){o._array[p+0]=h[l].x;o._array[p+1]=h[l].y;o._array[p+2]=h[l].z;o._array[p+3]=h[l].w}Y.uniform4fv(u,o._array);break;case"m3":Y.uniformMatrix3fv(u,false,h.elements);break;case"m3v":if(o._array===undefined){o._array=new Float32Array(9*h.length)}for(var l=0,f=h.length;l<f;l++){h[l].flattenToArrayOffset(o._array,l*9)}Y.uniformMatrix3fv(u,false,o._array);break;case"m4":Y.uniformMatrix4fv(u,false,h.elements);break;case"m4v":if(o._array===undefined){o._array=new Float32Array(16*h.length)}for(var l=0,f=h.length;l<f;l++){h[l].flattenToArrayOffset(o._array,l*16)}Y.uniformMatrix4fv(u,false,o._array);break;case"t":t=h;r=ze();Y.uniform1i(u,r);if(!t)continue;if(t instanceof i.CubeTexture||Array.isArray(t.image)&&t.image.length===6){Ke(t,r)}else if(t instanceof i.WebGLRenderTargetCube){Ze(t,r)}else{C.setTexture(t,r)}break;case"tv":if(o._array===undefined){o._array=[]}for(var l=0,f=o.value.length;l<f;l++){o._array[l]=ze()}Y.uniform1iv(u,o._array);for(var l=0,f=o.value.length;l<f;l++){t=o.value[l];r=o._array[l];if(!t)continue;C.setTexture(t,r)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}function je(e,t,r,n){e[t+0]=r.r*n;e[t+1]=r.g*n;e[t+2]=r.b*n}function We(e,t){var r,n,a,o=0,s=0,h=0,u,l,c,f,d,p=W,m=t.matrixWorldInverse,v=p.directional.colors,g=p.directional.positions,y=p.point.colors,x=p.point.positions,b=p.point.distances,w=p.point.decays,_=p.spot.colors,M=p.spot.positions,S=p.spot.distances,T=p.spot.directions,E=p.spot.anglesCos,C=p.spot.exponents,A=p.spot.decays,L=p.hemi.skyColors,P=p.hemi.groundColors,R=p.hemi.positions,D=0,k=0,F=0,O=0,U=0,B=0,V=0,I=0,N=0,G=0,j=0,X=0;for(r=0,n=e.length;r<n;r++){a=e[r];if(a.onlyShadow)continue;u=a.color;f=a.intensity;d=a.distance;if(a instanceof i.AmbientLight){if(!a.visible)continue;o+=u.r;s+=u.g;h+=u.b}else if(a instanceof i.DirectionalLight){U+=1;if(!a.visible)continue;H.setFromMatrixPosition(a.matrixWorld);z.setFromMatrixPosition(a.target.matrixWorld);H.sub(z);H.transformDirection(m);N=D*3;g[N+0]=H.x;g[N+1]=H.y;g[N+2]=H.z;je(v,N,u,f);D+=1}else if(a instanceof i.PointLight){B+=1;if(!a.visible)continue;G=k*3;je(y,G,u,f);z.setFromMatrixPosition(a.matrixWorld);z.applyMatrix4(m);x[G+0]=z.x;x[G+1]=z.y;x[G+2]=z.z;b[k]=d;w[k]=a.distance===0?0:a.decay;k+=1}else if(a instanceof i.SpotLight){V+=1;if(!a.visible)continue;j=F*3;je(_,j,u,f);H.setFromMatrixPosition(a.matrixWorld);z.copy(H).applyMatrix4(m);M[j+0]=z.x;M[j+1]=z.y;M[j+2]=z.z;S[F]=d;z.setFromMatrixPosition(a.target.matrixWorld);H.sub(z);H.transformDirection(m);T[j+0]=H.x;T[j+1]=H.y;T[j+2]=H.z;E[F]=Math.cos(a.angle);C[F]=a.exponent;A[F]=a.distance===0?0:a.decay;F+=1}else if(a instanceof i.HemisphereLight){I+=1;if(!a.visible)continue;H.setFromMatrixPosition(a.matrixWorld);H.transformDirection(m);X=O*3;R[X+0]=H.x;R[X+1]=H.y;R[X+2]=H.z;l=a.color;c=a.groundColor;je(L,X,l,f);je(P,X,c,f);O+=1}}for(r=D*3,n=Math.max(v.length,U*3);r<n;r++)v[r]=0;for(r=k*3,n=Math.max(y.length,B*3);r<n;r++)y[r]=0;for(r=F*3,n=Math.max(_.length,V*3);r<n;r++)_[r]=0;for(r=O*3,n=Math.max(L.length,I*3);r<n;r++)L[r]=0;for(r=O*3,n=Math.max(P.length,I*3);r<n;r++)P[r]=0;p.directional.length=D;p.point.length=k;p.spot.length=F;p.hemi.length=O;p.ambient[0]=o;p.ambient[1]=s;p.ambient[2]=h}this.setFaceCulling=function(e,t){if(e===i.CullFaceNone){$.disable(Y.CULL_FACE)}else{if(t===i.FrontFaceDirectionCW){Y.frontFace(Y.CW)}else{Y.frontFace(Y.CCW)}if(e===i.CullFaceBack){Y.cullFace(Y.BACK)}else if(e===i.CullFaceFront){Y.cullFace(Y.FRONT)}else{Y.cullFace(Y.FRONT_AND_BACK)}$.enable(Y.CULL_FACE)}};function Xe(e,t,r){var n;if(r){Y.texParameteri(e,Y.TEXTURE_WRAP_S,tt(t.wrapS));Y.texParameteri(e,Y.TEXTURE_WRAP_T,tt(t.wrapT));Y.texParameteri(e,Y.TEXTURE_MAG_FILTER,tt(t.magFilter));Y.texParameteri(e,Y.TEXTURE_MIN_FILTER,tt(t.minFilter))}else{Y.texParameteri(e,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE);Y.texParameteri(e,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE);if(t.wrapS!==i.ClampToEdgeWrapping||t.wrapT!==i.ClampToEdgeWrapping){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )")}Y.texParameteri(e,Y.TEXTURE_MAG_FILTER,et(t.magFilter));Y.texParameteri(e,Y.TEXTURE_MIN_FILTER,et(t.minFilter));if(t.minFilter!==i.NearestFilter&&t.minFilter!==i.LinearFilter){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")}}n=Q.get("EXT_texture_filter_anisotropic");if(n){if(t.type===i.FloatType&&Q.get("OES_texture_float_linear")===null)return;if(t.type===i.HalfFloatType&&Q.get("OES_texture_half_float_linear")===null)return;if(t.anisotropy>1||ee.get(t).__currentAnisotropy){Y.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,C.getMaxAnisotropy()));ee.get(t).__currentAnisotropy=t.anisotropy}}}function qe(e,t,r){if(e.__webglInit===undefined){e.__webglInit=true;t.__webglInit=true;t.addEventListener("dispose",fe);e.__webglTexture=Y.createTexture();X.textures++}$.activeTexture(Y.TEXTURE0+r);$.bindTexture(Y.TEXTURE_2D,e.__webglTexture);Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,t.flipY);Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha);Y.pixelStorei(Y.UNPACK_ALIGNMENT,t.unpackAlignment);t.image=Ye(t.image,J.maxTextureSize);var n=t.image,a=i.Math.isPowerOfTwo(n.width)&&i.Math.isPowerOfTwo(n.height),o=tt(t.format),s=tt(t.type);Xe(Y.TEXTURE_2D,t,a);var h,u=t.mipmaps;if(t instanceof i.DataTexture){if(u.length>0&&a){for(var l=0,c=u.length;l<c;l++){h=u[l];$.texImage2D(Y.TEXTURE_2D,l,o,h.width,h.height,0,o,s,h.data)}t.generateMipmaps=false}else{$.texImage2D(Y.TEXTURE_2D,0,o,n.width,n.height,0,o,s,n.data)}}else if(t instanceof i.CompressedTexture){for(var l=0,c=u.length;l<c;l++){h=u[l];if(t.format!==i.RGBAFormat&&t.format!==i.RGBFormat){if($.getCompressedTextureFormats().indexOf(o)>-1){$.compressedTexImage2D(Y.TEXTURE_2D,l,o,h.width,h.height,0,h.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{$.texImage2D(Y.TEXTURE_2D,l,o,h.width,h.height,0,o,s,h.data)}}}else{if(u.length>0&&a){for(var l=0,c=u.length;l<c;l++){h=u[l];$.texImage2D(Y.TEXTURE_2D,l,o,o,s,h)}t.generateMipmaps=false}else{$.texImage2D(Y.TEXTURE_2D,0,o,o,s,t.image)}}if(t.generateMipmaps&&a)Y.generateMipmap(Y.TEXTURE_2D);e.__version=t.version;if(t.onUpdate)t.onUpdate(t)}this.setTexture=function(e,t){var r=ee.get(e);if(e.version>0&&r.__version!==e.version){var n=e.image;if(n===undefined){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);return}if(n.complete===false){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e);return}qe(r,e,t);return}$.activeTexture(Y.TEXTURE0+t);$.bindTexture(Y.TEXTURE_2D,r.__webglTexture)};function Ye(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height);var n=document.createElement("canvas");n.width=Math.floor(e.width*r);n.height=Math.floor(e.height*r);var i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height);console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e);return n}return e}function Ke(e,t){var r=ee.get(e);if(e.image.length===6){if(e.version>0&&r.__version!==e.version){if(!r.__image__webglTextureCube){e.addEventListener("dispose",fe);r.__image__webglTextureCube=Y.createTexture();X.textures++}$.activeTexture(Y.TEXTURE0+t);$.bindTexture(Y.TEXTURE_CUBE_MAP,r.__image__webglTextureCube);Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,e.flipY);var n=e instanceof i.CompressedTexture;var a=e.image[0]instanceof i.DataTexture;var o=[];for(var s=0;s<6;s++){if(C.autoScaleCubemaps&&!n&&!a){o[s]=Ye(e.image[s],J.maxCubemapSize)}else{o[s]=a?e.image[s].image:e.image[s]}}var h=o[0],u=i.Math.isPowerOfTwo(h.width)&&i.Math.isPowerOfTwo(h.height),l=tt(e.format),c=tt(e.type);Xe(Y.TEXTURE_CUBE_MAP,e,u);for(var s=0;s<6;s++){if(!n){if(a){$.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,o[s].width,o[s].height,0,l,c,o[s].data)}else{$.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,l,c,o[s])}}else{var f,d=o[s].mipmaps;for(var p=0,m=d.length;p<m;p++){f=d[p];if(e.format!==i.RGBAFormat&&e.format!==i.RGBFormat){if($.getCompressedTextureFormats().indexOf(l)>-1){$.compressedTexImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,f.width,f.height,0,f.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{$.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,f.width,f.height,0,l,c,f.data)}}}}if(e.generateMipmaps&&u){Y.generateMipmap(Y.TEXTURE_CUBE_MAP)}r.__version=e.version;if(e.onUpdate)e.onUpdate(e)}else{$.activeTexture(Y.TEXTURE0+t);$.bindTexture(Y.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}}}function Ze(e,t){$.activeTexture(Y.TEXTURE0+t);$.bindTexture(Y.TEXTURE_CUBE_MAP,ee.get(e).__webglTexture)}function Qe(e,t,r){Y.bindFramebuffer(Y.FRAMEBUFFER,e);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,r,ee.get(t).__webglTexture,0)}function Je(e,t){Y.bindRenderbuffer(Y.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){Y.renderbufferStorage(Y.RENDERBUFFER,Y.DEPTH_COMPONENT16,t.width,t.height);Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){Y.renderbufferStorage(Y.RENDERBUFFER,Y.DEPTH_STENCIL,t.width,t.height);Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_STENCIL_ATTACHMENT,Y.RENDERBUFFER,e)}else{Y.renderbufferStorage(Y.RENDERBUFFER,Y.RGBA4,t.width,t.height)}}this.setRenderTarget=function(e){var t=e instanceof i.WebGLRenderTargetCube;if(e&&ee.get(e).__webglFramebuffer===undefined){var r=ee.get(e);if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",de);r.__webglTexture=Y.createTexture();X.textures++;var n=i.Math.isPowerOfTwo(e.width)&&i.Math.isPowerOfTwo(e.height),a=tt(e.format),o=tt(e.type);if(t){r.__webglFramebuffer=[];r.__webglRenderbuffer=[];$.bindTexture(Y.TEXTURE_CUBE_MAP,r.__webglTexture);Xe(Y.TEXTURE_CUBE_MAP,e,n);for(var s=0;s<6;s++){r.__webglFramebuffer[s]=Y.createFramebuffer();r.__webglRenderbuffer[s]=Y.createRenderbuffer();$.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a,e.width,e.height,0,a,o,null);Qe(r.__webglFramebuffer[s],e,Y.TEXTURE_CUBE_MAP_POSITIVE_X+s);Je(r.__webglRenderbuffer[s],e)}if(e.generateMipmaps&&n)Y.generateMipmap(Y.TEXTURE_CUBE_MAP)}else{r.__webglFramebuffer=Y.createFramebuffer();if(e.shareDepthFrom){r.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{r.__webglRenderbuffer=Y.createRenderbuffer()}$.bindTexture(Y.TEXTURE_2D,r.__webglTexture);Xe(Y.TEXTURE_2D,e,n);$.texImage2D(Y.TEXTURE_2D,0,a,e.width,e.height,0,a,o,null);Qe(r.__webglFramebuffer,e,Y.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,r.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_STENCIL_ATTACHMENT,Y.RENDERBUFFER,r.__webglRenderbuffer)}}else{Je(r.__webglRenderbuffer,e)}if(e.generateMipmaps&&n)Y.generateMipmap(Y.TEXTURE_2D)}if(t){$.bindTexture(Y.TEXTURE_CUBE_MAP,null)}else{$.bindTexture(Y.TEXTURE_2D,null)}Y.bindRenderbuffer(Y.RENDERBUFFER,null);Y.bindFramebuffer(Y.FRAMEBUFFER,null)}var h,u,l,c,f;if(e){var r=ee.get(e);if(t){h=r.__webglFramebuffer[e.activeCubeFace]}else{h=r.__webglFramebuffer}u=e.width;l=e.height;c=0;f=0}else{h=null;u=U;l=B;c=F;f=O}if(h!==L){Y.bindFramebuffer(Y.FRAMEBUFFER,h);Y.viewport(c,f,u,l);L=h}V=u;I=l};this.readRenderTargetPixels=function(e,t,r,n,a,o){if(!(e instanceof i.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(ee.get(e).__webglFramebuffer){if(e.format!==i.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");return}var s=false;if(ee.get(e).__webglFramebuffer!==L){Y.bindFramebuffer(Y.FRAMEBUFFER,ee.get(e).__webglFramebuffer);s=true}if(Y.checkFramebufferStatus(Y.FRAMEBUFFER)===Y.FRAMEBUFFER_COMPLETE){Y.readPixels(t,r,n,a,Y.RGBA,Y.UNSIGNED_BYTE,o)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}if(s){Y.bindFramebuffer(Y.FRAMEBUFFER,L)}}};function $e(e){if(e instanceof i.WebGLRenderTargetCube){$.bindTexture(Y.TEXTURE_CUBE_MAP,ee.get(e).__webglTexture);Y.generateMipmap(Y.TEXTURE_CUBE_MAP);$.bindTexture(Y.TEXTURE_CUBE_MAP,null)}else{$.bindTexture(Y.TEXTURE_2D,ee.get(e).__webglTexture);Y.generateMipmap(Y.TEXTURE_2D);$.bindTexture(Y.TEXTURE_2D,null)}}function et(e){if(e===i.NearestFilter||e===i.NearestMipMapNearestFilter||e===i.NearestMipMapLinearFilter){return Y.NEAREST}return Y.LINEAR}function tt(e){var t;if(e===i.RepeatWrapping)return Y.REPEAT;if(e===i.ClampToEdgeWrapping)return Y.CLAMP_TO_EDGE;if(e===i.MirroredRepeatWrapping)return Y.MIRRORED_REPEAT;if(e===i.NearestFilter)return Y.NEAREST;if(e===i.NearestMipMapNearestFilter)return Y.NEAREST_MIPMAP_NEAREST;if(e===i.NearestMipMapLinearFilter)return Y.NEAREST_MIPMAP_LINEAR;if(e===i.LinearFilter)return Y.LINEAR;if(e===i.LinearMipMapNearestFilter)return Y.LINEAR_MIPMAP_NEAREST;if(e===i.LinearMipMapLinearFilter)return Y.LINEAR_MIPMAP_LINEAR;if(e===i.UnsignedByteType)return Y.UNSIGNED_BYTE;if(e===i.UnsignedShort4444Type)return Y.UNSIGNED_SHORT_4_4_4_4;if(e===i.UnsignedShort5551Type)return Y.UNSIGNED_SHORT_5_5_5_1;if(e===i.UnsignedShort565Type)return Y.UNSIGNED_SHORT_5_6_5;if(e===i.ByteType)return Y.BYTE;if(e===i.ShortType)return Y.SHORT;if(e===i.UnsignedShortType)return Y.UNSIGNED_SHORT;if(e===i.IntType)return Y.INT;if(e===i.UnsignedIntType)return Y.UNSIGNED_INT;if(e===i.FloatType)return Y.FLOAT;t=Q.get("OES_texture_half_float");if(t!==null){if(e===i.HalfFloatType)return t.HALF_FLOAT_OES}if(e===i.AlphaFormat)return Y.ALPHA;if(e===i.RGBFormat)return Y.RGB;if(e===i.RGBAFormat)return Y.RGBA;if(e===i.LuminanceFormat)return Y.LUMINANCE;if(e===i.LuminanceAlphaFormat)return Y.LUMINANCE_ALPHA;if(e===i.AddEquation)return Y.FUNC_ADD;if(e===i.SubtractEquation)return Y.FUNC_SUBTRACT;if(e===i.ReverseSubtractEquation)return Y.FUNC_REVERSE_SUBTRACT;if(e===i.ZeroFactor)return Y.ZERO;if(e===i.OneFactor)return Y.ONE;if(e===i.SrcColorFactor)return Y.SRC_COLOR;if(e===i.OneMinusSrcColorFactor)return Y.ONE_MINUS_SRC_COLOR;if(e===i.SrcAlphaFactor)return Y.SRC_ALPHA;if(e===i.OneMinusSrcAlphaFactor)return Y.ONE_MINUS_SRC_ALPHA;if(e===i.DstAlphaFactor)return Y.DST_ALPHA;if(e===i.OneMinusDstAlphaFactor)return Y.ONE_MINUS_DST_ALPHA;if(e===i.DstColorFactor)return Y.DST_COLOR;if(e===i.OneMinusDstColorFactor)return Y.ONE_MINUS_DST_COLOR;if(e===i.SrcAlphaSaturateFactor)return Y.SRC_ALPHA_SATURATE;t=Q.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===i.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===i.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=Q.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===i.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===i.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===i.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===i.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=Q.get("EXT_blend_minmax");if(t!==null){if(e===i.MinEquation)return t.MIN_EXT;if(e===i.MaxEquation)return t.MAX_EXT}return 0}this.supportsFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return Q.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return Q.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return Q.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return Q.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return Q.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return Q.get("EXT_blend_minmax")};this.supportsVertexTextures=function(){return J.vertexTextures};this.supportsInstancedArrays=function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return Q.get("ANGLE_instanced_arrays")};this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Object.defineProperties(this,{shadowMapEnabled:{get:function(){return he.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");he.enabled=e}},shadowMapType:{get:function(){return he.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");he.type=e}},shadowMapCullFace:{get:function(){
return he.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");he.cullFace=e}},shadowMapDebug:{get:function(){return he.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug.");he.debug=e}}})};i.WebGLRenderTarget=function(e,t,r){this.uuid=i.Math.generateUUID();this.width=e;this.height=t;r=r||{};this.wrapS=r.wrapS!==undefined?r.wrapS:i.ClampToEdgeWrapping;this.wrapT=r.wrapT!==undefined?r.wrapT:i.ClampToEdgeWrapping;this.magFilter=r.magFilter!==undefined?r.magFilter:i.LinearFilter;this.minFilter=r.minFilter!==undefined?r.minFilter:i.LinearMipMapLinearFilter;this.anisotropy=r.anisotropy!==undefined?r.anisotropy:1;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.format=r.format!==undefined?r.format:i.RGBAFormat;this.type=r.type!==undefined?r.type:i.UnsignedByteType;this.depthBuffer=r.depthBuffer!==undefined?r.depthBuffer:true;this.stencilBuffer=r.stencilBuffer!==undefined?r.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=r.shareDepthFrom!==undefined?r.shareDepthFrom:null};i.WebGLRenderTarget.prototype={constructor:i.WebGLRenderTarget,setSize:function(e,t){if(this.width!==e||this.height!==t){this.width=e;this.height=t;this.dispose()}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.width=e.width;this.height=e.height;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.format=e.format;this.type=e.type;this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.generateMipmaps=e.generateMipmaps;this.shareDepthFrom=e.shareDepthFrom;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube=function(e,t,r){i.WebGLRenderTarget.call(this,e,t,r);this.activeCubeFace=0};i.WebGLRenderTargetCube.prototype=Object.create(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube.prototype.constructor=i.WebGLRenderTargetCube;i.WebGLBufferRenderer=function(e,t,r){var n;function a(e){n=e}function o(t,i){e.drawArrays(n,t,i);r.calls++;r.vertices+=i;if(n===e.TRIANGLES)r.faces+=i/3}function s(e){var r=t.get("ANGLE_instanced_arrays");if(r===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var a=e.attributes.position;if(a instanceof i.InterleavedBufferAttribute){r.drawArraysInstancedANGLE(n,0,a.data.count,e.maxInstancedCount)}else{r.drawArraysInstancedANGLE(n,0,a.count,e.maxInstancedCount)}}this.setMode=a;this.render=o;this.renderInstances=s};i.WebGLIndexedBufferRenderer=function(e,t,r){var n;function i(e){n=e}var a,o;function s(r){if(r.array instanceof Uint32Array&&t.get("OES_element_index_uint")){a=e.UNSIGNED_INT;o=4}else{a=e.UNSIGNED_SHORT;o=2}}function h(t,i){e.drawElements(n,i,a,t*o);r.calls++;r.vertices+=i;if(n===e.TRIANGLES)r.faces+=i/3}function u(e){var r=t.get("ANGLE_instanced_arrays");if(r===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var i=e.index;r.drawElementsInstancedANGLE(n,i.array.length,a,0,e.maxInstancedCount)}this.setMode=i;this.setIndex=s;this.render=h;this.renderInstances=u};i.WebGLExtensions=function(e){var t={};this.get=function(r){if(t[r]!==undefined){return t[r]}var n;switch(r){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}if(n===null){console.warn("THREE.WebGLRenderer: "+r+" extension not supported.")}t[r]=n;return n}};i.WebGLCapabilities=function(e,t,r){function n(t){if(t==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0){return"highp"}t="mediump"}if(t==="mediump"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0){return"mediump"}}return"lowp"}this.getMaxPrecision=n;this.precision=r.precision!==undefined?r.precision:"highp",this.logarithmicDepthBuffer=r.logarithmicDepthBuffer!==undefined?r.logarithmicDepthBuffer:false;this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE);this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS);this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=this.maxVertexTextures>0;this.floatFragmentTextures=!!t.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var i=n(this.precision);if(i!==this.precision){console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",i,"instead.");this.precision=i}if(this.logarithmicDepthBuffer){this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth")}};i.WebGLGeometries=function(e,t,r){var n={};function a(e){var t=e.geometry;if(n[t.id]!==undefined){return n[t.id]}t.addEventListener("dispose",o);var a;if(t instanceof i.BufferGeometry){a=t}else if(t instanceof i.Geometry){if(t._bufferGeometry===undefined){t._bufferGeometry=(new i.BufferGeometry).setFromObject(e)}a=t._bufferGeometry}n[t.id]=a;r.memory.geometries++;return a}function o(e){var i=e.target;var a=n[i.id];u(a.attributes);i.removeEventListener("dispose",o);delete n[i.id];var s=t.get(i);if(s.wireframe)h(s.wireframe);r.memory.geometries--}function s(e){if(e instanceof i.InterleavedBufferAttribute){return t.get(e.data).__webglBuffer}return t.get(e).__webglBuffer}function h(t){var r=s(t);if(r!==undefined){e.deleteBuffer(r);l(t)}}function u(e){for(var t in e){h(e[t])}}function l(e){if(e instanceof i.InterleavedBufferAttribute){t.delete(e.data)}else{t.delete(e)}}this.get=a};i.WebGLObjects=function(e,t,r){var n=new i.WebGLGeometries(e,t,r);function a(t){var r=n.get(t);if(t.geometry instanceof i.Geometry){r.updateFromObject(t)}var a=r.index;var s=r.attributes;if(a!==null){o(a,e.ELEMENT_ARRAY_BUFFER)}for(var h in s){o(s[h],e.ARRAY_BUFFER)}var u=r.morphAttributes;for(var h in u){var l=u[h];for(var c=0,f=l.length;c<f;c++){o(l[c],e.ARRAY_BUFFER)}}return r}function o(e,r){var n=e instanceof i.InterleavedBufferAttribute?e.data:e;var a=t.get(n);if(a.__webglBuffer===undefined){s(a,n,r)}else if(a.version!==n.version){h(a,n,r)}}function s(t,r,n){t.__webglBuffer=e.createBuffer();e.bindBuffer(n,t.__webglBuffer);var i=r.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(n,r.array,i);t.version=r.version}function h(t,r,n){e.bindBuffer(n,t.__webglBuffer);if(r.dynamic===false||r.updateRange.count===-1){e.bufferSubData(n,0,r.array)}else if(r.updateRange.count===0){console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.")}else{e.bufferSubData(n,r.updateRange.offset*r.array.BYTES_PER_ELEMENT,r.array.subarray(r.updateRange.offset,r.updateRange.offset+r.updateRange.count));r.updateRange.count=0}t.version=r.version}function u(e){if(e instanceof i.InterleavedBufferAttribute){return t.get(e.data).__webglBuffer}return t.get(e).__webglBuffer}function l(r){var n=t.get(r);if(n.wireframe!==undefined){return n.wireframe}var a=[];var s=r.index;var h=r.attributes;var u=h.position;if(s!==null){var l={};var f=s.array;for(var d=0,p=f.length;d<p;d+=3){var m=f[d+0];var v=f[d+1];var g=f[d+2];if(c(l,m,v))a.push(m,v);if(c(l,v,g))a.push(v,g);if(c(l,g,m))a.push(g,m)}}else{var f=h.position.array;for(var d=0,p=f.length/3-1;d<p;d+=3){var m=d+0;var v=d+1;var g=d+2;a.push(m,v,v,g,g,m)}}var y=u.count>65535?Uint32Array:Uint16Array;var x=new i.BufferAttribute(new y(a),1);o(x,e.ELEMENT_ARRAY_BUFFER);n.wireframe=x;return x}function c(e,t,r){if(t>r){var n=t;t=r;r=n}var i=e[t];if(i===undefined){e[t]=[r];return true}else if(i.indexOf(r)===-1){i.push(r);return true}return false}this.getAttributeBuffer=u;this.getWireframeAttribute=l;this.update=a};i.WebGLProgram=function(){var e=0;function t(e){var t=[];for(var r in e){var n=e[r];if(n===false)continue;t.push("#define "+r+" "+n)}return t.join("\n")}function r(e,t,r){var n={};var i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(var a=0;a<i;a++){var o=e.getActiveUniform(t,a);var s=o.name;var h=e.getUniformLocation(t,s);var u=s.lastIndexOf("[0]");if(u!==-1&&u===s.length-3){n[s.substr(0,u)]=h}n[s]=h}return n}function n(e,t,r){var n={};var i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(var a=0;a<i;a++){var o=e.getActiveAttrib(t,a);var s=o.name;n[s]=e.getAttribLocation(t,s)}return n}function a(e){return e!==""}return function o(s,h,u,l){var c=s.context;var f=u.defines;var d=u.__webglShader.vertexShader;var p=u.__webglShader.fragmentShader;var m="SHADOWMAP_TYPE_BASIC";if(l.shadowMapType===i.PCFShadowMap){m="SHADOWMAP_TYPE_PCF"}else if(l.shadowMapType===i.PCFSoftShadowMap){m="SHADOWMAP_TYPE_PCF_SOFT"}var v="ENVMAP_TYPE_CUBE";var g="ENVMAP_MODE_REFLECTION";var y="ENVMAP_BLENDING_MULTIPLY";if(l.envMap){switch(u.envMap.mapping){case i.CubeReflectionMapping:case i.CubeRefractionMapping:v="ENVMAP_TYPE_CUBE";break;case i.EquirectangularReflectionMapping:case i.EquirectangularRefractionMapping:v="ENVMAP_TYPE_EQUIREC";break;case i.SphericalReflectionMapping:v="ENVMAP_TYPE_SPHERE";break}switch(u.envMap.mapping){case i.CubeRefractionMapping:case i.EquirectangularRefractionMapping:g="ENVMAP_MODE_REFRACTION";break}switch(u.combine){case i.MultiplyOperation:y="ENVMAP_BLENDING_MULTIPLY";break;case i.MixOperation:y="ENVMAP_BLENDING_MIX";break;case i.AddOperation:y="ENVMAP_BLENDING_ADD";break}}var x=s.gammaFactor>0?s.gammaFactor:1;var b=t(f);var w=c.createProgram();var _,M;if(u instanceof i.RawShaderMaterial){_="";M=""}else{_=["precision "+l.precision+" float;","precision "+l.precision+" int;","#define SHADER_NAME "+u.__webglShader.name,b,l.supportsVertexTextures?"#define VERTEX_TEXTURES":"",s.gammaInput?"#define GAMMA_INPUT":"",s.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,"#define MAX_BONES "+l.maxBones,l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+g:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===false?"#define USE_MORPHNORMALS":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+m:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(a).join("\n");M=[l.bumpMap||l.normalMap||l.flatShading||u.derivatives?"#extension GL_OES_standard_derivatives : enable":"",l.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+l.precision+" float;","precision "+l.precision+" int;","#define SHADER_NAME "+u.__webglShader.name,b,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,l.alphaTest?"#define ALPHATEST "+l.alphaTest:"",s.gammaInput?"#define GAMMA_INPUT":"",s.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+v:"",l.envMap?"#define "+g:"",l.envMap?"#define "+y:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.flatShading?"#define FLAT_SHADED":"",l.metal?"#define METAL":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+m:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(a).join("\n")}var S=_+d;var T=M+p;var E=i.WebGLShader(c,c.VERTEX_SHADER,S);var C=i.WebGLShader(c,c.FRAGMENT_SHADER,T);c.attachShader(w,E);c.attachShader(w,C);if(u.index0AttributeName!==undefined){c.bindAttribLocation(w,0,u.index0AttributeName)}else if(l.morphTargets===true){c.bindAttribLocation(w,0,"position")}c.linkProgram(w);var A=c.getProgramInfoLog(w);var L=c.getShaderInfoLog(E);var P=c.getShaderInfoLog(C);var R=true;var D=true;if(c.getProgramParameter(w,c.LINK_STATUS)===false){R=false;console.error("THREE.WebGLProgram: shader error: ",c.getError(),"gl.VALIDATE_STATUS",c.getProgramParameter(w,c.VALIDATE_STATUS),"gl.getProgramInfoLog",A,L,P)}else if(A!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A)}else if(L===""||P===""){D=false}if(D){this.diagnostics={runnable:R,material:u,programLog:A,vertexShader:{log:L,prefix:_},fragmentShader:{log:P,prefix:M}}}c.deleteShader(E);c.deleteShader(C);var k;this.getUniforms=function(){if(k===undefined){k=r(c,w)}return k};var F;this.getAttributes=function(){if(F===undefined){F=n(c,w)}return F};this.destroy=function(){c.deleteProgram(w);this.program=undefined};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=e++;this.code=h;this.usedTimes=1;this.program=w;this.vertexShader=E;this.fragmentShader=C;return this}}();i.WebGLPrograms=function(e,t){var r=[];var n={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"};var a=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];function o(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture){return 1024}else{var r=t.maxVertexUniforms;var n=Math.floor((r-20)/4);var a=n;if(e!==undefined&&e instanceof i.SkinnedMesh){a=Math.min(e.skeleton.bones.length,a);if(a<e.skeleton.bones.length){console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+a+" (try OpenGL instead of ANGLE)")}}return a}}function s(e){var t=0;var r=0;var n=0;var a=0;for(var o=0,s=e.length;o<s;o++){var h=e[o];if(h.onlyShadow||h.visible===false)continue;if(h instanceof i.DirectionalLight)t++;if(h instanceof i.PointLight)r++;if(h instanceof i.SpotLight)n++;if(h instanceof i.HemisphereLight)a++}return{directional:t,point:r,spot:n,hemi:a}}function h(e){var t=0;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(!a.castShadow)continue;if(a instanceof i.SpotLight)t++;if(a instanceof i.DirectionalLight)t++}return t}this.getParameters=function(r,a,u,l){var c=n[r.type];var f=s(a);var d=h(a);var p=o(l);var m=e.getPrecision();if(r.precision!==null){m=t.getMaxPrecision(r.precision);if(m!==r.precision){console.warn("THREE.WebGLRenderer.initMaterial:",r.precision,"not supported, using",m,"instead.")}}var v={shaderID:c,precision:m,supportsVertexTextures:t.vertexTextures,map:!!r.map,envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,combine:r.combine,vertexColors:r.vertexColors,fog:u,useFog:r.fog,fogExp:u instanceof i.FogExp2,flatShading:r.shading===i.FlatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:r.skinning,maxBones:p,useVertexTexture:t.floatVertexTextures&&l&&l.skeleton&&l.skeleton.useVertexTexture,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,maxDirLights:f.directional,maxPointLights:f.point,maxSpotLights:f.spot,maxHemiLights:f.hemi,maxShadows:d,shadowMapEnabled:e.shadowMap.enabled&&l.receiveShadow&&d>0,shadowMapType:e.shadowMap.type,shadowMapDebug:e.shadowMap.debug,alphaTest:r.alphaTest,metal:r.metal,doubleSided:r.side===i.DoubleSide,flipSided:r.side===i.BackSide};return v};this.getProgramCode=function(e,t){var r=[];if(t.shaderID){r.push(t.shaderID)}else{r.push(e.fragmentShader);r.push(e.vertexShader)}if(e.defines!==undefined){for(var n in e.defines){r.push(n);r.push(e.defines[n])}}for(var i=0;i<a.length;i++){var o=a[i];r.push(o);r.push(t[o])}return r.join()};this.acquireProgram=function(t,n,a){var o;for(var s=0,h=r.length;s<h;s++){var u=r[s];if(u.code===a){o=u;++o.usedTimes;break}}if(o===undefined){o=new i.WebGLProgram(e,a,t,n);r.push(o)}return o};this.releaseProgram=function(e){if(--e.usedTimes===0){var t=r.indexOf(e);r[t]=r[r.length-1];r.pop();e.destroy()}};this.programs=r};i.WebGLProperties=function(){var e={};this.get=function(t){var r=t.uuid;var n=e[r];if(n===undefined){n={};e[r]=n}return n};this.delete=function(t){delete e[t.uuid]};this.clear=function(){e={}}};i.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var r=0;r<t.length;r++){t[r]=r+1+": "+t[r]}return t.join("\n")};return function t(r,n,i){var a=r.createShader(n);r.shaderSource(a,i);r.compileShader(a);if(r.getShaderParameter(a,r.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(r.getShaderInfoLog(a)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",n===r.VERTEX_SHADER?"vertex":"fragment",r.getShaderInfoLog(a),e(i))}return a}}();i.WebGLShadowMap=function(e,t,r){var n=e.context,a=e.state,o=new i.Frustum,s=new i.Matrix4,h=new i.Vector3,u=new i.Vector3,l=new i.Vector3,c=[];var f=i.ShaderLib["depthRGBA"];var d=i.UniformsUtils.clone(f.uniforms);var p=new i.ShaderMaterial({uniforms:d,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader});var m=new i.ShaderMaterial({uniforms:d,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,morphTargets:true});var v=new i.ShaderMaterial({uniforms:d,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,skinning:true});var g=new i.ShaderMaterial({uniforms:d,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,morphTargets:true,skinning:true});p._shadowPass=true;m._shadowPass=true;v._shadowPass=true;g._shadowPass=true;var y=this;this.enabled=false;this.autoUpdate=true;this.needsUpdate=false;this.type=i.PCFShadowMap;this.cullFace=i.CullFaceFront;this.render=function(h,u){if(y.enabled===false)return;if(y.autoUpdate===false&&y.needsUpdate===false)return;n.clearColor(1,1,1,1);a.disable(n.BLEND);a.enable(n.CULL_FACE);n.frontFace(n.CCW);if(y.cullFace===i.CullFaceFront){n.cullFace(n.FRONT)}else{n.cullFace(n.BACK)}a.setDepthTest(true);for(var f=0,d=t.length;f<d;f++){var p=t[f];if(!p.castShadow)continue;if(!p.shadowMap){var m=i.LinearFilter;if(y.type===i.PCFSoftShadowMap){m=i.NearestFilter}var v={minFilter:m,magFilter:m,format:i.RGBAFormat};p.shadowMap=new i.WebGLRenderTarget(p.shadowMapWidth,p.shadowMapHeight,v);p.shadowMapSize=new i.Vector2(p.shadowMapWidth,p.shadowMapHeight);p.shadowMatrix=new i.Matrix4}if(!p.shadowCamera){if(p instanceof i.SpotLight){p.shadowCamera=new i.PerspectiveCamera(p.shadowCameraFov,p.shadowMapWidth/p.shadowMapHeight,p.shadowCameraNear,p.shadowCameraFar)}else if(p instanceof i.DirectionalLight){p.shadowCamera=new i.OrthographicCamera(p.shadowCameraLeft,p.shadowCameraRight,p.shadowCameraTop,p.shadowCameraBottom,p.shadowCameraNear,p.shadowCameraFar)}else{console.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",p);continue}h.add(p.shadowCamera);if(h.autoUpdate===true)h.updateMatrixWorld()}if(p.shadowCameraVisible&&!p.cameraHelper){p.cameraHelper=new i.CameraHelper(p.shadowCamera);h.add(p.cameraHelper)}var g=p.shadowMap;var w=p.shadowMatrix;var _=p.shadowCamera;_.position.setFromMatrixPosition(p.matrixWorld);l.setFromMatrixPosition(p.target.matrixWorld);_.lookAt(l);_.updateMatrixWorld();_.matrixWorldInverse.getInverse(_.matrixWorld);if(p.cameraHelper)p.cameraHelper.visible=p.shadowCameraVisible;if(p.shadowCameraVisible)p.cameraHelper.update();w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);w.multiply(_.projectionMatrix);w.multiply(_.matrixWorldInverse);s.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse);o.setFromMatrix(s);e.setRenderTarget(g);e.clear();c.length=0;b(h,_);for(var M=0,S=c.length;M<S;M++){var T=c[M];var E=r.update(T);var C=T.material;if(C instanceof i.MeshFaceMaterial){var A=E.groups;var L=C.materials;for(var P=0,R=A.length;P<R;P++){var D=A[P];var k=L[D.materialIndex];if(k.visible===true){e.renderBufferDirect(_,t,null,E,x(T,k),T,D)}}}else{e.renderBufferDirect(_,t,null,E,x(T,C),T)}}}var F=e.getClearColor(),O=e.getClearAlpha();e.setClearColor(F,O);a.enable(n.BLEND);if(y.cullFace===i.CullFaceFront){n.cullFace(n.BACK)}e.resetGLState();y.needsUpdate=false};function x(e,t){var r=e.geometry;var n=r.morphTargets!==undefined&&r.morphTargets.length>0&&t.morphTargets;var a=e instanceof i.SkinnedMesh&&t.skinning;var o;if(e.customDepthMaterial){o=e.customDepthMaterial}else if(a){o=n?g:v}else if(n){o=m}else{o=p}o.visible=t.visible;o.wireframe=t.wireframe;o.wireframeLinewidth=t.wireframeLinewidth;return o}function b(e,t){if(e.visible===false)return;if(e instanceof i.Mesh||e instanceof i.Line||e instanceof i.Points){if(e.castShadow&&(e.frustumCulled===false||o.intersectsObject(e)===true)){var r=e.material;if(r.visible===true){e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);c.push(e)}}}var n=e.children;for(var a=0,s=n.length;a<s;a++){b(n[a],t)}}};i.WebGLState=function(e,t,r){var n=this;var a=new Uint8Array(16);var o=new Uint8Array(16);var s={};var h=null;var u=null;var l=null;var c=null;var f=null;var d=null;var p=null;var m=null;var v=null;var g=null;var y=null;var x=null;var b=null;var w=null;var _=null;var M=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);var S=undefined;var T={};this.init=function(){e.clearColor(0,0,0,1);e.clearDepth(1);e.clearStencil(0);this.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL);e.frontFace(e.CCW);e.cullFace(e.BACK);this.enable(e.CULL_FACE);this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)};this.initAttributes=function(){for(var e=0,t=a.length;e<t;e++){a[e]=0}};this.enableAttribute=function(t){a[t]=1;if(o[t]===0){e.enableVertexAttribArray(t);o[t]=1}};this.disableUnusedAttributes=function(){for(var t=0,r=o.length;t<r;t++){if(o[t]!==a[t]){e.disableVertexAttribArray(t);o[t]=0}}};this.enable=function(t){if(s[t]!==true){e.enable(t);s[t]=true}};this.disable=function(t){if(s[t]!==false){e.disable(t);s[t]=false}};this.getCompressedTextureFormats=function(){if(h===null){h=[];if(t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")){var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS);for(var n=0;n<r.length;n++){h.push(r[n])}}}return h};this.setBlending=function(t,n,a,o,s,h,v){if(t!==u){if(t===i.NoBlending){this.disable(e.BLEND)}else if(t===i.AdditiveBlending){this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE)}else if(t===i.SubtractiveBlending){this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)}else if(t===i.MultiplyBlending){this.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.SRC_COLOR)}else if(t===i.CustomBlending){this.enable(e.BLEND)}else{this.enable(e.BLEND);e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}u=t}if(t===i.CustomBlending){s=s||n;h=h||a;v=v||o;if(n!==l||s!==d){e.blendEquationSeparate(r(n),r(s));l=n;d=s}if(a!==c||o!==f||h!==p||v!==m){e.blendFuncSeparate(r(a),r(o),r(h),r(v));c=a;f=o;p=h;m=v}}else{l=null;c=null;f=null;d=null;p=null;m=null}};this.setDepthFunc=function(t){if(v!==t){if(t){switch(t){case i.NeverDepth:e.depthFunc(e.NEVER);break;case i.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case i.LessDepth:e.depthFunc(e.LESS);break;case i.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case i.EqualDepth:e.depthFunc(e.EQUAL);break;case i.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case i.GreaterDepth:e.depthFunc(e.GREATER);break;case i.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}}else{e.depthFunc(e.LEQUAL)}v=t}};this.setDepthTest=function(t){if(t){this.enable(e.DEPTH_TEST)}else{this.disable(e.DEPTH_TEST)}};this.setDepthWrite=function(t){if(g!==t){e.depthMask(t);g=t}};this.setColorWrite=function(t){if(y!==t){e.colorMask(t,t,t,t);y=t}};this.setFlipSided=function(t){if(x!==t){if(t){e.frontFace(e.CW)}else{e.frontFace(e.CCW)}x=t}};this.setLineWidth=function(t){if(t!==b){e.lineWidth(t);b=t}};this.setPolygonOffset=function(t,r,n){if(t){this.enable(e.POLYGON_OFFSET_FILL)}else{this.disable(e.POLYGON_OFFSET_FILL)}if(t&&(w!==r||_!==n)){e.polygonOffset(r,n);w=r;_=n}};this.setScissorTest=function(t){if(t){this.enable(e.SCISSOR_TEST)}else{this.disable(e.SCISSOR_TEST)}};this.activeTexture=function(t){if(t===undefined)t=e.TEXTURE0+M-1;if(S!==t){e.activeTexture(t);S=t}};this.bindTexture=function(t,r){if(S===undefined){n.activeTexture()}var i=T[S];if(i===undefined){i={type:undefined,texture:undefined};T[S]=i}if(i.type!==t||i.texture!==r){e.bindTexture(t,r);i.type=t;i.texture=r}};this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}};this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}};this.reset=function(){for(var t=0;t<o.length;t++){if(o[t]===1){e.disableVertexAttribArray(t);o[t]=0}}s={};h=null;u=null;g=null;y=null;x=null}};i.LensFlarePlugin=function(e,t){var r=e.context;var n=e.state;var a,o;var s,h,u;var l;var c,f;var d=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);a=r.createBuffer();o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);c=r.createTexture();f=r.createTexture();n.bindTexture(r.TEXTURE_2D,c);r.texImage2D(r.TEXTURE_2D,0,r.RGB,16,16,0,r.RGB,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);n.bindTexture(r.TEXTURE_2D,f);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,16,16,0,r.RGBA,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);l=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var i;if(l){i={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{i={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),
fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}s=p(i);h={vertex:r.getAttribLocation(s,"position"),uv:r.getAttribLocation(s,"uv")};u={renderType:r.getUniformLocation(s,"renderType"),map:r.getUniformLocation(s,"map"),occlusionMap:r.getUniformLocation(s,"occlusionMap"),opacity:r.getUniformLocation(s,"opacity"),color:r.getUniformLocation(s,"color"),scale:r.getUniformLocation(s,"scale"),rotation:r.getUniformLocation(s,"rotation"),screenPosition:r.getUniformLocation(s,"screenPosition")}};this.render=function(p,m,v,g){if(t.length===0)return;var y=new i.Vector3;var x=g/v,b=v*.5,w=g*.5;var _=16/g,M=new i.Vector2(_*x,_);var S=new i.Vector3(1,1,0),T=new i.Vector2(1,1);if(s===undefined){d()}r.useProgram(s);n.initAttributes();n.enableAttribute(h.vertex);n.enableAttribute(h.uv);n.disableUnusedAttributes();r.uniform1i(u.occlusionMap,0);r.uniform1i(u.map,1);r.bindBuffer(r.ARRAY_BUFFER,a);r.vertexAttribPointer(h.vertex,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(h.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);n.disable(r.CULL_FACE);r.depthMask(false);for(var E=0,C=t.length;E<C;E++){_=16/g;M.set(_*x,_);var A=t[E];y.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]);y.applyMatrix4(m.matrixWorldInverse);y.applyProjection(m.projectionMatrix);S.copy(y);T.x=S.x*b+b;T.y=S.y*w+w;if(l||T.x>0&&T.x<v&&T.y>0&&T.y<g){n.activeTexture(r.TEXTURE0);n.bindTexture(r.TEXTURE_2D,null);n.activeTexture(r.TEXTURE1);n.bindTexture(r.TEXTURE_2D,c);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGB,T.x-8,T.y-8,16,16,0);r.uniform1i(u.renderType,0);r.uniform2f(u.scale,M.x,M.y);r.uniform3f(u.screenPosition,S.x,S.y,S.z);n.disable(r.BLEND);n.enable(r.DEPTH_TEST);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);n.activeTexture(r.TEXTURE0);n.bindTexture(r.TEXTURE_2D,f);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,T.x-8,T.y-8,16,16,0);r.uniform1i(u.renderType,1);n.disable(r.DEPTH_TEST);n.activeTexture(r.TEXTURE1);n.bindTexture(r.TEXTURE_2D,c);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);A.positionScreen.copy(S);if(A.customUpdateCallback){A.customUpdateCallback(A)}else{A.updateLensFlares()}r.uniform1i(u.renderType,2);n.enable(r.BLEND);for(var L=0,P=A.lensFlares.length;L<P;L++){var R=A.lensFlares[L];if(R.opacity>.001&&R.scale>.001){S.x=R.x;S.y=R.y;S.z=R.z;_=R.size*R.scale/g;M.x=_*x;M.y=_;r.uniform3f(u.screenPosition,S.x,S.y,S.z);r.uniform2f(u.scale,M.x,M.y);r.uniform1f(u.rotation,R.rotation);r.uniform1f(u.opacity,R.opacity);r.uniform3f(u.color,R.color.r,R.color.g,R.color.b);n.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst);e.setTexture(R.texture,1);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}}}}n.enable(r.CULL_FACE);n.enable(r.DEPTH_TEST);r.depthMask(true);e.resetGLState()};function p(t){var n=r.createProgram();var i=r.createShader(r.FRAGMENT_SHADER);var a=r.createShader(r.VERTEX_SHADER);var o="precision "+e.getPrecision()+" float;\n";r.shaderSource(i,o+t.fragmentShader);r.shaderSource(a,o+t.vertexShader);r.compileShader(i);r.compileShader(a);r.attachShader(n,i);r.attachShader(n,a);r.linkProgram(n);return n}};i.SpritePlugin=function(e,t){var r=e.context;var n=e.state;var a,o;var s,h,u;var l;var c=new i.Vector3;var f=new i.Quaternion;var d=new i.Vector3;var p=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);a=r.createBuffer();o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);s=m();h={position:r.getAttribLocation(s,"position"),uv:r.getAttribLocation(s,"uv")};u={uvOffset:r.getUniformLocation(s,"uvOffset"),uvScale:r.getUniformLocation(s,"uvScale"),rotation:r.getUniformLocation(s,"rotation"),scale:r.getUniformLocation(s,"scale"),color:r.getUniformLocation(s,"color"),map:r.getUniformLocation(s,"map"),opacity:r.getUniformLocation(s,"opacity"),modelViewMatrix:r.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(s,"projectionMatrix"),fogType:r.getUniformLocation(s,"fogType"),fogDensity:r.getUniformLocation(s,"fogDensity"),fogNear:r.getUniformLocation(s,"fogNear"),fogFar:r.getUniformLocation(s,"fogFar"),fogColor:r.getUniformLocation(s,"fogColor"),alphaTest:r.getUniformLocation(s,"alphaTest")};var n=document.createElement("canvas");n.width=8;n.height=8;var c=n.getContext("2d");c.fillStyle="white";c.fillRect(0,0,8,8);l=new i.Texture(n);l.needsUpdate=true};this.render=function(m,g){if(t.length===0)return;if(s===undefined){p()}r.useProgram(s);n.initAttributes();n.enableAttribute(h.position);n.enableAttribute(h.uv);n.disableUnusedAttributes();n.disable(r.CULL_FACE);n.enable(r.BLEND);r.bindBuffer(r.ARRAY_BUFFER,a);r.vertexAttribPointer(h.position,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(h.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o);r.uniformMatrix4fv(u.projectionMatrix,false,g.projectionMatrix.elements);n.activeTexture(r.TEXTURE0);r.uniform1i(u.map,0);var y=0;var x=0;var b=m.fog;if(b){r.uniform3f(u.fogColor,b.color.r,b.color.g,b.color.b);if(b instanceof i.Fog){r.uniform1f(u.fogNear,b.near);r.uniform1f(u.fogFar,b.far);r.uniform1i(u.fogType,1);y=1;x=1}else if(b instanceof i.FogExp2){r.uniform1f(u.fogDensity,b.density);r.uniform1i(u.fogType,2);y=2;x=2}}else{r.uniform1i(u.fogType,0);y=0;x=0}for(var w=0,_=t.length;w<_;w++){var M=t[w];M.modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld);M.z=-M.modelViewMatrix.elements[14]}t.sort(v);var S=[];for(var w=0,_=t.length;w<_;w++){var M=t[w];var T=M.material;r.uniform1f(u.alphaTest,T.alphaTest);r.uniformMatrix4fv(u.modelViewMatrix,false,M.modelViewMatrix.elements);M.matrixWorld.decompose(c,f,d);S[0]=d.x;S[1]=d.y;var E=0;if(m.fog&&T.fog){E=x}if(y!==E){r.uniform1i(u.fogType,E);y=E}if(T.map!==null){r.uniform2f(u.uvOffset,T.map.offset.x,T.map.offset.y);r.uniform2f(u.uvScale,T.map.repeat.x,T.map.repeat.y)}else{r.uniform2f(u.uvOffset,0,0);r.uniform2f(u.uvScale,1,1)}r.uniform1f(u.opacity,T.opacity);r.uniform3f(u.color,T.color.r,T.color.g,T.color.b);r.uniform1f(u.rotation,T.rotation);r.uniform2fv(u.scale,S);n.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst);n.setDepthTest(T.depthTest);n.setDepthWrite(T.depthWrite);if(T.map&&T.map.image&&T.map.image.width){e.setTexture(T.map,0)}else{e.setTexture(l,0)}r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}n.enable(r.CULL_FACE);e.resetGLState()};function m(){var t=r.createProgram();var n=r.createShader(r.VERTEX_SHADER);var i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));r.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));r.compileShader(n);r.compileShader(i);r.attachShader(t,n);r.attachShader(t,i);r.linkProgram(t);return t}function v(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}};i.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;if(t instanceof i.Mesh){t.matrixAutoUpdate&&t.updateMatrix();n=t.matrix;t=t.geometry}e.merge(t,n,r)},center:function(e){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};i.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,r,n){var a=new i.ImageLoader;a.crossOrigin=this.crossOrigin;var o=new i.Texture(undefined,t);a.load(e,function(e){o.image=e;o.needsUpdate=true;if(r)r(o)},undefined,function(e){if(n)n(e)});o.sourceFile=e;return o},loadTextureCube:function(e,t,r,n){var a=[];var o=new i.ImageLoader;o.crossOrigin=this.crossOrigin;var s=new i.CubeTexture(a,t);var h=0;var u=function(t){o.load(e[t],function(e){s.images[t]=e;h+=1;if(h===6){s.needsUpdate=true;if(r)r(s)}},undefined,n)};for(var l=0,c=e.length;l<c;++l){u(l)}return s},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var a=e.width;var o=e.height;var s=document.createElement("canvas");s.width=a;s.height=o;var h=s.getContext("2d");h.drawImage(e,0,0);var u=h.getImageData(0,0,a,o).data;var l=h.createImageData(a,o);var c=l.data;for(var f=0;f<a;f++){for(var d=0;d<o;d++){var p=d-1<0?0:d-1;var m=d+1>o-1?o-1:d+1;var v=f-1<0?0:f-1;var g=f+1>a-1?a-1:f+1;var y=[];var x=[0,0,u[(d*a+f)*4]/255*t];y.push([-1,0,u[(d*a+v)*4]/255*t]);y.push([-1,-1,u[(p*a+v)*4]/255*t]);y.push([0,-1,u[(p*a+f)*4]/255*t]);y.push([1,-1,u[(p*a+g)*4]/255*t]);y.push([1,0,u[(d*a+g)*4]/255*t]);y.push([1,1,u[(m*a+g)*4]/255*t]);y.push([0,1,u[(m*a+f)*4]/255*t]);y.push([-1,1,u[(m*a+v)*4]/255*t]);var b=[];var w=y.length;for(var _=0;_<w;_++){var M=y[_];var S=y[(_+1)%w];M=n(M,x);S=n(S,x);b.push(i(r(M,S)))}var T=[0,0,0];for(var _=0;_<b.length;_++){T[0]+=b[_][0];T[1]+=b[_][1];T[2]+=b[_][2]}T[0]/=b.length;T[1]/=b.length;T[2]/=b.length;var E=(d*a+f)*4;c[E]=(T[0]+1)/2*255|0;c[E+1]=(T[1]+1)/2*255|0;c[E+2]=T[2]*255|0;c[E+3]=255}}h.putImageData(l,0,0);return s},generateDataTexture:function(e,t,r){var n=e*t;var a=new Uint8Array(3*n);var o=Math.floor(r.r*255);var s=Math.floor(r.g*255);var h=Math.floor(r.b*255);for(var u=0;u<n;u++){a[u*3]=o;a[u*3+1]=s;a[u*3+2]=h}var l=new i.DataTexture(a,e,t,i.RGBFormat);l.needsUpdate=true;return l}};i.SceneUtils={createMultiMaterialObject:function(e,t){var r=new i.Group;for(var n=0,a=t.length;n<a;n++){r.add(new i.Mesh(e,t[n]))}return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld);t.remove(e);r.add(e)},attach:function(e,t,r){var n=new i.Matrix4;n.getInverse(r.matrixWorld);e.applyMatrix(n);t.remove(e);r.add(e)}};i.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face.toLowerCase()][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();var r=this;r.faces[t]=r.faces[t]||{};r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{};r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),n=this.size/r.resolution,a=0,o=String(e).split(""),s=o.length;var h=[];for(t=0;t<s;t++){var u=new i.Path;var l=this.extractGlyphPoints(o[t],r,n,a,u);a+=l.offset;h.push(l.path)}var c=a/2;return{paths:h,offset:c}},extractGlyphPoints:function(e,t,r,n,a){var o=[];var s,h,u,l,c,f,d,p,m,v,g,y,x,b,w,_,M,S,T,E=t.glyphs[e]||t.glyphs["?"];if(!E)return;if(E.o){l=E._cachedOutline||(E._cachedOutline=E.o.split(" "));f=l.length;d=r;p=r;for(s=0;s<f;){c=l[s++];switch(c){case"m":m=l[s++]*d+n;v=l[s++]*p;a.moveTo(m,v);break;case"l":m=l[s++]*d+n;v=l[s++]*p;a.lineTo(m,v);break;case"q":g=l[s++]*d+n;y=l[s++]*p;w=l[s++]*d+n;_=l[s++]*p;a.quadraticCurveTo(w,_,g,y);T=o[o.length-1];if(T){x=T.x;b=T.y;for(h=1,u=this.divisions;h<=u;h++){var C=h/u;i.Shape.Utils.b2(C,x,w,g);i.Shape.Utils.b2(C,b,_,y)}}break;case"b":g=l[s++]*d+n;y=l[s++]*p;w=l[s++]*d+n;_=l[s++]*p;M=l[s++]*d+n;S=l[s++]*p;a.bezierCurveTo(w,_,M,S,g,y);T=o[o.length-1];if(T){x=T.x;b=T.y;for(h=1,u=this.divisions;h<=u;h++){var C=h/u;i.Shape.Utils.b3(C,x,w,M,g);i.Shape.Utils.b3(C,b,_,S,y)}}break}}}return{offset:E.ha*r,path:a}}};i.FontUtils.generateShapes=function(e,t){t=t||{};var r=t.size!==undefined?t.size:100;var n=t.curveSegments!==undefined?t.curveSegments:4;var a=t.font!==undefined?t.font:"helvetiker";var o=t.weight!==undefined?t.weight:"normal";var s=t.style!==undefined?t.style:"normal";i.FontUtils.size=r;i.FontUtils.divisions=n;i.FontUtils.face=a;i.FontUtils.weight=o;i.FontUtils.style=s;var h=i.FontUtils.drawText(e);var u=h.paths;var l=[];for(var c=0,f=u.length;c<f;c++){Array.prototype.push.apply(l,u[c].toShapes())}return l};(function(e){var t=1e-10;var r=function(e,t){var r=e.length;if(r<3)return null;var a=[],o=[],s=[];var h,u,l;if(n(e)>0){for(u=0;u<r;u++)o[u]=u}else{for(u=0;u<r;u++)o[u]=r-1-u}var c=r;var f=2*c;for(u=c-1;c>2;){if(f--<=0){console.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");if(t)return s;return a}h=u;if(c<=h)h=0;u=h+1;if(c<=u)u=0;l=u+1;if(c<=l)l=0;if(i(e,h,u,l,c,o)){var d,p,m,v,g;d=o[h];p=o[u];m=o[l];a.push([e[d],e[p],e[m]]);s.push([o[h],o[u],o[l]]);for(v=u,g=u+1;g<c;v++,g++){o[v]=o[g]}c--;f=2*c}}if(t)return s;return a};var n=function(e){var t=e.length;var r=0;for(var n=t-1,i=0;i<t;n=i++){r+=e[n].x*e[i].y-e[i].x*e[n].y}return r*.5};var i=function(e,r,n,i,a,o){var s;var h,u,l,c;var f,d,p,m;h=e[o[r]].x;u=e[o[r]].y;l=e[o[n]].x;c=e[o[n]].y;f=e[o[i]].x;d=e[o[i]].y;if(t>(l-h)*(d-u)-(c-u)*(f-h))return false;var v,g,y,x,b,w;var _,M,S,T,E,C;var A,L,P;v=f-l;g=d-c;y=h-f;x=u-d;b=l-h;w=c-u;for(s=0;s<a;s++){p=e[o[s]].x;m=e[o[s]].y;if(p===h&&m===u||p===l&&m===c||p===f&&m===d)continue;_=p-h;M=m-u;S=p-l;T=m-c;E=p-f;C=m-d;P=v*T-g*S;A=b*M-w*_;L=y*C-x*E;if(P>=-t&&L>=-t&&A>=-t)return false}return true};e.Triangulate=r;e.Triangulate.area=n;return e})(i.FontUtils);i.typeface_js={faces:i.FontUtils.faces,loadFace:i.FontUtils.loadFace};if(typeof n!=="undefined")n._typeface_js=i.typeface_js;i.Audio=function(e){i.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.playbackRate=1;this.isPlaying=false};i.Audio.prototype=Object.create(i.Object3D.prototype);i.Audio.prototype.constructor=i.Audio;i.Audio.prototype.load=function(e){var t=this;var r=new XMLHttpRequest;r.open("GET",e,true);r.responseType="arraybuffer";r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e;if(t.autoplay)t.play()})};r.send();return this};i.Audio.prototype.play=function(){if(this.isPlaying===true){console.warn("THREE.Audio: Audio is already playing.");return}var e=this.context.createBufferSource();e.buffer=this.source.buffer;e.loop=this.source.loop;e.onended=this.source.onended;e.start(0,this.startTime);e.playbackRate.value=this.playbackRate;this.isPlaying=true;this.source=e;this.connect()};i.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};i.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};i.Audio.prototype.connect=function(){if(this.filter!==undefined){this.source.connect(this.filter);this.filter.connect(this.panner)}else{this.source.connect(this.panner)}};i.Audio.prototype.disconnect=function(){if(this.filter!==undefined){this.source.disconnect(this.filter);this.filter.disconnect(this.panner)}else{this.source.disconnect(this.panner)}};i.Audio.prototype.setFilter=function(e){if(this.isPlaying===true){this.disconnect();this.filter=e;this.connect()}else{this.filter=e}};i.Audio.prototype.getFilter=function(){return this.filter};i.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e;if(this.isPlaying===true){this.source.playbackRate.value=this.playbackRate}};i.Audio.prototype.getPlaybackRate=function(){return this.playbackRate};i.Audio.prototype.onEnded=function(){this.isPlaying=false};i.Audio.prototype.setLoop=function(e){this.source.loop=e};i.Audio.prototype.getLoop=function(){return this.source.loop};i.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e};i.Audio.prototype.getRefDistance=function(){return this.panner.refDistance};i.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e};i.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor};i.Audio.prototype.setVolume=function(e){this.gain.gain.value=e};i.Audio.prototype.getVolume=function(){return this.gain.gain.value};i.Audio.prototype.updateMatrixWorld=function(){var e=new i.Vector3;return function t(r){i.Object3D.prototype.updateMatrixWorld.call(this,r);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();i.AudioListener=function(){i.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};i.AudioListener.prototype=Object.create(i.Object3D.prototype);i.AudioListener.prototype.constructor=i.AudioListener;i.AudioListener.prototype.updateMatrixWorld=function(){var e=new i.Vector3;var t=new i.Quaternion;var r=new i.Vector3;var n=new i.Vector3;return function a(o){i.Object3D.prototype.updateMatrixWorld.call(this,o);var s=this.context.listener;var h=this.up;this.matrixWorld.decompose(e,t,r);n.set(0,0,-1).applyQuaternion(t);s.setPosition(e.x,e.y,e.z);s.setOrientation(n.x,n.y,n.z,h.x,h.y,h.z)}}();i.Curve=function(){};i.Curve.prototype.getPoint=function(e){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};i.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};i.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPoint(t/e))}return r};i.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPointAt(t/e))}return r};i.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};i.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var r,n=this.getPoint(0);var i,a=0;t.push(0);for(i=1;i<=e;i++){r=this.getPoint(i/e);a+=r.distanceTo(n);t.push(a);n=r}this.cacheArcLengths=t;return t};i.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};i.Curve.prototype.getUtoTmapping=function(e,t){var r=this.getLengths();var n=0,i=r.length;var a;if(t){a=t}else{a=e*r[i-1]}var o=0,s=i-1,h;while(o<=s){n=Math.floor(o+(s-o)/2);h=r[n]-a;if(h<0){o=n+1}else if(h>0){s=n-1}else{s=n;break}}n=s;if(r[n]===a){var u=n/(i-1);return u}var l=r[n];var c=r[n+1];var f=c-l;var d=(a-l)/f;var u=(n+d)/(i-1);return u};i.Curve.prototype.getTangent=function(e){var t=1e-4;var r=e-t;var n=e+t;if(r<0)r=0;if(n>1)n=1;var i=this.getPoint(r);var a=this.getPoint(n);var o=a.clone().sub(i);return o.normalize()};i.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};i.Curve.Utils={tangentQuadraticBezier:function(e,t,r,n){return 2*(1-e)*(r-t)+2*e*(n-r)},tangentCubicBezier:function(e,t,r,n,i){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*i},tangentSpline:function(e,t,r,n,i){var a=6*e*e-6*e;var o=3*e*e-4*e+1;var s=-6*e*e+6*e;var h=3*e*e-2*e;return a+o+s+h},interpolate:function(e,t,r,n,i){var a=(r-e)*.5;var o=(n-t)*.5;var s=i*i;var h=i*s;return(2*t-2*r+a+o)*h+(-3*t+3*r-2*a-o)*s+a*i+t}};i.Curve.create=function(e,t){e.prototype=Object.create(i.Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};i.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};i.CurvePath.prototype=Object.create(i.Curve.prototype);i.CurvePath.prototype.constructor=i.CurvePath;i.CurvePath.prototype.add=function(e){this.curves.push(e)};i.CurvePath.prototype.checkConnection=function(){};i.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new i.LineCurve(t,e))}};i.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var r=this.getCurveLengths();var n=0,i,a;while(n<r.length){if(r[n]>=t){i=r[n]-t;a=this.curves[n];var o=1-i/a.getLength();return a.getPointAt(o)}n++}return null};i.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};i.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}var e=[],t=0;var r,n=this.curves.length;for(r=0;r<n;r++){t+=this.curves[r].getLength();e.push(t)}this.cacheLengths=e;return e};i.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,r,n;var a,o,s;t=r=Number.NEGATIVE_INFINITY;a=o=Number.POSITIVE_INFINITY;var h,u,l,c;var f=e[0]instanceof i.Vector3;c=f?new i.Vector3:new i.Vector2;for(u=0,l=e.length;u<l;u++){h=e[u];if(h.x>t)t=h.x;else if(h.x<a)a=h.x;if(h.y>r)r=h.y;else if(h.y<o)o=h.y;if(f){if(h.z>n)n=h.z;else if(h.z<s)s=h.z}c.add(h)}var d={minX:a,minY:o,maxX:t,maxY:r};if(f){d.maxZ=n;d.minZ=s}return d};i.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createGeometry=function(e){var t=new i.Geometry;for(var r=0;r<e.length;r++){t.vertices.push(new i.Vector3(e[r].x,e[r].y,e[r].z||0))}return t};i.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};i.CurvePath.prototype.getTransformedPoints=function(e,t){var r=this.getPoints(e);var n,i;if(!t){t=this.bends}for(n=0,i=t.length;n<i;n++){r=this.getWrapPoints(r,t[n])}return r};i.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r=this.getSpacedPoints(e);var n,i;if(!t){t=this.bends}for(n=0,i=t.length;n<i;n++){r=this.getWrapPoints(r,t[n])}return r};i.CurvePath.prototype.getWrapPoints=function(e,t){var r=this.getBoundingBox();var n,i,a,o,s,h;for(n=0,i=e.length;n<i;n++){a=e[n];o=a.x;s=a.y;h=o/r.maxX;h=t.getUtoTmapping(h,o);var u=t.getPoint(h);var l=t.getTangent(h);l.set(-l.y,l.x).multiplyScalar(s);a.x=u.x+l.x;a.y=u.y+l.y}return e};i.Path=function(e){i.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};i.Path.prototype=Object.create(i.CurvePath.prototype);i.Path.prototype.constructor=i.Path;i.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};i.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++){this.lineTo(e[t].x,e[t].y)}};i.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:i.PathActions.MOVE_TO,args:r})};i.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments);var n=this.actions[this.actions.length-1].args;var a=n[n.length-2];var o=n[n.length-1];var s=new i.LineCurve(new i.Vector2(a,o),new i.Vector2(e,t));this.curves.push(s);this.actions.push({action:i.PathActions.LINE_TO,args:r})};i.Path.prototype.quadraticCurveTo=function(e,t,r,n){var a=Array.prototype.slice.call(arguments);var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];var u=new i.QuadraticBezierCurve(new i.Vector2(s,h),new i.Vector2(e,t),new i.Vector2(r,n));this.curves.push(u);this.actions.push({action:i.PathActions.QUADRATIC_CURVE_TO,args:a})};i.Path.prototype.bezierCurveTo=function(e,t,r,n,a,o){var s=Array.prototype.slice.call(arguments);var h=this.actions[this.actions.length-1].args;var u=h[h.length-2];var l=h[h.length-1];var c=new i.CubicBezierCurve(new i.Vector2(u,l),new i.Vector2(e,t),new i.Vector2(r,n),new i.Vector2(a,o));this.curves.push(c);this.actions.push({action:i.PathActions.BEZIER_CURVE_TO,args:s})};i.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var n=r[r.length-2];var a=r[r.length-1];var o=[new i.Vector2(n,a)];Array.prototype.push.apply(o,e);var s=new i.SplineCurve(o);this.curves.push(s);this.actions.push({action:i.PathActions.CSPLINE_THRU,args:t})};i.Path.prototype.arc=function(e,t,r,n,i,a){var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];this.absarc(e+s,t+h,r,n,i,a)};i.Path.prototype.absarc=function(e,t,r,n,i,a){this.absellipse(e,t,r,r,n,i,a)};i.Path.prototype.ellipse=function(e,t,r,n,i,a,o,s){var h=this.actions[this.actions.length-1].args;var u=h[h.length-2];var l=h[h.length-1];this.absellipse(e+u,t+l,r,n,i,a,o,s)};i.Path.prototype.absellipse=function(e,t,r,n,a,o,s,h){var u=[e,t,r,n,a,o,s,h||0];var l=new i.EllipseCurve(e,t,r,n,a,o,s,h);this.curves.push(l);var c=l.getPoint(1);u.push(c.x);u.push(c.y);this.actions.push({action:i.PathActions.ELLIPSE,args:u})};i.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var r=[];for(var n=0;n<e;n++){r.push(this.getPoint(n/e))}return r};i.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){return this.getSpacedPoints(e,t)}e=e||12;var r=[];var n,a,o,s,h;var u,l,c,f,d,p,m,v,g,y,x,b,w;for(n=0,a=this.actions.length;n<a;n++){o=this.actions[n];s=o.action;h=o.args;switch(s){case i.PathActions.MOVE_TO:r.push(new i.Vector2(h[0],h[1]));break;case i.PathActions.LINE_TO:r.push(new i.Vector2(h[0],h[1]));break;case i.PathActions.QUADRATIC_CURVE_TO:u=h[2];l=h[3];d=h[0];p=h[1];if(r.length>0){g=r[r.length-1];m=g.x;v=g.y}else{g=this.actions[n-1].args;m=g[g.length-2];v=g[g.length-1]}for(y=1;y<=e;y++){x=y/e;b=i.Shape.Utils.b2(x,m,d,u);w=i.Shape.Utils.b2(x,v,p,l);r.push(new i.Vector2(b,w))}break;case i.PathActions.BEZIER_CURVE_TO:u=h[4];l=h[5];d=h[0];p=h[1];c=h[2];f=h[3];if(r.length>0){g=r[r.length-1];m=g.x;v=g.y}else{g=this.actions[n-1].args;m=g[g.length-2];v=g[g.length-1]}for(y=1;y<=e;y++){x=y/e;b=i.Shape.Utils.b3(x,m,d,c,u);w=i.Shape.Utils.b3(x,v,p,f,l);r.push(new i.Vector2(b,w))}break;case i.PathActions.CSPLINE_THRU:g=this.actions[n-1].args;var _=new i.Vector2(g[g.length-2],g[g.length-1]);var M=[_];var S=e*h[0].length;M=M.concat(h[0]);var T=new i.SplineCurve(M);for(y=1;y<=S;y++){r.push(T.getPointAt(y/S))}break;case i.PathActions.ARC:var E=h[0],C=h[1],A=h[2],L=h[3],P=h[4],R=!!h[5];var D=P-L;var k;var F=e*2;for(y=1;y<=F;y++){x=y/F;if(!R){x=1-x}k=L+x*D;b=E+A*Math.cos(k);w=C+A*Math.sin(k);r.push(new i.Vector2(b,w))}break;case i.PathActions.ELLIPSE:var E=h[0],C=h[1],O=h[2],U=h[3],L=h[4],P=h[5],R=!!h[6],B=h[7];var D=P-L;var k;var F=e*2;var V,I;if(B!==0){V=Math.cos(B);I=Math.sin(B)}for(y=1;y<=F;y++){x=y/F;if(!R){x=1-x}k=L+x*D;b=E+O*Math.cos(k);w=C+U*Math.sin(k);if(B!==0){var N=b,G=w;b=(N-E)*V-(G-C)*I+E;w=(N-E)*I+(G-C)*V+C}r.push(new i.Vector2(b,w))}break}}var z=r[r.length-1];var H=1e-10;if(Math.abs(z.x-r[0].x)<H&&Math.abs(z.y-r[0].y)<H)r.splice(r.length-1,1);if(t){r.push(r[0])}return r};i.Path.prototype.toShapes=function(e,t){function r(e){var t,r,n,a,o;var s=[],h=new i.Path;for(t=0,r=e.length;t<r;t++){n=e[t];o=n.args;a=n.action;if(a===i.PathActions.MOVE_TO){if(h.actions.length!==0){s.push(h);h=new i.Path}}h[a].apply(h,o)}if(h.actions.length!==0){s.push(h)}return s}function n(e){var t=[];for(var r=0,n=e.length;r<n;r++){var a=e[r];var o=new i.Shape;o.actions=a.actions;o.curves=a.curves;t.push(o)}return t}function a(e,t){var r=1e-10;var n=t.length;var i=false;for(var a=n-1,o=0;o<n;a=o++){var s=t[a];var h=t[o];var u=h.x-s.x;var l=h.y-s.y;if(Math.abs(l)>r){if(l<0){s=t[o];u=-u;h=t[a];l=-l}if(e.y<s.y||e.y>h.y)continue;if(e.y===s.y){if(e.x===s.x)return true}else{var c=l*(e.x-s.x)-u*(e.y-s.y);if(c===0)return true;if(c<0)continue;i=!i}}else{if(e.y!==s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return true}}return i}var o=r(this.actions);if(o.length===0)return[];if(t===true)return n(o);var s,h,u,l=[];if(o.length===1){h=o[0];u=new i.Shape;u.actions=h.actions;u.curves=h.curves;l.push(u);return l}var c=!i.Shape.Utils.isClockWise(o[0].getPoints());c=e?!c:c;var f=[];var d=[];var p=[];var m=0;var v;d[m]=undefined;p[m]=[];var g,y;for(g=0,y=o.length;g<y;g++){h=o[g];v=h.getPoints();s=i.Shape.Utils.isClockWise(v);s=e?!s:s;if(s){if(!c&&d[m])m++;d[m]={s:new i.Shape,p:v};d[m].s.actions=h.actions;d[m].s.curves=h.curves;if(c)m++;p[m]=[]}else{p[m].push({h:h,p:v[0]})}}if(!d[0])return n(o);if(d.length>1){var x=false;var b=[];for(var w=0,_=d.length;w<_;w++){f[w]=[]}for(var w=0,_=d.length;w<_;w++){var M=p[w];for(var S=0;S<M.length;S++){var T=M[S];var E=true;for(var C=0;C<d.length;C++){if(a(T.p,d[C].p)){if(w!==C)b.push({froms:w,tos:C,hole:S});if(E){E=false;f[C].push(T)}else{x=true}}}if(E){f[w].push(T)}}}if(b.length>0){if(!x)p=f}}var A,L,P;for(g=0,y=d.length;g<y;g++){u=d[g].s;l.push(u);A=p[g];for(L=0,P=A.length;L<P;L++){u.holes.push(A[L].h)}}return l};i.Shape=function(){i.Path.apply(this,arguments);this.holes=[]};i.Shape.prototype=Object.create(i.Path.prototype);i.Shape.prototype.constructor=i.Shape;i.Shape.prototype.extrude=function(e){var t=new i.ExtrudeGeometry(this,e);return t};i.Shape.prototype.makeGeometry=function(e){var t=new i.ShapeGeometry(this,e);return t};i.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;t<r;t++){n[t]=this.holes[t].getTransformedPoints(e,this.bends)}return n};i.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;t<r;t++){n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return n};i.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};i.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};i.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};i.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){if(e.x!==t.x){if(e.x<t.x){return e.x<=r.x&&r.x<=t.x;
}else{return t.x<=r.x&&r.x<=e.x}}else{if(e.y<t.y){return e.y<=r.y&&r.y<=t.y}else{return t.y<=r.y&&r.y<=e.y}}}function n(e,t,n,i,a){var o=1e-10;var s=t.x-e.x,h=t.y-e.y;var u=i.x-n.x,l=i.y-n.y;var c=e.x-n.x;var f=e.y-n.y;var d=h*u-s*l;var p=h*c-s*f;if(Math.abs(d)>o){var m;if(d>0){if(p<0||p>d)return[];m=l*c-u*f;if(m<0||m>d)return[]}else{if(p>0||p<d)return[];m=l*c-u*f;if(m>0||m<d)return[]}if(m===0){if(a&&(p===0||p===d))return[];return[e]}if(m===d){if(a&&(p===0||p===d))return[];return[t]}if(p===0)return[n];if(p===d)return[i];var v=m/d;return[{x:e.x+v*s,y:e.y+v*h}]}else{if(p!==0||l*c!==u*f)return[];var g=s===0&&h===0;var y=u===0&&l===0;if(g&&y){if(e.x!==n.x||e.y!==n.y)return[];return[e]}if(g){if(!r(n,i,e))return[];return[e]}if(y){if(!r(e,t,n))return[];return[n]}var x,b,w,_;var M,S,T,E;if(s!==0){if(e.x<t.x){x=e;w=e.x;b=t;_=t.x}else{x=t;w=t.x;b=e;_=e.x}if(n.x<i.x){M=n;T=n.x;S=i;E=i.x}else{M=i;T=i.x;S=n;E=n.x}}else{if(e.y<t.y){x=e;w=e.y;b=t;_=t.y}else{x=t;w=t.y;b=e;_=e.y}if(n.y<i.y){M=n;T=n.y;S=i;E=i.y}else{M=i;T=i.y;S=n;E=n.y}}if(w<=T){if(_<T)return[];if(_===T){if(a)return[];return[M]}if(_<=E)return[M,b];return[M,S]}else{if(w>E)return[];if(w===E){if(a)return[];return[x]}if(_<=E)return[x,b];return[x,S]}}}function a(e,t,r,n){var i=1e-10;var a=t.x-e.x,o=t.y-e.y;var s=r.x-e.x,h=r.y-e.y;var u=n.x-e.x,l=n.y-e.y;var c=a*h-o*s;var f=a*l-o*u;if(Math.abs(c)>i){var d=u*h-l*s;if(c>0){return f>=0&&d>=0}else{return f>=0||d>=0}}else{return f>0}}function o(e,t){var r=e.concat();var i;function o(e,t){var n=r.length-1;var o=e-1;if(o<0)o=n;var s=e+1;if(s>n)s=0;var h=a(r[e],r[o],r[s],i[t]);if(!h){return false}var u=i.length-1;var l=t-1;if(l<0)l=u;var c=t+1;if(c>u)c=0;h=a(i[t],i[l],i[c],r[e]);if(!h){return false}return true}function s(e,t){var i,a,o;for(i=0;i<r.length;i++){a=i+1;a%=r.length;o=n(e,t,r[i],r[a],true);if(o.length>0)return true}return false}var h=[];function u(e,r){var i,a,o,s,u;for(i=0;i<h.length;i++){a=t[h[i]];for(o=0;o<a.length;o++){s=o+1;s%=a.length;u=n(e,r,a[o],a[s],true);if(u.length>0)return true}}return false}var l,c,f,d,p,m,v=[],g,y,x,b;for(var w=0,_=t.length;w<_;w++){h.push(w)}var M=0;var S=h.length*2;while(h.length>0){S--;if(S<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(c=M;c<r.length;c++){f=r[c];l=-1;for(var w=0;w<h.length;w++){p=h[w];m=f.x+":"+f.y+":"+p;if(v[m]!==undefined)continue;i=t[p];for(var T=0;T<i.length;T++){d=i[T];if(!o(c,T))continue;if(s(f,d))continue;if(u(f,d))continue;l=T;h.splice(w,1);g=r.slice(0,c+1);y=r.slice(c);x=i.slice(l);b=i.slice(0,l+1);r=g.concat(x).concat(b).concat(y);M=c;break}if(l>=0)break;v[m]=true}if(l>=0)break}}return r}var s,h,u,l,c,f,d={};var p=e.concat();for(var m=0,v=t.length;m<v;m++){Array.prototype.push.apply(p,t[m])}for(s=0,h=p.length;s<h;s++){c=p[s].x+":"+p[s].y;if(d[c]!==undefined){console.warn("THREE.Shape: Duplicate point",c)}d[c]=s}var g=o(e,t);var y=i.FontUtils.Triangulate(g,false);for(s=0,h=y.length;s<h;s++){l=y[s];for(u=0;u<3;u++){c=l[u].x+":"+l[u].y;f=d[c];if(f!==undefined){l[u]=f}}}return y.concat()},isClockWise:function(e){return i.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,n){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,n)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,n,i){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,n)+this.b3p3(e,i)}};i.LineCurve=function(e,t){this.v1=e;this.v2=t};i.LineCurve.prototype=Object.create(i.Curve.prototype);i.LineCurve.prototype.constructor=i.LineCurve;i.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};i.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};i.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};i.QuadraticBezierCurve=function(e,t,r){this.v0=e;this.v1=t;this.v2=r};i.QuadraticBezierCurve.prototype=Object.create(i.Curve.prototype);i.QuadraticBezierCurve.prototype.constructor=i.QuadraticBezierCurve;i.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new i.Vector2;t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return t};i.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new i.Vector2;t.x=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);t.y=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);return t.normalize()};i.CubicBezierCurve=function(e,t,r,n){this.v0=e;this.v1=t;this.v2=r;this.v3=n};i.CubicBezierCurve.prototype=Object.create(i.Curve.prototype);i.CubicBezierCurve.prototype.constructor=i.CubicBezierCurve;i.CubicBezierCurve.prototype.getPoint=function(e){var t,r;t=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new i.Vector2(t,r)};i.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=i.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r=i.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new i.Vector2(t,r);n.normalize();return n};i.SplineCurve=function(e){this.points=e==undefined?[]:e};i.SplineCurve.prototype=Object.create(i.Curve.prototype);i.SplineCurve.prototype.constructor=i.SplineCurve;i.SplineCurve.prototype.getPoint=function(e){var t=this.points;var r=(t.length-1)*e;var n=Math.floor(r);var a=r-n;var o=t[n===0?n:n-1];var s=t[n];var h=t[n>t.length-2?t.length-1:n+1];var u=t[n>t.length-3?t.length-1:n+2];var l=new i.Vector2;l.x=i.Curve.Utils.interpolate(o.x,s.x,h.x,u.x,a);l.y=i.Curve.Utils.interpolate(o.y,s.y,h.y,u.y,a);return l};i.EllipseCurve=function(e,t,r,n,i,a,o,s){this.aX=e;this.aY=t;this.xRadius=r;this.yRadius=n;this.aStartAngle=i;this.aEndAngle=a;this.aClockwise=o;this.aRotation=s||0};i.EllipseCurve.prototype=Object.create(i.Curve.prototype);i.EllipseCurve.prototype.constructor=i.EllipseCurve;i.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(t<0)t+=Math.PI*2;if(t>Math.PI*2)t-=Math.PI*2;var r;if(this.aClockwise===true){r=this.aEndAngle+(1-e)*(Math.PI*2-t)}else{r=this.aStartAngle+e*t}var n=this.aX+this.xRadius*Math.cos(r);var a=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){var o=Math.cos(this.aRotation);var s=Math.sin(this.aRotation);var h=n,u=a;n=(h-this.aX)*o-(u-this.aY)*s+this.aX;a=(h-this.aX)*s+(u-this.aY)*o+this.aY}return new i.Vector2(n,a)};i.ArcCurve=function(e,t,r,n,a,o){i.EllipseCurve.call(this,e,t,r,r,n,a,o)};i.ArcCurve.prototype=Object.create(i.EllipseCurve.prototype);i.ArcCurve.prototype.constructor=i.ArcCurve;i.LineCurve3=i.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new i.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});i.QuadraticBezierCurve3=i.Curve.create(function(e,t,r){this.v0=e;this.v1=t;this.v2=r},function(e){var t=new i.Vector3;t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);t.z=i.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return t});i.CubicBezierCurve3=i.Curve.create(function(e,t,r,n){this.v0=e;this.v1=t;this.v2=r;this.v3=n},function(e){var t=new i.Vector3;t.x=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t.y=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t.z=i.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return t});i.SplineCurve3=i.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-1)*e;var n=Math.floor(r);var a=r-n;var o=t[n==0?n:n-1];var s=t[n];var h=t[n>t.length-2?t.length-1:n+1];var u=t[n>t.length-3?t.length-1:n+2];var l=new i.Vector3;l.x=i.Curve.Utils.interpolate(o.x,s.x,h.x,u.x,a);l.y=i.Curve.Utils.interpolate(o.y,s.y,h.y,u.y,a);l.z=i.Curve.Utils.interpolate(o.z,s.z,h.z,u.z,a);return l});i.CatmullRomCurve3=function(){var e=new i.Vector3,t=new a,r=new a,n=new a;function a(){}a.prototype.init=function(e,t,r,n){this.c0=e;this.c1=r;this.c2=-3*e+3*t-2*r-n;this.c3=2*e-2*t+r+n};a.prototype.initNonuniformCatmullRom=function(e,t,r,n,i,a,o){var s=(t-e)/i-(r-e)/(i+a)+(r-t)/a;var h=(r-t)/a-(n-t)/(a+o)+(n-r)/o;s*=a;h*=a;this.init(t,r,s,h)};a.prototype.initCatmullRom=function(e,t,r,n,i){this.init(t,r,i*(r-e),i*(n-t))};a.prototype.calc=function(e){var t=e*e;var r=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*r};return i.Curve.create(function(e){this.points=e||[]},function(a){var o=this.points,s,h,u,l;l=o.length;if(l<2)console.log("duh, you need at least 2 points");s=(l-1)*a;h=Math.floor(s);u=s-h;if(u===0&&h===l-1){h=l-2;u=1}var c,f,d,p;if(h===0){e.subVectors(o[0],o[1]).add(o[0]);c=e}else{c=o[h-1]}f=o[h];d=o[h+1];if(h+2<l){p=o[h+2]}else{e.subVectors(o[l-1],o[l-2]).add(o[l-2]);p=e}if(this.type===undefined||this.type==="centripetal"||this.type==="chordal"){var m=this.type==="chordal"?.5:.25;var v=Math.pow(c.distanceToSquared(f),m);var g=Math.pow(f.distanceToSquared(d),m);var y=Math.pow(d.distanceToSquared(p),m);if(g<1e-4)g=1;if(v<1e-4)v=g;if(y<1e-4)y=g;t.initNonuniformCatmullRom(c.x,f.x,d.x,p.x,v,g,y);r.initNonuniformCatmullRom(c.y,f.y,d.y,p.y,v,g,y);n.initNonuniformCatmullRom(c.z,f.z,d.z,p.z,v,g,y)}else if(this.type==="catmullrom"){var x=this.tension!==undefined?this.tension:.5;t.initCatmullRom(c.x,f.x,d.x,p.x,x);r.initCatmullRom(c.y,f.y,d.y,p.y,x);n.initCatmullRom(c.z,f.z,d.z,p.z,x)}var b=new i.Vector3(t.calc(u),r.calc(u),n.calc(u));return b})}();i.ClosedSplineCurve3=i.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-0)*e;var n=Math.floor(r);var a=r-n;n+=n>0?0:(Math.floor(Math.abs(n)/t.length)+1)*t.length;var o=t[(n-1)%t.length];var s=t[n%t.length];var h=t[(n+1)%t.length];var u=t[(n+2)%t.length];var l=new i.Vector3;l.x=i.Curve.Utils.interpolate(o.x,s.x,h.x,u.x,a);l.y=i.Curve.Utils.interpolate(o.y,s.y,h.y,u.y,a);l.z=i.Curve.Utils.interpolate(o.z,s.z,h.z,u.z,a);return l});i.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===true)return e;for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++){if(e.hierarchy[t].keys[r].time<0){e.hierarchy[t].keys[r].time=0}if(e.hierarchy[t].keys[r].rot!==undefined&&!(e.hierarchy[t].keys[r].rot instanceof i.Quaternion)){var n=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new i.Quaternion).fromArray(n)}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var a={};for(var r=0;r<e.hierarchy[t].keys.length;r++){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){var s=e.hierarchy[t].keys[r].morphTargets[o];a[s]=-1}}e.hierarchy[t].usedMorphTargets=a;for(var r=0;r<e.hierarchy[t].keys.length;r++){var h={};for(var s in a){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){if(e.hierarchy[t].keys[r].morphTargets[o]===s){h[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[o];break}}if(o===e.hierarchy[t].keys[r].morphTargets.length){h[s]=0}}e.hierarchy[t].keys[r].morphTargetsInfluences=h}}for(var r=1;r<e.hierarchy[t].keys.length;r++){if(e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time){e.hierarchy[t].keys.splice(r,1);r--}}for(var r=0;r<e.hierarchy[t].keys.length;r++){e.hierarchy[t].keys[r].index=r}}e.initialized=true;return e},parse:function(e){var t=function(e,r){r.push(e);for(var n=0;n<e.children.length;n++)t(e.children[n],r)};var r=[];if(e instanceof i.SkinnedMesh){for(var n=0;n<e.skeleton.bones.length;n++){r.push(e.skeleton.bones[n])}}else{t(e,r)}return r},play:function(e){if(this.animations.indexOf(e)===-1){this.animations.push(e)}},stop:function(e){var t=this.animations.indexOf(e);if(t!==-1){this.animations.splice(t,1)}},update:function(e){for(var t=0;t<this.animations.length;t++){this.animations[t].resetBlendWeights()}for(var t=0;t<this.animations.length;t++){this.animations[t].update(e)}}};i.Animation=function(e,t){this.root=e;this.data=i.AnimationHandler.init(t);this.hierarchy=i.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=i.AnimationHandler.LINEAR};i.Animation.prototype={constructor:i.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=e!==undefined?e:0;this.weight=t!==undefined?t:1;this.isPlaying=true;this.reset();i.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;i.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];if(r.animationCache===undefined){r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}var n=this.data.name;var i=r.animationCache.animations;var a=i[n];if(a===undefined){a={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:r.matrix};i[n]=a}for(var o=0;o<3;o++){var s=this.keyTypes[o];var h=this.data.hierarchy[e].keys[0];var u=this.getNextKeyWith(s,e,1);while(u.time<this.currentTime&&u.index>h.index){h=u;u=this.getNextKeyWith(s,e,u.index+1)}a.prevKey[s]=h;a.nextKey[s]=u}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];var n=r.animationCache;if(n!==undefined){var i=n.blending;i.positionWeight=0;i.quaternionWeight=0;i.scaleWeight=0}}},update:function(){var e=[];var t=new i.Vector3;var r=new i.Vector3;var n=new i.Quaternion;var a=function(e,t){var r=[],n=[],i,a,s,h,u,l,c,f,d;i=(e.length-1)*t;a=Math.floor(i);s=i-a;r[0]=a===0?a:a-1;r[1]=a;r[2]=a>e.length-2?a:a+1;r[3]=a>e.length-3?a:a+2;l=e[r[0]];c=e[r[1]];f=e[r[2]];d=e[r[3]];h=s*s;u=s*h;n[0]=o(l[0],c[0],f[0],d[0],s,h,u);n[1]=o(l[1],c[1],f[1],d[1],s,h,u);n[2]=o(l[2],c[2],f[2],d[2],s,h,u);return n};var o=function(e,t,r,n,i,a,o){var s=(r-e)*.5,h=(n-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*i+t};return function(o){if(this.isPlaying===false)return;this.currentTime+=o*this.timeScale;if(this.weight===0)return;var s=this.data.length;if(this.currentTime>s||this.currentTime<0){if(this.loop){this.currentTime%=s;if(this.currentTime<0)this.currentTime+=s;this.reset()}else{this.stop()}}for(var h=0,u=this.hierarchy.length;h<u;h++){var l=this.hierarchy[h];var c=l.animationCache.animations[this.data.name];var f=l.animationCache.blending;for(var d=0;d<3;d++){var p=this.keyTypes[d];var m=c.prevKey[p];var v=c.nextKey[p];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){m=this.data.hierarchy[h].keys[0];v=this.getNextKeyWith(p,h,1);while(v.time<this.currentTime&&v.index>m.index){m=v;v=this.getNextKeyWith(p,h,v.index+1)}c.prevKey[p]=m;c.nextKey[p]=v}var g=(this.currentTime-m.time)/(v.time-m.time);var y=m[p];var x=v[p];if(g<0)g=0;if(g>1)g=1;if(p==="pos"){if(this.interpolationType===i.AnimationHandler.LINEAR){r.x=y[0]+(x[0]-y[0])*g;r.y=y[1]+(x[1]-y[1])*g;r.z=y[2]+(x[2]-y[2])*g;var b=this.weight/(this.weight+f.positionWeight);l.position.lerp(r,b);f.positionWeight+=this.weight}else if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",h,m.index-1)["pos"];e[1]=y;e[2]=x;e[3]=this.getNextKeyWith("pos",h,v.index+1)["pos"];g=g*.33+.33;var w=a(e,g);var b=this.weight/(this.weight+f.positionWeight);f.positionWeight+=this.weight;var _=l.position;_.x=_.x+(w[0]-_.x)*b;_.y=_.y+(w[1]-_.y)*b;_.z=_.z+(w[2]-_.z)*b;if(this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){var M=a(e,g*1.01);t.set(M[0],M[1],M[2]);t.sub(_);t.y=0;t.normalize();var S=Math.atan2(t.x,t.z);l.rotation.set(0,S,0)}}}else if(p==="rot"){i.Quaternion.slerp(y,x,n,g);if(f.quaternionWeight===0){l.quaternion.copy(n);f.quaternionWeight=this.weight}else{var b=this.weight/(this.weight+f.quaternionWeight);i.Quaternion.slerp(l.quaternion,n,l.quaternion,b);f.quaternionWeight+=this.weight}}else if(p==="scl"){r.x=y[0]+(x[0]-y[0])*g;r.y=y[1]+(x[1]-y[1])*g;r.z=y[2]+(x[2]-y[2])*g;var b=this.weight/(this.weight+f.scaleWeight);l.scale.lerp(r,b);f.scaleWeight+=this.weight}}}return true}}(),getNextKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){r=r<n.length-1?r:n.length-1}else{r=r%n.length}for(;r<n.length;r++){if(n[r][e]!==undefined){return n[r]}}return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){r=r>0?r:0}else{r=r>=0?r:r+n.length}for(;r>=0;r--){if(n[r][e]!==undefined){return n[r]}}return this.data.hierarchy[t].keys[n.length-1]}};i.KeyFrameAnimation=function(e){this.root=e.node;this.data=i.AnimationHandler.init(e);this.hierarchy=i.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var t=0,r=this.hierarchy.length;t<r;t++){var n=this.data.hierarchy[t].keys,a=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(n.length&&a){for(var s=0;s<a.length;s++){var h=a[s],u=this.getNextKeyWith(h,t,0);if(u){u.apply(h)}}o.matrixAutoUpdate=false;this.data.hierarchy[t].node.updateMatrix();o.matrixWorldNeedsUpdate=true}}};i.KeyFrameAnimation.prototype={constructor:i.KeyFrameAnimation,play:function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;var t,r=this.hierarchy.length,n,a;for(t=0;t<r;t++){n=this.hierarchy[t];a=this.data.hierarchy[t];if(a.animationCache===undefined){a.animationCache={};a.animationCache.prevKey=null;a.animationCache.nextKey=null;a.animationCache.originalMatrix=n.matrix}var o=this.data.hierarchy[t].keys;if(o.length){a.animationCache.prevKey=o[0];a.animationCache.nextKey=o[1];this.startTime=Math.min(o[0].time,this.startTime);this.endTime=Math.max(o[o.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;i.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;this.isPaused=false;i.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var r=this.data.hierarchy[e];if(r.animationCache!==undefined){var n=r.animationCache.originalMatrix;n.copy(t.matrix);t.matrix=n;delete r.animationCache}}},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e*this.timeScale;var t=this.data.length;if(this.loop===true&&this.currentTime>t){this.currentTime%=t}this.currentTime=Math.min(this.currentTime,t);for(var r=0,n=this.hierarchy.length;r<n;r++){var i=this.hierarchy[r];var a=this.data.hierarchy[r];var o=a.keys,s=a.animationCache;if(o.length){var h=s.prevKey;var u=s.nextKey;if(u.time<=this.currentTime){while(u.time<this.currentTime&&u.index>h.index){h=u;u=o[h.index+1]}s.prevKey=h;s.nextKey=u}if(u.time>=this.currentTime){h.interpolate(u,this.currentTime)}else{h.interpolate(u,u.time)}this.data.hierarchy[r].node.updateMatrix();i.matrixWorldNeedsUpdate=true}}},getNextKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;r=r%n.length;for(;r<n.length;r++){if(n[r].hasTarget(e)){return n[r]}}return n[0]},getPrevKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;r=r>=0?r:r+n.length;for(;r>=0;r--){if(n[r].hasTarget(e)){return n[r]}}return n[n.length-1]}};i.MorphAnimation=function(e){this.mesh=e;this.frames=e.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};i.MorphAnimation.prototype={constructor:i.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames;var r=Math.floor(this.currentTime/t);var n=this.mesh.morphTargetInfluences;if(r!==this.currentFrame){n[this.lastFrame]=0;n[this.currentFrame]=1;n[r]=0;this.lastFrame=this.currentFrame;this.currentFrame=r}var i=this.currentTime%t/t;n[r]=i;n[this.lastFrame]=1-i}};i.BoxGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:a,depthSegments:o};this.widthSegments=n||1;this.heightSegments=a||1;this.depthSegments=o||1;var s=this;var h=e/2;var u=t/2;var l=r/2;c("z","y",-1,-1,r,t,h,0);c("z","y",1,-1,r,t,-h,1);c("x","z",1,1,e,r,u,2);c("x","z",1,-1,e,r,-u,3);c("x","y",1,-1,e,t,l,4);c("x","y",-1,-1,e,t,-l,5);function c(e,t,r,n,a,o,h,u){var l,c,f,d=s.widthSegments,p=s.heightSegments,m=a/2,v=o/2,g=s.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){l="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){l="y";p=s.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){l="x";d=s.depthSegments}var y=d+1,x=p+1,b=a/d,w=o/p,_=new i.Vector3;_[l]=h>0?1:-1;for(f=0;f<x;f++){for(c=0;c<y;c++){var M=new i.Vector3;M[e]=(c*b-m)*r;M[t]=(f*w-v)*n;M[l]=h;s.vertices.push(M)}}for(f=0;f<p;f++){for(c=0;c<d;c++){var S=c+y*f;var T=c+y*(f+1);var E=c+1+y*(f+1);var C=c+1+y*f;var A=new i.Vector2(c/d,1-f/p);var L=new i.Vector2(c/d,1-(f+1)/p);var P=new i.Vector2((c+1)/d,1-(f+1)/p);var R=new i.Vector2((c+1)/d,1-f/p);var D=new i.Face3(S+g,T+g,C+g);D.normal.copy(_);D.vertexNormals.push(_.clone(),_.clone(),_.clone());D.materialIndex=u;s.faces.push(D);s.faceVertexUvs[0].push([A,L,R]);D=new i.Face3(T+g,E+g,C+g);D.normal.copy(_);D.vertexNormals.push(_.clone(),_.clone(),_.clone());D.materialIndex=u;s.faces.push(D);s.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}}this.mergeVertices()};i.BoxGeometry.prototype=Object.create(i.Geometry.prototype);i.BoxGeometry.prototype.constructor=i.BoxGeometry;i.BoxGeometry.prototype.clone=function(){var e=new i.BoxGeometry(this.parameters.width,this.parameters.height,this.parameters.depth,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.depthSegments);return e};i.CubeGeometry=i.BoxGeometry;i.CircleGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};e=e||50;t=t!==undefined?Math.max(3,t):8;r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;var a,o=[],s=new i.Vector3,h=new i.Vector2(.5,.5);this.vertices.push(s);o.push(h);for(a=0;a<=t;a++){var u=new i.Vector3;var l=r+a/t*n;u.x=e*Math.cos(l);u.y=e*Math.sin(l);this.vertices.push(u);o.push(new i.Vector2((u.x/e+1)/2,(u.y/e+1)/2))}var c=new i.Vector3(0,0,1);for(a=1;a<=t;a++){this.faces.push(new i.Face3(a,a+1,0,[c.clone(),c.clone(),c.clone()]));this.faceVertexUvs[0].push([o[a].clone(),o[a+1].clone(),h.clone()])}this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.CircleGeometry.prototype=Object.create(i.Geometry.prototype);i.CircleGeometry.prototype.constructor=i.CircleGeometry;i.CircleGeometry.prototype.clone=function(){var e=new i.CircleGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);return e};i.CircleBufferGeometry=function(e,t,r,n){i.BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};e=e||50;t=t!==undefined?Math.max(3,t):8;r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;var a=t+2;var o=new Float32Array(a*3);var s=new Float32Array(a*3);var h=new Float32Array(a*2);s[3]=1;h[0]=.5;h[1]=.5;for(var u=0,l=3,c=2;u<=t;u++,l+=3,c+=2){var f=r+u/t*n;o[l]=e*Math.cos(f);o[l+1]=e*Math.sin(f);s[l+2]=1;h[c]=(o[l]/e+1)/2;h[c+1]=(o[l+1]/e+1)/2}var d=[];for(var l=1;l<=t;l++){d.push(l);d.push(l+1);d.push(0)}this.setIndex(new i.BufferAttribute(new Uint16Array(d),1));this.addAttribute("position",new i.BufferAttribute(o,3));this.addAttribute("normal",new i.BufferAttribute(s,3));this.addAttribute("uv",new i.BufferAttribute(h,2));this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.CircleBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.CircleBufferGeometry.prototype.constructor=i.CircleBufferGeometry;i.CircleBufferGeometry.prototype.clone=function(){var e=new i.CircleBufferGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);e.copy(this);return e};i.CylinderGeometry=function(e,t,r,n,a,o,s,h){i.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:h};e=e!==undefined?e:20;t=t!==undefined?t:20;r=r!==undefined?r:100;n=n||8;a=a||1;o=o!==undefined?o:false;s=s!==undefined?s:0;h=h!==undefined?h:2*Math.PI;var u=r/2;var l,c,f=[],d=[];for(c=0;c<=a;c++){var p=[];var m=[];var v=c/a;var g=v*(t-e)+e;for(l=0;l<=n;l++){var y=l/n;var x=new i.Vector3;x.x=g*Math.sin(y*h+s);x.y=-v*r+u;x.z=g*Math.cos(y*h+s);this.vertices.push(x);p.push(this.vertices.length-1);m.push(new i.Vector2(y,1-v))}f.push(p);d.push(m)}var b=(t-e)/r;var w,_;for(l=0;l<n;l++){if(e!==0){w=this.vertices[f[0][l]].clone();_=this.vertices[f[0][l+1]].clone()}else{w=this.vertices[f[1][l]].clone();_=this.vertices[f[1][l+1]].clone()}w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize();_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize();for(c=0;c<a;c++){var M=f[c][l];var S=f[c+1][l];var T=f[c+1][l+1];var E=f[c][l+1];var C=w.clone();var A=w.clone();var L=_.clone();var P=_.clone();var R=d[c][l].clone();var D=d[c+1][l].clone();var k=d[c+1][l+1].clone();var F=d[c][l+1].clone();this.faces.push(new i.Face3(M,S,E,[C,A,P]));this.faceVertexUvs[0].push([R,D,F]);this.faces.push(new i.Face3(S,T,E,[A.clone(),L,P.clone()]));this.faceVertexUvs[0].push([D.clone(),k,F.clone()])}}if(o===false&&e>0){this.vertices.push(new i.Vector3(0,u,0));for(l=0;l<n;l++){var M=f[0][l];var S=f[0][l+1];var T=this.vertices.length-1;var C=new i.Vector3(0,1,0);var A=new i.Vector3(0,1,0);var L=new i.Vector3(0,1,0);var R=d[0][l].clone();var D=d[0][l+1].clone();var k=new i.Vector2(D.x,0);this.faces.push(new i.Face3(M,S,T,[C,A,L],undefined,1));this.faceVertexUvs[0].push([R,D,k])}}if(o===false&&t>0){this.vertices.push(new i.Vector3(0,-u,0));for(l=0;l<n;l++){var M=f[a][l+1];var S=f[a][l];var T=this.vertices.length-1;var C=new i.Vector3(0,-1,0);var A=new i.Vector3(0,-1,0);var L=new i.Vector3(0,-1,0);var R=d[a][l+1].clone();var D=d[a][l].clone();var k=new i.Vector2(D.x,1);this.faces.push(new i.Face3(M,S,T,[C,A,L],undefined,2));this.faceVertexUvs[0].push([R,D,k])}}this.computeFaceNormals()};i.CylinderGeometry.prototype=Object.create(i.Geometry.prototype);i.CylinderGeometry.prototype.constructor=i.CylinderGeometry;i.CylinderGeometry.prototype.clone=function(){var e=new i.CylinderGeometry(this.parameters.radiusTop,this.parameters.radiusBottom,this.parameters.height,this.parameters.radialSegments,this.parameters.heightSegments,this.parameters.openEnded,this.parameters.thetaStart,this.parameters.thetaLength);return e};i.EdgesGeometry=function(e,t){i.BufferGeometry.call(this);t=t!==undefined?t:1;var r=Math.cos(i.Math.degToRad(t));var n=[0,0],a={};var o=function(e,t){return e-t};var s=["a","b","c"];var h;if(e instanceof i.BufferGeometry){h=new i.Geometry;h.fromBufferGeometry(e)}else{h=e.clone()}h.mergeVertices();h.computeFaceNormals();var u=h.vertices;var l=h.faces;for(var c=0,f=l.length;c<f;c++){var d=l[c];for(var p=0;p<3;p++){n[0]=d[s[p]];n[1]=d[s[(p+1)%3]];n.sort(o);var m=n.toString();if(a[m]===undefined){a[m]={vert1:n[0],vert2:n[1],face1:c,face2:undefined}}else{a[m].face2=c}}}var v=[];for(var m in a){var g=a[m];if(g.face2===undefined||l[g.face1].normal.dot(l[g.face2].normal)<=r){var y=u[g.vert1];v.push(y.x);v.push(y.y);v.push(y.z);y=u[g.vert2];v.push(y.x);v.push(y.y);v.push(y.z)}}this.addAttribute("position",new i.BufferAttribute(new Float32Array(v),3))};i.EdgesGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.EdgesGeometry.prototype.constructor=i.EdgesGeometry;i.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}i.Geometry.call(this);this.type="ExtrudeGeometry";e=Array.isArray(e)?e:[e];this.addShapeList(e,t);this.computeFaceNormals()};i.ExtrudeGeometry.prototype=Object.create(i.Geometry.prototype);i.ExtrudeGeometry.prototype.constructor=i.ExtrudeGeometry;i.ExtrudeGeometry.prototype.addShapeList=function(e,t){var r=e.length;for(var n=0;n<r;n++){var i=e[n];this.addShape(i,t)}};i.ExtrudeGeometry.prototype.addShape=function(e,t){var r=t.amount!==undefined?t.amount:100;var n=t.bevelThickness!==undefined?t.bevelThickness:6;var a=t.bevelSize!==undefined?t.bevelSize:n-2;var o=t.bevelSegments!==undefined?t.bevelSegments:3;var s=t.bevelEnabled!==undefined?t.bevelEnabled:true;var h=t.curveSegments!==undefined?t.curveSegments:12;var u=t.steps!==undefined?t.steps:1;var l=t.extrudePath;var c,f=false;var d=t.UVGenerator!==undefined?t.UVGenerator:i.ExtrudeGeometry.WorldUVGenerator;var p,m,v,g;if(l){c=l.getSpacedPoints(u);f=true;s=false;p=t.frames!==undefined?t.frames:new i.TubeGeometry.FrenetFrames(l,u,false);m=new i.Vector3;v=new i.Vector3;g=new i.Vector3}if(!s){o=0;n=0;a=0}var y,x,b;var w=this;var _=this.vertices.length;var M=e.extractPoints(h);var S=M.shape;var T=M.holes;var E=!i.Shape.Utils.isClockWise(S);if(E){S=S.reverse();for(x=0,b=T.length;x<b;x++){y=T[x];if(i.Shape.Utils.isClockWise(y)){T[x]=y.reverse()}}E=false}var C=i.Shape.Utils.triangulateShape(S,T);var A=S;for(x=0,b=T.length;x<b;x++){y=T[x];S=S.concat(y)}function L(e,t,r){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(r).add(e)}var P,R,D,k,F,O=S.length,U,B=C.length;function V(e,t,r){var n=1e-10;var a,o,s=1;var h=e.x-t.x,u=e.y-t.y;var l=r.x-e.x,c=r.y-e.y;var f=h*h+u*u;var d=h*c-u*l;if(Math.abs(d)>n){var p=Math.sqrt(f);var m=Math.sqrt(l*l+c*c);var v=t.x-u/p;var g=t.y+h/p;var y=r.x-c/m;var x=r.y+l/m;var b=((y-v)*c-(x-g)*l)/(h*c-u*l);a=v+h*b-e.x;o=g+u*b-e.y;var w=a*a+o*o;if(w<=2){return new i.Vector2(a,o)}else{s=Math.sqrt(w/2)}}else{var _=false;if(h>n){if(l>n){_=true}}else{if(h<-n){if(l<-n){_=true}}else{if(Math.sign(u)===Math.sign(c)){_=true}}}if(_){a=-u;o=h;s=Math.sqrt(f)}else{a=h;o=u;s=Math.sqrt(f/2)}}return new i.Vector2(a/s,o/s)}var I=[];for(var N=0,G=A.length,z=G-1,H=N+1;N<G;N++,z++,H++){if(z===G)z=0;if(H===G)H=0;I[N]=V(A[N],A[z],A[H])}var j=[],W,X=I.concat();for(x=0,b=T.length;x<b;x++){y=T[x];W=[];for(N=0,G=y.length,z=G-1,H=N+1;N<G;N++,z++,H++){if(z===G)z=0;if(H===G)H=0;W[N]=V(y[N],y[z],y[H])}j.push(W);X=X.concat(W)}for(P=0;P<o;P++){D=P/o;k=n*(1-D);R=a*Math.sin(D*Math.PI/2);for(N=0,G=A.length;N<G;N++){F=L(A[N],I[N],R);Q(F.x,F.y,-k)}for(x=0,b=T.length;x<b;x++){y=T[x];W=j[x];for(N=0,G=y.length;N<G;N++){F=L(y[N],W[N],R);Q(F.x,F.y,-k)}}}R=a;for(N=0;N<O;N++){F=s?L(S[N],X[N],R):S[N];if(!f){Q(F.x,F.y,0)}else{v.copy(p.normals[0]).multiplyScalar(F.x);m.copy(p.binormals[0]).multiplyScalar(F.y);g.copy(c[0]).add(v).add(m);Q(g.x,g.y,g.z)}}var q;for(q=1;q<=u;q++){for(N=0;N<O;N++){F=s?L(S[N],X[N],R):S[N];if(!f){Q(F.x,F.y,r/u*q)}else{v.copy(p.normals[q]).multiplyScalar(F.x);m.copy(p.binormals[q]).multiplyScalar(F.y);g.copy(c[q]).add(v).add(m);Q(g.x,g.y,g.z)}}}for(P=o-1;P>=0;P--){D=P/o;k=n*(1-D);R=a*Math.sin(D*Math.PI/2);for(N=0,G=A.length;N<G;N++){F=L(A[N],I[N],R);Q(F.x,F.y,r+k)}for(x=0,b=T.length;x<b;x++){y=T[x];W=j[x];for(N=0,G=y.length;N<G;N++){F=L(y[N],W[N],R);if(!f){Q(F.x,F.y,r+k)}else{Q(F.x,F.y+c[u-1].y,c[u-1].x+k)}}}}Y();K();function Y(){if(s){var e=0;var t=O*e;for(N=0;N<B;N++){U=C[N];J(U[2]+t,U[1]+t,U[0]+t)}e=u+o*2;t=O*e;for(N=0;N<B;N++){U=C[N];J(U[0]+t,U[1]+t,U[2]+t)}}else{for(N=0;N<B;N++){U=C[N];J(U[2],U[1],U[0])}for(N=0;N<B;N++){U=C[N];J(U[0]+O*u,U[1]+O*u,U[2]+O*u)}}}function K(){var e=0;Z(A,e);e+=A.length;for(x=0,b=T.length;x<b;x++){y=T[x];Z(y,e);e+=y.length;
}}function Z(e,t){var r,n;N=e.length;while(--N>=0){r=N;n=N-1;if(n<0)n=e.length-1;var i=0,a=u+o*2;for(i=0;i<a;i++){var s=O*i;var h=O*(i+1);var l=t+r+s,c=t+n+s,f=t+n+h,d=t+r+h;$(l,c,f,d,e,i,a,r,n)}}}function Q(e,t,r){w.vertices.push(new i.Vector3(e,t,r))}function J(e,t,r){e+=_;t+=_;r+=_;w.faces.push(new i.Face3(e,t,r));var n=d.generateTopUV(w,e,t,r);w.faceVertexUvs[0].push(n)}function $(e,t,r,n,a,o,s,h,u){e+=_;t+=_;r+=_;n+=_;w.faces.push(new i.Face3(e,t,n));w.faces.push(new i.Face3(t,r,n));var l=d.generateSideWallUV(w,e,t,r,n);w.faceVertexUvs[0].push([l[0],l[1],l[3]]);w.faceVertexUvs[0].push([l[1],l[2],l[3]])}};i.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n){var a=e.vertices;var o=a[t];var s=a[r];var h=a[n];return[new i.Vector2(o.x,o.y),new i.Vector2(s.x,s.y),new i.Vector2(h.x,h.y)]},generateSideWallUV:function(e,t,r,n,a){var o=e.vertices;var s=o[t];var h=o[r];var u=o[n];var l=o[a];if(Math.abs(s.y-h.y)<.01){return[new i.Vector2(s.x,1-s.z),new i.Vector2(h.x,1-h.z),new i.Vector2(u.x,1-u.z),new i.Vector2(l.x,1-l.z)]}else{return[new i.Vector2(s.y,1-s.z),new i.Vector2(h.y,1-h.z),new i.Vector2(u.y,1-u.z),new i.Vector2(l.y,1-l.z)]}}};i.ShapeGeometry=function(e,t){i.Geometry.call(this);this.type="ShapeGeometry";if(Array.isArray(e)===false)e=[e];this.addShapeList(e,t);this.computeFaceNormals()};i.ShapeGeometry.prototype=Object.create(i.Geometry.prototype);i.ShapeGeometry.prototype.constructor=i.ShapeGeometry;i.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,n=e.length;r<n;r++){this.addShape(e[r],t)}return this};i.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var r=t.curveSegments!==undefined?t.curveSegments:12;var n=t.material;var a=t.UVGenerator===undefined?i.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var o,s,h;var u=this.vertices.length;var l=e.extractPoints(r);var c=l.shape;var f=l.holes;var d=!i.Shape.Utils.isClockWise(c);if(d){c=c.reverse();for(o=0,s=f.length;o<s;o++){h=f[o];if(i.Shape.Utils.isClockWise(h)){f[o]=h.reverse()}}d=false}var p=i.Shape.Utils.triangulateShape(c,f);for(o=0,s=f.length;o<s;o++){h=f[o];c=c.concat(h)}var m,v=c.length;var g,y=p.length;for(o=0;o<v;o++){m=c[o];this.vertices.push(new i.Vector3(m.x,m.y,0))}for(o=0;o<y;o++){g=p[o];var x=g[0]+u;var b=g[1]+u;var w=g[2]+u;this.faces.push(new i.Face3(x,b,w,null,null,n));this.faceVertexUvs[0].push(a.generateTopUV(this,x,b,w))}};i.LatheGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:r,phiLength:n};t=t||12;r=r||0;n=n||2*Math.PI;var a=1/(e.length-1);var o=1/t;for(var s=0,h=t;s<=h;s++){var u=r+s*o*n;var l=Math.cos(u),c=Math.sin(u);for(var f=0,d=e.length;f<d;f++){var p=e[f];var m=new i.Vector3;m.x=l*p.x-c*p.y;m.y=c*p.x+l*p.y;m.z=p.z;this.vertices.push(m)}}var v=e.length;for(var s=0,h=t;s<h;s++){for(var f=0,d=e.length-1;f<d;f++){var g=f+v*s;var y=g;var x=g+v;var l=g+1+v;var b=g+1;var w=s*o;var _=f*a;var M=w+o;var S=_+a;this.faces.push(new i.Face3(y,x,b));this.faceVertexUvs[0].push([new i.Vector2(w,_),new i.Vector2(M,_),new i.Vector2(w,S)]);this.faces.push(new i.Face3(x,l,b));this.faceVertexUvs[0].push([new i.Vector2(M,_),new i.Vector2(M,S),new i.Vector2(w,S)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};i.LatheGeometry.prototype=Object.create(i.Geometry.prototype);i.LatheGeometry.prototype.constructor=i.LatheGeometry;i.PlaneGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};this.fromBufferGeometry(new i.PlaneBufferGeometry(e,t,r,n))};i.PlaneGeometry.prototype=Object.create(i.Geometry.prototype);i.PlaneGeometry.prototype.constructor=i.PlaneGeometry;i.PlaneGeometry.prototype.clone=function(){var e=new i.PlaneGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);return e};i.PlaneBufferGeometry=function(e,t,r,n){i.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var a=e/2;var o=t/2;var s=Math.floor(r)||1;var h=Math.floor(n)||1;var u=s+1;var l=h+1;var c=e/s;var f=t/h;var d=new Float32Array(u*l*3);var p=new Float32Array(u*l*3);var m=new Float32Array(u*l*2);var v=0;var g=0;for(var y=0;y<l;y++){var x=y*f-o;for(var b=0;b<u;b++){var w=b*c-a;d[v]=w;d[v+1]=-x;p[v+2]=1;m[g]=b/s;m[g+1]=1-y/h;v+=3;g+=2}}v=0;var _=new(d.length/3>65535?Uint32Array:Uint16Array)(s*h*6);for(var y=0;y<h;y++){for(var b=0;b<s;b++){var M=b+u*y;var S=b+u*(y+1);var T=b+1+u*(y+1);var E=b+1+u*y;_[v]=M;_[v+1]=S;_[v+2]=E;_[v+3]=S;_[v+4]=T;_[v+5]=E;v+=6}}this.setIndex(new i.BufferAttribute(_,1));this.addAttribute("position",new i.BufferAttribute(d,3));this.addAttribute("normal",new i.BufferAttribute(p,3));this.addAttribute("uv",new i.BufferAttribute(m,2))};i.PlaneBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.PlaneBufferGeometry.prototype.constructor=i.PlaneBufferGeometry;i.PlaneBufferGeometry.prototype.clone=function(){var e=new i.PlaneBufferGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);e.copy(this);return e};i.RingGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:a,thetaLength:o};e=e||0;t=t||50;a=a!==undefined?a:0;o=o!==undefined?o:Math.PI*2;r=r!==undefined?Math.max(3,r):8;n=n!==undefined?Math.max(1,n):8;var s,h,u=[],l=e,c=(t-e)/n;for(s=0;s<n+1;s++){for(h=0;h<r+1;h++){var f=new i.Vector3;var d=a+h/r*o;f.x=l*Math.cos(d);f.y=l*Math.sin(d);this.vertices.push(f);u.push(new i.Vector2((f.x/t+1)/2,(f.y/t+1)/2))}l+=c}var p=new i.Vector3(0,0,1);for(s=0;s<n;s++){var m=s*(r+1);for(h=0;h<r;h++){var d=h+m;var v=d;var g=d+r+1;var y=d+r+2;this.faces.push(new i.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([u[v].clone(),u[g].clone(),u[y].clone()]);v=d;g=d+r+2;y=d+1;this.faces.push(new i.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([u[v].clone(),u[g].clone(),u[y].clone()])}}this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,l)};i.RingGeometry.prototype=Object.create(i.Geometry.prototype);i.RingGeometry.prototype.constructor=i.RingGeometry;i.RingGeometry.prototype.clone=function(){var e=new i.RingGeometry(this.parameters.innerRadius,this.parameters.outerRadius,this.parameters.thetaSegments,this.parameters.phiSegments,this.parameters.thetaStart,this.parameters.thetaLength);return e};i.SphereGeometry=function(e,t,r,n,a,o,s){i.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:a,thetaStart:o,thetaLength:s};this.fromBufferGeometry(new i.SphereBufferGeometry(e,t,r,n,a,o,s))};i.SphereGeometry.prototype=Object.create(i.Geometry.prototype);i.SphereGeometry.prototype.constructor=i.SphereGeometry;i.SphereGeometry.prototype.clone=function(){var e=new i.SphereGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);return e};i.SphereBufferGeometry=function(e,t,r,n,a,o,s){i.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:a,thetaStart:o,thetaLength:s};e=e||50;t=Math.max(3,Math.floor(t)||8);r=Math.max(2,Math.floor(r)||6);n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;o=o!==undefined?o:0;s=s!==undefined?s:Math.PI;var h=o+s;var u=(t+1)*(r+1);var l=new i.BufferAttribute(new Float32Array(u*3),3);var c=new i.BufferAttribute(new Float32Array(u*3),3);var f=new i.BufferAttribute(new Float32Array(u*2),2);var d=0,p=[],m=new i.Vector3;for(var v=0;v<=r;v++){var g=[];var y=v/r;for(var x=0;x<=t;x++){var b=x/t;var w=-e*Math.cos(n+b*a)*Math.sin(o+y*s);var _=e*Math.cos(o+y*s);var M=e*Math.sin(n+b*a)*Math.sin(o+y*s);m.set(w,_,M).normalize();l.setXYZ(d,w,_,M);c.setXYZ(d,m.x,m.y,m.z);f.setXY(d,b,1-y);g.push(d);d++}p.push(g)}var S=[];for(var v=0;v<r;v++){for(var x=0;x<t;x++){var T=p[v][x+1];var E=p[v][x];var C=p[v+1][x];var A=p[v+1][x+1];if(v!==0||o>0)S.push(T,E,A);if(v!==r-1||h<Math.PI)S.push(E,C,A)}}this.setIndex(new i.BufferAttribute(new Uint16Array(S),1));this.addAttribute("position",l);this.addAttribute("normal",c);this.addAttribute("uv",f);this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.SphereBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.SphereBufferGeometry.prototype.constructor=i.SphereBufferGeometry;i.SphereBufferGeometry.prototype.clone=function(){var e=new i.SphereBufferGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);e.copy(this);return e};i.TextGeometry=function(e,t){t=t||{};var r=i.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;i.ExtrudeGeometry.call(this,r,t);this.type="TextGeometry"};i.TextGeometry.prototype=Object.create(i.ExtrudeGeometry.prototype);i.TextGeometry.prototype.constructor=i.TextGeometry;i.TorusGeometry=function(e,t,r,n,a){i.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:a};e=e||100;t=t||40;r=r||8;n=n||6;a=a||Math.PI*2;var o=new i.Vector3,s=[],h=[];for(var u=0;u<=r;u++){for(var l=0;l<=n;l++){var c=l/n*a;var f=u/r*Math.PI*2;o.x=e*Math.cos(c);o.y=e*Math.sin(c);var d=new i.Vector3;d.x=(e+t*Math.cos(f))*Math.cos(c);d.y=(e+t*Math.cos(f))*Math.sin(c);d.z=t*Math.sin(f);this.vertices.push(d);s.push(new i.Vector2(l/n,u/r));h.push(d.clone().sub(o).normalize())}}for(var u=1;u<=r;u++){for(var l=1;l<=n;l++){var p=(n+1)*u+l-1;var m=(n+1)*(u-1)+l-1;var v=(n+1)*(u-1)+l;var g=(n+1)*u+l;var y=new i.Face3(p,m,g,[h[p].clone(),h[m].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[g].clone()]);y=new i.Face3(m,v,g,[h[m].clone(),h[v].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[m].clone(),s[v].clone(),s[g].clone()])}}this.computeFaceNormals()};i.TorusGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusGeometry.prototype.constructor=i.TorusGeometry;i.TorusGeometry.prototype.clone=function(){var e=new i.TorusGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.arc);return e};i.TorusKnotGeometry=function(e,t,r,n,a,o,s){i.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:a,q:o,heightScale:s};e=e||100;t=t||40;r=r||64;n=n||8;a=a||2;o=o||3;s=s||1;var h=new Array(r);var u=new i.Vector3;var l=new i.Vector3;var c=new i.Vector3;for(var f=0;f<r;++f){h[f]=new Array(n);var d=f/r*2*a*Math.PI;var p=R(d,o,a,e,s);var m=R(d+.01,o,a,e,s);u.subVectors(m,p);l.addVectors(m,p);c.crossVectors(u,l);l.crossVectors(c,u);c.normalize();l.normalize();for(var v=0;v<n;++v){var g=v/n*2*Math.PI;var y=-t*Math.cos(g);var x=t*Math.sin(g);var b=new i.Vector3;b.x=p.x+y*l.x+x*c.x;b.y=p.y+y*l.y+x*c.y;b.z=p.z+y*l.z+x*c.z;h[f][v]=this.vertices.push(b)-1}}for(var f=0;f<r;++f){for(var v=0;v<n;++v){var w=(f+1)%r;var _=(v+1)%n;var M=h[f][v];var S=h[w][v];var T=h[w][_];var E=h[f][_];var C=new i.Vector2(f/r,v/n);var A=new i.Vector2((f+1)/r,v/n);var L=new i.Vector2((f+1)/r,(v+1)/n);var P=new i.Vector2(f/r,(v+1)/n);this.faces.push(new i.Face3(M,S,E));this.faceVertexUvs[0].push([C,A,P]);this.faces.push(new i.Face3(S,T,E));this.faceVertexUvs[0].push([A.clone(),L,P.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function R(e,t,r,n,a){var o=Math.cos(e);var s=Math.sin(e);var h=t/r*e;var u=Math.cos(h);var l=n*(2+u)*.5*o;var c=n*(2+u)*s*.5;var f=a*n*Math.sin(h)*.5;return new i.Vector3(l,c,f)}};i.TorusKnotGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusKnotGeometry.prototype.constructor=i.TorusKnotGeometry;i.TorusKnotGeometry.prototype.clone=function(){var e=new i.TorusKnotGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.p,this.parameters.q,this.parameters.heightScale);return e};i.TubeGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:a};t=t||64;r=r||1;n=n||8;a=a||false;o=o||i.TubeGeometry.NoTaper;var s=[];var h=this,u,l,c,f=t+1,d,p,m,v,g,y,x=new i.Vector3,b,w,_,M,S,T,E,C,A,L,P,R;var D=new i.TubeGeometry.FrenetFrames(e,t,a),k=D.tangents,F=D.normals,O=D.binormals;this.tangents=k;this.normals=F;this.binormals=O;function U(e,t,r){return h.vertices.push(new i.Vector3(e,t,r))-1}for(b=0;b<f;b++){s[b]=[];d=b/(f-1);y=e.getPointAt(d);u=k[b];l=F[b];c=O[b];m=r*o(d);for(w=0;w<n;w++){p=w/n*2*Math.PI;v=-m*Math.cos(p);g=m*Math.sin(p);x.copy(y);x.x+=v*l.x+g*c.x;x.y+=v*l.y+g*c.y;x.z+=v*l.z+g*c.z;s[b][w]=U(x.x,x.y,x.z)}}for(b=0;b<t;b++){for(w=0;w<n;w++){_=a?(b+1)%t:b+1;M=(w+1)%n;S=s[b][w];T=s[_][w];E=s[_][M];C=s[b][M];A=new i.Vector2(b/t,w/n);L=new i.Vector2((b+1)/t,w/n);P=new i.Vector2((b+1)/t,(w+1)/n);R=new i.Vector2(b/t,(w+1)/n);this.faces.push(new i.Face3(S,T,C));this.faceVertexUvs[0].push([A,L,R]);this.faces.push(new i.Face3(T,E,C));this.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};i.TubeGeometry.prototype=Object.create(i.Geometry.prototype);i.TubeGeometry.prototype.constructor=i.TubeGeometry;i.TubeGeometry.NoTaper=function(e){return 1};i.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)};i.TubeGeometry.FrenetFrames=function(e,t,r){var n=new i.Vector3,a=[],o=[],s=[],h=new i.Vector3,u=new i.Matrix4,l=t+1,c,f=1e-4,d,p,m,v,g,y;this.tangents=a;this.normals=o;this.binormals=s;for(g=0;g<l;g++){y=g/(l-1);a[g]=e.getTangentAt(y);a[g].normalize()}x();function x(){o[0]=new i.Vector3;s[0]=new i.Vector3;d=Number.MAX_VALUE;p=Math.abs(a[0].x);m=Math.abs(a[0].y);v=Math.abs(a[0].z);if(p<=d){d=p;n.set(1,0,0)}if(m<=d){d=m;n.set(0,1,0)}if(v<=d){n.set(0,0,1)}h.crossVectors(a[0],n).normalize();o[0].crossVectors(a[0],h);s[0].crossVectors(a[0],o[0])}for(g=1;g<l;g++){o[g]=o[g-1].clone();s[g]=s[g-1].clone();h.crossVectors(a[g-1],a[g]);if(h.length()>f){h.normalize();c=Math.acos(i.Math.clamp(a[g-1].dot(a[g]),-1,1));o[g].applyMatrix4(u.makeRotationAxis(h,c))}s[g].crossVectors(a[g],o[g])}if(r){c=Math.acos(i.Math.clamp(o[0].dot(o[l-1]),-1,1));c/=l-1;if(a[0].dot(h.crossVectors(o[0],o[l-1]))>0){c=-c}for(g=1;g<l;g++){o[g].applyMatrix4(u.makeRotationAxis(a[g],c*g));s[g].crossVectors(a[g],o[g])}}};i.PolyhedronGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:r,detail:n};r=r||1;n=n||0;var a=this;for(var o=0,s=e.length;o<s;o+=3){w(new i.Vector3(e[o],e[o+1],e[o+2]))}var h=this.vertices;var u=[];for(var o=0,l=0,s=t.length;o<s;o+=3,l++){var c=h[t[o]];var f=h[t[o+1]];var d=h[t[o+2]];u[l]=new i.Face3(c.index,f.index,d.index,[c.clone(),f.clone(),d.clone()],undefined,l)}var p=new i.Vector3;for(var o=0,s=u.length;o<s;o++){M(u[o],n)}for(var o=0,s=this.faceVertexUvs[0].length;o<s;o++){var m=this.faceVertexUvs[0][o];var v=m[0].x;var g=m[1].x;var y=m[2].x;var x=Math.max(v,Math.max(g,y));var b=Math.min(v,Math.min(g,y));if(x>.9&&b<.1){if(v<.2)m[0].x+=1;if(g<.2)m[1].x+=1;if(y<.2)m[2].x+=1}}for(var o=0,s=this.vertices.length;o<s;o++){this.vertices[o].multiplyScalar(r)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,r);function w(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var r=S(e)/2/Math.PI+.5;var n=T(e)/Math.PI+.5;t.uv=new i.Vector2(r,1-n);return t}function _(e,t,r,n){var o=new i.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()],undefined,n);a.faces.push(o);p.copy(e).add(t).add(r).divideScalar(3);var s=S(p);a.faceVertexUvs[0].push([E(e.uv,e,s),E(t.uv,t,s),E(r.uv,r,s)])}function M(e,t){var r=Math.pow(2,t);var n=w(a.vertices[e.a]);var i=w(a.vertices[e.b]);var o=w(a.vertices[e.c]);var s=[];var h=e.materialIndex;for(var u=0;u<=r;u++){s[u]=[];var l=w(n.clone().lerp(o,u/r));var c=w(i.clone().lerp(o,u/r));var f=r-u;for(var d=0;d<=f;d++){if(d===0&&u===r){s[u][d]=l}else{s[u][d]=w(l.clone().lerp(c,d/f))}}}for(var u=0;u<r;u++){for(var d=0;d<2*(r-u)-1;d++){var p=Math.floor(d/2);if(d%2===0){_(s[u][p+1],s[u+1][p],s[u][p],h)}else{_(s[u][p+1],s[u+1][p+1],s[u+1][p],h)}}}}function S(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function E(e,t,r){if(r<0&&e.x===1)e=new i.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new i.Vector2(r/2/Math.PI+.5,e.y);return e.clone()}};i.PolyhedronGeometry.prototype=Object.create(i.Geometry.prototype);i.PolyhedronGeometry.prototype.constructor=i.PolyhedronGeometry;i.PolyhedronGeometry.prototype.clone=function(){var e=new i.PolyhedronGeometry(this.parameters.vertices,this.parameters.indices,this.parameters.radius,this.parameters.detail);return e.copy(this)};i.PolyhedronGeometry.prototype.copy=function(e){i.Geometry.prototype.copy.call(this,e);return this};i.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;var n=1/r;var a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];var o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];i.PolyhedronGeometry.call(this,a,o,e,t);this.type="DodecahedronGeometry";this.parameters={radius:e,detail:t}};i.DodecahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.DodecahedronGeometry.prototype.constructor=i.DodecahedronGeometry;i.DodecahedronGeometry.prototype.clone=function(){var e=new i.DodecahedronGeometry(this.parameters.radius,this.parameters.detail);e.copy(this);return e};i.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;var n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];var a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];i.PolyhedronGeometry.call(this,n,a,e,t);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t}};i.IcosahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.IcosahedronGeometry.prototype.constructor=i.IcosahedronGeometry;i.IcosahedronGeometry.prototype.clone=function(){var e=new i.IcosahedronGeometry(this.parameters.radius,this.parameters.detail);e.copy(this);return e};i.OctahedronGeometry=function(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];i.PolyhedronGeometry.call(this,r,n,e,t);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t}};i.OctahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.OctahedronGeometry.prototype.constructor=i.OctahedronGeometry;i.OctahedronGeometry.prototype.clone=function(){var e=new i.OctahedronGeometry(this.parameters.radius,this.parameters.detail);e.copy(this);return e};i.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var n=[2,1,0,0,3,2,1,3,0,2,3,1];i.PolyhedronGeometry.call(this,r,n,e,t);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t}};i.TetrahedronGeometry.prototype=Object.create(i.PolyhedronGeometry.prototype);i.TetrahedronGeometry.prototype.constructor=i.TetrahedronGeometry;i.TetrahedronGeometry.prototype.clone=function(){var e=new i.TetrahedronGeometry(this.parameters.radius,this.parameters.detail);e.copy(this);return e};i.ParametricGeometry=function(e,t,r){i.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:r};var n=this.vertices;var a=this.faces;var o=this.faceVertexUvs[0];var s,h,u;var l,c;var f=t+1;for(s=0;s<=r;s++){c=s/r;for(h=0;h<=t;h++){l=h/t;u=e(l,c);n.push(u)}}var d,p,m,v;var g,y,x,b;for(s=0;s<r;s++){for(h=0;h<t;h++){d=s*f+h;p=s*f+h+1;m=(s+1)*f+h+1;v=(s+1)*f+h;g=new i.Vector2(h/t,s/r);y=new i.Vector2((h+1)/t,s/r);x=new i.Vector2((h+1)/t,(s+1)/r);b=new i.Vector2(h/t,(s+1)/r);a.push(new i.Face3(d,p,v));o.push([g,y,b]);a.push(new i.Face3(p,m,v));o.push([y.clone(),x,b.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};i.ParametricGeometry.prototype=Object.create(i.Geometry.prototype);i.ParametricGeometry.prototype.constructor=i.ParametricGeometry;i.WireframeGeometry=function(e){i.BufferGeometry.call(this);var t=[0,0],r={};var n=function(e,t){return e-t};var a=["a","b","c"];if(e instanceof i.Geometry){var o=e.vertices;var s=e.faces;var h=0;var u=new Uint32Array(6*s.length);for(var l=0,c=s.length;l<c;l++){var f=s[l];for(var d=0;d<3;d++){t[0]=f[a[d]];t[1]=f[a[(d+1)%3]];t.sort(n);var p=t.toString();if(r[p]===undefined){u[2*h]=t[0];u[2*h+1]=t[1];r[p]=true;h++}}}var m=new Float32Array(h*2*3);for(var l=0,c=h;l<c;l++){for(var d=0;d<2;d++){var v=o[u[2*l+d]];var g=6*l+3*d;m[g+0]=v.x;m[g+1]=v.y;m[g+2]=v.z}}this.addAttribute("position",new i.BufferAttribute(m,3))}else if(e instanceof i.BufferGeometry){if(e.index!==null){var y=e.index.array;var o=e.attributes.position;var x=e.drawcalls;var h=0;if(x.length===0){e.addDrawCall(0,y.length)}var u=new Uint32Array(2*y.length);for(var b=0,w=x.length;b<w;++b){var _=x[b];var M=_.start;var S=_.count;for(var l=M,T=M+S;l<T;l+=3){for(var d=0;d<3;d++){t[0]=y[l+d];t[1]=y[l+(d+1)%3];t.sort(n);var p=t.toString();if(r[p]===undefined){u[2*h]=t[0];u[2*h+1]=t[1];r[p]=true;h++}}}}var m=new Float32Array(h*2*3);for(var l=0,c=h;l<c;l++){for(var d=0;d<2;d++){var g=6*l+3*d;var E=u[2*l+d];m[g+0]=o.getX(E);m[g+1]=o.getY(E);m[g+2]=o.getZ(E)}}this.addAttribute("position",new i.BufferAttribute(m,3))}else{var o=e.attributes.position.array;var h=o.length/3;var C=h/3;var m=new Float32Array(h*2*3);for(var l=0,c=C;l<c;l++){for(var d=0;d<3;d++){var g=18*l+6*d;var A=9*l+3*d;m[g+0]=o[A];m[g+1]=o[A+1];m[g+2]=o[A+2];var E=9*l+3*((d+1)%3);m[g+3]=o[E];m[g+4]=o[E+1];m[g+5]=o[E+2]}}this.addAttribute("position",new i.BufferAttribute(m,3))}}};i.WireframeGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.WireframeGeometry.prototype.constructor=i.WireframeGeometry;i.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]);var r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var n=new i.BufferGeometry;n.addAttribute("position",new i.BufferAttribute(t,3));n.addAttribute("color",new i.BufferAttribute(r,3));var a=new i.LineBasicMaterial({vertexColors:i.VertexColors});i.LineSegments.call(this,n,a)};i.AxisHelper.prototype=Object.create(i.LineSegments.prototype);i.AxisHelper.prototype.constructor=i.AxisHelper;i.ArrowHelper=function(){var e=new i.Geometry;e.vertices.push(new i.Vector3(0,0,0),new i.Vector3(0,1,0));var t=new i.CylinderGeometry(0,.5,1,5,1);t.translate(0,-.5,0);return function r(n,a,o,s,h,u){i.Object3D.call(this);if(s===undefined)s=16776960;if(o===undefined)o=1;if(h===undefined)h=.2*o;if(u===undefined)u=.2*h;this.position.copy(a);if(h<o){this.line=new i.Line(e,new i.LineBasicMaterial({color:s}));this.line.matrixAutoUpdate=false;this.add(this.line)}this.cone=new i.Mesh(t,new i.MeshBasicMaterial({color:s}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(n);this.setLength(o,h,u)}}();i.ArrowHelper.prototype=Object.create(i.Object3D.prototype);i.ArrowHelper.prototype.constructor=i.ArrowHelper;i.ArrowHelper.prototype.setDirection=function(){var e=new i.Vector3;var t;return function r(n){if(n.y>.99999){this.quaternion.set(0,0,0,1)}else if(n.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(n.z,0,-n.x).normalize();t=Math.acos(n.y);this.quaternion.setFromAxisAngle(e,t)}}}();i.ArrowHelper.prototype.setLength=function(e,t,r){if(t===undefined)t=.2*e;if(r===undefined)r=.2*t;if(t<e){this.line.scale.set(1,e-t,1);this.line.updateMatrix()}this.cone.scale.set(r,t,r);this.cone.position.y=e;this.cone.updateMatrix()};i.ArrowHelper.prototype.setColor=function(e){if(this.line!==undefined)this.line.material.color.set(e);this.cone.material.color.set(e)};i.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(8*3);var n=new i.BufferGeometry;n.setIndex(new i.BufferAttribute(t,1));n.addAttribute("position",new i.BufferAttribute(r,3));i.LineSegments.call(this,n,new i.LineBasicMaterial({color:16776960}));if(e!==undefined){this.update(e)}};i.BoxHelper.prototype=Object.create(i.LineSegments.prototype);i.BoxHelper.prototype.constructor=i.BoxHelper;i.BoxHelper.prototype.update=function(){var e=new i.Box3;return function(t){e.setFromObject(t);if(e.empty())return;var r=e.min;var n=e.max;var i=this.geometry.attributes.position;var a=i.array;a[0]=n.x;a[1]=n.y;a[2]=n.z;a[3]=r.x;a[4]=n.y;a[5]=n.z;a[6]=r.x;a[7]=r.y;a[8]=n.z;a[9]=n.x;a[10]=r.y;a[11]=n.z;a[12]=n.x;a[13]=n.y;a[14]=r.z;a[15]=r.x;a[16]=n.y;a[17]=r.z;a[18]=r.x;a[19]=r.y;a[20]=r.z;a[21]=n.x;a[22]=r.y;a[23]=r.z;i.needsUpdate=true;this.geometry.computeBoundingSphere()}}();i.BoundingBoxHelper=function(e,t){var r=t!==undefined?t:8947848;this.object=e;this.box=new i.Box3;i.Mesh.call(this,new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:r,wireframe:true}))};i.BoundingBoxHelper.prototype=Object.create(i.Mesh.prototype);i.BoundingBoxHelper.prototype.constructor=i.BoundingBoxHelper;i.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};i.CameraHelper=function(e){var t=new i.Geometry;var r=new i.LineBasicMaterial({color:16777215,vertexColors:i.FaceColors});var n={};var a=16755200;var o=16711680;var s=43775;var h=16777215;var u=3355443;l("n1","n2",a);l("n2","n4",a);l("n4","n3",a);l("n3","n1",a);l("f1","f2",a);l("f2","f4",a);l("f4","f3",a);l("f3","f1",a);l("n1","f1",a);l("n2","f2",a);l("n3","f3",a);l("n4","f4",a);l("p","n1",o);l("p","n2",o);l("p","n3",o);l("p","n4",o);l("u1","u2",s);l("u2","u3",s);l("u3","u1",s);l("c","t",h);l("p","c",u);l("cn1","cn2",u);l("cn3","cn4",u);l("cf1","cf2",u);l("cf3","cf4",u);function l(e,t,r){c(e,r);c(t,r)}function c(e,r){t.vertices.push(new i.Vector3);t.colors.push(new i.Color(r));if(n[e]===undefined){n[e]=[]}n[e].push(t.vertices.length-1)}i.LineSegments.call(this,t,r);this.camera=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=n;this.update()};i.CameraHelper.prototype=Object.create(i.LineSegments.prototype);i.CameraHelper.prototype.constructor=i.CameraHelper;i.CameraHelper.prototype.update=function(){var e,t;var r=new i.Vector3;var n=new i.Camera;var a=function(i,a,o,s){r.set(a,o,s).unproject(n);var h=t[i];if(h!==undefined){for(var u=0,l=h.length;u<l;u++){e.vertices[h[u]].copy(r)}}};return function(){e=this.geometry;t=this.pointMap;var r=1,i=1;n.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-r,-i,-1);a("n2",r,-i,-1);a("n3",-r,i,-1);a("n4",r,i,-1);a("f1",-r,-i,1);a("f2",r,-i,1);a("f3",-r,i,1);a("f4",r,i,1);a("u1",r*.7,i*1.1,-1);a("u2",-r*.7,i*1.1,-1);a("u3",0,i*2,-1);a("cf1",-r,0,1);a("cf2",r,0,1);a("cf3",0,-i,1);a("cf4",0,i,1);a("cn1",-r,0,-1);a("cn2",r,0,-1);a("cn3",0,-i,-1);a("cn4",0,i,-1);e.verticesNeedUpdate=true}}();i.DirectionalLightHelper=function(e,t){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var r=new i.Geometry;r.vertices.push(new i.Vector3(-t,t,0),new i.Vector3(t,t,0),new i.Vector3(t,-t,0),new i.Vector3(-t,-t,0),new i.Vector3(-t,t,0));var n=new i.LineBasicMaterial({fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new i.Line(r,n);this.add(this.lightPlane);r=new i.Geometry;r.vertices.push(new i.Vector3,new i.Vector3);n=new i.LineBasicMaterial({fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new i.Line(r,n);this.add(this.targetLine);this.update()};i.DirectionalLightHelper.prototype=Object.create(i.Object3D.prototype);i.DirectionalLightHelper.prototype.constructor=i.DirectionalLightHelper;i.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};i.DirectionalLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);r.subVectors(t,e);this.lightPlane.lookAt(r);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(r);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();i.EdgesHelper=function(e,t,r){var n=t!==undefined?t:16777215;i.LineSegments.call(this,new i.EdgesGeometry(e.geometry,r),new i.LineBasicMaterial({color:n}));this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.EdgesHelper.prototype=Object.create(i.LineSegments.prototype);i.EdgesHelper.prototype.constructor=i.EdgesHelper;i.FaceNormalsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16776960;var o=n!==undefined?n:1;var s=0;var h=this.object.geometry;if(h instanceof i.Geometry){s=h.faces.length}else{console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.")}var u=new i.BufferGeometry;var l=new i.Float32Attribute(s*2*3,3);u.addAttribute("position",l);i.LineSegments.call(this,u,new i.LineBasicMaterial({color:a,linewidth:o}));this.matrixAutoUpdate=false;this.update()};i.FaceNormalsHelper.prototype=Object.create(i.LineSegments.prototype);i.FaceNormalsHelper.prototype.constructor=i.FaceNormalsHelper;i.FaceNormalsHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function n(){this.object.updateMatrixWorld(true);r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld;var i=this.geometry.attributes.position;var a=this.object.geometry;var o=a.vertices;var s=a.faces;var h=0;for(var u=0,l=s.length;u<l;u++){var c=s[u];var f=c.normal;e.copy(o[c.a]).add(o[c.b]).add(o[c.c]).divideScalar(3).applyMatrix4(n);t.copy(f).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e);i.setXYZ(h,e.x,e.y,e.z);h=h+1;i.setXYZ(h,t.x,t.y,t.z);h=h+1}i.needsUpdate=true;return this}}();i.GridHelper=function(e,t){var r=new i.Geometry;var n=new i.LineBasicMaterial({vertexColors:i.VertexColors});this.color1=new i.Color(4473924);this.color2=new i.Color(8947848);for(var a=-e;a<=e;a+=t){r.vertices.push(new i.Vector3(-e,0,a),new i.Vector3(e,0,a),new i.Vector3(a,0,-e),new i.Vector3(a,0,e));var o=a===0?this.color1:this.color2;r.colors.push(o,o,o,o)}i.LineSegments.call(this,r,n)};i.GridHelper.prototype=Object.create(i.LineSegments.prototype);i.GridHelper.prototype.constructor=i.GridHelper;i.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};i.HemisphereLightHelper=function(e,t){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new i.Color,new i.Color];var r=new i.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var n=0,a=8;n<a;n++){r.faces[n].color=this.colors[n<4?0:1]}var o=new i.MeshBasicMaterial({vertexColors:i.FaceColors,wireframe:true});this.lightSphere=new i.Mesh(r,o);this.add(this.lightSphere);this.update()};i.HemisphereLightHelper.prototype=Object.create(i.Object3D.prototype);i.HemisphereLightHelper.prototype.constructor=i.HemisphereLightHelper;i.HemisphereLightHelper.prototype.dispose=function(){
this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};i.HemisphereLightHelper.prototype.update=function(){var e=new i.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();i.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var r=new i.SphereGeometry(t,4,2);var n=new i.MeshBasicMaterial({wireframe:true,fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);i.Mesh.call(this,r,n);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};i.PointLightHelper.prototype=Object.create(i.Mesh.prototype);i.PointLightHelper.prototype.constructor=i.PointLightHelper;i.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};i.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};i.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new i.Geometry;for(var r=0;r<this.bones.length;r++){var n=this.bones[r];if(n.parent instanceof i.Bone){t.vertices.push(new i.Vector3);t.vertices.push(new i.Vector3);t.colors.push(new i.Color(0,0,1));t.colors.push(new i.Color(0,1,0))}}t.dynamic=true;var a=new i.LineBasicMaterial({vertexColors:i.VertexColors,depthTest:false,depthWrite:false,transparent:true});i.LineSegments.call(this,t,a);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.update()};i.SkeletonHelper.prototype=Object.create(i.LineSegments.prototype);i.SkeletonHelper.prototype.constructor=i.SkeletonHelper;i.SkeletonHelper.prototype.getBoneList=function(e){var t=[];if(e instanceof i.Bone){t.push(e)}for(var r=0;r<e.children.length;r++){t.push.apply(t,this.getBoneList(e.children[r]))}return t};i.SkeletonHelper.prototype.update=function(){var e=this.geometry;var t=(new i.Matrix4).getInverse(this.root.matrixWorld);var r=new i.Matrix4;var n=0;for(var a=0;a<this.bones.length;a++){var o=this.bones[a];if(o.parent instanceof i.Bone){r.multiplyMatrices(t,o.matrixWorld);e.vertices[n].setFromMatrixPosition(r);r.multiplyMatrices(t,o.parent.matrixWorld);e.vertices[n+1].setFromMatrixPosition(r);n+=2}}e.verticesNeedUpdate=true;e.computeBoundingSphere()};i.SpotLightHelper=function(e){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;var t=new i.CylinderGeometry(0,1,1,8,1,true);t.translate(0,-.5,0);t.rotateX(-Math.PI/2);var r=new i.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new i.Mesh(t,r);this.add(this.cone);this.update()};i.SpotLightHelper.prototype=Object.create(i.Object3D.prototype);i.SpotLightHelper.prototype.constructor=i.SpotLightHelper;i.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};i.SpotLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4;var n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();i.VertexNormalsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16711680;var o=n!==undefined?n:1;var s=0;var h=this.object.geometry;if(h instanceof i.Geometry){s=h.faces.length*3}else if(h instanceof i.BufferGeometry){s=h.attributes.normal.count}var u=new i.BufferGeometry;var l=new i.Float32Attribute(s*2*3,3);u.addAttribute("position",l);i.LineSegments.call(this,u,new i.LineBasicMaterial({color:a,linewidth:o}));this.matrixAutoUpdate=false;this.update()};i.VertexNormalsHelper.prototype=Object.create(i.LineSegments.prototype);i.VertexNormalsHelper.prototype.constructor=i.VertexNormalsHelper;i.VertexNormalsHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function n(){var n=["a","b","c"];this.object.updateMatrixWorld(true);r.getNormalMatrix(this.object.matrixWorld);var a=this.object.matrixWorld;var o=this.geometry.attributes.position;var s=this.object.geometry;if(s instanceof i.Geometry){var h=s.vertices;var u=s.faces;var l=0;for(var c=0,f=u.length;c<f;c++){var d=u[c];for(var p=0,m=d.vertexNormals.length;p<m;p++){var v=h[d[n[p]]];var g=d.vertexNormals[p];e.copy(v).applyMatrix4(a);t.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e);o.setXYZ(l,e.x,e.y,e.z);l=l+1;o.setXYZ(l,t.x,t.y,t.z);l=l+1}}}else if(s instanceof i.BufferGeometry){var y=s.attributes.position;var x=s.attributes.normal;var l=0;for(var p=0,m=y.count;p<m;p++){e.set(y.getX(p),y.getY(p),y.getZ(p)).applyMatrix4(a);t.set(x.getX(p),x.getY(p),x.getZ(p));t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e);o.setXYZ(l,e.x,e.y,e.z);l=l+1;o.setXYZ(l,t.x,t.y,t.z);l=l+1}}o.needsUpdate=true;return this}}();i.WireframeHelper=function(e,t){var r=t!==undefined?t:16777215;i.LineSegments.call(this,new i.WireframeGeometry(e.geometry),new i.LineBasicMaterial({color:r}));this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.WireframeHelper.prototype=Object.create(i.LineSegments.prototype);i.WireframeHelper.prototype.constructor=i.WireframeHelper;i.ImmediateRenderObject=function(){i.Object3D.call(this);this.render=function(e){}};i.ImmediateRenderObject.prototype=Object.create(i.Object3D.prototype);i.ImmediateRenderObject.prototype.constructor=i.ImmediateRenderObject;i.MorphBlendMesh=function(e,t){i.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var r=this.geometry.morphTargets.length;var n="__default";var a=0;var o=r-1;var s=r/1;this.createAnimation(n,a,o,s);this.setAnimationWeight(n,1)};i.MorphBlendMesh.prototype=Object.create(i.Mesh.prototype);i.MorphBlendMesh.prototype.constructor=i.MorphBlendMesh;i.MorphBlendMesh.prototype.createAnimation=function(e,t,r,n){var i={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=i;this.animationsList.push(i)};i.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/;var r,n={};var i=this.geometry;for(var a=0,o=i.morphTargets.length;a<o;a++){var s=i.morphTargets[a];var h=s.name.match(t);if(h&&h.length>1){var u=h[1];if(!n[u])n[u]={start:Infinity,end:-Infinity};var l=n[u];if(a<l.start)l.start=a;if(a>l.end)l.end=a;if(!r)r=u}}for(var u in n){var l=n[u];this.createAnimation(u,l.start,l.end,e)}this.firstAnimation=r};i.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};i.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};i.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];if(r){r.fps=t;r.duration=(r.end-r.start)/r.fps}};i.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];if(r){r.duration=t;r.fps=(r.end-r.start)/r.duration}};i.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];if(r){r.weight=t}};i.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];if(r){r.time=t}};i.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var r=this.animationsMap[e];if(r){t=r.time}return t};i.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var r=this.animationsMap[e];if(r){t=r.duration}return t};i.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")}};i.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};i.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var n=this.animationsList[t];if(!n.active)continue;var a=n.duration/n.length;n.time+=n.direction*e;if(n.mirroredLoop){if(n.time>n.duration||n.time<0){n.direction*=-1;if(n.time>n.duration){n.time=n.duration;n.directionBackwards=true}if(n.time<0){n.time=0;n.directionBackwards=false}}}else{n.time=n.time%n.duration;if(n.time<0)n.time+=n.duration}var o=n.start+i.Math.clamp(Math.floor(n.time/a),0,n.length-1);var s=n.weight;if(o!==n.currentFrame){this.morphTargetInfluences[n.lastFrame]=0;this.morphTargetInfluences[n.currentFrame]=1*s;this.morphTargetInfluences[o]=0;n.lastFrame=n.currentFrame;n.currentFrame=o}var h=n.time%a/a;if(n.directionBackwards)h=1-h;if(n.currentFrame!==n.lastFrame){this.morphTargetInfluences[n.currentFrame]=h*s;this.morphTargetInfluences[n.lastFrame]=(1-h)*s}else{this.morphTargetInfluences[n.currentFrame]=s}}};if(typeof r!=="undefined"){if(typeof t!=="undefined"&&t.exports){r=t.exports=i}r.THREE=i}else{this["THREE"]=i}},{}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function i(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("three");var h=a(s);var u=e("lodash.bindall");var l=a(u);var c=e("raf");var f=a(c);var d=e("brindille-resize");var p=a(d);var m=e("./webgl/config/colors");var v=i(m);var g=e("@superguigui/wagner");var y=a(g);var x=e("./webgl/objects/Structure");var b=a(x);e("./webgl/controls/OrbitControls");var w=e("dat-gui");var _=a(w);var M=e("stats.js");var S=a(M);var T=e("@superguigui/wagner/src/passes/bloom/MultiPassBloomPass");var E=a(T);var C=e("@superguigui/wagner/src/passes/box-blur/BoxBlurPass");var A=a(C);var L=e("@superguigui/wagner/src/passes/fxaa/FXAAPass");var P=a(L);var R=function(){function e(t){o(this,e);console.log("App.constructor()");(0,l["default"])(this,"render","handleResize");this.isAnimate=false;this.passes={usePostProcessing:false,useFXAA:true,useBlur:false,useBloom:true};this.camera=new h["default"].PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e4);this.camera.position.z=1e3;this.scene=new h["default"].Scene;this.scene.fog=new h["default"].Fog(0,500,2e3);this.structure=new b["default"];this.scene.add(this.structure);var r=new h["default"].PointLight(16776396);r.position.set(0,0,0);this.scene.add(r);this.ambientLight=new h["default"].AmbientLight(16777215);this.ambientLight.intensity=22.2;this.ambientLight.color.setHex(16777215);this.scene.add(this.ambientLight);this.renderer=new h["default"].WebGLRenderer({antialias:true});this.renderer.setSize(p["default"].width,p["default"].height);t.appendChild(this.renderer.domElement);this.controls=new h["default"].OrbitControls(this.camera,this.renderer.domElement);this.initPostprocessing();this.addGui();(0,f["default"])(this.render)}n(e,[{key:"addGui",value:function t(){var e=this;this.stats=new S["default"];this.stats.setMode(0);this.stats.domElement.style.position="absolute";this.stats.domElement.style.left="0px";this.stats.domElement.style.top="0px";document.body.appendChild(this.stats.domElement);this.gui=new _["default"].GUI;var t={uniforms:{c:.3,p:2.7}};var r=this.gui.addFolder("Global");r.add(this,"isAnimate");r.add(this.passes,"usePostProcessing");r.add(this.passes,"useFXAA");r.add(this.passes,"useBlur");r.add(this.passes,"useBloom");r.open();var n=this.gui.addFolder("Fog");n.addColor(v,"fogColor").onChange(function(){e.scene.fog.color.setHex(v.fogColor)});n.add(this.scene.fog,"near",0,3e3);n.add(this.scene.fog,"far",100,3e3);var i=this.gui.addFolder("Structure");i.open();i.addColor(v,"particuleColor").onChange(function(){var t=e.structure.particules;for(var r=0;r<t.length;r++){t[r].material.color.setHex(v.particuleColor)}});i.addColor(v,"lineColor").onChange(function(){e.structure.line.material.color.setHex(v.lineColor)})}},{key:"initPostprocessing",value:function r(){this.renderer.autoClearColor=true;this.composer=new y["default"].Composer(this.renderer);this.fxaaPass=new P["default"];this.boxBlurPass=new A["default"](3,3);this.bloomPass=new E["default"]({blurAmount:2,applyZoomBlur:true})}},{key:"handleResize",value:function i(){this.camera.aspect=p["default"].width/p["default"].height;this.camera.updateProjectionMatrix();this.renderer.setSize(p["default"].width,p["default"].height)}},{key:"render",value:function a(){(0,f["default"])(this.render);var e=1e-4*Date.now();this.stats.begin();if(this.isAnimate)this.structure.update(e);if(this.passes.usePostProcessing){this.composer.reset();this.composer.render(this.scene,this.camera);this.composer.toScreen()}else{this.renderer.render(this.scene,this.camera)}this.stats.end()}}]);return e}();r["default"]=R;t.exports=r["default"]},{"./webgl/config/colors":62,"./webgl/controls/OrbitControls":63,"./webgl/objects/Structure":66,"@superguigui/wagner":1,"@superguigui/wagner/src/passes/bloom/MultiPassBloomPass":7,"@superguigui/wagner/src/passes/box-blur/BoxBlurPass":8,"@superguigui/wagner/src/passes/fxaa/FXAAPass":12,"brindille-resize":15,"dat-gui":20,"lodash.bindall":36,raf:51,"stats.js":56,three:59}],61:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=e("domready");var a=n(i);var o=e("./webgl/three/Detector");var s=n(o);var h=e("./App");var u=n(h);var l=undefined;(0,a["default"])(function(){if(s["default"].webgl){console.log(document);l=new u["default"](document.querySelector(".webgl"))}else{}})},{"./App":60,"./webgl/three/Detector":68,domready:35}],62:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=0;r.fogColor=n;var i=2237183;r.lineColor=i;var a=16755200;r.particuleColor=a},{}],63:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=e("three");var a=n(i);(function(){function e(e){this.object=e;this.target=new a["default"].Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=.25;var t=this;var r=1e-6;var n;var i;var o=0;var s=0;var h=1;var u=new a["default"].Vector3;var l=false;this.getPolarAngle=function(){return i};this.getAzimuthalAngle=function(){return n};this.rotateLeft=function(e){s-=e};this.rotateUp=function(e){o-=e};this.panLeft=function(){var e=new a["default"].Vector3;return function t(r){var n=this.object.matrix.elements;e.set(n[0],n[1],n[2]);e.multiplyScalar(-r);u.add(e)}}();this.panUp=function(){var e=new a["default"].Vector3;return function t(r){var n=this.object.matrix.elements;e.set(n[4],n[5],n[6]);e.multiplyScalar(r);u.add(e)}}();this.pan=function(e,r,n,i){if(t.object instanceof a["default"].PerspectiveCamera){var o=t.object.position;var s=o.clone().sub(t.target);var h=s.length();h*=Math.tan(t.object.fov/2*Math.PI/180);t.panLeft(2*e*h/i);t.panUp(2*r*h/i)}else if(t.object instanceof a["default"].OrthographicCamera){t.panLeft(e*(t.object.right-t.object.left)/n);t.panUp(r*(t.object.top-t.object.bottom)/i)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(t.object instanceof a["default"].PerspectiveCamera){h/=e}else if(t.object instanceof a["default"].OrthographicCamera){t.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e));t.object.updateProjectionMatrix();l=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")}};this.dollyOut=function(e){if(t.object instanceof a["default"].PerspectiveCamera){h*=e}else if(t.object instanceof a["default"].OrthographicCamera){t.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e));t.object.updateProjectionMatrix();l=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")}};this.update=function(){var t=new a["default"].Vector3;var c=(new a["default"].Quaternion).setFromUnitVectors(e.up,new a["default"].Vector3(0,1,0));var f=c.clone().inverse();var d=new a["default"].Vector3;var p=new a["default"].Quaternion;return function(){var e=this.object.position;t.copy(e).sub(this.target);t.applyQuaternion(c);n=Math.atan2(t.x,t.z);i=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);n+=s;i+=o;n=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,n));i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i));i=Math.max(r,Math.min(Math.PI-r,i));var a=t.length()*h;a=Math.max(this.minDistance,Math.min(this.maxDistance,a));this.target.add(u);t.x=a*Math.sin(i)*Math.sin(n);t.y=a*Math.cos(i);t.z=a*Math.sin(i)*Math.cos(n);t.applyQuaternion(f);e.copy(this.target).add(t);this.object.lookAt(this.target);if(this.enableDamping===true){s*=1-this.dampingFactor;o*=1-this.dampingFactor}else{s=0;o=0}h=1;u.set(0,0,0);if(l||d.distanceToSquared(this.object.position)>r||8*(1-p.dot(this.object.quaternion))>r){d.copy(this.object.position);p.copy(this.object.quaternion);l=false;return true}return false}}()}a["default"].OrbitControls=function(t,r){var n=new e(t);this.domElement=r!==undefined?r:document;Object.defineProperty(this,"constraint",{get:function D(){return n}});this.getPolarAngle=function(){return n.getPolarAngle()};this.getAzimuthalAngle=function(){return n.getAzimuthalAngle()};this.enabled=true;this.center=this.target;this.enableZoom=true;this.zoomSpeed=1;this.enableRotate=true;this.rotateSpeed=1;this.enablePan=true;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.enableKeys=true;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:a["default"].MOUSE.LEFT,ZOOM:a["default"].MOUSE.MIDDLE,PAN:a["default"].MOUSE.RIGHT};var i=this;var o=new a["default"].Vector2;var s=new a["default"].Vector2;var h=new a["default"].Vector2;var u=new a["default"].Vector2;var l=new a["default"].Vector2;var c=new a["default"].Vector2;var f=new a["default"].Vector2;var d=new a["default"].Vector2;var p=new a["default"].Vector2;var m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var v=m.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;var g={type:"change"};var y={type:"start"};var x={type:"end"};function b(e,t){var r=i.domElement===document?i.domElement.body:i.domElement;n.pan(e,t,r.clientWidth,r.clientHeight)}this.update=function(){if(this.autoRotate&&v===m.NONE){n.rotateLeft(w())}if(n.update()===true){this.dispatchEvent(g)}};this.reset=function(){v=m.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent(g);this.update()};function w(){return 2*Math.PI/60/60*i.autoRotateSpeed}function _(){return Math.pow(.95,i.zoomSpeed)}function M(e){if(i.enabled===false)return;e.preventDefault();if(e.button===i.mouseButtons.ORBIT){if(i.enableRotate===false)return;v=m.ROTATE;o.set(e.clientX,e.clientY)}else if(e.button===i.mouseButtons.ZOOM){if(i.enableZoom===false)return;v=m.DOLLY;f.set(e.clientX,e.clientY)}else if(e.button===i.mouseButtons.PAN){if(i.enablePan===false)return;v=m.PAN;u.set(e.clientX,e.clientY)}if(v!==m.NONE){document.addEventListener("mousemove",S,false);document.addEventListener("mouseup",T,false);i.dispatchEvent(y)}}function S(e){if(i.enabled===false)return;e.preventDefault();var t=i.domElement===document?i.domElement.body:i.domElement;if(v===m.ROTATE){if(i.enableRotate===false)return;s.set(e.clientX,e.clientY);h.subVectors(s,o);n.rotateLeft(2*Math.PI*h.x/t.clientWidth*i.rotateSpeed);n.rotateUp(2*Math.PI*h.y/t.clientHeight*i.rotateSpeed);o.copy(s)}else if(v===m.DOLLY){if(i.enableZoom===false)return;d.set(e.clientX,e.clientY);p.subVectors(d,f);if(p.y>0){n.dollyIn(_())}else if(p.y<0){n.dollyOut(_())}f.copy(d)}else if(v===m.PAN){if(i.enablePan===false)return;l.set(e.clientX,e.clientY);c.subVectors(l,u);b(c.x,c.y);u.copy(l)}if(v!==m.NONE)i.update()}function T(){if(i.enabled===false)return;document.removeEventListener("mousemove",S,false);document.removeEventListener("mouseup",T,false);i.dispatchEvent(x);v=m.NONE}function E(e){if(i.enabled===false||i.enableZoom===false||v!==m.NONE)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta!==undefined){t=e.wheelDelta}else if(e.detail!==undefined){t=-e.detail}if(t>0){n.dollyOut(_())}else if(t<0){n.dollyIn(_())}i.update();i.dispatchEvent(y);i.dispatchEvent(x)}function C(e){if(i.enabled===false||i.enableKeys===false||i.enablePan===false)return;switch(e.keyCode){case i.keys.UP:b(0,i.keyPanSpeed);i.update();break;case i.keys.BOTTOM:b(0,-i.keyPanSpeed);i.update();break;case i.keys.LEFT:b(i.keyPanSpeed,0);i.update();break;case i.keys.RIGHT:b(-i.keyPanSpeed,0);i.update();break}}function A(e){if(i.enabled===false)return;switch(e.touches.length){case 1:if(i.enableRotate===false)return;v=m.TOUCH_ROTATE;o.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(i.enableZoom===false)return;v=m.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var n=Math.sqrt(t*t+r*r);f.set(0,n);break;case 3:if(i.enablePan===false)return;v=m.TOUCH_PAN;u.set(e.touches[0].pageX,e.touches[0].pageY);break;default:v=m.NONE}if(v!==m.NONE)i.dispatchEvent(y)}function L(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();var t=i.domElement===document?i.domElement.body:i.domElement;switch(e.touches.length){case 1:if(i.enableRotate===false)return;if(v!==m.TOUCH_ROTATE)return;s.set(e.touches[0].pageX,e.touches[0].pageY);h.subVectors(s,o);n.rotateLeft(2*Math.PI*h.x/t.clientWidth*i.rotateSpeed);n.rotateUp(2*Math.PI*h.y/t.clientHeight*i.rotateSpeed);o.copy(s);i.update();break;case 2:if(i.enableZoom===false)return;if(v!==m.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX;var a=e.touches[0].pageY-e.touches[1].pageY;var g=Math.sqrt(r*r+a*a);d.set(0,g);p.subVectors(d,f);if(p.y>0){n.dollyOut(_())}else if(p.y<0){n.dollyIn(_())}f.copy(d);i.update();break;case 3:if(i.enablePan===false)return;if(v!==m.TOUCH_PAN)return;l.set(e.touches[0].pageX,e.touches[0].pageY);c.subVectors(l,u);b(c.x,c.y);u.copy(l);i.update();break;default:v=m.NONE}}function P(){if(i.enabled===false)return;i.dispatchEvent(x);v=m.NONE}function R(e){e.preventDefault()}this.dispose=function(){this.domElement.removeEventListener("contextmenu",R,false);this.domElement.removeEventListener("mousedown",M,false);this.domElement.removeEventListener("mousewheel",E,false);this.domElement.removeEventListener("DOMMouseScroll",E,false);this.domElement.removeEventListener("touchstart",A,false);this.domElement.removeEventListener("touchend",P,false);this.domElement.removeEventListener("touchmove",L,false);document.removeEventListener("mousemove",S,false);document.removeEventListener("mouseup",T,false);window.removeEventListener("keydown",C,false)};this.domElement.addEventListener("contextmenu",R,false);this.domElement.addEventListener("mousedown",M,false);this.domElement.addEventListener("mousewheel",E,false);this.domElement.addEventListener("DOMMouseScroll",E,false);this.domElement.addEventListener("touchstart",A,false);this.domElement.addEventListener("touchend",P,false);this.domElement.addEventListener("touchmove",L,false);window.addEventListener("keydown",C,false);this.update()};a["default"].OrbitControls.prototype=Object.create(a["default"].EventDispatcher.prototype);a["default"].OrbitControls.prototype.constructor=a["default"].OrbitControls;Object.defineProperties(a["default"].OrbitControls.prototype,{object:{get:function t(){return this.constraint.object}},target:{get:function r(){return this.constraint.target},set:function n(e){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead.");this.constraint.target.copy(e)}},minDistance:{get:function i(){return this.constraint.minDistance},set:function o(e){this.constraint.minDistance=e}},maxDistance:{get:function s(){return this.constraint.maxDistance},set:function h(e){this.constraint.maxDistance=e}},minZoom:{get:function u(){return this.constraint.minZoom},set:function l(e){this.constraint.minZoom=e}},maxZoom:{get:function c(){return this.constraint.maxZoom},set:function f(e){this.constraint.maxZoom=e}},minPolarAngle:{get:function d(){return this.constraint.minPolarAngle},set:function p(e){this.constraint.minPolarAngle=e}},maxPolarAngle:{get:function m(){return this.constraint.maxPolarAngle},set:function v(e){this.constraint.maxPolarAngle=e}},minAzimuthAngle:{get:function g(){return this.constraint.minAzimuthAngle},set:function y(e){this.constraint.minAzimuthAngle=e}},maxAzimuthAngle:{get:function x(){return this.constraint.maxAzimuthAngle},set:function b(e){this.constraint.maxAzimuthAngle=e}},enableDamping:{get:function w(){return this.constraint.enableDamping},set:function _(e){this.constraint.enableDamping=e}},dampingFactor:{get:function M(){return this.constraint.dampingFactor},set:function S(e){this.constraint.dampingFactor=e}},noZoom:{get:function T(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function E(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!e}},noRotate:{get:function C(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function A(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!e}},noPan:{get:function L(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function P(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!e}},noKeys:{get:function R(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function D(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!e}},staticMoving:{get:function k(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.constraint.enableDamping},set:function F(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function O(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.constraint.dampingFactor},set:function U(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.constraint.dampingFactor=e}}})})()},{three:59}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();var i=function g(e,t,r){var n=true;e:while(n){var i=e,a=t,o=r;s=h=u=undefined;n=false;if(i===null)i=Function.prototype;var s=Object.getOwnPropertyDescriptor(i,a);if(s===undefined){var h=Object.getPrototypeOf(i);if(h===null){return undefined}else{e=h;t=a;r=o;n=true;continue e}}else if("value"in s){return s.value}else{var u=s.get;if(u===undefined){return undefined}return u.call(o)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=e("three");var u=a(h);var l=e("three-simplicial-complex");var c=a(l);var f=e("delaunay-triangulate");var d=a(f);var p=e("simplicial-complex");var m=a(p);var v=function(e){s(t,e);function t(e){o(this,t);i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.points=e;this.triangles=(0,d["default"])(this.points);this.sc={positions:this.points,cells:m["default"].unique(m["default"].skeleton(this.triangles,3))};this.cpl=(0,c["default"])(u["default"]);this.complex=this.cpl(this.sc);this.material=new u["default"].MeshLambertMaterial({color:2237183,wireframe:true,fog:true,wireframeLinewidth:2});this.mesh=new u["default"].Mesh(this.complex,this.material);this.add(this.mesh)}n(t,[{key:"update",value:function r(e,t){this.points=e;if(t){this.triangles=m["default"].unique(m["default"].skeleton((0,d["default"])(this.points),3))}this.sc={positions:this.points,cells:this.triangles};this.complex=this.cpl(this.sc);this.mesh.geometry=this.complex}}]);return t}(u["default"].Object3D);r["default"]=v;t.exports=r["default"]},{"delaunay-triangulate":34,"simplicial-complex":55,three:59,"three-simplicial-complex":57}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function l(e,t,r){var n=true;e:while(n){var i=e,a=t,o=r;s=h=u=undefined;n=false;if(i===null)i=Function.prototype;var s=Object.getOwnPropertyDescriptor(i,a);if(s===undefined){var h=Object.getPrototypeOf(i);if(h===null){return undefined}else{e=h;t=a;r=o;n=true;continue e}}else if("value"in s){return s.value}else{var u=s.get;if(u===undefined){return undefined}return u.call(o)}}};function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("three");var h=i(s);var u=function(e){o(t,e);function t(){a(this,t);n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var e=new h["default"].SphereGeometry(2,64,64);this.material=new h["default"].MeshLambertMaterial({color:16755200});this.mesh=new h["default"].Mesh(e,this.material);this.add(this.mesh);var r=new h["default"].MeshLambertMaterial({color:16755200,transparent:true,fog:true,opacity:.2});this.glow=new h["default"].Mesh(this.mesh.geometry.clone(),r.clone());this.glow.positions=this.mesh.positions;this.glow.scale.multiplyScalar(1.4);this.add(this.glow)}return t}(h["default"].Object3D);r["default"]=u;t.exports=r["default"]},{three:59}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();var i=function m(e,t,r){var n=true;e:while(n){var i=e,a=t,o=r;s=h=u=undefined;n=false;if(i===null)i=Function.prototype;var s=Object.getOwnPropertyDescriptor(i,a);if(s===undefined){var h=Object.getPrototypeOf(i);if(h===null){return undefined}else{e=h;t=a;r=o;n=true;continue e}}else if("value"in s){return s.value}else{var u=s.get;if(u===undefined){return undefined}return u.call(o);
}}};function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=e("three");var u=a(h);e("../shaders/FresnelShader");var l=e("./Particule");var c=a(l);var f=e("./Line");var d=a(f);var p=function(e){s(t,e);function t(){o(this,t);i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.particules=[];this.positions=[];this.interval=.1;this.startT=1e-4*Date.now();for(var e=0;e<50;e++){this.particule=new c["default"];this.particule.position.x=Math.random()*2-1;this.particule.position.y=Math.random()*2-1;this.particule.position.z=Math.random()*2-1;this.particule.position.normalize();this.particule.position.multiplyScalar(Math.random()*10+850);this.particule.scale.set(10,10,10);this.positions[e]=[this.particule.position.x,this.particule.position.y,this.particule.position.z];this.add(this.particule);this.particules.push(this.particule)}this.line=new d["default"](this.positions);this.add(this.line)}n(t,[{key:"update",value:function r(e){for(var t=0;t<this.particules.length;t++){var r=this.particules[t];r.position.x=650*Math.cos(e+t);r.position.z=650*Math.sin(e+t*1.1);this.positions[t]=[r.position.x,r.position.y,r.position.z]}console.log(e-this.startT+"ms elapsed");if(e-this.startT>=this.interval){console.log("ok");this.line.update(this.positions,true);this.startT=e}else{this.line.update(this.positions)}}}]);return t}(u["default"].Object3D);r["default"]=p;t.exports=r["default"]},{"../shaders/FresnelShader":67,"./Line":64,"./Particule":65,three:59}],67:[function(e,t,r){"use strict";var n=e("three");n.FresnelShader={uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")}},{three:59}],68:[function(e,t,r){"use strict";var n={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch(t){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function i(){var e=document.createElement("div");e.id="webgl-error-message";e.style.fontFamily="monospace";e.style.fontSize="13px";e.style.fontWeight="normal";e.style.textAlign="center";e.style.background="#fff";e.style.color="#000";e.style.padding="1.5em";e.style.width="400px";e.style.margin="5em auto 0";if(!this.webgl){e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")}return e},addGetWebGLMessage:function a(e){var t,r,i;e=e||{};t=e.parent!==undefined?e.parent:document.body;r=e.id!==undefined?e.id:"oldie";i=n.getWebGLErrorMessage();i.id=r;t.appendChild(i)}};if(typeof t==="object"){t.exports=n}},{}]},{},[61]);
